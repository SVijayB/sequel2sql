[
  {
    "query_idx": 0,
    "db_id": "financial",
    "sql_snippet": "SELECT account_id, MAX(payments) AS max_payment, M...",
    "valid": true,
    "error": null,
    "duration_ms": 17.75503158569336,
    "input_sql_tokens": 55,
    "estimated_tokens": 139,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT account_id, MAX(payments) AS max_payment, MIN(payments) AS min_payment FROM loan GROUP BY account_id HAVING COUNT(account_id) > 1 AND (MAX(payments) - MIN(payments)) > 2;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.057,
        "pattern_signature": "SELECT-FROM-GROUP-HAVING",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 5
      }
    }
  },
  {
    "query_idx": 1,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT CreationDate::time FROM comments;",
    "valid": true,
    "error": null,
    "duration_ms": 1.0499954223632812,
    "input_sql_tokens": 9,
    "estimated_tokens": 98,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT CreationDate::time FROM comments;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 2,
    "db_id": "financial",
    "sql_snippet": "CREATE OR REPLACE FUNCTION total_loans()\n    RETUR...",
    "valid": true,
    "error": null,
    "duration_ms": 2.0143985748291016,
    "input_sql_tokens": 94,
    "estimated_tokens": 182,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION total_loans()\n    RETURNS TRIGGER\n    AS $$\n    BEGIN\n        UPDATE loan_summary\n        SET total_loan_count = (SELECT COUNT(CASE WHEN status = 'A' THEN 1 END) FROM loan WHERE loan_summary.account_id = loan.account_id) WHERE account_id = NEW.account_id; RETURN NEW;\n    END;\n    $$ LANGUAGE plpgsql;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 3,
    "db_id": "financial",
    "sql_snippet": "CREATE TRIGGER tr_total_loans AFTER UPDATE OF stat...",
    "valid": true,
    "error": null,
    "duration_ms": 1.3248920440673828,
    "input_sql_tokens": 23,
    "estimated_tokens": 90,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TRIGGER tr_total_loans AFTER UPDATE OF status FOR EACH ROW EXECUTE PROCEDURE total_loans();",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 4,
    "db_id": "student_club",
    "sql_snippet": "CREATE UNIQUE INDEX unique_name ON event(event_nam...",
    "valid": true,
    "error": null,
    "duration_ms": 2.5458335876464844,
    "input_sql_tokens": 47,
    "estimated_tokens": 117,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE UNIQUE INDEX unique_name ON event(event_name, event_date) where event_name is not null;CREATE UNIQUE INDEX unique_location ON event(location, event_date) where location is not null;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "WHERE",
        "clauses_present": [
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 5,
    "db_id": "debit_card_specializing",
    "sql_snippet": "UPDATE transactions_1k\n    SET Amount = 100\n    FR...",
    "valid": true,
    "error": null,
    "duration_ms": 4.42957878112793,
    "input_sql_tokens": 65,
    "estimated_tokens": 176,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "UPDATE transactions_1k\n    SET Amount = 100\n    FROM ( SELECT TransactionID FROM transactions_1k WHERE Amount = 50 ORDER BY Date LIMIT 100 FOR UPDATE ) sub\n    WHERE transactions_1k.TransactionID = sub.TransactionID RETURNING *;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.1,
        "pattern_signature": "SELECT-FROM-WHERE-ORDER-LIMIT-LOCKING-UPDATE-RETURNING-SUBQUERY",
        "clauses_present": [
          "FROM",
          "LIMIT",
          "LOCKING",
          "ORDER",
          "RETURNING",
          "SELECT",
          "SUBQUERY",
          "UPDATE",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 6,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT users.Id, COUNT(posts.Id) as answered FROM ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.3495426177978516,
    "input_sql_tokens": 38,
    "estimated_tokens": 139,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT users.Id, COUNT(posts.Id) as answered FROM users LEFT JOIN posts ON users.Id = posts.OwnerUserId GROUP BY users.Id ORDER BY answered DESC;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.051000000000000004,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 7,
    "db_id": "codebase_community",
    "sql_snippet": "DROP TABLE IF EXISTS users;",
    "valid": true,
    "error": null,
    "duration_ms": 1.0151863098144531,
    "input_sql_tokens": 7,
    "estimated_tokens": 91,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DROP TABLE IF EXISTS users;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 8,
    "db_id": "student_club",
    "sql_snippet": "SELECT  ARRAY_AGG(DISTINCT u.id) AS ids, ARRAY_AGG...",
    "valid": true,
    "error": null,
    "duration_ms": 6.21485710144043,
    "input_sql_tokens": 109,
    "estimated_tokens": 195,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT  ARRAY_AGG(DISTINCT u.id) AS ids, ARRAY_AGG(DISTINCT u.username) AS usernames, ARRAY_AGG(DISTINCT u.ref1) AS refs1, ARRAY_AGG(DISTINCT u.ref2) AS refs2,  COUNT(DISTINCT a.id) AS asset_count FROM assets a JOIN users u ON a.owner = u.ref1 OR a.owner = u.ref2 GROUP BY a.owner ORDER BY MIN(a.id);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.091,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 6
      }
    }
  },
  {
    "query_idx": 9,
    "db_id": "student_club",
    "sql_snippet": "WITH CTE AS ( SELECT link_to_event, COUNT(link_to_...",
    "valid": true,
    "error": null,
    "duration_ms": 7.465839385986328,
    "input_sql_tokens": 83,
    "estimated_tokens": 177,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH CTE AS ( SELECT link_to_event, COUNT(link_to_member) AS count FROM attendance GROUP BY link_to_event ) SELECT CTE.link_to_event, CTE.count AS newCount, budget.count AS oldCount FROM budget JOIN CTE ON budget.link_to_event = CTE.link_to_event WHERE budget.count != CTE.count;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.112,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 10,
    "db_id": "student_club",
    "sql_snippet": "INSERT INTO attendance VALUES ('recEVTik3MlqbvLFi'...",
    "valid": true,
    "error": null,
    "duration_ms": 2.0134449005126953,
    "input_sql_tokens": 34,
    "estimated_tokens": 123,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO attendance VALUES ('recEVTik3MlqbvLFi', 'rec280Sk7o31iG0Tx', 1)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 11,
    "db_id": "financial",
    "sql_snippet": "UPDATE account\n    SET date__timestamp = date__big...",
    "valid": true,
    "error": null,
    "duration_ms": 2.25067138671875,
    "input_sql_tokens": 16,
    "estimated_tokens": 102,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "UPDATE account\n    SET date__timestamp = date__bigint::timestamp;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UPDATE",
        "clauses_present": [
          "UPDATE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 12,
    "db_id": "card_games",
    "sql_snippet": "SELECT * FROM cards GROUP BY artist;",
    "valid": true,
    "error": null,
    "duration_ms": 2.016305923461914,
    "input_sql_tokens": 9,
    "estimated_tokens": 102,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM cards GROUP BY artist;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 13,
    "db_id": "debit_card_specializing",
    "sql_snippet": "IF SELECT * FROM transactions_1k WHERE CustomerID ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.008676528930664,
    "input_sql_tokens": 67,
    "estimated_tokens": 135,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "IF SELECT * FROM transactions_1k WHERE CustomerID = 3 AND Date = '2012-08-24' RETURNS NO ROWS\nTHEN SELECT * FROM transactions_1k WHERE CustomerID = 7626 AND Date = '2012-08-24'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 14,
    "db_id": "financial",
    "sql_snippet": "SELECT 'SELECT ' || array_to_string(ARRAY(SELECT '...",
    "valid": true,
    "error": null,
    "duration_ms": 4.826545715332031,
    "input_sql_tokens": 79,
    "estimated_tokens": 175,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT 'SELECT ' || array_to_string(ARRAY(SELECT 'o' || '.' || c.column_name\n    FROM information_schema.columns As c\n        WHERE table_name = 'account'\n        AND  c.column_name NOT IN('account_id', 'date')\n), ',') || ' FROM accountAs o' As sqlstmt",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.027000000000000003,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 15,
    "db_id": "financial",
    "sql_snippet": "(\n  SELECT\n    account.account_id,\n    account.fre...",
    "valid": true,
    "error": null,
    "duration_ms": 8.77690315246582,
    "input_sql_tokens": 205,
    "estimated_tokens": 320,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "(\n  SELECT\n    account.account_id,\n    account.frequency,\n    l.loan_id,\n    l.date AS loan_date,\n    0 AS priority\n  FROM account\n  LEFT JOIN loan l\n    ON account.account_id = l.account_id\n  WHERE account.district_id = '18'\n    AND l.date >= (NOW() - INTERVAL '48 hours')\n  ORDER BY l.date DESC NULLS LAST\n  LIMIT 6\n)\nUNION\n(\n  SELECT\n    account.account_id,\n    account.frequency,\n    l.loan_id,\n    l.date AS loan_date,\n    1 AS priority\n  FROM account\n  LEFT JOIN loan l\n    ON account.account_id = l.account_id\n  WHERE account.district_id = '18'\n  ORDER BY account.date DESC\n);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.202,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-UNION-ORDER-LIMIT-SUBQUERY",
        "clauses_present": [
          "FROM",
          "JOIN",
          "LIMIT",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 16,
    "db_id": "student_club",
    "sql_snippet": "SELECT Array_agg(rw) FROM (SELECT link_to_event, (...",
    "valid": true,
    "error": null,
    "duration_ms": 4.993200302124023,
    "input_sql_tokens": 72,
    "estimated_tokens": 160,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT Array_agg(rw) FROM (SELECT link_to_event, (SELECT To_(Array_agg(Row_to_(t))) FROM (SELECT link_to_member FROM public.attendance WHERE link_to_event = b.link_to_event) t) rw FROM attendance b GROUP BY link_to_event);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.257,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 3,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 17,
    "db_id": "financial",
    "sql_snippet": "SELECT to_char(generate_series, 'YYYY') FROM gener...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 123.\n  rate_series, 'YYYY') FROM generate_series(MIN(date)::timestamptz, MAX(date)::timestamptz, '1 year') \u001b[4mFROM\u001b[0m loan;",
    "duration_ms": 10.09511947631836,
    "input_sql_tokens": 41,
    "estimated_tokens": 177,
    "error_tokens": 64,
    "invalid_sql_tokens": 41,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 123.\n  rate_series, 'YYYY') FROM generate_series(MIN(date)::timestamptz, MAX(date)::timestamptz, '1 year') \u001b[4mFROM\u001b[0m loan;",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT to_char(generate_series, 'YYYY') FROM generate_series(MIN(date)::timestamptz, MAX(date)::timestamptz, '1 year') FROM loan;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 18,
    "db_id": "financial",
    "sql_snippet": "SELECT account_id, amount FROM (SELECT account_id,...",
    "valid": true,
    "error": null,
    "duration_ms": 3.8824081420898438,
    "input_sql_tokens": 45,
    "estimated_tokens": 151,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT account_id, amount FROM (SELECT account_id, amount, ROW_NUMBER() OVER(PARTITION BY account_id ORDER BY amount DESC) AS rn FROM loan) AS a WHERE rn = 1;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09300000000000003,
        "pattern_signature": "SELECT-FROM-WHERE-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 19,
    "db_id": "financial",
    "sql_snippet": "CREATE TABLE client_information ( client_id smalls...",
    "valid": true,
    "error": null,
    "duration_ms": 5.031585693359375,
    "input_sql_tokens": 70,
    "estimated_tokens": 154,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TABLE client_information ( client_id smallserial NOT NULL, first_name character varying(50), last_name character varying(50), full_name character varying(100) GENERATED ALWAYS AS (concat(first_name, ' ', last_name)) STORED, PRIMARY KEY (client_id) );",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 20,
    "db_id": "card_games",
    "sql_snippet": "INSERT INTO cards(uuid, name) VALUES ('5f8287b1-5b...",
    "valid": true,
    "error": null,
    "duration_ms": 2.949953079223633,
    "input_sql_tokens": 61,
    "estimated_tokens": 158,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO cards(uuid, name) VALUES ('5f8287b1-5bb6-5f4c-ad17-316a40d5bb0c', 'Ancestor''s Chosen') ON CONFLICT DO NOTHING RETURNING id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT-RETURNING",
        "clauses_present": [
          "INSERT",
          "RETURNING",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 21,
    "db_id": "financial",
    "sql_snippet": "INSERT INTO account (account_id, district_id, freq...",
    "valid": true,
    "error": null,
    "duration_ms": 4.899501800537109,
    "input_sql_tokens": 53,
    "estimated_tokens": 142,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO account (account_id, district_id, frequency, date) VALUES (1, 18, 'POPLATEK MESICNE', CURRENT_DATE) ON CONFLICT (account_id) DO UPDATE SET date = CURRENT_DATE",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 22,
    "db_id": "card_games",
    "sql_snippet": "SELECT COUNT(*) -1 AS count, MAX(releaseDate), MIN...",
    "valid": true,
    "error": null,
    "duration_ms": 6.042957305908203,
    "input_sql_tokens": 77,
    "estimated_tokens": 189,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT COUNT(*) -1 AS count, MAX(releaseDate), MIN(releaseDate) FROM (SELECT *, date(releaseDate) - row_number() OVER (PARTITION BY releaseDate ORDER BY date(releaseDate)) * INTERVAL '1 day' AS filter FROM sets_releaseInfo ) t1 GROUP BY filter HAVING COUNT(*) -1 > 0 ORDER BY count DESC",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11700000000000002,
        "pattern_signature": "SELECT-FROM-GROUP-HAVING-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 23,
    "db_id": "card_games",
    "sql_snippet": "WITH RECURSIVE path_cte AS (SELECT id, nextCardId,...",
    "valid": true,
    "error": null,
    "duration_ms": 8.605718612670898,
    "input_sql_tokens": 85,
    "estimated_tokens": 183,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE path_cte AS (SELECT id, nextCardId, id::TEXT AS Path FROM collection WHERE nextCardId IS NULL UNION ALL SELECT collection.id, collection.nextCardId, collection.id || ' --> ' || cte.Path FROM collection JOIN path_cte cte ON collection.nextCardId = cte.id) SELECT Path FROM path_cte ORDER BY id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.096,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-UNION-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 24,
    "db_id": "financial",
    "sql_snippet": "SELECT EXTRACT(QUARTER FROM TIMESTAMP '2001-02-16 ...",
    "valid": true,
    "error": null,
    "duration_ms": 1.0004043579101562,
    "input_sql_tokens": 30,
    "estimated_tokens": 98,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT EXTRACT(QUARTER FROM TIMESTAMP '2001-02-16 20:38:40');",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "SELECT",
        "clauses_present": [
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 25,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT (select r.relname from pg_class r where r.o...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 83.\n  SELECT (select r.relname from pg_class r where r.oid = c.confrelid) as base_table,\u001b[4m\\\u001b[0mn       a.attname as base_col,\\n       (select r.relname from pg_class r where r.oid = c.conrelid) a",
    "duration_ms": 7.688283920288086,
    "input_sql_tokens": 201,
    "estimated_tokens": 363,
    "error_tokens": 91,
    "invalid_sql_tokens": 201,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 83.\n  SELECT (select r.relname from pg_class r where r.oid = c.confrelid) as base_table,\u001b[4m\\\u001b[0mn       a.attname as base_col,\\n       (select r.relname from pg_class r where r.oid = c.conrelid) a",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT (select r.relname from pg_class r where r.oid = c.confrelid) as base_table,\\n       a.attname as base_col,\\n       (select r.relname from pg_class r where r.oid = c.conrelid) as referencing_table,\\n       UNNEST((select array_agg(attname) from pg_attribute where attrelid = c.conrelid and array[attnum] <@ c.conkey)) as referencing_col,\\n       pg_get_constraintdef(c.oid) contraint_sql  FROM pg_constraint c join pg_attribute a on c.confrelid=a.attrelid and a.attnum = ANY(confkey)\\n WHERE c.confrelid = (select oid from pg_class where relname = 'users')\\n   AND c.confrelid!=c.conrelid;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 26,
    "db_id": "financial",
    "sql_snippet": "SELECT first_value(bank ignore nulls) over (partit...",
    "valid": true,
    "error": null,
    "duration_ms": 2.002239227294922,
    "input_sql_tokens": 32,
    "estimated_tokens": 114,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT first_value(bank ignore nulls) over (partition by account_id order by date rows unbounded following) as next_bank FROM trans;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 27,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT team_api_id, team_short_name FROM Team as d...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0145645141601562,
    "input_sql_tokens": 77,
    "estimated_tokens": 165,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT team_api_id, team_short_name FROM Team as data FULL OUTER JOIN (SELECT buildUpPlaySpeed, team_api_id FROM Team_Attributes ta WHERE team_api_id = data.team_api_id) AS subquery_alias ON data.team_api_id = subquery_alias.team_api_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.128,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 28,
    "db_id": "financial",
    "sql_snippet": "WITH one AS ( SELECT date_trunc('year', date) as t...",
    "valid": false,
    "error": "The number of provided arguments (2) is greater than the maximum number of supported arguments (1). Line 1, Col: 270.\n  NT(*) as loan_count FROM loan ORDER BY timeTwo ) SELECT timeOne as year, SUM(trans_count, loan_count\u001b[4m)\u001b[0m as count FROM one, two ORDER BY 1;",
    "duration_ms": 8.916378021240234,
    "input_sql_tokens": 87,
    "estimated_tokens": 243,
    "error_tokens": 82,
    "invalid_sql_tokens": 87,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "The number of provided arguments (2) is greater than the maximum number of supported arguments (1). Line 1, Col: 270.\n  NT(*) as loan_count FROM loan ORDER BY timeTwo ) SELECT timeOne as year, SUM(trans_count, loan_count\u001b[4m)\u001b[0m as count FROM one, two ORDER BY 1;",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "WITH one AS ( SELECT date_trunc('year', date) as timeOne, COUNT(*) as trans_count FROM trans ORDER BY timeOne ), two AS ( SELECT date_trunc('year', date) as timeTwo, COUNT(*) as loan_count FROM loan ORDER BY timeTwo ) SELECT timeOne as year, SUM(trans_count, loan_count) as count FROM one, two ORDER BY 1;",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 29,
    "db_id": "debit_card_specializing",
    "sql_snippet": "WITH gen_transactions AS ( SELECT CustomerID, Amou...",
    "valid": true,
    "error": null,
    "duration_ms": 4.013776779174805,
    "input_sql_tokens": 60,
    "estimated_tokens": 188,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH gen_transactions AS ( SELECT CustomerID, Amount FROM transactions_1k CROSS JOIN LATERAL generate_series(1, CAST(Amount AS INTEGER)) ) SELECT CustomerID, Amount, ROW_NUMBER() OVER (ORDER BY random()) AS rn FROM gen_transactions LIMIT 5;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08900000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_CROSS-LATERAL-WINDOW-ORDER-LIMIT",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "LATERAL",
          "LIMIT",
          "ORDER",
          "SELECT",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 30,
    "db_id": "card_games",
    "sql_snippet": "INSERT INTO card_information(price) SELECT jsonb_a...",
    "valid": true,
    "error": null,
    "duration_ms": 2.656698226928711,
    "input_sql_tokens": 37,
    "estimated_tokens": 135,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO card_information(price) SELECT jsonb_agg(price) FROM (SELECT price FROM card_information) AS subquery;SELECT * FROM card_information;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08600000000000002,
        "pattern_signature": "SELECT-FROM-INSERT-SUBQUERY",
        "clauses_present": [
          "FROM",
          "INSERT",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 31,
    "db_id": "financial",
    "sql_snippet": "SELECT t.k_symbol, t.operation, t.amount, t.balanc...",
    "valid": true,
    "error": null,
    "duration_ms": 4.569053649902344,
    "input_sql_tokens": 68,
    "estimated_tokens": 177,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT t.k_symbol, t.operation, t.amount, t.balance, a.frequency FROM trans t INNER JOIN account a ON t.account_id = a.account_id WHERE t.account_id = 1 AND t.type = 'PRIJEM' GROUP BY t.k_symbol",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.062000000000000006,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 32,
    "db_id": "card_games",
    "sql_snippet": "SELECT user_id, COUNT(*) AS num_consecutive_months...",
    "valid": true,
    "error": null,
    "duration_ms": 10.526895523071289,
    "input_sql_tokens": 200,
    "estimated_tokens": 310,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT user_id, COUNT(*) AS num_consecutive_months FROM (SELECT user_id, purchase_date, DATE_TRUNC('month', TO_DATE(purchase_date || '-01', 'YYYY-MM-DD')) AS month_date, ROW_NUMBER() OVER(PARTITION BY user_id ORDER BY DATE_TRUNC('month', TO_DATE(purchase_date || '-01', 'YYYY-MM-DD'))) - ROW_NUMBER() OVER(PARTITION BY user_id, DATE_TRUNC('month', TO_DATE(purchase_date || '-01', 'YYYY-MM-DD')) - INTERVAL '1 month' * ROW_NUMBER() OVER(PARTITION BY user_id ORDER BY DATE_TRUNC('month', TO_DATE(purchase_date || '-01', 'YYYY-MM-DD')))) AS grp FROM purchase) sub GROUP BY user_id, grp ORDER BY COUNT(*) DESC LIMIT 1;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09800000000000002,
        "pattern_signature": "SELECT-FROM-GROUP-WINDOW-ORDER-LIMIT-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "LIMIT",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 33,
    "db_id": "financial",
    "sql_snippet": "WITH tab_with_cardid AS (\n   select split(cardid, ...",
    "valid": false,
    "error": "Expecting ). Line 8, Col: 71.\n  ma.table\n), ranked_visits AS (\n    SELECT *, ROW_NUMBER() OVER(PARTITION BY CONCAT(ivm_arr[2],item) \u001b[4mas\u001b[0m temp ORDER BY type) AS rn\n    FROM tab_with_cardid\n)\nSELECT cardid, pure_cardid\nFROM ranked_visits\n",
    "duration_ms": 13.5040283203125,
    "input_sql_tokens": 117,
    "estimated_tokens": 298,
    "error_tokens": 91,
    "invalid_sql_tokens": 117,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unbalanced_tokens",
          "message": "Expecting ). Line 8, Col: 71.\n  ma.table\n), ranked_visits AS (\n    SELECT *, ROW_NUMBER() OVER(PARTITION BY CONCAT(ivm_arr[2],item) \u001b[4mas\u001b[0m temp ORDER BY type) AS rn\n    FROM tab_with_cardid\n)\nSELECT cardid, pure_cardid\nFROM ranked_visits\n",
          "location": null,
          "context": "Parser reported expecting parenthesis",
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "WITH tab_with_cardid AS (\n   select split(cardid, '-', 3)ivm_arr,\n\n           type,\n           last_refresh_date\n    FROM db.scema.table\n), ranked_visits AS (\n    SELECT *, ROW_NUMBER() OVER(PARTITION BY CONCAT(ivm_arr[2],item) as temp ORDER BY type) AS rn\n    FROM tab_with_cardid\n)\nSELECT cardid, pure_cardid\nFROM ranked_visits\nWHERE rn = 1",
      "tags": [
        "syntax_unbalanced_tokens"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 34,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT player_api_id, MAX(date), FIRST(overall_rat...",
    "valid": true,
    "error": null,
    "duration_ms": 2.2606849670410156,
    "input_sql_tokens": 34,
    "estimated_tokens": 131,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT player_api_id, MAX(date), FIRST(overall_rating) FROM Player_Attributes GROUP BY player_api_id ORDER BY date desc;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.022000000000000002,
        "pattern_signature": "SELECT-FROM-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 35,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT Age::numeric FROM users;",
    "valid": true,
    "error": null,
    "duration_ms": 1.3420581817626953,
    "input_sql_tokens": 8,
    "estimated_tokens": 97,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT Age::numeric FROM users;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 36,
    "db_id": "codebase_community",
    "sql_snippet": "begin insert into profiles (Id, CreationDate, Webs...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 12.\n  begin \u001b[4minsert\u001b[0m into profiles (Id, CreationDate, WebsiteUrl) select new.Id, new.CreationDate, left(replace(new.Webs",
    "duration_ms": 2.3889541625976562,
    "input_sql_tokens": 59,
    "estimated_tokens": 190,
    "error_tokens": 59,
    "invalid_sql_tokens": 59,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 12.\n  begin \u001b[4minsert\u001b[0m into profiles (Id, CreationDate, WebsiteUrl) select new.Id, new.CreationDate, left(replace(new.Webs",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "begin insert into profiles (Id, CreationDate, WebsiteUrl) select new.Id, new.CreationDate, left(replace(new.WebsiteUrl, '.', '-'), charindex('@', replace(new.WebsiteUrl, '.', '-')) - 1);return new;end;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 37,
    "db_id": "card_games",
    "sql_snippet": "SELECT * FROM cards WHERE availability = 'paper' A...",
    "valid": true,
    "error": null,
    "duration_ms": 2.0139217376708984,
    "input_sql_tokens": 31,
    "estimated_tokens": 109,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM cards WHERE availability = 'paper' AND bordercolor = 'black' AND rarity = 'uncommon' AND types = 'Creature';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.047,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 38,
    "db_id": "student_club",
    "sql_snippet": "insert into event (event_id, event_name, event_dat...",
    "valid": false,
    "error": "Unknown option DO. Line 1, Col: 251.\n  :00', 'Social', 'Annual Gala for club members', 'Grand Ballroom', 'Open') on conflict (event_id) do \u001b[4minsert\u001b[0m into failure (event, member) values ('recAlAwtBZ0Fqbr5K', 'rec280Sk7o31iG0Tx');",
    "duration_ms": 5.232334136962891,
    "input_sql_tokens": 124,
    "estimated_tokens": 288,
    "error_tokens": 92,
    "invalid_sql_tokens": 124,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unsupported_dialect",
          "message": "Unknown option DO. Line 1, Col: 251.\n  :00', 'Social', 'Annual Gala for club members', 'Grand Ballroom', 'Open') on conflict (event_id) do \u001b[4minsert\u001b[0m into failure (event, member) values ('recAlAwtBZ0Fqbr5K', 'rec280Sk7o31iG0Tx');",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "insert into event (event_id, event_name, event_date, type, notes, location, status) values ('recAlAwtBZ0Fqbr5K', 'Annual Gala', '2023-12-15T19:00:00', 'Social', 'Annual Gala for club members', 'Grand Ballroom', 'Open') on conflict (event_id) do insert into failure (event, member) values ('recAlAwtBZ0Fqbr5K', 'rec280Sk7o31iG0Tx');",
      "tags": [
        "syntax_unsupported_dialect"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 39,
    "db_id": "european_football_2",
    "sql_snippet": "CREATE OR REPLACE FUNCTION log_player_name_changes...",
    "valid": true,
    "error": null,
    "duration_ms": 3.752470016479492,
    "input_sql_tokens": 110,
    "estimated_tokens": 177,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION log_player_name_changes() RETURNS trigger AS $BODY$ BEGIN IF NEW.player_name <> OLD.player_name THEN INSERT INTO player_audits(player_id, old_player_name, changed_on) VALUES(OLD.id, OLD.player_name, now()); END IF; RETURN NEW; END; $BODY$ CREATE TRIGGER tr_change_playername AFTER UPDATE OF player_name ON player FOR EACH ROW EXECUTE PROCEDURE log_player_name_changes();",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 40,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT DISTINCT userid, tag\nFROM preference_tag\nWH...",
    "valid": true,
    "error": null,
    "duration_ms": 2.2230148315429688,
    "input_sql_tokens": 27,
    "estimated_tokens": 113,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DISTINCT userid, tag\nFROM preference_tag\nWHERE tag @> (ARRAY['friend', 'cat']::VARCHAR[]);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-DISTINCT-FROM-WHERE",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 41,
    "db_id": "financial",
    "sql_snippet": "SELECT *  FROM account_info WHERE ((condition->0->...",
    "valid": true,
    "error": null,
    "duration_ms": 3.5142898559570312,
    "input_sql_tokens": 36,
    "estimated_tokens": 114,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT *  FROM account_info WHERE ((condition->0->>'conditions')::json->>'rootcompanyid')::json->>'$in' = '[5]';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 42,
    "db_id": "superhero",
    "sql_snippet": "ALTER TABLE hero_power ADD CONSTRAINT unique_activ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.3009777069091797,
    "input_sql_tokens": 26,
    "estimated_tokens": 110,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "ALTER TABLE hero_power ADD CONSTRAINT unique_active_hero_power UNIQUE (hero_id, power_id);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 43,
    "db_id": "toxicology",
    "sql_snippet": "SELECT DISTINCT(user_id), email FROM orders o WHER...",
    "valid": true,
    "error": null,
    "duration_ms": 5.426168441772461,
    "input_sql_tokens": 47,
    "estimated_tokens": 131,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DISTINCT(user_id), email FROM orders o WHERE (o.segment = 'luxury' AND o.destination = 'New York') OR (o.segment = 'luxury' AND o.destination = 'London')",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.047,
        "pattern_signature": "SELECT-DISTINCT-FROM-WHERE",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 44,
    "db_id": "formula_1",
    "sql_snippet": "SELECT version FROM cars ORDER BY SUBSTRING(versio...",
    "valid": true,
    "error": null,
    "duration_ms": 5.954742431640625,
    "input_sql_tokens": 113,
    "estimated_tokens": 213,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT version FROM cars ORDER BY SUBSTRING(version, '^[0-9]+') DESC, SUBSTRING(version, '[0-9]+\\.[0-9]+\\.([0-9]+)-') DESC, CAST(SUBSTRING(version, '[0-9]+\\.[0-9]+\\.[0-9]+-([0-9]+)') AS INTEGER) DESC, SUBSTRING(version, '[0-9]+\\.[0-9]+\\.[0-9]+-[0-9]+\\.([0-9]+)') DESC",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 45,
    "db_id": "formula_1",
    "sql_snippet": "SELECT r.driverId, ((SELECT COALESCE(SUM(r.points)...",
    "valid": true,
    "error": null,
    "duration_ms": 8.917093276977539,
    "input_sql_tokens": 79,
    "estimated_tokens": 181,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT r.driverId, ((SELECT COALESCE(SUM(r.points), 0) FROM results r WHERE r.raceId = races.raceId) - (SELECT COALESCE(SUM(r.points), 0) FROM results r WHERE r.raceId = races.raceId)) AS total_points FROM results r GROUP BY r.driverId",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14400000000000002,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 46,
    "db_id": "superhero",
    "sql_snippet": "select count(S.id), A.alignment, count(R.race), R....",
    "valid": true,
    "error": null,
    "duration_ms": 5.537748336791992,
    "input_sql_tokens": 60,
    "estimated_tokens": 146,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select count(S.id), A.alignment, count(R.race), R.race from superhero S, alignment A, race R where S.alignment_id=A.id and S.race_id=R.id group by A.alignment, R.race;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.109,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 47,
    "db_id": "formula_1",
    "sql_snippet": "select driverId, points, lead(driverId) over (orde...",
    "valid": true,
    "error": null,
    "duration_ms": 6.340503692626953,
    "input_sql_tokens": 107,
    "estimated_tokens": 193,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select driverId, points, lead(driverId) over (order by points asc) as \"lead(driverId) with order\", array_agg(driverId) over (order by points asc) as \"array_agg(driverId) with order\", lead(driverId) over () as \"lead(driverId) without order\", array_agg(driverId) over () as \"array_agg(driverId) without order\" from results where raceId = 19 order by driverId asc",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.041,
        "pattern_signature": "SELECT-FROM-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 48,
    "db_id": "formula_1",
    "sql_snippet": "SELECT\n  raceId,\n  MAX(time::time) AS end_time,\n  ...",
    "valid": true,
    "error": null,
    "duration_ms": 6.000280380249023,
    "input_sql_tokens": 72,
    "estimated_tokens": 158,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT\n  raceId,\n  MAX(time::time) AS end_time,\n  MIN(time::time) AS start_time,\n  (MAX(time::time) - MIN(time::time)) AS total_duration\nFROM pitStops\nWHERE raceId = 842\nGROUP BY raceId;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.041,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 49,
    "db_id": "toxicology",
    "sql_snippet": "select label, JSON_AGG(JSON_BUILD_OBJECT(atom.mole...",
    "valid": true,
    "error": null,
    "duration_ms": 3.759622573852539,
    "input_sql_tokens": 49,
    "estimated_tokens": 146,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select label, JSON_AGG(JSON_BUILD_OBJECT(atom.molecule_id, atom.atom_id)) AS groupedMolecules FROM molecule JOIN atom ON molecule.molecule_id = atom.molecule_id GROUP BY label",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.051000000000000004,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 50,
    "db_id": "toxicology",
    "sql_snippet": "SELECT molecule_id, COALESCE(SUM(CASE WHEN element...",
    "valid": true,
    "error": null,
    "duration_ms": 5.964994430541992,
    "input_sql_tokens": 75,
    "estimated_tokens": 153,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT molecule_id, COALESCE(SUM(CASE WHEN element = 'na' THEN 1 ELSE 0 END), 0) na_atoms, COALESCE(SUM(CASE WHEN element = 'c' OR element = 'cl' THEN 1 ELSE 0 END), 0) c_atoms FROM atom GROUP BY molecule_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.032,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 51,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT home_team_api_id, AVG(home_team_goal) as av...",
    "valid": true,
    "error": null,
    "duration_ms": 6.209135055541992,
    "input_sql_tokens": 132,
    "estimated_tokens": 210,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT home_team_api_id, AVG(home_team_goal) as avg_home_goals, AVG(away_team_goal) as avg_away_goals, SUM(home_team_goal) as total_home_goals, SUM(away_team_goal) as total_away_goals, MAX(home_team_goal) as max_home_goals, MIN(home_team_goal) as min_home_goals, COUNT(home_team_api_id) as count FROM Match GROUP BY home_team_api_id, date_part('hour', date);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.052,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 7
      }
    }
  },
  {
    "query_idx": 52,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT transaction_date AS date, club_name, sum(am...",
    "valid": true,
    "error": null,
    "duration_ms": 2.7015209197998047,
    "input_sql_tokens": 38,
    "estimated_tokens": 120,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT transaction_date AS date, club_name, sum(amount) over (partition by club_name, sign(amount) order by transaction_date) from club_transactions",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 53,
    "db_id": "california_schools",
    "sql_snippet": "SELECT array_to_json(array_agg(row_to_json(alias))...",
    "valid": true,
    "error": null,
    "duration_ms": 2.000570297241211,
    "input_sql_tokens": 28,
    "estimated_tokens": 122,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT array_to_json(array_agg(row_to_json(alias))) FROM (select * from modules ) alias",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09200000000000003,
        "pattern_signature": "SELECT-FROM-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 54,
    "db_id": "debit_card_specializing",
    "sql_snippet": "INSERT INTO customers (customerid, segment, curren...",
    "valid": true,
    "error": null,
    "duration_ms": 4.03594970703125,
    "input_sql_tokens": 66,
    "estimated_tokens": 163,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO customers (customerid, segment, currency) VALUES (3, 'SME', 'EUR'), (1, 'KAM', 'CZK'), (3, 'SME', 'EUR') ON CONFLICT (customerid, segment, currency) DO UPDATE SET Currency = customers.Currency RETURNING CustomerID;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT-RETURNING",
        "clauses_present": [
          "INSERT",
          "RETURNING",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 55,
    "db_id": "financial",
    "sql_snippet": "SELECT client.client_id, client.gender, disp.disp_...",
    "valid": true,
    "error": null,
    "duration_ms": 5.184412002563477,
    "input_sql_tokens": 76,
    "estimated_tokens": 166,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT client.client_id, client.gender, disp.disp_id, address ->> 'PostCode' AS PostCode FROM client JOIN disp ON client.client_id = disp.client_id CROSS JOIN jsonb_array_elements(disp.addresses) AS address WHERE disp.client_id IN (100, 414);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.077,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_CROSS-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 56,
    "db_id": "financial",
    "sql_snippet": "INSERT INTO loan (\n    loan_id,\n    account_id,\n  ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.01361083984375,
    "input_sql_tokens": 125,
    "estimated_tokens": 216,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO loan (\n    loan_id,\n    account_id,\n    date,\n    amount,\n    duration,\n    payments,\n    status\n)\nVALUES (\n    DEFAULT,\n    2,\n    '1996-04-29',\n    30276,\n    12,\n    2523.0,\n    'B'\n)\nON CONFLICT (loan_id, account_id, date)\nDO UPDATE\n    SET amount = loan.amount + 1000;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 57,
    "db_id": "card_games",
    "sql_snippet": "DELETE FROM cards WHERE (uuid, setCode, rarity, ma...",
    "valid": true,
    "error": null,
    "duration_ms": 8.264780044555664,
    "input_sql_tokens": 107,
    "estimated_tokens": 213,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DELETE FROM cards WHERE (uuid, setCode, rarity, manaCost) NOT IN ( SELECT uuid, setCode, rarity, manaCost FROM norm1 WHERE uuid IS NOT NULL AND setCode IS NOT NULL AND rarity IS NOT NULL AND manaCost IS NOT NULL ) AND (uuid, setCode, rarity, manaCost) NOT IN ( SELECT uuid, setCode, rarity, manaCost FROM norm2 WHERE uuid IS NOT NULL AND setCode IS NOT NULL AND rarity IS NOT NULL AND manaCost IS NOT NULL ) LIMIT 1000;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.22899999999999998,
        "pattern_signature": "SELECT-FROM-WHERE-LIMIT-DELETE-SUBQUERY",
        "clauses_present": [
          "DELETE",
          "FROM",
          "LIMIT",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 58,
    "db_id": "financial",
    "sql_snippet": "CREATE OR REPLACE FUNCTION f_gap_fill_update(tbl t...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0062198638916016,
    "input_sql_tokens": 150,
    "estimated_tokens": 234,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION f_gap_fill_update(tbl text, id text, row_num text) RETURNS void LANGUAGE plpgsql AS $func$ DECLARE tmp text[]; col text; BEGIN select array ( select column_name from information_schema.columns c where table_name = tbl ) into tmp; foreach col in array tmp loop execute 'update '||tbl||' set '||col||' = gapfill('||col||') OVER w AS '||col||' where '||tbl||'.row_num = '||col||'.row_num window w as (PARTITION BY '||id||' ORDER BY '||row_num||') returning *;'; end loop; end $func$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 59,
    "db_id": "financial",
    "sql_snippet": "UPDATE card SET disp_id = 1 WHERE disp_id = 41;",
    "valid": true,
    "error": null,
    "duration_ms": 1.9583702087402344,
    "input_sql_tokens": 19,
    "estimated_tokens": 93,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "UPDATE card SET disp_id = 1 WHERE disp_id = 41;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "WHERE-UPDATE",
        "clauses_present": [
          "UPDATE",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 60,
    "db_id": "financial",
    "sql_snippet": "CREATE OR REPLACE FUNCTION public.generate_series_...",
    "valid": true,
    "error": null,
    "duration_ms": 4.500389099121094,
    "input_sql_tokens": 134,
    "estimated_tokens": 201,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION public.generate_series_monthly(a date, b date) RETURNS SETOF date LANGUAGE SQL IMMUTABLE PARALLEL SAFE ROWS 10 AS $function$ select generate_series(date_trunc('month', a), date_trunc('month', b), '1 month') $function$;EXPLAIN SELECT generate_series_monthly('2024-01-01', '2024-05-01');EXPLAIN SELECT * FROM generate_series_monthly('2024-01-01', '2024-05-01');",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 61,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT\n    m.id,\n    m.date,\n    CASE WHEN m.home_...",
    "valid": true,
    "error": null,
    "duration_ms": 8.22138786315918,
    "input_sql_tokens": 126,
    "estimated_tokens": 211,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT\n    m.id,\n    m.date,\n    CASE WHEN m.home_team_goal = m.away_team_goal THEN 1 ELSE 0 END AS invoiced,\n    SUM(m.home_team_goal + m.away_team_goal)\n        OVER (PARTITION BY (CASE WHEN m.home_team_goal = m.away_team_goal THEN 1 ELSE 0 END)\n              ORDER BY m.id, m.date) AS amount\nFROM match AS m\nORDER BY m.id, m.date;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 62,
    "db_id": "debit_card_specializing",
    "sql_snippet": "WITH DataSource AS (\n  SELECT\n    *,\n    MIN(CASE ...",
    "valid": true,
    "error": null,
    "duration_ms": 7.483005523681641,
    "input_sql_tokens": 179,
    "estimated_tokens": 303,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH DataSource AS (\n  SELECT\n    *,\n    MIN(CASE WHEN amount < 10 THEN gasstationid END)\n      OVER (PARTITION BY customerid) AS first_issue_gasstation,\n    ROW_NUMBER() OVER (PARTITION BY customerid ORDER BY gasstationid DESC) AS gasstation_id\n  FROM transactions_1k\n  WHERE gasstationid = (\n    SELECT MAX(gasstationid)\n    FROM transactions_1k\n    WHERE customerid = transactions_1k.customerid\n  )\n)\nSELECT\n  customerid,\n  transactionid,\n  gasstationid,\n  amount\nFROM DataSource\nWHERE\n  (first_issue_gasstation IS NULL AND gasstation_id = 1)\n  OR (first_issue_gasstation = gasstationid);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.19300000000000006,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 1,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 63,
    "db_id": "card_games",
    "sql_snippet": "SELECT c1.user_id, COUNT(*) FROM user_actions c1 L...",
    "valid": true,
    "error": null,
    "duration_ms": 8.698701858520508,
    "input_sql_tokens": 169,
    "estimated_tokens": 275,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT c1.user_id, COUNT(*) FROM user_actions c1 LEFT JOIN (SELECT user_id, action, action_time FROM user_actions WHERE action = 'LOGIN') c2 ON c1.user_id = c2.user_id AND c2.action_time > c1.action_time LEFT JOIN (SELECT user_id, action, action_time FROM user_actions WHERE action = 'BUY') c3 ON c1.user_id = c3.user_id AND c3.action_time > c1.action_time AND c3.action_time < c2.action_time WHERE c1.action = 'SEARCH' AND c2.user_id IS NOT NULL AND c3.user_id IS NULL GROUP BY 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.24500000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 64,
    "db_id": "card_games",
    "sql_snippet": "SELECT c.id, c.name FROM cards c WHERE c.id IN (SE...",
    "valid": true,
    "error": null,
    "duration_ms": 2.996206283569336,
    "input_sql_tokens": 34,
    "estimated_tokens": 132,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT c.id, c.name FROM cards c WHERE c.id IN (SELECT unnest(card_order) FROM decks WHERE id = 1);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11000000000000001,
        "pattern_signature": "SELECT-FROM-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 65,
    "db_id": "card_games",
    "sql_snippet": "SELECT ord.order_date, ord.order_id, ord.card_id, ...",
    "valid": true,
    "error": null,
    "duration_ms": 4.04810905456543,
    "input_sql_tokens": 74,
    "estimated_tokens": 162,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT ord.order_date, ord.order_id, ord.card_id, prd.price FROM order_cards ord LEFT JOIN (SELECT * FROM card_prices ORDER BY start_date ASC) AS prd ON ord.card_id = prd.card_id AND ord.order_date >= prd.start_date",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.131,
        "pattern_signature": "SELECT-FROM-JOIN-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 66,
    "db_id": "european_football_2",
    "sql_snippet": "select player_id, stats_keys, stats_values from pl...",
    "valid": true,
    "error": null,
    "duration_ms": 1.0180473327636719,
    "input_sql_tokens": 17,
    "estimated_tokens": 106,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select player_id, stats_keys, stats_values from player_stats",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 67,
    "db_id": "european_football_2",
    "sql_snippet": "UPDATE teams_config SET configurations = jsonb_set...",
    "valid": true,
    "error": null,
    "duration_ms": 4.265308380126953,
    "input_sql_tokens": 71,
    "estimated_tokens": 169,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "UPDATE teams_config SET configurations = jsonb_set(configurations, '{settings}', (configurations->'id') - (SELECT DISTINCT position - 1 FROM teams_config, jsonb_array_elements(configurations) WITH ORDINALITY arr(elem, position) WHERE elem->>'id' = '101')::int);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.118,
        "pattern_signature": "SELECT-DISTINCT-FROM-JOIN-WHERE-UPDATE-SUBQUERY",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "JOIN",
          "SELECT",
          "SUBQUERY",
          "UPDATE",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 68,
    "db_id": "formula_1",
    "sql_snippet": "SELECT begin_date, end_date, age(CASE WHEN end_dat...",
    "valid": true,
    "error": null,
    "duration_ms": 7.861852645874023,
    "input_sql_tokens": 113,
    "estimated_tokens": 202,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT begin_date, end_date, age(CASE WHEN end_date = date_trunc('month', end_date) + interval '1 month - 1 day' THEN end_date + interval '1 day' ELSE date_trunc('month', end_date) END::date, CASE WHEN begin_date = date_trunc('month', begin_date) THEN begin_date ELSE date_trunc('month', begin_date) + interval '1 month' END::date) AS calculated_months FROM race_dates;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 69,
    "db_id": "student_club",
    "sql_snippet": "INSERT INTO new_attendance (link_to_event, link_to...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0508041381835938,
    "input_sql_tokens": 83,
    "estimated_tokens": 163,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO new_attendance (link_to_event, link_to_member, date)\n    VALUES ('reciRZdAqNIKuMC96', 'recL94zpn6Xh6kQii', NOW())\n    ON CONFLICT\n    WHERE link_to_member='recL94zpn6Xh6kQii' DO NOTHING;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "WHERE-VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 70,
    "db_id": "financial",
    "sql_snippet": "pg_advisory_xact_lock(lkhndl);",
    "valid": true,
    "error": null,
    "duration_ms": 0.9996891021728516,
    "input_sql_tokens": 15,
    "estimated_tokens": 82,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "pg_advisory_xact_lock(lkhndl);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 71,
    "db_id": "student_club",
    "sql_snippet": "SELECT\n            link_to_member,\n            CAS...",
    "valid": true,
    "error": null,
    "duration_ms": 12.506961822509766,
    "input_sql_tokens": 232,
    "estimated_tokens": 332,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT\n            link_to_member,\n            CASE\n                WHEN (SUBSTRING(ROUND(SUM(hours)::NUMERIC, 0)::TEXT FROM '.{1}$') IN ('5', '6', '7', '8', '9', '0'))\n                THEN CEIL(SUM(hours) / 10) * 10\n                ELSE FLOOR(SUM(hours) / 10) * 10\n            END AS rounded_hours,\n            RANK() OVER (ORDER BY\n                CASE\n                    WHEN (SUBSTRING(ROUND(SUM(hours)::NUMERIC, 0)::TEXT FROM '.{1}$') IN ('5', '6', '7', '8', '9', '0'))\n                    THEN CEIL(SUM(hours) / 10) * 10\n                    ELSE FLOOR(SUM(hours) / 10) * 10\n                END DESC\n            ) AS rank\n        FROM attendance\n        GROUP BY link_to_member\n        ORDER BY rank, link_to_member;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.052,
        "pattern_signature": "SELECT-FROM-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 7
      }
    }
  },
  {
    "query_idx": 72,
    "db_id": "financial",
    "sql_snippet": "CREATE INDEX ix_account ON account USING btree (di...",
    "valid": true,
    "error": null,
    "duration_ms": 2.0093917846679688,
    "input_sql_tokens": 20,
    "estimated_tokens": 104,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE INDEX ix_account ON account USING btree (district_id, frequency, date);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 73,
    "db_id": "european_football_2",
    "sql_snippet": "create or replace view findcount(season, team_coun...",
    "valid": true,
    "error": null,
    "duration_ms": 4.209041595458984,
    "input_sql_tokens": 67,
    "estimated_tokens": 176,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "create or replace view findcount(season, team_count) as\n        select\n            season,\n            findteam(season) as team_count\n        from (\n            select distinct season\n            from match\n            where season >= '2008/2009'\n        ) seasons;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10300000000000002,
        "pattern_signature": "SELECT-DISTINCT-FROM-WHERE-SUBQUERY",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 74,
    "db_id": "codebase_community",
    "sql_snippet": "select posttypeid\n        case when tags like ('%b...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 2, Col: 17.\n  select posttypeid\n        case \u001b[4mwhen\u001b[0m tags like ('%bayesian%','%distributions%')\n        then 1 else 0 end as keyword_count\n        from ",
    "duration_ms": 1.9977092742919922,
    "input_sql_tokens": 37,
    "estimated_tokens": 178,
    "error_tokens": 64,
    "invalid_sql_tokens": 37,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 2, Col: 17.\n  select posttypeid\n        case \u001b[4mwhen\u001b[0m tags like ('%bayesian%','%distributions%')\n        then 1 else 0 end as keyword_count\n        from ",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "select posttypeid\n        case when tags like ('%bayesian%','%distributions%')\n        then 1 else 0 end as keyword_count\n        from posts",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 75,
    "db_id": "toxicology",
    "sql_snippet": "SELECT count(bond_id), molecule_id FROM bond GROUP...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 98.\n  SELECT count(bond_id), molecule_id FROM bond GROUP BY molecule_id ORDER BY molecule_id \u001b[4mlast_update\u001b[0m DESC;",
    "duration_ms": 5.017757415771484,
    "input_sql_tokens": 28,
    "estimated_tokens": 155,
    "error_tokens": 55,
    "invalid_sql_tokens": 28,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 98.\n  SELECT count(bond_id), molecule_id FROM bond GROUP BY molecule_id ORDER BY molecule_id \u001b[4mlast_update\u001b[0m DESC;",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT count(bond_id), molecule_id FROM bond GROUP BY molecule_id ORDER BY molecule_id last_update DESC;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 76,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT entity_id, coalesce(change->'height', lag(c...",
    "valid": true,
    "error": null,
    "duration_ms": 7.761716842651367,
    "input_sql_tokens": 125,
    "estimated_tokens": 231,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT entity_id, coalesce(change->'height', lag(change->'height', 1, null) over (partition by entity_id order by updated_at)) as height, coalesce(change->'weight', lag(change->'weight', 1, null) over (partition by entity_id order by updated_at)) as weight, updated_at FROM ( SELECT entity_id, json_object_agg(column_id, value) as change, updated_at FROM player_stats_changes GROUP BY entity_id, updated_at) as changes;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10400000000000002,
        "pattern_signature": "SELECT-FROM-GROUP-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 77,
    "db_id": "superhero",
    "sql_snippet": "with qr1(item, subgroup) AS (SELECT id, subgroup1 ...",
    "valid": true,
    "error": null,
    "duration_ms": 7.012128829956055,
    "input_sql_tokens": 119,
    "estimated_tokens": 237,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "with qr1(item, subgroup) AS (SELECT id, subgroup1 FROM superhero_group WHERE subgroup1 IS NOT NULL), qr2(item, subgroup) AS (SELECT id, subgroup2 FROM superhero_group WHERE subgroup2 IS NOT NULL) select item, subgroup1, subgroup2, dense_rank() over (order by item) as group from (select qr1.item, qr1.subgroup as subgroup1, qr2.subgroup as subgroup2 from qr1 full outer join qr2 on qr1.item = qr2.item) as combined",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.15100000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 78,
    "db_id": "superhero",
    "sql_snippet": "WITH r AS (SELECT id, date_of_visit, SUM(sessions)...",
    "valid": true,
    "error": null,
    "duration_ms": 70.98507881164551,
    "input_sql_tokens": 1264,
    "estimated_tokens": 1363,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH r AS (SELECT id, date_of_visit, SUM(sessions) AS sessions, SUM(pageviews) AS pageviews, SUM(bounces) AS bounce, COALESCE(utm_campaign, '') AS utm_campaign, COALESCE(utm_source, '') AS utm_source, COALESCE(utm_medium, '') AS utm_medium, COALESCE(utm_content, '') AS utm_content, COALESCE(utm_term, '') AS utm_term FROM report GROUP BY id, date_of_visit, utm_campaign, utm_source, utm_medium, utm_content, utm_term UNION SELECT id, date_of_visit, SUM(sessions), SUM(pageviews), SUM(bounces), COALESCE(utm_campaign, ''), COALESCE(utm_source, ''), '' AS utm_medium, '' AS utm_content, '' AS utm_term FROM report GROUP BY id, date_of_visit, utm_campaign, utm_source UNION SELECT id, date_of_visit, SUM(sessions), SUM(pageviews), SUM(bounces), COALESCE(utm_campaign, ''), '' AS utm_source, COALESCE(utm_medium, ''), '' AS utm_content, '' AS utm_term FROM report GROUP BY id, date_of_visit, utm_campaign, utm_medium UNION SELECT id, date_of_visit, SUM(sessions), SUM(pageviews), SUM(bounces), COALESCE(utm_campaign, ''), '' AS utm_source, '' AS utm_medium, COALESCE(utm_content, ''), '' AS utm_term FROM report GROUP BY id, date_of_visit, utm_campaign, utm_content UNION SELECT id, date_of_visit, SUM(sessions), SUM(pageviews), SUM(bounces), COALESCE(utm_campaign, ''), '' AS utm_source, '' AS utm_medium, '' AS utm_content, COALESCE(utm_term, '') FROM report GROUP BY id, date_of_visit, utm_campaign, utm_term UNION SELECT id, date_of_visit, SUM(sessions), SUM(pageviews), SUM(bounces), '' AS utm_campaign, COALESCE(utm_source, ''), COALESCE(utm_medium, ''), '' AS utm_content, '' AS utm_term FROM report GROUP BY id, date_of_visit, utm_source, utm_medium UNION SELECT id, date_of_visit, SUM(sessions), SUM(pageviews), SUM(bounces), '' AS utm_campaign, COALESCE(utm_source, ''), '' AS utm_medium, COALESCE(utm_content, ''), '' AS utm_term FROM report GROUP BY id, date_of_visit, utm_source, utm_content UNION SELECT id, date_of_visit, SUM(sessions), SUM(pageviews), SUM(bounces), '' AS utm_campaign, COALESCE(utm_source, ''), '' AS utm_medium, '' AS utm_content, COALESCE(utm_term, '') FROM report GROUP BY id, date_of_visit, utm_source, utm_term UNION SELECT id, date_of_visit, SUM(sessions), SUM(pageviews), SUM(bounces), '' AS utm_campaign, '' AS utm_source, COALESCE(utm_medium, ''), COALESCE(utm_content, ''), '' AS utm_term FROM report GROUP BY id, date_of_visit, utm_medium, utm_content UNION SELECT id, date_of_visit, SUM(sessions), SUM(pageviews), SUM(bounces), '' AS utm_campaign, '' AS utm_source, COALESCE(utm_medium, ''), '' AS utm_content, COALESCE(utm_term, '') FROM report GROUP BY id, date_of_visit, utm_medium, utm_term UNION SELECT id, date_of_visit, SUM(sessions), SUM(pageviews), SUM(bounces), '' AS utm_campaign, '' AS utm_source, '' AS utm_medium, COALESCE(utm_content, ''), COALESCE(utm_term, '') FROM report GROUP BY id, date_of_visit, utm_content, utm_term UNION SELECT id, date_of_visit, SUM(sessions), SUM(pageviews), SUM(bounces), '' AS utm_campaign, '' AS utm_source, '' AS utm_medium, '' AS utm_content, '' AS utm_term FROM report GROUP BY id, date_of_visit) SELECT r.* FROM r JOIN utm AS u ON r.id = u.row_id AND (r.utm_campaign = u.utm_campaign OR (r.utm_campaign = '' AND u.utm_campaign IS NULL)) AND (r.utm_source = u.utm_source OR (r.utm_source = '' AND u.utm_source IS NULL)) AND (r.utm_medium = u.utm_medium OR (r.utm_medium = '' AND u.utm_medium IS NULL)) AND (r.utm_content = u.utm_content OR (r.utm_content = '' AND u.utm_content IS NULL)) AND (r.utm_term = u.utm_term OR (r.utm_term = '' AND u.utm_term IS NULL)) WHERE 'NA' NOT IN (r.utm_campaign, r.utm_source, r.utm_medium, r.utm_content, r.utm_term);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.266,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-UNION",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 36
      }
    }
  },
  {
    "query_idx": 79,
    "db_id": "card_games",
    "sql_snippet": "SELECT\n    id,\n    text,\n    REGEXP_MATCHES(\n     ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.0275115966796875,
    "input_sql_tokens": 47,
    "estimated_tokens": 138,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT\n    id,\n    text,\n    REGEXP_MATCHES(\n        text,\n        '\\{.*?\\}',\n        'g'\n    ) AS bracketed_tokens\nFROM cards;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 80,
    "db_id": "superhero",
    "sql_snippet": "SELECT race_id, top(count(*), 5) as cnt FROM super...",
    "valid": true,
    "error": null,
    "duration_ms": 1.0211467742919922,
    "input_sql_tokens": 23,
    "estimated_tokens": 101,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT race_id, top(count(*), 5) as cnt FROM superhero group by gender_id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 81,
    "db_id": "card_games",
    "sql_snippet": "SELECT rulings.id, rulings.date, rulings.text, rul...",
    "valid": true,
    "error": null,
    "duration_ms": 3.984689712524414,
    "input_sql_tokens": 212,
    "estimated_tokens": 302,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT rulings.id, rulings.date, rulings.text, rulings.uuid FROM rulings WHERE rulings.uuid IN ('6d268c95-c176-5766-9a46-c14f739aba1c', '56f4935b-f6c5-59b9-88bf-9bcce20247ce', '8dfc67e9-8323-5d1f-9e25-9f9394abd5a0', '5ac794d2-4c66-5332-afb1-54b24bc11823', '60f49caf-3583-5f85-b4b3-08dca73a8628') GROUP BY rulings.id ORDER BY rulings.id LIMIT 3",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "GROUP",
          "LIMIT",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 82,
    "db_id": "formula_1",
    "sql_snippet": "select rank() over (order by total_points desc) as...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0078887939453125,
    "input_sql_tokens": 32,
    "estimated_tokens": 114,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select rank() over (order by total_points desc) as place, id, name, total_points, race_points, raceId from racers",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 83,
    "db_id": "card_games",
    "sql_snippet": "SELECT month_year, COUNT(DISTINCT customer_id) FRO...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0002593994140625,
    "input_sql_tokens": 31,
    "estimated_tokens": 115,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT month_year, COUNT(DISTINCT customer_id) FROM orders GROUP BY month_year HAVING COUNT(order_id) > 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.029,
        "pattern_signature": "SELECT-FROM-GROUP-HAVING",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 84,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT player_name, event_date as join_date, (SELE...",
    "valid": true,
    "error": null,
    "duration_ms": 3.597736358642578,
    "input_sql_tokens": 76,
    "estimated_tokens": 174,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT player_name, event_date as join_date, (SELECT event_date FROM player_movements pm1 WHERE pm1.player_name = pm.player_name AND pm1.event = 'Leave' AND pm1.event_date > pm.event_date) as leave_date FROM player_movements pm WHERE event = 'Join'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.12000000000000001,
        "pattern_signature": "SELECT-FROM-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 85,
    "db_id": "financial",
    "sql_snippet": "select account_id, date,\n        sum(amount) OVER ...",
    "valid": true,
    "error": null,
    "duration_ms": 6.552219390869141,
    "input_sql_tokens": 76,
    "estimated_tokens": 155,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select account_id, date,\n        sum(amount) OVER (PARTITION BY account_id, date) as total_amount,\n        sum(balance) OVER (PARTITION BY account_id, date) as total_balance,\n        count(trans_id) OVER (PARTITION BY account_id, date) as total_transactions\n        from trans",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.028,
        "pattern_signature": "SELECT-FROM-WINDOW",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 86,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT * FROM transactions_1k WHERE (Date, Time, A...",
    "valid": true,
    "error": null,
    "duration_ms": 2.973318099975586,
    "input_sql_tokens": 43,
    "estimated_tokens": 121,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM transactions_1k WHERE (Date, Time, Amount) < ('2012-08-24', '10:00:00', 20);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 87,
    "db_id": "financial",
    "sql_snippet": "SELECT client.gender, loan.amount, loan.duration, ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.9794445037841797,
    "input_sql_tokens": 91,
    "estimated_tokens": 187,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT client.gender, loan.amount, loan.duration, account.date FROM loan JOIN account ON loan.account_id = account.account_id JOIN client ON disp.client_id = client.client_id JOIN disp ON account.account_id = disp.account_id WHERE loan.date BETWEEN '1996-01-01' AND '1996-12-31';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.12200000000000001,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 3,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 88,
    "db_id": "codebase_community",
    "sql_snippet": "with cte as (select pv1.session_id, pv1.post_id, p...",
    "valid": true,
    "error": null,
    "duration_ms": 9.016275405883789,
    "input_sql_tokens": 201,
    "estimated_tokens": 291,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "with cte as (select pv1.session_id, pv1.post_id, pv2.view_perc, pv1.ts as start_time, min(pv2.ts) as end_time from view_logs pv1 join view_logs pv2 on pv1.session_id = pv2.session_id and pv1.post_id = pv2.post_id and pv1.event_name <> pv2.event_name and pv1.ts < pv2.ts group by pv1.session_id, pv1.post_id, pv2.view_perc, pv1.ts) select session_id, post_id, start_time, end_time, case when (end_time - start_time > 3  and view_perc > 0.8 )then 'yes' else 'no' end as has_meaningful_view from cte;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.135,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-GROUP",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 89,
    "db_id": "superhero",
    "sql_snippet": "delete from superhero where id = 999 returning 1",
    "valid": true,
    "error": null,
    "duration_ms": 2.039670944213867,
    "input_sql_tokens": 14,
    "estimated_tokens": 96,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "delete from superhero where id = 999 returning 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "WHERE-DELETE-RETURNING",
        "clauses_present": [
          "DELETE",
          "RETURNING",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 90,
    "db_id": "superhero",
    "sql_snippet": "CREATE OR REPLACE FUNCTION GapFillInternal(s anyel...",
    "valid": true,
    "error": null,
    "duration_ms": 6.303548812866211,
    "input_sql_tokens": 180,
    "estimated_tokens": 264,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION GapFillInternal(s anyelement, v anyelement) RETURNS anyelement AS $$ DECLARE temp alias for $0; BEGIN F v IS NULL AND s NOTNULL THEN temp := s; ELSIF s IS NULL AND v NOTNULL THEN temp := v; ELSIF s NOTNULL AND v NOTNULL THEN temp := v; ELSE temp := NULL; END;END; $$ LANGUAGE PLPGSQL;CREATE AGGREGATE GapFill(anyelement) (SFUNC=GapFillInternal, STYPE=anyelement);SELECT id, publisher_id, height_cm, weight_kg, GapFill(height_cm) OVER (PARTITION BY publisher_id ORDER BY id) AS height_cm_filled, GapFill(weight_kg) OVER (PARTITION BY publisher_id ORDER BY id) AS weight_kg_filled FROM superhero;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 91,
    "db_id": "toxicology",
    "sql_snippet": "SELECT SUM(CASE WHEN timestamp::date = '2022-01-27...",
    "valid": true,
    "error": null,
    "duration_ms": 21.017789840698242,
    "input_sql_tokens": 421,
    "estimated_tokens": 509,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT SUM(CASE WHEN timestamp::date = '2022-01-27'::date - 1 THEN amount ELSE NULL END) AS yesterday_revenue, ROUND((SUM(CASE WHEN timestamp::date > '2022-01-27'::date - 1 THEN amount ELSE NULL END) - SUM(CASE WHEN timestamp::date = '2022-01-27'::date - 8 THEN amount ELSE NULL END)) / SUM(CASE WHEN timestamp::date = '2022-01-27'::date - 8 THEN amount ELSE NULL END), 2) AS pct_change_week_ago, SUM(CASE WHEN date_trunc('month', timestamp) = date_trunc('month', '2022-01-27'::date - 1) THEN amount ELSE NULL END) AS mtd, ROUND((SUM(CASE WHEN date_trunc('month', timestamp) = date_trunc('month', '2022-01-27'::date - 1) THEN amount ELSE NULL END) - SUM(CASE WHEN date_trunc('month', timestamp) = date_trunc('month', '2022-01-27'::date - 1) - interval '1 month' AND date_part('day', timestamp) <= date_part('day', '2022-01-27'::date - 1) THEN amount ELSE NULL END)) / SUM(CASE WHEN date_trunc('month', timestamp) = date_trunc('month', '2022-01-27'::date - 1) - interval '1 month' AND date_part('day', timestamp) <= date_part('day', '2022-01-27'::date - 1) THEN amount ELSE NULL END), 2) AS pct_change_month_prior FROM transactions;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.07800000000000001,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 8
      }
    }
  },
  {
    "query_idx": 92,
    "db_id": "card_games",
    "sql_snippet": "SELECT name, convertedManaCost, avg(convertedManaC...",
    "valid": true,
    "error": null,
    "duration_ms": 2.8030872344970703,
    "input_sql_tokens": 49,
    "estimated_tokens": 135,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT name, convertedManaCost, avg(convertedManaCost) OVER(ORDER BY id ROWS BETWEEN 8 PRECEDING AND CURRENT ROW) AS nine_card_avg FROM cards WHERE name LIKE 'A%' ORDER BY id DESC",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.023,
        "pattern_signature": "SELECT-FROM-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 93,
    "db_id": "superhero",
    "sql_snippet": "SELECT hero_id, attribute_id, jsonb_array_length(a...",
    "valid": true,
    "error": null,
    "duration_ms": 3.9920806884765625,
    "input_sql_tokens": 74,
    "estimated_tokens": 152,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT hero_id, attribute_id, jsonb_array_length(a.ss) AS ss_cnt, jsonb_array_length(CASE WHEN a.ss -> 'approved' = 'true' THEN a.ss END) AS approved_cnt FROM hero_attribute a WHERE a.hero_id IN (1, 2);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 94,
    "db_id": "card_games",
    "sql_snippet": "SELECT set_translations.language\n              CAS...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 2, Col: 23.\n  SELECT set_translations.language\n              CASE \u001b[4mWHEN\u001b[0m set_translations.language IN (SELECT foreign_data.language in foreign_data)\n              THEN 'com",
    "duration_ms": 3.0128955841064453,
    "input_sql_tokens": 51,
    "estimated_tokens": 187,
    "error_tokens": 61,
    "invalid_sql_tokens": 51,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 2, Col: 23.\n  SELECT set_translations.language\n              CASE \u001b[4mWHEN\u001b[0m set_translations.language IN (SELECT foreign_data.language in foreign_data)\n              THEN 'com",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT set_translations.language\n              CASE WHEN set_translations.language IN (SELECT foreign_data.language in foreign_data)\n              THEN 'common'\n              ELSE 'not common'\n              END\n        FROM set_translations",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 95,
    "db_id": "european_football_2",
    "sql_snippet": "DO $$ DECLARE i integer; BEGIN\n        FOREACH i I...",
    "valid": true,
    "error": null,
    "duration_ms": 2.3488998413085938,
    "input_sql_tokens": 146,
    "estimated_tokens": 218,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DO $$ DECLARE i integer; BEGIN\n        FOREACH i IN ARRAY[11, 20]::integer[] LOOP\n            RAISE NOTICE 'Value: %', i;\n            UPDATE Player_Attributes SET overall_rating = i\n            WHERE player_api_id = ANY (ARRAY[505942, 155782]::integer[])\n            AND date = ANY (ARRAY['2016-02-18 00:00:00', '2015-10-16 00:00:00']::text[]);\n        END LOOP;\n    END $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 96,
    "db_id": "formula_1",
    "sql_snippet": "SELECT resultId FROM results WHERE to_tsvector(res...",
    "valid": true,
    "error": null,
    "duration_ms": 2.6679039001464844,
    "input_sql_tokens": 34,
    "estimated_tokens": 112,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT resultId FROM results WHERE to_tsvector(results.fastestLapTime) @@ to_tsquery('1:35.405');",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 97,
    "db_id": "formula_1",
    "sql_snippet": "SELECT raceId, position, COUNT(*) as cnt FROM resu...",
    "valid": true,
    "error": null,
    "duration_ms": 2.059459686279297,
    "input_sql_tokens": 19,
    "estimated_tokens": 97,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT raceId, position, COUNT(*) as cnt FROM results GROUP BY raceId, position",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 98,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT * FROM Match WHERE (match_api_id, date, id)...",
    "valid": true,
    "error": null,
    "duration_ms": 3.954648971557617,
    "input_sql_tokens": 59,
    "estimated_tokens": 145,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM Match WHERE (match_api_id, date, id) > (492473, '2008-08-17 00:00:00', 1) ORDER BY date, id ASC LIMIT 3",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "LIMIT",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 99,
    "db_id": "california_schools",
    "sql_snippet": "SELECT School FROM schools GROUP BY School HAVING ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.5954246520996094,
    "input_sql_tokens": 20,
    "estimated_tokens": 108,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT School FROM schools GROUP BY School HAVING COUNT(*) > 1 ORDER BY COUNT(*) DESC;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.029,
        "pattern_signature": "SELECT-FROM-GROUP-HAVING-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 100,
    "db_id": "formula_1",
    "sql_snippet": "SELECT MAX(date), raceid, name FROM races GROUP BY...",
    "valid": true,
    "error": null,
    "duration_ms": 3.9606094360351562,
    "input_sql_tokens": 26,
    "estimated_tokens": 110,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT MAX(date), raceid, name FROM races GROUP BY name, raceid HAVING MAX(date) = date;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.029,
        "pattern_signature": "SELECT-FROM-GROUP-HAVING",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 101,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT t.team_name, o.outcome FROM (VALUES('Team A...",
    "valid": true,
    "error": null,
    "duration_ms": 2.255678176879883,
    "input_sql_tokens": 46,
    "estimated_tokens": 128,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT t.team_name, o.outcome FROM (VALUES('Team A'),('Team B')) AS t(team_name) JOIN (VALUES('win'),('lose'),('draw')) AS o(outcome);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.025,
        "pattern_signature": "SELECT-FROM-JOIN-VALUES",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "VALUES"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 102,
    "db_id": "california_schools",
    "sql_snippet": "SELECT DISTINCT ON (\"County Code\") * FROM frpm ORD...",
    "valid": true,
    "error": null,
    "duration_ms": 2.01416015625,
    "input_sql_tokens": 28,
    "estimated_tokens": 140,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DISTINCT ON (\"County Code\") * FROM frpm ORDER BY \"County Code\", \"Enrollment (K-12)\" DESC;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-DISTINCT-DISTINCT_ON-FROM-ORDER",
        "clauses_present": [
          "DISTINCT",
          "DISTINCT_ON",
          "FROM",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 103,
    "db_id": "formula_1",
    "sql_snippet": "SELECT SUM(quantity) FROM race_materials WHERE pri...",
    "valid": true,
    "error": null,
    "duration_ms": 1.997232437133789,
    "input_sql_tokens": 24,
    "estimated_tokens": 102,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT SUM(quantity) FROM race_materials WHERE price_per_unit * quantity <= 100;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.023,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 104,
    "db_id": "european_football_2",
    "sql_snippet": "INSERT INTO historical_rating (player_fifa_api_id,...",
    "valid": true,
    "error": null,
    "duration_ms": 2.9015541076660156,
    "input_sql_tokens": 63,
    "estimated_tokens": 160,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO historical_rating (player_fifa_api_id, player_api_id, grouped_rating) SELECT player_fifa_api_id, player_api_id AS grouped_rating FROM player_attributes GROUP BY player_fifa_api_id, player_api_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.020000000000000004,
        "pattern_signature": "SELECT-FROM-GROUP-INSERT",
        "clauses_present": [
          "FROM",
          "GROUP",
          "INSERT",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 105,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT DISTINCT id, acceptedanswerid, posttypeid, ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.99835205078125,
    "input_sql_tokens": 42,
    "estimated_tokens": 145,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DISTINCT id, acceptedanswerid, posttypeid, score FROM posts WHERE score >= 20 OR acceptedanswerid IS NOT NULL AND score >= 20 GROUP BY id, acceptedanswerid;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.037000000000000005,
        "pattern_signature": "SELECT-DISTINCT-FROM-WHERE-GROUP",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "GROUP",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 106,
    "db_id": "card_games",
    "sql_snippet": "WITH card_activity AS ( SELECT to_date(fe.start_da...",
    "valid": true,
    "error": null,
    "duration_ms": 10.675430297851562,
    "input_sql_tokens": 220,
    "estimated_tokens": 324,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH card_activity AS ( SELECT to_date(fe.start_date_key::text, 'YYYYMMDD') AS start_date, to_date(fe.end_date_key::text, 'YYYYMMDD') AS end_date, dp.set_name, dp.set_code FROM fact_collection fe INNER JOIN dim_set dp ON fe.set_key = dp.set_key ) SELECT date_trunc('month', month_series) AS month, COUNT(*) AS existing_cards, sa.set_name FROM ( SELECT generate_series( (SELECT MIN(to_date(start_date_key::text, 'YYYYMMDD')) FROM fact_collection), '2100-12-31', INTERVAL '1 month') AS month_series ) AS months LEFT JOIN card_activity sa ON sa.start_date < month_series AND (sa.end_date IS NULL OR sa.end_date >= month_series) GROUP BY month, sa.set_name;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.264,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-GROUP-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "SUBQUERY",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 2,
        "num_ctes": 1,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 107,
    "db_id": "superhero",
    "sql_snippet": "WITH mission_spans AS ( SELECT hero_id, mission_st...",
    "valid": true,
    "error": null,
    "duration_ms": 4.736185073852539,
    "input_sql_tokens": 84,
    "estimated_tokens": 174,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH mission_spans AS ( SELECT hero_id, mission_start, mission_end FROM superhero_missions ORDER BY hero_id, mission_start, mission_end ) SELECT hero_id, MIN(mission_start) OVER (PARTITION BY hero_id), MAX(mission_end) OVER (PARTITION BY hero_id) FROM mission_spans ORDER BY 1, 2, 3",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.076,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 108,
    "db_id": "card_games",
    "sql_snippet": "SELECT percentile_cont(0.5) within group (ORDER by...",
    "valid": true,
    "error": null,
    "duration_ms": 0.9853839874267578,
    "input_sql_tokens": 20,
    "estimated_tokens": 98,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT percentile_cont(0.5) within group (ORDER by releasedate) FROM sets",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 109,
    "db_id": "formula_1",
    "sql_snippet": "CREATE TABLE race_incidents ( incident_type VARCHA...",
    "valid": true,
    "error": null,
    "duration_ms": 3.545522689819336,
    "input_sql_tokens": 47,
    "estimated_tokens": 131,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TABLE race_incidents ( incident_type VARCHAR(30) NOT NULL CHECK(incident_type = 'Engine failure' OR incident_type = 'Collision'), incident_description VARCHAR(30) NOT NULL);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.020000000000000004,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 110,
    "db_id": "financial",
    "sql_snippet": "select * from trans t1 where (account_id, trans_id...",
    "valid": true,
    "error": null,
    "duration_ms": 2.6166439056396484,
    "input_sql_tokens": 40,
    "estimated_tokens": 142,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select * from trans t1 where (account_id, trans_id) in (select account_id, max(trans_id) from trans t1 group by account_id);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09900000000000003,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 111,
    "db_id": "european_football_2",
    "sql_snippet": "WITH TAB AS (SELECT id as league_id, name FROM Lea...",
    "valid": false,
    "error": "Expecting (. Line 1, Col: 108.\n  ITH TAB AS (SELECT id as league_id, name FROM League UNION SELECT id, name FROM League) , RECURSIVE \u001b[4mrecuree\u001b[0m AS ( SELECT league_id, name FROM TAB UNION SELECT E.league_id, E.name FROM TAB E JOIN recuree S ON ",
    "duration_ms": 5.541324615478516,
    "input_sql_tokens": 77,
    "estimated_tokens": 238,
    "error_tokens": 85,
    "invalid_sql_tokens": 77,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unbalanced_tokens",
          "message": "Expecting (. Line 1, Col: 108.\n  ITH TAB AS (SELECT id as league_id, name FROM League UNION SELECT id, name FROM League) , RECURSIVE \u001b[4mrecuree\u001b[0m AS ( SELECT league_id, name FROM TAB UNION SELECT E.league_id, E.name FROM TAB E JOIN recuree S ON ",
          "location": null,
          "context": "Parser reported expecting parenthesis",
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "WITH TAB AS (SELECT id as league_id, name FROM League UNION SELECT id, name FROM League) , RECURSIVE recuree AS ( SELECT league_id, name FROM TAB UNION SELECT E.league_id, E.name FROM TAB E JOIN recuree S ON E.id = S.league_id)  SELECT * FROM recuree",
      "tags": [
        "syntax_unbalanced_tokens"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 112,
    "db_id": "superhero",
    "sql_snippet": "SELECT *\nFROM superhero.\"%_id\";",
    "valid": true,
    "error": null,
    "duration_ms": 2.019643783569336,
    "input_sql_tokens": 11,
    "estimated_tokens": 101,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT *\nFROM superhero.\"%_id\";",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 113,
    "db_id": "formula_1",
    "sql_snippet": "INSERT INTO races (raceid, year, round, circuitid,...",
    "valid": true,
    "error": null,
    "duration_ms": 3.631591796875,
    "input_sql_tokens": 92,
    "estimated_tokens": 181,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO races (raceid, year, round, circuitid, name, date, time, url)\nVALUES (\n    999,\n    2023,\n    1,\n    2,\n    'Test Grand Prix',\n    '2023-04-01',\n    '12:00:00',\n    'http://example.com'\n)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 114,
    "db_id": "formula_1",
    "sql_snippet": "SELECT\n    sub.raceId,\n    sub.t[1] AS \"Lap_Time_R...",
    "valid": true,
    "error": null,
    "duration_ms": 8.959770202636719,
    "input_sql_tokens": 120,
    "estimated_tokens": 233,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT\n    sub.raceId,\n    sub.t[1] AS \"Lap_Time_Race1\",\n    sub.t[2] AS \"Lap_Time_Race2\",\n    sub.t[3] AS \"Lap_Time_Race3\"\nFROM (\n    SELECT\n        driverId,\n        raceId,\n        ARRAY_AGG(milliseconds ORDER BY lap) AS t\n    FROM lapTimes\n    WHERE driverId = 1\n    GROUP BY driverId\n) AS sub\nORDER BY sub.raceId;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09900000000000003,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 115,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT * FROM Examination AS e LEFT JOIN LATERAL (...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0333995819091797,
    "input_sql_tokens": 34,
    "estimated_tokens": 138,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM Examination AS e LEFT JOIN LATERAL (SELECT * FROM Laboratory WHERE ID = e.ID ORDER BY Date DESC LIMIT 2) AS lab ON true",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.128,
        "pattern_signature": "SELECT-FROM-JOIN-LATERAL-WHERE-ORDER-LIMIT-SUBQUERY",
        "clauses_present": [
          "FROM",
          "JOIN",
          "LATERAL",
          "LIMIT",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 116,
    "db_id": "toxicology",
    "sql_snippet": "select a.f as \"id\", count(a.f) as \"num\" from ( sel...",
    "valid": true,
    "error": null,
    "duration_ms": 3.792285919189453,
    "input_sql_tokens": 60,
    "estimated_tokens": 170,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select a.f as \"id\", count(a.f) as \"num\" from ( select atom_id as f from connected union all select atom_id2 as f from connected ) a group by a.f order by count(a.f) desc limit 1;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09800000000000002,
        "pattern_signature": "SELECT-FROM-GROUP-UNION-ORDER-LIMIT-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "LIMIT",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 117,
    "db_id": "european_football_2",
    "sql_snippet": "CREATE OR REPLACE FUNCTION triger_function() RETUR...",
    "valid": true,
    "error": null,
    "duration_ms": 3.2858848571777344,
    "input_sql_tokens": 139,
    "estimated_tokens": 223,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION triger_function() RETURNS TRIGGER AS $BODY$ BEGIN INSERT INTO public.destination_table ( created_at, match_id, player_id, event_type, url, user_id) SELECT created_at, match_id, player_id, event_type, split_part(url::text, '?', 1) AS url, ((((data >> '{}')::jsonb >> '{}')::jsonb -> 'local_storage'::text) -> 'data'::text) >> '{}' -> 'user_id'::varchar FROM source_table; RETURN new; END; $BODY$ language plpgsql;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 118,
    "db_id": "european_football_2",
    "sql_snippet": "CREATE TRIGGER after_insert_source_error\nAFTER INS...",
    "valid": true,
    "error": null,
    "duration_ms": 1.6872882843017578,
    "input_sql_tokens": 33,
    "estimated_tokens": 103,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TRIGGER after_insert_source_error\nAFTER INSERT ON public.source_table\nFOR EACH ROW\nEXECUTE PROCEDURE trigger_function_error();",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 119,
    "db_id": "european_football_2",
    "sql_snippet": "INSERT INTO public.source_table (\n    created_at,\n...",
    "valid": true,
    "error": null,
    "duration_ms": 4.282474517822266,
    "input_sql_tokens": 120,
    "estimated_tokens": 213,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO public.source_table (\n    created_at,\n    match_id,\n    player_id,\n    event_type,\n    url,\n    data\n)\nVALUES (\n    NOW(),\n101,\n202,\n'goal',\n'http://example.com?foo=bar',\n'{\n        \"local_storage\": {\n            \"data\": {\n                \"user_id\": \"u12345\"\n            }\n        }\n    }'::jsonb\n);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 120,
    "db_id": "formula_1",
    "sql_snippet": "SELECT raceId, name, year, COUNT(*) AS same_year_r...",
    "valid": true,
    "error": null,
    "duration_ms": 3.3583641052246094,
    "input_sql_tokens": 27,
    "estimated_tokens": 105,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT raceId, name, year, COUNT(*) AS same_year_races FROM races GROUP BY raceid, name, year",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 121,
    "db_id": "superhero",
    "sql_snippet": "with hero_attribute_data (hero_id, attribute_id, m...",
    "valid": true,
    "error": null,
    "duration_ms": 15.59305191040039,
    "input_sql_tokens": 237,
    "estimated_tokens": 341,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "with hero_attribute_data (hero_id, attribute_id, max_score, year_1, year_2, year_3, year_4, year_5) as (values (1, 1, 80, 80, 80, 80, null, 80), (2, 2, 90, 90, 85, 90, 88, 90), (3, 3, 75, 75, 70, null, 75, 75), (4, 4, 60, null, 60, 60, 60, null)), score_check as (select *, case when (max_score <> year_1 or max_score <> year_2 or max_score <> year_3 or max_score <> year_4 or max_score <> year_5) then false else true end as is_a_match from hero_attribute_data) select * from score_check where is_a_match is false",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11100000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-VALUES",
        "clauses_present": [
          "CTE",
          "FROM",
          "SELECT",
          "VALUES",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 122,
    "db_id": "superhero",
    "sql_snippet": "select item_id, item_price as retail_price, sum(co...",
    "valid": true,
    "error": null,
    "duration_ms": 3.6330223083496094,
    "input_sql_tokens": 67,
    "estimated_tokens": 160,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select item_id, item_price as retail_price, sum(coalesce(uses_item_price, 0) * quantity) + sum(coalesce(resource_price*quantity, 0))  as partial_craft_price FROM store GROUP BY item_id, retail_price;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.022000000000000002,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 123,
    "db_id": "superhero",
    "sql_snippet": "UPDATE superhero SET full_name = 'Superman' JOIN t...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 48.\n  UPDATE superhero SET full_name = 'Superman' \u001b[4mJOIN\u001b[0m team_member_superhero ON superhero.id = team_member_superhero.superhero_id JOIN team_member ON team",
    "duration_ms": 2.0029544830322266,
    "input_sql_tokens": 66,
    "estimated_tokens": 205,
    "error_tokens": 67,
    "invalid_sql_tokens": 66,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 48.\n  UPDATE superhero SET full_name = 'Superman' \u001b[4mJOIN\u001b[0m team_member_superhero ON superhero.id = team_member_superhero.superhero_id JOIN team_member ON team",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "UPDATE superhero SET full_name = 'Superman' JOIN team_member_superhero ON superhero.id = team_member_superhero.superhero_id JOIN team_member ON team_member_superhero.team_member_id = team_member.id WHERE team_id = 91;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 124,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT p.id, CASE WHEN e.id = p.id AND e.diagnosis...",
    "valid": true,
    "error": null,
    "duration_ms": 8.199930191040039,
    "input_sql_tokens": 120,
    "estimated_tokens": 206,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT p.id, CASE WHEN e.id = p.id AND e.diagnosis = 'SLE' THEN TRUE ELSE FALSE END AS SLE, CASE WHEN e.id = p.id AND e.diagnosis = 'PSS' THEN TRUE ELSE FALSE END AS PSS, CASE WHEN e.id = p.id AND e.diagnosis = 'RA susp.' THEN TRUE ELSE FALSE END AS RA_susp FROM patient p LEFT JOIN examination e ON p.id = e.id WHERE e.diagnosis IN ('SLE', 'PSS', 'RA susp.') ORDER BY p.id DESC",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.082,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-ORDER",
        "clauses_present": [
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 125,
    "db_id": "superhero",
    "sql_snippet": "SELECT hbi.id, hbi.hero_name, hbi.birthdate, hbial...",
    "valid": true,
    "error": null,
    "duration_ms": 2.999544143676758,
    "input_sql_tokens": 59,
    "estimated_tokens": 152,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT hbi.id, hbi.hero_name, hbi.birthdate, hbialt.date_of_birth FROM hero_birth_info hbi LEFT JOIN hero_birth_info_alt hbialt ON hbi.id = hbialt.id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.045000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 126,
    "db_id": "superhero",
    "sql_snippet": "CREATE OR REPLACE FUNCTION reindex_superhero_ids(I...",
    "valid": true,
    "error": null,
    "duration_ms": 2.022981643676758,
    "input_sql_tokens": 109,
    "estimated_tokens": 193,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION reindex_superhero_ids(IN BIGINT) RETURNS VOID LANGUAGE SQL AS $$ CREATE TEMPORARY SEQUENCE id_seq_temp MINVALUE 1 START WITH 1 INCREMENT BY 1; ALTER SEQUENCE id_seq_temp RESTART; UPDATE superhero SET hair_colour_id=hair_colour_id+2000 WHERE publisher_id=$1; UPDATE superhero SET hair_colour_id=nextval('id_seq_temp') WHERE publisher_id=$1; $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 127,
    "db_id": "card_games",
    "sql_snippet": "UPDATE card_versions SET seqnr=seqnr+1 WHERE defn_...",
    "valid": true,
    "error": null,
    "duration_ms": 2.195596694946289,
    "input_sql_tokens": 38,
    "estimated_tokens": 127,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "UPDATE card_versions SET seqnr=seqnr+1 WHERE defn_id = 100 AND attr_id = 100 AND seqnr >= 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.037000000000000005,
        "pattern_signature": "WHERE-UPDATE",
        "clauses_present": [
          "UPDATE",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 128,
    "db_id": "european_football_2",
    "sql_snippet": "UPDATE team_attributes SET attributes_jsonb = json...",
    "valid": true,
    "error": null,
    "duration_ms": 2.509593963623047,
    "input_sql_tokens": 45,
    "estimated_tokens": 119,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "UPDATE team_attributes SET attributes_jsonb = jsonb_insert('{}', '{buildupplayspeed}', buildupplayspeed) WHERE team_api_id = 1773;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "WHERE-UPDATE",
        "clauses_present": [
          "UPDATE",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 129,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT id, attributes_jsonb FROM team_attributes W...",
    "valid": true,
    "error": null,
    "duration_ms": 1.523733139038086,
    "input_sql_tokens": 28,
    "estimated_tokens": 110,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT id, attributes_jsonb FROM team_attributes WHERE team_api_id = 1773 ORDER BY id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 130,
    "db_id": "toxicology",
    "sql_snippet": "WITH RECURSIVE atom_ancestors AS ( SELECT atom_id,...",
    "valid": true,
    "error": null,
    "duration_ms": 6.026506423950195,
    "input_sql_tokens": 78,
    "estimated_tokens": 180,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE atom_ancestors AS ( SELECT atom_id, parent_id, enabled FROM connection WHERE atom_id = 4 UNION ALL SELECT c.atom_id, c.parent_id, c.enabled FROM connection c INNER JOIN atom_ancestors aa ON c.atom_id = aa.parent_id) SELECT * FROM atom_ancestors",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.096,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-UNION",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 131,
    "db_id": "card_games",
    "sql_snippet": "select customerid,\n       (select jsonb_agg(t->>'d...",
    "valid": true,
    "error": null,
    "duration_ms": 7.210254669189453,
    "input_sql_tokens": 65,
    "estimated_tokens": 148,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select customerid,\n       (select jsonb_agg(t->>'dis') from jsonb_array_elements(preference::jsonb) as x(t) where t->>'dis' is not null) as sdata\nfrom card_preference where customerid='123.abc'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.1,
        "pattern_signature": "SELECT-FROM-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 132,
    "db_id": "superhero",
    "sql_snippet": "SELECT hero_id, 'attribute_value' AS Difference FR...",
    "valid": true,
    "error": null,
    "duration_ms": 8.528947830200195,
    "input_sql_tokens": 123,
    "estimated_tokens": 229,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT hero_id, 'attribute_value' AS Difference FROM hero_attribute\nGROUP BY hero_id HAVING COUNT(DISTINCT attribute_value) > 1\nOR (COUNT(attribute_value) != COUNT(*) AND COUNT(DISTINCT attribute_value) > 0)\nUNION ALL SELECT hero_id, 'attribute_id' AS Difference FROM hero_attribute GROUP BY hero_id\nHAVING COUNT(DISTINCT attribute_id) > 1 OR (COUNT(attribute_id) != COUNT(*)\nAND COUNT(DISTINCT attribute_id) > 0)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11200000000000002,
        "pattern_signature": "SELECT-FROM-GROUP-HAVING-UNION",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "SELECT",
          "UNION"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 8
      }
    }
  },
  {
    "query_idx": 133,
    "db_id": "student_club",
    "sql_snippet": "INSERT INTO member(member_id, first_name, last_nam...",
    "valid": true,
    "error": null,
    "duration_ms": 3.369569778442383,
    "input_sql_tokens": 74,
    "estimated_tokens": 163,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO member(member_id, first_name, last_name) VALUES ('new_member_id', 'John', 'Doe','rec06DF6vZ1CyPKpc') ON CONFLICT (member_id) DO UPDATE SET first_name=excluded.first_name, last_name=excluded.last_name;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 134,
    "db_id": "student_club",
    "sql_snippet": "SELECT COUNT(*) AS streak_count, 'April Meeting' A...",
    "valid": true,
    "error": null,
    "duration_ms": 3.9708614349365234,
    "input_sql_tokens": 89,
    "estimated_tokens": 179,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT COUNT(*) AS streak_count, 'April Meeting' AS event_name, 'MST' AS timezone, MIN(event_date) AS start_date, MAX(event_date) AS end_date FROM attendance WHERE event_name = 'April Meeting' GROUP BY DATE_TRUNC('day', event_date AT TIME ZONE 'UTC' AT TIME ZONE 'MST') ORDER BY end_date DESC LIMIT 1;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.035,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "GROUP",
          "LIMIT",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 135,
    "db_id": "formula_1",
    "sql_snippet": "SELECT DATE_TRUNC('day', to_timestamp(transaction_...",
    "valid": true,
    "error": null,
    "duration_ms": 2.0034313201904297,
    "input_sql_tokens": 47,
    "estimated_tokens": 125,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DATE_TRUNC('day', to_timestamp(transaction_timestamp / 1000000000.0)), COUNT(*) FROM pitstops GROUP BY DATE_TRUNC('day', transaction_timestamp)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 136,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "select a.id, a.date, a.got, a.gpt from laboratory ...",
    "valid": true,
    "error": null,
    "duration_ms": 5.247354507446289,
    "input_sql_tokens": 62,
    "estimated_tokens": 176,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select a.id, a.date, a.got, a.gpt from laboratory as a inner join ( select id, max(date) as date from laboratory group by id ) as b on a.id = b.id and a.date = b.date order by id, date",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.12700000000000003,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-GROUP-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 137,
    "db_id": "formula_1",
    "sql_snippet": "WITH constructor_roles AS ( SELECT 18 race_id, 1 c...",
    "valid": true,
    "error": null,
    "duration_ms": 9.536027908325195,
    "input_sql_tokens": 149,
    "estimated_tokens": 243,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH constructor_roles AS ( SELECT 18 race_id, 1 constructor_id, false customer_billing, true commander, true agent UNION ALL SELECT 18, 2, true, false, false ) SELECT n.race_id, string_agg(distinct CASE WHEN n.customer_billing = TRUE THEN 'AR (Customer Billing)' WHEN n.commander = TRUE THEN 'AP (Commander)' WHEN n.agent = TRUE THEN 'AP (Agent)' ELSE NULL END, ', ') AS finance FROM constructor_roles n WHERE n.race_id = 18 AND (n.customer_billing = TRUE or n.commander = TRUE or n.agent = TRUE) GROUP BY race_id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.097,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-GROUP-UNION",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 138,
    "db_id": "california_schools",
    "sql_snippet": "SELECT s.firstName, jsonb_agg(DISTINCT jsonb_build...",
    "valid": true,
    "error": null,
    "duration_ms": 12.026548385620117,
    "input_sql_tokens": 144,
    "estimated_tokens": 254,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT s.firstName, jsonb_agg(DISTINCT jsonb_build_object('yearId', y.id, 'classes', (SELECT jsonb_agg(jsonb_build_object('classId', c.id)) FROM classes AS c WHERE y.id = cy.yearId AND c.id = cy.classId AND s.id = cys.studentId))) AS years FROM users3 AS s LEFT JOIN classYearStudents AS cys ON cys.studentId = s.id LEFT JOIN classYears AS cy ON cy.id = cys.classYearId LEFT JOIN years AS y ON y.id = cy.yearId GROUP BY s.id order by s.id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.22800000000000004,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 3,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 139,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH RECURSIVE EmpMgrCTE AS (SELECT id, bossid, sa...",
    "valid": true,
    "error": null,
    "duration_ms": 8.224010467529297,
    "input_sql_tokens": 82,
    "estimated_tokens": 184,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE EmpMgrCTE AS (SELECT id, bossid, salary, 0 as EmployeeLevel FROM staff WHERE bossid IS NULL UNION ALL SELECT emp.id, emp.bossid, emp.salary, mgr.EmployeeLevel + 1 as EmployeeLevel FROM staff emp INNER JOIN EmpMgrCTE mgr ON emp.bossid = mgr.id) SELECT * FROM EmpMgrCTE emp",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.096,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-UNION",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 140,
    "db_id": "card_games",
    "sql_snippet": "select rarity, id from cards order by convertedman...",
    "valid": true,
    "error": null,
    "duration_ms": 4.007816314697266,
    "input_sql_tokens": 33,
    "estimated_tokens": 130,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select rarity, id from cards order by convertedmanacost desc nulls last, edhrecrank desc nulls last, multiverseid asc limit 1;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "LIMIT",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 141,
    "db_id": "financial",
    "sql_snippet": "DROP TABLE IF EXISTS card, account, disp;CREATE TA...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 26.\n  DROP TABLE IF EXISTS card\u001b[4m,\u001b[0m account, disp;CREATE TABLE account (account_id INT PRIMARY KEY NOT NULL, district_id INT NOT NULL, ",
    "duration_ms": 8.083343505859375,
    "input_sql_tokens": 126,
    "estimated_tokens": 255,
    "error_tokens": 58,
    "invalid_sql_tokens": 126,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 26.\n  DROP TABLE IF EXISTS card\u001b[4m,\u001b[0m account, disp;CREATE TABLE account (account_id INT PRIMARY KEY NOT NULL, district_id INT NOT NULL, ",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "DROP TABLE IF EXISTS card, account, disp;CREATE TABLE account (account_id INT PRIMARY KEY NOT NULL, district_id INT NOT NULL, frequency TEXT NOT NULL, date DATE NOT NULL, disp_id INT NOT NULL, FOREIGN KEY (disp_id) REFERENCES disp(disp_id) ON UPDATE CASCADE ON DELETE CASCADE);CREATE TABLE disp (disp_id INT PRIMARY KEY NOT NULL, client_id INT NOT NULL, account_id INT NOT NULL, type TEXT NOT NULL, FOREIGN KEY (account_id) REFERENCES account(account_id) ON UPDATE CASCADE ON DELETE CASCADE);",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 142,
    "db_id": "financial",
    "sql_snippet": "SELECT COALESCE(json_agg(CASE WHEN client.client_i...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 207.\n  _id', client.client_id, 'gender', client.gender, 'birth_date', client.birth_date) END), '[]') AS AS \u001b[4mclients\u001b[0m FROM client;",
    "duration_ms": 10.026931762695312,
    "input_sql_tokens": 67,
    "estimated_tokens": 206,
    "error_tokens": 67,
    "invalid_sql_tokens": 67,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 207.\n  _id', client.client_id, 'gender', client.gender, 'birth_date', client.birth_date) END), '[]') AS AS \u001b[4mclients\u001b[0m FROM client;",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT COALESCE(json_agg(CASE WHEN client.client_id IS NULL THEN NULL ELSE json_build_object('client_id', client.client_id, 'gender', client.gender, 'birth_date', client.birth_date) END), '[]') AS AS clients FROM client;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 143,
    "db_id": "debit_card_specializing",
    "sql_snippet": "select * from transactions_1k e\nwhere exists\n ( se...",
    "valid": true,
    "error": null,
    "duration_ms": 6.208181381225586,
    "input_sql_tokens": 97,
    "estimated_tokens": 199,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select * from transactions_1k e\nwhere exists\n ( select * from transactions_1k e2\n   where e.date=e2.date and e.time=e2.time\n     and e.cardid=e2.cardid\n     and e.gasstationid=e2.gasstationid\n     and e.productid='2' and e2.productid='5') order by e.date asc;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.07400000000000001,
        "pattern_signature": "SELECT-FROM-WHERE-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 144,
    "db_id": "financial",
    "sql_snippet": "select id, amount as cum_sum, 1 as bucket from tra...",
    "valid": true,
    "error": null,
    "duration_ms": 7.689952850341797,
    "input_sql_tokens": 88,
    "estimated_tokens": 189,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select id, amount as cum_sum, 1 as bucket from transfer where id = 1 union all select transfer.id, (case when cum_sum + amount > 20 then amount else cum_sum + amount end), (case when cum_sum + amount > 20 then bucket + 1 else bucket end) from cte join transfer on transfer.id = cte.id + 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.052000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-UNION",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "UNION",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 145,
    "db_id": "formula_1",
    "sql_snippet": "SELECT raceid mode() within group(order by laps) a...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 19.\n  SELECT raceid mode\u001b[4m(\u001b[0m) within group(order by laps) as modal_laps FROM results;",
    "duration_ms": 43.85495185852051,
    "input_sql_tokens": 20,
    "estimated_tokens": 139,
    "error_tokens": 47,
    "invalid_sql_tokens": 20,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 19.\n  SELECT raceid mode\u001b[4m(\u001b[0m) within group(order by laps) as modal_laps FROM results;",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT raceid mode() within group(order by laps) as modal_laps FROM results;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 146,
    "db_id": "card_games",
    "sql_snippet": "select t1.table_name as t1_table_name, t2.table_na...",
    "valid": true,
    "error": null,
    "duration_ms": 8.014440536499023,
    "input_sql_tokens": 82,
    "estimated_tokens": 179,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select t1.table_name as t1_table_name, t2.table_name as t2_extra_tables_in_schema from required_tables t1 right join information_schema.tables t2 on t1.table_name = t2.table_name where t2.table_schema='public' and t1.table_name IS NULL;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.062000000000000006,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 147,
    "db_id": "card_games",
    "sql_snippet": "select t1.table_name as t1_tables_missing_from_sch...",
    "valid": true,
    "error": null,
    "duration_ms": 10.001897811889648,
    "input_sql_tokens": 75,
    "estimated_tokens": 172,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select t1.table_name as t1_tables_missing_from_schema, t2.table_name from required_tables t1 left join information_schema.tables t2 on t1.table_name = t2.table_name where t2.table_schema='public' and t2.table_name IS NULL;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.062000000000000006,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 148,
    "db_id": "european_football_2",
    "sql_snippet": "update match set stage = stage + 1 where id = 'mat...",
    "valid": true,
    "error": null,
    "duration_ms": 4.044771194458008,
    "input_sql_tokens": 17,
    "estimated_tokens": 91,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "update match set stage = stage + 1 where id = 'match1';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "WHERE-UPDATE",
        "clauses_present": [
          "UPDATE",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 149,
    "db_id": "california_schools",
    "sql_snippet": "with hero_attribute(hero_id, attribute_id, attribu...",
    "valid": true,
    "error": null,
    "duration_ms": 9.359359741210938,
    "input_sql_tokens": 106,
    "estimated_tokens": 211,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "with hero_attribute(hero_id, attribute_id, attribute_value) as ( values (1, 1, 80), (2, 1, 75), (3, 1, 95), (4, 1, 85), (5, 1, 90), (6, 1, 70) ) select sum(attribute_value) from hero_attribute group by (hero_id-1) / 2;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.060000000000000005,
        "pattern_signature": "WITH-CTE-SELECT-FROM-GROUP-VALUES",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "SELECT",
          "VALUES",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 150,
    "db_id": "european_football_2",
    "sql_snippet": "select id, name, d ->> 'description' as skill from...",
    "valid": true,
    "error": null,
    "duration_ms": 4.001379013061523,
    "input_sql_tokens": 30,
    "estimated_tokens": 108,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select id, name, d ->> 'description' as skill from player_skills, json_array_elements(skills) as d;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.035,
        "pattern_signature": "SELECT-FROM-JOIN",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 151,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT CASE when (t.events::json->0->'id')::varcha...",
    "valid": true,
    "error": null,
    "duration_ms": 11.631011962890625,
    "input_sql_tokens": 115,
    "estimated_tokens": 204,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT CASE when (t.events::json->0->'id')::varchar::int = 2 then (t.events::json->0)::varchar when (t.events::json->1->'id')::varchar::int = 2 then (t.events::json->1)::varchar when (t.events::json->2->'id')::varchar::int = 2 then (t.events::json->2)::varchar else null::varchar end as \"result\" FROM match_events as t;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 152,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT COUNT(\"ANA Pattern\") AS c, \"ANA Pattern\", E...",
    "valid": true,
    "error": null,
    "duration_ms": 6.110906600952148,
    "input_sql_tokens": 72,
    "estimated_tokens": 162,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT COUNT(\"ANA Pattern\") AS c, \"ANA Pattern\", EXTRACT(YEAR FROM \"Examination Date\") AS examination_year FROM examination WHERE EXTRACT(YEAR FROM \"Examination Date\") BETWEEN 1993 AND 1996 GROUP BY EXTRACT(YEAR FROM \"Examination Date\"), \"ANA Pattern\" ORDER BY examination_year, c DESC;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.023,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 153,
    "db_id": "european_football_2",
    "sql_snippet": "WITH player_names AS (SELECT 1 AS source, ROW_NUMB...",
    "valid": true,
    "error": null,
    "duration_ms": 15.343189239501953,
    "input_sql_tokens": 179,
    "estimated_tokens": 297,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH player_names AS (SELECT 1 AS source, ROW_NUMBER() OVER (ORDER BY player_name) AS row_number, CONCAT(player_name, '(', LEFT(birthday, 4), ')') AS dest FROM player_table), birth_year_summary AS (SELECT 2 AS source, ROW_NUMBER() OVER (ORDER BY COUNT(*), LEFT(birthday, 4)) AS row_number, CONCAT('There are a total of ', COUNT(*), ' player', CASE WHEN COUNT(*) > 1 THEN 's' ELSE '' END, ' born in ', LEFT(birthday, 4), '.') AS dest FROM player_table GROUP BY LEFT(birthday, 4)) SELECT dest FROM (SELECT * FROM player_names UNION ALL SELECT * FROM birth_year_summary) AS combined_results ORDER BY ROW_NUM;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.12400000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-GROUP-WINDOW-UNION-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 2,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 154,
    "db_id": "formula_1",
    "sql_snippet": "SELECT rs.raceId AS race_id, string_agg(constructo...",
    "valid": true,
    "error": null,
    "duration_ms": 6.145000457763672,
    "input_sql_tokens": 92,
    "estimated_tokens": 178,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT rs.raceId AS race_id, string_agg(constructorId::TEXT, ',' ORDER BY res.resultId) AS constructor_ids, string_agg(p.stop::TEXT, ', ' ORDER BY p.raceId) AS stops FROM races rs LEFT JOIN results res ON res.raceId = rs.raceId LEFT JOIN pitstops p ON rs.raceId = p.raceId GROUP BY rs.raceId",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.092,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 155,
    "db_id": "formula_1",
    "sql_snippet": "SELECT r.id, r.start_day, r.end_day, de.point_of_d...",
    "valid": true,
    "error": null,
    "duration_ms": 12.072324752807617,
    "input_sql_tokens": 174,
    "estimated_tokens": 264,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT r.id, r.start_day, r.end_day, de.point_of_delivery_plant_name, de.point_of_delivery_plant_number, de.visit_status FROM route r JOIN route_detail de ON de.route_id = r.id WHERE NOT EXISTS (SELECT 1 FROM route ro JOIN route_detail rd ON rd.route_id = ro.id JOIN route_event ev ON ev.route_detail_id = rd.id WHERE rd.route_id = r.id AND ev.event_type !=3 AND rd.visit_status = '5' AND rd.id = de.id) AND de.visit_status = '5' GROUP BY 1,2,3,4,5,6 ORDER BY r.id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.159,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 3,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 156,
    "db_id": "european_football_2",
    "sql_snippet": "CREATE OR REPLACE FUNCTION update_team_attributes_...",
    "valid": true,
    "error": null,
    "duration_ms": 4.414558410644531,
    "input_sql_tokens": 182,
    "estimated_tokens": 266,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION update_team_attributes_eff_to() RETURNS TRIGGER AS $$ BEGIN UPDATE team_attributes SET eff_to = subquery.next_date FROM ( SELECT COALESCE( LEAD(TO_TIMESTAMP(date, 'YYYY-MM-DD HH24:MI:SS')::DATE, 1) OVER ( ORDER BY TO_TIMESTAMP(date, 'YYYY-MM-DD HH24:MI:SS')::DATE DESC), TO_DATE('6000-00-00', 'YYYY-MM-DD') ) - 1 AS next_date FROM team_attributes ) AS subquery; RETURN NULL; END; $$ LANGUAGE plpgsql;CREATE OR REPLACE TRIGGER after_insert_team_attributes AFTER INSERT ON team_attributes FOR EACH ROW EXECUTE PROCEDURE update_team_attributes_eff_to();",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 157,
    "db_id": "formula_1",
    "sql_snippet": "select position, array_agg(driverid) as driverids ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.8094520568847656,
    "input_sql_tokens": 27,
    "estimated_tokens": 115,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select position, array_agg(driverid) as driverids from results group by position having COUNT(*)>1 order by position",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.029,
        "pattern_signature": "SELECT-FROM-GROUP-HAVING-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 158,
    "db_id": "superhero",
    "sql_snippet": "WITH RECURSIVE cte AS ( SELECT id, parent_id, colo...",
    "valid": true,
    "error": null,
    "duration_ms": 9.782791137695312,
    "input_sql_tokens": 148,
    "estimated_tokens": 246,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE cte AS ( SELECT id, parent_id, color FROM superhero2 WHERE parent_id IS NULL UNION ALL SELECT s.id, s.parent_id, CASE WHEN c1.color IS NULL THEN c2.color WHEN c2.color IS NULL THEN c1.color WHEN c1.color = c2.color THEN c1.color ELSE 'gray' END AS color FROM superhero2 s LEFT JOIN cte c1 ON s.id = c1.parent_id LEFT JOIN cte c2 ON s.id = c2.parent_id ) UPDATE superhero2 SET color = cte.color FROM cte WHERE superhero2.id = cte.id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.128,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-UNION-UPDATE",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "SELECT",
          "UNION",
          "UPDATE",
          "WHERE",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 159,
    "db_id": "card_games",
    "sql_snippet": "SELECT artist, setcode, COUNT(setcode) AS counter ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.9620399475097656,
    "input_sql_tokens": 36,
    "estimated_tokens": 124,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT artist, setcode, COUNT(setcode) AS counter FROM cards GROUP BY setcode, artist HAVING COUNT(setcode) > 1 ORDER BY counter DESC;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.029,
        "pattern_signature": "SELECT-FROM-GROUP-HAVING-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 160,
    "db_id": "formula_1",
    "sql_snippet": "SELECT *\nFROM jsonb_to_record(circuit_id_name) AS ...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 3, Col: 4.\n  SELECT *\nFROM jsonb_to_record(circuit_id_name) AS x(circuitid int, name text)\n\u001b[4mFROM\u001b[0m circuit_json;",
    "duration_ms": 4.533052444458008,
    "input_sql_tokens": 36,
    "estimated_tokens": 170,
    "error_tokens": 61,
    "invalid_sql_tokens": 36,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 3, Col: 4.\n  SELECT *\nFROM jsonb_to_record(circuit_id_name) AS x(circuitid int, name text)\n\u001b[4mFROM\u001b[0m circuit_json;",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT *\nFROM jsonb_to_record(circuit_id_name) AS x(circuitid int, name text)\nFROM circuit_json;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 161,
    "db_id": "financial",
    "sql_snippet": "SELECT y.district_id,\n       CASE WHEN y.status IN...",
    "valid": true,
    "error": null,
    "duration_ms": 7.669210433959961,
    "input_sql_tokens": 125,
    "estimated_tokens": 223,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT y.district_id,\n       CASE WHEN y.status IN ('A', 'B') THEN array_agg(loan_id) END AS type_A_B,\n       CASE WHEN y.status = 'C' THEN array_agg(loan_id) END AS type_C\nFROM (\n  SELECT x.district_id, l.loan_id, l.status\n  FROM loan l\n  JOIN account x ON l.account_id = x.account_id\n) y\nGROUP BY 1, y.status\nORDER BY 1;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.133,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 162,
    "db_id": "superhero",
    "sql_snippet": "SELECT ts, superhero_id, activity_code, LEAD(ts) O...",
    "valid": true,
    "error": null,
    "duration_ms": 2.0117759704589844,
    "input_sql_tokens": 39,
    "estimated_tokens": 121,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT ts, superhero_id, activity_code, LEAD(ts) OVER (PARTITION BY superhero_id, activity_code ORDER BY ts) as next_ts FROM superhero_activities",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 163,
    "db_id": "card_games",
    "sql_snippet": "SELECT count(*) FROM card_matches INNER JOIN card_...",
    "valid": true,
    "error": null,
    "duration_ms": 2.9909610748291016,
    "input_sql_tokens": 53,
    "estimated_tokens": 143,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT count(*) FROM card_matches INNER JOIN card_players ON card_matches.player1_id = card_players.id OR card_matches.player2_id = card_players.id WHERE card_players.type = 'Pro'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.068,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 164,
    "db_id": "european_football_2",
    "sql_snippet": "WITH all_dates AS (SELECT league_id, season, ARRAY...",
    "valid": true,
    "error": null,
    "duration_ms": 6.74128532409668,
    "input_sql_tokens": 123,
    "estimated_tokens": 223,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH all_dates AS (SELECT league_id, season, ARRAY_AGG(DISTINCT id order by id) as match_ids, date AS match_date FROM match WHERE season IS NOT NULL AND league_id IS NOT NULL AND id is not null AND date IS NOT NULL GROUP BY league_id, season, date) SELECT DISTINCT league_id, season, match_ids, ARRAY_AGG(DISTINCT all_dates.match_date ORDER BY match_date) AS dates FROM all_dates GROUP BY season, league_id, match_ids order by league_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.113,
        "pattern_signature": "WITH-CTE-SELECT-DISTINCT-FROM-WHERE-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "DISTINCT",
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 165,
    "db_id": "card_games",
    "sql_snippet": "select * from crosstab ('select id, uuid, text fro...",
    "valid": true,
    "error": null,
    "duration_ms": 2.212047576904297,
    "input_sql_tokens": 42,
    "estimated_tokens": 114,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select * from crosstab ('select id, uuid, text from ruling order by 1,2') AS final_result(id int, uuid1 text, uuid2 text, uuid3 text);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 166,
    "db_id": "card_games",
    "sql_snippet": "SELECT c.*\nFROM cards_info c\nWHERE NOT EXISTS (\n  ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.9932727813720703,
    "input_sql_tokens": 58,
    "estimated_tokens": 156,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT c.*\nFROM cards_info c\nWHERE NOT EXISTS (\n    SELECT 1\n    FROM card_choice cc\n    WHERE cc.card_id = c.id\n    AND c.id = ANY (cc.non_valid_cards)\n);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.044000000000000004,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 167,
    "db_id": "card_games",
    "sql_snippet": "WITH RECURSIVE nodes AS (\n    SELECT\n        uuid,...",
    "valid": true,
    "error": null,
    "duration_ms": 6.280660629272461,
    "input_sql_tokens": 107,
    "estimated_tokens": 214,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE nodes AS (\n    SELECT\n        uuid,\n        card_name AS name,\n        ARRAY[]::uuid[] AS parents\n    FROM card_type\n    WHERE parent_uuid IS NULL\n\n    UNION ALL\n\n    SELECT\n        c.uuid,\n        c.card_name AS name,\n        nodes.parents || c.uuid\n    FROM card_type c\n    JOIN nodes ON nodes.uuid = c.parent_uuid\n)\nSELECT * FROM nodes;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.096,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-UNION",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 168,
    "db_id": "student_club",
    "sql_snippet": "SELECT d.the_day AS \"Date\", COUNT(e.event_id) AS \"...",
    "valid": true,
    "error": null,
    "duration_ms": 6.067514419555664,
    "input_sql_tokens": 142,
    "estimated_tokens": 248,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT d.the_day AS \"Date\", COUNT(e.event_id) AS \"Number of Events\", AVG(b.remaining) AS \"Avg Remaining Budget\" FROM (SELECT ts::date AS the_day FROM generate_series (timestamp '2020-01-01', timestamp '2020-03-31', interval '1 day'::interval) ts) d LEFT JOIN \"event\" e ON e.event_date::date = d.the_day LEFT JOIN budget b ON b.link_to_event = e.event_id GROUP BY d.the_day ORDER BY d.the_day;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.15800000000000003,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 2,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 169,
    "db_id": "financial",
    "sql_snippet": "SELECT LPAD(extract (month from trans.date)::text,...",
    "valid": true,
    "error": null,
    "duration_ms": 3.6377906799316406,
    "input_sql_tokens": 81,
    "estimated_tokens": 167,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT LPAD(extract (month from trans.date)::text, 2, '0') as month, sum(trans.amount) as a1997 from trans WHERE trans.date >= '1997-01-01' and trans.date < '1998-01-01' group by month order by 1;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.033,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 170,
    "db_id": "formula_1",
    "sql_snippet": "SELECT * FROM circuits WHERE ST_DWithin(ST_SetSRID...",
    "valid": true,
    "error": null,
    "duration_ms": 6.516218185424805,
    "input_sql_tokens": 153,
    "estimated_tokens": 231,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM circuits WHERE ST_DWithin(ST_SetSRID(ST_MakePoint(lng, lat), 4326)::geography, ST_ClosestPoint((ST_MakePoint(lng, lat), 4326)::geography, ST_Collect(Array[ST_SetSRID(ST_MakePoint(2.76083, 101.73800), 4326)::geography, ST_SetSRID(ST_MakePoint(26.03250, 50.51060), 4326)::geography])), 1000000, FALSE);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 171,
    "db_id": "card_games",
    "sql_snippet": "CREATE OR REPLACE FUNCTION words_get_chat(in_gid i...",
    "valid": true,
    "error": null,
    "duration_ms": 2.998828887939453,
    "input_sql_tokens": 136,
    "estimated_tokens": 220,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION words_get_chat(in_gid integer, in_social integer, in_sid text) RETURNS TABLE (out_mine integer, out_msg text) AS $func$ SELECT CASE WHEN c.uid = s.uid THEN 1 ELSE 0 END, c.msg FROM words_chat c JOIN words_games g USING (gid) JOIN words_social s ON s.uid IN (g.player1, g.player2) WHERE c.gid = in_gid AND s.social = in_social AND s.sid = in_sid ORDER BY c.CREATED ASC; $func$ LANGUAGE sql;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 172,
    "db_id": "card_games",
    "sql_snippet": "SELECT words_get_chat(10, 100, 'abc') AS nice_user...",
    "valid": true,
    "error": null,
    "duration_ms": 1.0194778442382812,
    "input_sql_tokens": 24,
    "estimated_tokens": 92,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT words_get_chat(10, 100, 'abc') AS nice_user;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "SELECT",
        "clauses_present": [
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 173,
    "db_id": "formula_1",
    "sql_snippet": "SELECT driverid, points, (points * 100) as earning...",
    "valid": true,
    "error": null,
    "duration_ms": 3.9949417114257812,
    "input_sql_tokens": 87,
    "estimated_tokens": 176,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT driverid, points, (points * 100) as earnings, CASE WHEN (points * 100) > 5000 THEN (points * 100) * 0.2 WHEN (points * 100) > 3000 THEN (points * 100) * 0.15 ELSE null END AS bonus FROM driverstandings",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 174,
    "db_id": "european_football_2",
    "sql_snippet": "with dataset as (\n  SELECT\n      date,\n      COUNT...",
    "valid": true,
    "error": null,
    "duration_ms": 5.176067352294922,
    "input_sql_tokens": 157,
    "estimated_tokens": 257,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "with dataset as (\n  SELECT\n      date,\n      COUNT(*) as rows_added\n  FROM\n      team_attributes\n  WHERE\n      date between '2010-01-01 00:00:00'\n      AND '2015-12-31 00:00:00'\n  GROUP BY\n      date\n )\nSELECT\n    COUNT(*) as total_days_in_result_set,\n    COUNT(DISTINCT rows_added) as total_days_w_distinct_record_counts,\n    COUNT(*) - COUNT(DISTINCT rows_added) as toal_days_w_duplicate_record_counts\nFROM dataset",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.101,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-GROUP",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 5
      }
    }
  },
  {
    "query_idx": 175,
    "db_id": "card_games",
    "sql_snippet": "insert into card_counters (card_name, counters) va...",
    "valid": true,
    "error": null,
    "duration_ms": 4.67228889465332,
    "input_sql_tokens": 67,
    "estimated_tokens": 141,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "insert into card_counters (card_name, counters) values ('Lightning Bolt', array[2,0,2,1]) on conflict (card_name) do update set counters = array_agg(unnest(card_counters.counters) + unnest(array[2,0,2,1]))",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 176,
    "db_id": "erolp",
    "sql_snippet": "select id, round(prev + event * sum(prev) over(ord...",
    "valid": true,
    "error": null,
    "duration_ms": 4.510164260864258,
    "input_sql_tokens": 75,
    "estimated_tokens": 177,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select id, round(prev + event * sum(prev) over(order by id range between unbounded preceding and 1 preceding)::numeric(10, 6), 6) as not_quite_my_tempo from (select *, event*sum(trx) over(order by id) as prev from sales_transactions) t order by id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09800000000000002,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 177,
    "db_id": "california_schools",
    "sql_snippet": "WITH cte_funding_count AS (SELECT fundingtype, COU...",
    "valid": true,
    "error": null,
    "duration_ms": 4.530429840087891,
    "input_sql_tokens": 63,
    "estimated_tokens": 169,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH cte_funding_count AS (SELECT fundingtype, COUNT(*) AS count FROM schools GROUP BY fundingtype) SELECT fundingtype, count, ROUND(count*100/(SELECT SUM(count) FROM cte_funding_count),0) AS percent FROM cte_funding_count",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10800000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-GROUP-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "SELECT",
          "SUBQUERY",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 1,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 178,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT lab.date AS firstActivity, pat.id FROM pati...",
    "valid": true,
    "error": null,
    "duration_ms": 4.012346267700195,
    "input_sql_tokens": 56,
    "estimated_tokens": 156,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT lab.date AS firstActivity, pat.id FROM patient pat JOIN laboratory lab ON lab.id = pat.id AND lab.date <= pat.description AND lab.date > pat.\"First Date\" WHERE pat.sex='F' order by pat.id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.07200000000000001,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-ORDER",
        "clauses_present": [
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 179,
    "db_id": "card_games",
    "sql_snippet": "select id, array_agg(elem) from cards, unnest(stri...",
    "valid": true,
    "error": null,
    "duration_ms": 4.999876022338867,
    "input_sql_tokens": 69,
    "estimated_tokens": 159,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select id, array_agg(elem) from cards, unnest(string_to_array(cards.keywords, ',')::text[]) elem where elem <> all(SELECT unnest(sq.RemoveKeywords) from SelectQuery sq) and id in (61, 65) group by id order by id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.068,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 180,
    "db_id": "toxicology",
    "sql_snippet": "SELECT date_trunc('week', \"TIMESTAMP\") AS week, co...",
    "valid": true,
    "error": null,
    "duration_ms": 4.688262939453125,
    "input_sql_tokens": 103,
    "estimated_tokens": 192,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT date_trunc('week', \"TIMESTAMP\") AS week, count(*), AVG(\"CL\") AS cl, AVG(\"C\") AS c FROM \"Experiment\" WHERE \"TIMESTAMP\" >= '2021-01-07T00:00:00.000Z' AND \"TIMESTAMP\" <= '2022-01-06T23:59:59.999Z' GROUP BY week ORDER BY week ASC",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.045,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 181,
    "db_id": "financial",
    "sql_snippet": "CREATE FUNCTION calculate_loan_status()\n    RETURN...",
    "valid": true,
    "error": null,
    "duration_ms": 1.9938945770263672,
    "input_sql_tokens": 96,
    "estimated_tokens": 167,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE FUNCTION calculate_loan_status()\n    RETURNS SETOF loan_last\n    AS $$\n    DECLARE temp_table TABLE (loan_id int, status text);\n    BEGIN INSERT INTO temp_table\n    SELECT loan_id, status FROM loan_first WHERE status = 'A';\n    INSERT INTO loan_last SELECT loan_id, status FROM temp_table;\n    RETURN;\n    END;\n    $$ LANGUAGE plpgsql;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 182,
    "db_id": "superhero",
    "sql_snippet": "UPDATE superhero SET total_powers = (SELECT COUNT(...",
    "valid": true,
    "error": null,
    "duration_ms": 1.8036365509033203,
    "input_sql_tokens": 21,
    "estimated_tokens": 119,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "UPDATE superhero SET total_powers = (SELECT COUNT(power_id) FROM hero_power);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10200000000000002,
        "pattern_signature": "SELECT-FROM-UPDATE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY",
          "UPDATE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 183,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT ID, Date, GOT, GPT FROM Laboratory GROUP BY...",
    "valid": true,
    "error": null,
    "duration_ms": 2.9478073120117188,
    "input_sql_tokens": 26,
    "estimated_tokens": 114,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT ID, Date, GOT, GPT FROM Laboratory GROUP BY ID HAVING COUNT(ID) > 1 ORDER BY Date DESC",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.023,
        "pattern_signature": "SELECT-FROM-GROUP-HAVING-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 184,
    "db_id": "formula_1",
    "sql_snippet": "select (coalesce(circui_name_A1, '') || ' ' || coa...",
    "valid": true,
    "error": null,
    "duration_ms": 5.432367324829102,
    "input_sql_tokens": 106,
    "estimated_tokens": 195,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select (coalesce(circui_name_A1, '') || ' ' || coalesce(circui_name_A2,'') || ' ' || coalesce(circui_name_A3, '')) as A, (coalesce(circui_name_B1, '') || ' ' || coalesce(circui_name_B2,'') || ' ' || coalesce(circui_name_B3, '')) as B from race_info;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 185,
    "db_id": "card_games",
    "sql_snippet": "WITH s as ( SELECT DATE(date_value) as dt, date_va...",
    "valid": true,
    "error": null,
    "duration_ms": 9.521722793579102,
    "input_sql_tokens": 160,
    "estimated_tokens": 290,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH s as ( SELECT DATE(date_value) as dt, date_value, card_id cid, price FROM card_prices ) SELECT cid, dt, date_value, s.price as second_price FROM s INNER JOIN ( SELECT q.card_id, DATE(q.date_value) as dat FROM card_prices q GROUP BY q.card_id, dat ORDER BY q.card_id ASC ) as end_price ON s.cid = end_price.card_id AND s.date_value = (SELECT date_value FROM s WHERE s.cid = end_price.card_id AND s.dt = end_price.dat LIMIT 1) + interval '15 minutes' ORDER BY cid, dt;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.18000000000000005,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-ORDER-LIMIT-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "LIMIT",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 2,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 186,
    "db_id": "toxicology",
    "sql_snippet": "SELECT b.bond_id as current_bond, b2.bond_id as ne...",
    "valid": true,
    "error": null,
    "duration_ms": 3.843069076538086,
    "input_sql_tokens": 73,
    "estimated_tokens": 167,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT b.bond_id as current_bond, b2.bond_id as next_bond, b.bond_type as bond_type FROM bond b INNER JOIN bond b2 ON b.molecule_id = b2.molecule_id WHERE b.bond_id < b2.bond_id ORDER BY b.bond_id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.042,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-WHERE-ORDER",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 187,
    "db_id": "toxicology",
    "sql_snippet": "SELECT timestamp, avg(strength) FROM bond_strength...",
    "valid": true,
    "error": null,
    "duration_ms": 3.5207271575927734,
    "input_sql_tokens": 49,
    "estimated_tokens": 131,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT timestamp, avg(strength) FROM bond_strength WHERE timestamp >= ('2023-10-01 02:30:00'::timestamp - INTERVAL '1 hour') GROUP BY timestamp, strength",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.023,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 188,
    "db_id": "card_games",
    "sql_snippet": "select jsonb_set(t.data, '{purchaseurls}',  (selec...",
    "valid": false,
    "error": "Unbalanced parentheses or brackets",
    "duration_ms": 4.997968673706055,
    "input_sql_tokens": 81,
    "estimated_tokens": 155,
    "error_tokens": 6,
    "invalid_sql_tokens": 81,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unbalanced_tokens",
          "message": "Unbalanced parentheses or brackets",
          "location": null,
          "context": "1 unclosed '('",
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "select jsonb_set(t.data, '{purchaseurls}',  (select jsonb_agg(case when v.value::text ~ 'tcgplayer' or v.value::text ~ 'cardKingdom' then md5(substring(v.value::text)), jsonb_array_elements(t.data -> 'purchaseurls') v))  from cards_info",
      "tags": [
        "syntax_unbalanced_tokens"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 189,
    "db_id": "erolp",
    "sql_snippet": "WITH RNG AS(SELECT date_num, product_id, sales_val...",
    "valid": true,
    "error": null,
    "duration_ms": 5.6552886962890625,
    "input_sql_tokens": 82,
    "estimated_tokens": 190,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RNG AS(SELECT date_num, product_id, sales_value FROM sales_data WHERE (date_num = 123 OR date_num=567) ORDER BY date_num) SELECT date_num, product_id, sales_value, SUM(sales_value) AS trend FROM RNG group by date_num, product_id, sales_value",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08700000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 190,
    "db_id": "superhero",
    "sql_snippet": "DROP TABLE IF EXISTS temp_superhero;",
    "valid": true,
    "error": null,
    "duration_ms": 0.0,
    "input_sql_tokens": 10,
    "estimated_tokens": 94,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DROP TABLE IF EXISTS temp_superhero;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 191,
    "db_id": "superhero",
    "sql_snippet": "CREATE TABLE temp_superhero (id int);",
    "valid": true,
    "error": null,
    "duration_ms": 1.0001659393310547,
    "input_sql_tokens": 11,
    "estimated_tokens": 95,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TABLE temp_superhero (id int);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 192,
    "db_id": "superhero",
    "sql_snippet": "CREATE OR REPLACE FUNCTION insert_and_return(int) ...",
    "valid": true,
    "error": null,
    "duration_ms": 0.9987354278564453,
    "input_sql_tokens": 39,
    "estimated_tokens": 123,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION insert_and_return(int) RETURNS int AS $$ BEGIN INSERT INTO temp_superhero VALUES ($1); RETURN $1; END; $$ LANGUAGE plpgsql;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 193,
    "db_id": "superhero",
    "sql_snippet": "SELECT * FROM insert_and_return(10), temp_superher...",
    "valid": true,
    "error": null,
    "duration_ms": 1.9865036010742188,
    "input_sql_tokens": 20,
    "estimated_tokens": 98,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM insert_and_return(10), temp_superhero AS y;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.035,
        "pattern_signature": "SELECT-FROM-JOIN",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 194,
    "db_id": "toxicology",
    "sql_snippet": "SELECT count(*) FROM (SELECT DISTINCT molecule_id ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.8281211853027344,
    "input_sql_tokens": 46,
    "estimated_tokens": 156,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT count(*) FROM (SELECT DISTINCT molecule_id FROM bond GROUP BY molecule_id HAVING COUNT(CASE WHEN bond_type = '-' THEN 1 END) = 0) AS molecule_without_bond_type;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10500000000000002,
        "pattern_signature": "SELECT-DISTINCT-FROM-GROUP-HAVING-SUBQUERY",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "GROUP",
          "HAVING",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 195,
    "db_id": "card_games",
    "sql_snippet": "create or replace function setup_vector_store(tabl...",
    "valid": true,
    "error": null,
    "duration_ms": 3.709554672241211,
    "input_sql_tokens": 175,
    "estimated_tokens": 243,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "create or replace function setup_vector_store(table_name text) returns void language plpgsql as $$ begin execute 'drop function if exists match_strategies(int, jsonb)'; execute format('create table %I ( id bigint primary key generated always as identity, description text, metadata jsonb )', table_name); execute format('create function match_strategies ( match_count int default null, filter jsonb default \"{}\"::jsonb ) returns table ( id bigint, description text, metadata jsonb, similarity float ) language plpgsql as $$ begin return query select id, description, metadata, 1 as similarity from %I where metadata @> filter order by ''%I''.embedding <=> query_embedding limit match_count; end;$$;', table_name, table_name, table_name); end; $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 196,
    "db_id": "erolp",
    "sql_snippet": "WITH variables_array AS (SELECT datapoint_id, ARRA...",
    "valid": true,
    "error": null,
    "duration_ms": 7.737159729003906,
    "input_sql_tokens": 143,
    "estimated_tokens": 245,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH variables_array AS (SELECT datapoint_id, ARRAY_AGG(variablevalue_id) AS varvalues FROM datapoint_variablevalue GROUP BY datapoint_id) SELECT COALESCE(SUM(dp.value),0), sd.name AS sp_name, v.varvalues AS varvalues, td.years AS years FROM variables_array v CROSS JOIN spatial_dimension sd CROSS JOIN time_dimension td LEFT JOIN datapoints dp ON dp.id = v.datapoint_id AND dp.spatial_dimension_id = sd.id AND dp.time_dimension_id = td.id GROUP BY years, sp_name, varvalues ORDER BY years DESC",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.201,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_CROSS-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_CROSS",
          "ORDER",
          "SELECT",
          "WITH"
        ],
        "num_joins": 3,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 197,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT count(*) AS exact_count FROM match;",
    "valid": true,
    "error": null,
    "duration_ms": 1.0342597961425781,
    "input_sql_tokens": 11,
    "estimated_tokens": 85,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT count(*) AS exact_count FROM match;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 198,
    "db_id": "european_football_2",
    "sql_snippet": "CREATE OR REPLACE FUNCTION lcp_iterate(_state TEXT...",
    "valid": true,
    "error": null,
    "duration_ms": 2.509593963623047,
    "input_sql_tokens": 137,
    "estimated_tokens": 221,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION lcp_iterate(_state TEXT, value TEXT) RETURNS TEXT AS $$ SELECT SUBSTRING($2, 1, s - 1) FROM generate_series(1, LEAST(LENGTH($1), LENGTH($2))) s WHERE SUBSTRING($1, 1, s) <> SUBSTRING($2, 1, s) UNION ALL SELECT LEAST($1, $2) LIMIT 1; $$ LANGUAGE 'sql';DO $$ BEGIN CREATE AGGREGATE lcp(TEXT) (SFUNC = lcp_iterate, STYPE = TEXT); EXCEPTION WHEN sqlstate '42723' THEN null; END $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 199,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT lcp(event_description) AS common_prefix FRO...",
    "valid": true,
    "error": null,
    "duration_ms": 1.0938644409179688,
    "input_sql_tokens": 18,
    "estimated_tokens": 107,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT lcp(event_description) AS common_prefix FROM match_events;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 200,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT player_api_id, player_name FROM player WHER...",
    "valid": true,
    "error": null,
    "duration_ms": 3.1740665435791016,
    "input_sql_tokens": 49,
    "estimated_tokens": 147,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT player_api_id, player_name FROM player WHERE player_name LIKE 'Ale%' AND player_fifa_api_id > 220000 AND id = (SELECT MAX(id) FROM player);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11900000000000004,
        "pattern_signature": "SELECT-FROM-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 201,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT match_id, match_date FROM detail WHERE matc...",
    "valid": true,
    "error": null,
    "duration_ms": 1.1687278747558594,
    "input_sql_tokens": 39,
    "estimated_tokens": 117,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT match_id, match_date FROM detail WHERE match_details @@ '$.player_stats[*] ? (@.player_id == :player_id).goals > 0';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 202,
    "db_id": "toxicology",
    "sql_snippet": "SELECT b.bond_id, jsonb_build_object('time', sum((...",
    "valid": true,
    "error": null,
    "duration_ms": 2.7370452880859375,
    "input_sql_tokens": 40,
    "estimated_tokens": 118,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT b.bond_id, jsonb_build_object('time', sum((b.bond_stat_->'time')::numeric)) FROM bond b GROUP BY bond_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 203,
    "db_id": "toxicology",
    "sql_snippet": "CREATE OR REPLACE FUNCTION public.new_function(typ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.0110607147216797,
    "input_sql_tokens": 55,
    "estimated_tokens": 122,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION public.new_function(type text DEFAULT 'Unknown'::text) RETURNS SETOF bond LANGUAGE sql STABLE AS $function$ select * from bond where bond_stat_ @? '$.** ? (@ == $1)'; $function$",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 204,
    "db_id": "toxicology",
    "sql_snippet": "SELECT bond_id FROM new_function();",
    "valid": true,
    "error": null,
    "duration_ms": 1.1527538299560547,
    "input_sql_tokens": 10,
    "estimated_tokens": 82,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT bond_id FROM new_function();",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 205,
    "db_id": "european_football_2",
    "sql_snippet": "CREATE UNIQUE INDEX conditional_unique_index ON ma...",
    "valid": true,
    "error": null,
    "duration_ms": 3.6287307739257812,
    "input_sql_tokens": 68,
    "estimated_tokens": 166,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE UNIQUE INDEX conditional_unique_index ON match_results (match_id, team_id) WHERE (SELECT COUNT(*) FROM match_results t2 WHERE t2.match_id = match_results.match_id AND t2.team_id = match_results.team_id) = 1;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11600000000000002,
        "pattern_signature": "SELECT-FROM-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 206,
    "db_id": "california_schools",
    "sql_snippet": "SELECT CAST(time_bucket AS DATE) AS time_bucket, r...",
    "valid": true,
    "error": null,
    "duration_ms": 7.56382942199707,
    "input_sql_tokens": 91,
    "estimated_tokens": 185,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT CAST(time_bucket AS DATE) AS time_bucket, rate / DATE_PART('days', time_bucket + INTERVAL '1 month - 1 day') AS daily_rate FROM (SELECT DATE(generate_series(LOWER(time_span)::TIMESTAMP, COALESCE(UPPER(time_span),NOW())::TIMESTAMP, '1 day')) AS time_bucket, rate FROM budgets) AS daily_rates;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08600000000000002,
        "pattern_signature": "SELECT-FROM-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 207,
    "db_id": "superhero",
    "sql_snippet": "SELECT attribute_name, to_number(attribute_name) F...",
    "valid": true,
    "error": null,
    "duration_ms": 1.0149478912353516,
    "input_sql_tokens": 17,
    "estimated_tokens": 106,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT attribute_name, to_number(attribute_name) FROM attribute;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 208,
    "db_id": "toxicology",
    "sql_snippet": "SELECT molecule_id, COUNT(*) FILTER (WHERE COUNT(*...",
    "valid": true,
    "error": null,
    "duration_ms": 1.9729137420654297,
    "input_sql_tokens": 29,
    "estimated_tokens": 115,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT molecule_id, COUNT(*) FILTER (WHERE COUNT(*) > 5) AS total_bonds FROM bond GROUP BY molecule_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.029,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-FILTER",
        "clauses_present": [
          "FILTER",
          "FROM",
          "GROUP",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 209,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH range_values AS ( SELECT date_trunc('week', m...",
    "valid": true,
    "error": null,
    "duration_ms": 8.818626403808594,
    "input_sql_tokens": 177,
    "estimated_tokens": 274,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH range_values AS ( SELECT date_trunc('week', min(date)) as minval, date_trunc('week', max(date)) as maxval FROM laboratory ), week_range AS ( SELECT generate_series('1991-01-01', now(), '1 week') as week FROM range_values ), grouped_labs AS ( SELECT date_trunc('week', date) as week, count(id) as total_tests FROM laboratory WHERE date >= '1991-01-01' GROUP BY 1 ) SELECT week_range.week, COALESCE(sum(total_tests)::integer, 0) AS total_labs FROM week_range LEFT OUTER JOIN grouped_labs on week_range.week = grouped_labs.week GROUP BY 1 ORDER BY 1;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 210,
    "db_id": "california_schools",
    "sql_snippet": "DROP FUNCTION IF EXISTS update_school_inventory_af...",
    "valid": true,
    "error": null,
    "duration_ms": 3.62396240234375,
    "input_sql_tokens": 133,
    "estimated_tokens": 217,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DROP FUNCTION IF EXISTS update_school_inventory_after_supply() CASCADE;CREATE OR REPLACE FUNCTION update_school_inventory_after_supply() RETURNS TRIGGER LANGUAGE plpgsql AS $trigger$ BEGIN UPDATE school_inventory AS i SET NEW.quantity = school_supplies.quantity + OLD.quantity FROM school_supplies WHERE i.cdscode = school_supplies.cdscode; RETURN NEW; END; $trigger$;DROP TRIGGER IF EXISTS trigger_insert_supply ON school_supplies;CREATE TRIGGER trigger_insert_supply AFTER INSERT ON school_supplies FOR EACH ROW EXECUTE FUNCTION update_school_inventory_after_supply();",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 211,
    "db_id": "california_schools",
    "sql_snippet": "SELECT county, AVG(avgscrread + avgscrmath + avgsc...",
    "valid": true,
    "error": null,
    "duration_ms": 1.9779205322265625,
    "input_sql_tokens": 48,
    "estimated_tokens": 134,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT county, AVG(avgscrread + avgscrmath + avgscrwrite) / 3 AS avg_total_sat FROM satscores GROUP BY county ORDER BY avg_total_sat DESC LIMIT 5;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-GROUP-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "GROUP",
          "LIMIT",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 212,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH vars AS ((select count(*) from laboratory) AS...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0362606048583984,
    "input_sql_tokens": 29,
    "estimated_tokens": 135,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH vars AS ((select count(*) from laboratory) AS vars_id) select * from laboratory where id=vars.vars_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14300000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 213,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT * FROM match_location WHERE ST_INTERSECTS(l...",
    "valid": true,
    "error": null,
    "duration_ms": 2.034425735473633,
    "input_sql_tokens": 44,
    "estimated_tokens": 122,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM match_location WHERE ST_INTERSECTS(location, CIRCLE(POINT(-73.935242, 40.730610), 2));",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 214,
    "db_id": "erolp",
    "sql_snippet": "INSERT INTO learners\n  (\"Age\", \"Gender\", \"Geograph...",
    "valid": true,
    "error": null,
    "duration_ms": 3.622770309448242,
    "input_sql_tokens": 119,
    "estimated_tokens": 212,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO learners\n  (\"Age\", \"Gender\", \"Geographic_Location\", \"Socioeconomic_Background\",\n   \"Education_Level\", \"Previous_Academic_Performance\", \"Language_Proficiency\",\n   \"Preferred_Learning_Medium\", \"Learning_Pace\", \"Engagement_History\")\nVALUES\n  (18,\n   'Male',\n   'Urban',\n   'Low',\n   'UndergraduateUndergraduateUndergraduate',\n   88.55,\n   'Intermediate',\n   'Video',\n   'Moderate',\n   6);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 215,
    "db_id": "erolp",
    "sql_snippet": "SELECT\n    x.curriculum_id,\n    ARRAY_LENGTH(x.com...",
    "valid": true,
    "error": null,
    "duration_ms": 8.46242904663086,
    "input_sql_tokens": 180,
    "estimated_tokens": 293,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT\n    x.curriculum_id,\n    ARRAY_LENGTH(x.combined_array, 1) AS distinct_count\nFROM\n(\n\nSELECT\n        c.curriculum_id,\n        ARRAY[e.\"Content_Type\", e.\"Platform_Used\"] AS combined_array\n    FROM curriculum_resources cr\n    JOIN educational_resources e\n      ON cr.resource_key = e.resource_key\n    JOIN curricula c\n      ON c.curriculum_id = cr.curriculum_id\n\n    UNION\nSELECT\n        c2.curriculum_id,\n        ARRAY[cr2.recommended] AS combined_array\n    FROM curriculum_resources cr2\n    JOIN curricula c2\n      ON c2.curriculum_id = cr2.curriculum_id\n) AS x\nGROUP BY x.curriculum_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.181,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-UNION-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "SUBQUERY",
          "UNION"
        ],
        "num_joins": 3,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 216,
    "db_id": "erolp",
    "sql_snippet": "ALTER TABLE curricula\n  ADD COLUMN status TEXT DEF...",
    "valid": true,
    "error": null,
    "duration_ms": 4.963397979736328,
    "input_sql_tokens": 138,
    "estimated_tokens": 247,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "ALTER TABLE curricula\n  ADD COLUMN status TEXT DEFAULT 'installed';\n\n\nWITH RECURSIVE curricula_to_upgrade AS (\n\nSELECT c.curriculum_id\n    FROM curricula c\n    WHERE c.status = 'installed'\n      AND c.curriculum_id = 1\n\nUNION ALL\n\n\nSELECT c2.curriculum_id\n    FROM curricula c2\n    JOIN curricula_to_upgrade ctu\n         ON c2.curriculum_id = ctu.curriculum_id\n)\nUPDATE curricula\nSET status = 'to upgrade'\nWHERE curriculum_id IN (\n    SELECT curriculum_id\n    FROM curricula_to_upgrade\n);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 217,
    "db_id": "erolp",
    "sql_snippet": "SELECT learner_code, resource_key, SUM(duration) A...",
    "valid": true,
    "error": null,
    "duration_ms": 1.9917488098144531,
    "input_sql_tokens": 67,
    "estimated_tokens": 151,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT learner_code, resource_key, SUM(duration) AS total_time_spent\nFROM event_usage\nWHERE start_timestamp BETWEEN '2024-10-01' AND '2024-10-09'\nGROUP BY learner_code, resource_key;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.023,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 218,
    "db_id": "erolp",
    "sql_snippet": "SELECT\n  first_value(rating) OVER (\n    PARTITION ...",
    "valid": true,
    "error": null,
    "duration_ms": 4.188776016235352,
    "input_sql_tokens": 84,
    "estimated_tokens": 174,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT\n  first_value(rating) OVER (\n    PARTITION BY learner_code, resource_key\n    ORDER BY usage_date\n    ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW\n  ) AS filled_rating,\n  learner_code,\n  resource_key\nFROM\n  resource_usage_2\nORDER BY\n  learner_code, usage_date;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 219,
    "db_id": "formula_1",
    "sql_snippet": "SELECT dd::date AS day_start, SUM(CASE WHEN T.inci...",
    "valid": true,
    "error": null,
    "duration_ms": 4.873991012573242,
    "input_sql_tokens": 119,
    "estimated_tokens": 220,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT dd::date AS day_start, SUM(CASE WHEN T.incident_start <= dd AND T.incident_end >= dd THEN 1440 ELSE 0 END) AS incident_minutes FROM generate_series('2022-01-01'::timestamp, '2022-01-31'::timestamp, '1 day'::interval) dd LEFT JOIN race_incidents T ON dd::date BETWEEN T.incident_start AND T.incident_end GROUP BY dd::date ORDER BY dd::date",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.051000000000000004,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 220,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT * FROM CROSSTAB ('SELECT p.id, l.ldh, l.ldh...",
    "valid": true,
    "error": null,
    "duration_ms": 1.97601318359375,
    "input_sql_tokens": 73,
    "estimated_tokens": 145,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM CROSSTAB ('SELECT p.id, l.ldh, l.ldh, l.ldh FROM patient p JOIN laboratory l ON p.id = l.id ORDER BY 1,2;') AS (id INT, ldh_1 INT, ldh_2 INT, ldh_3 INT);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 221,
    "db_id": "formula_1",
    "sql_snippet": "SELECT DISTINCT tempId, pemId, time, rank, (CASE p...",
    "valid": true,
    "error": null,
    "duration_ms": 7.660865783691406,
    "input_sql_tokens": 113,
    "estimated_tokens": 225,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DISTINCT tempId, pemId, time, rank, (CASE pointsno WHEN 1 THEN points ELSE points END ) AS points FROM (SELECT ROW_NUMBER() OVER(PARTITION BY points) AS pointsno, tempId, pemId, time, rank, points FROM (SELECT driverid AS tempId, driverid AS pemId, time, rank, points FROM results GROUP BY GROUPING SETS ((tempId, points), (tempId, pemId, time, rank))) AS b) AS s ORDER BY tempId, points ASC;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.16200000000000003,
        "pattern_signature": "SELECT-DISTINCT-FROM-GROUP-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 222,
    "db_id": "formula_1",
    "sql_snippet": "select * from results r inner join drivers d on r....",
    "valid": true,
    "error": null,
    "duration_ms": 1.9998550415039062,
    "input_sql_tokens": 35,
    "estimated_tokens": 144,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select * from results r inner join drivers d on r.driverid = d.driverid where r.grid = 21 order by r.points desc;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.052000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-WHERE-ORDER",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 223,
    "db_id": "erolp",
    "sql_snippet": "INSERT INTO customer_orders(name, title) SELECT CO...",
    "valid": true,
    "error": null,
    "duration_ms": 3.9854049682617188,
    "input_sql_tokens": 56,
    "estimated_tokens": 153,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO customer_orders(name, title) SELECT COALESCE(uo.name, co.name), COALESCE(uo.title, co.title) FROM customer_orders co LEFT OUTER JOIN updated_orders uo ON uo.id = co.id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.045000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-INSERT",
        "clauses_present": [
          "FROM",
          "INSERT",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 224,
    "db_id": "superhero",
    "sql_snippet": "SELECT superhero_name, performance_date, attribute...",
    "valid": false,
    "error": "Expecting an aggregation function in PIVOT. Line 1, Col: 103.\n  SELECT superhero_name, performance_date, attribute_name, result FROM superhero_performance PIVOT(\u001b[4mresult\u001b[0m FOR attribute_name IN (Strength, Speed, Intelligence))",
    "duration_ms": 3.403186798095703,
    "input_sql_tokens": 36,
    "estimated_tokens": 176,
    "error_tokens": 66,
    "invalid_sql_tokens": 36,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "Expecting an aggregation function in PIVOT. Line 1, Col: 103.\n  SELECT superhero_name, performance_date, attribute_name, result FROM superhero_performance PIVOT(\u001b[4mresult\u001b[0m FOR attribute_name IN (Strength, Speed, Intelligence))",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT superhero_name, performance_date, attribute_name, result FROM superhero_performance PIVOT(result FOR attribute_name IN (Strength, Speed, Intelligence))",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 225,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT COUNT(*) FROM laboratory WHERE date_part('y...",
    "valid": false,
    "error": "Unterminated quoted string",
    "duration_ms": 1.6489028930664062,
    "input_sql_tokens": 59,
    "estimated_tokens": 149,
    "error_tokens": 5,
    "invalid_sql_tokens": 59,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unterminated_string",
          "message": "Unterminated quoted string",
          "location": null,
          "context": "Error tokenizing 'NT_DATE) AND date [I don't know what to put here]'",
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT COUNT(*) FROM laboratory WHERE date_part('year', date) = date_part('year', CURRENT_DATE) AND date_part('month', date) = date_part('month', CURRENT_DATE) AND date [I don't know what to put here];",
      "tags": [
        "syntax_unterminated_string"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 226,
    "db_id": "california_schools",
    "sql_snippet": "WITH reporting_dates AS (SELECT generate_series('2...",
    "valid": true,
    "error": null,
    "duration_ms": 5.958318710327148,
    "input_sql_tokens": 111,
    "estimated_tokens": 219,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH reporting_dates AS (SELECT generate_series('2000-01-01'::date, '2017-01-01'::date, '1 year'::interval) AS reporting_date) SELECT reporting_date, COUNT(CASE WHEN OpenDate > reporting_date AND (ClosedDate IS NULL OR ClosedDate <=reporting_date) THEN cdscode END) AS active_schools FROM reporting_dates LEFT JOIN schools ON true GROUP BY reporting_date ORDER BY reporting_date;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11500000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 227,
    "db_id": "student_club",
    "sql_snippet": "SELECT budget_id, category, amount, SUM(amount) OV...",
    "valid": true,
    "error": null,
    "duration_ms": 2.524852752685547,
    "input_sql_tokens": 36,
    "estimated_tokens": 118,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT budget_id, category, amount, SUM(amount) OVER (PARTITION BY category ORDER BY amount) AS cum_amount FROM budget ORDER BY category DESC, amount;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 228,
    "db_id": "financial",
    "sql_snippet": "SELECT district_id FROM client WHERE district_id =...",
    "valid": true,
    "error": null,
    "duration_ms": 3.6220550537109375,
    "input_sql_tokens": 39,
    "estimated_tokens": 121,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT district_id FROM client WHERE district_id = 1 LIMIT 100;SELECT district_id FROM client WHERE district_id <> 1 LIMIT 900;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE-LIMIT",
        "clauses_present": [
          "FROM",
          "LIMIT",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 229,
    "db_id": "financial",
    "sql_snippet": "UPDATE card SET type = ( SELECT type, client_id FR...",
    "valid": true,
    "error": null,
    "duration_ms": 2.0189285278320312,
    "input_sql_tokens": 28,
    "estimated_tokens": 130,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "UPDATE card SET type = ( SELECT type, client_id FROM disp WHERE card.disp_id = disp.disp_id );",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10300000000000002,
        "pattern_signature": "SELECT-FROM-WHERE-UPDATE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY",
          "UPDATE",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 230,
    "db_id": "financial",
    "sql_snippet": "CREATE TABLE card (card_id SERIAL PRIMARY KEY,loan...",
    "valid": true,
    "error": null,
    "duration_ms": 6.049156188964844,
    "input_sql_tokens": 84,
    "estimated_tokens": 168,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TABLE card (card_id SERIAL PRIMARY KEY,loan_id INT UNIQUE,type TEXT NOT NULL,issued DATE NOT NULL,CONSTRAINT fk_loan_id FOREIGN KEY (loan_id) REFERENCES loan(loan_id) ON DELETE SET NULL);ALTER TABLE loan ADD CONSTRAINT fk_card_loan FOREIGN KEY (loan_id) REFERENCES card(loan_id) ON DELETE CASCADE;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.020000000000000004,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 231,
    "db_id": "debit_card_specializing",
    "sql_snippet": "DO $$ DECLARE value RECORD[]; BEGIN SELECT t FROM ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.160787582397461,
    "input_sql_tokens": 65,
    "estimated_tokens": 132,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DO $$ DECLARE value RECORD[]; BEGIN SELECT t FROM transactions_1k t LIMIT 1 INTO value[1]; SELECT c FROM customers c LIMIT 1 INTO value[2]; RAISE NOTICE 'Transaction: %', value[1]; RAISE NOTICE 'Customer: %', value[2]; END $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 232,
    "db_id": "financial",
    "sql_snippet": "UPDATE loan l SET status = 'updated_status', date ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.902912139892578,
    "input_sql_tokens": 50,
    "estimated_tokens": 139,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "UPDATE loan l SET status = 'updated_status', date = 'new_date', amount = 'new_amount' WHERE l.loan_id = 'loan_id_value' AND l.status = 'current_status';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.027000000000000003,
        "pattern_signature": "WHERE-UPDATE",
        "clauses_present": [
          "UPDATE",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 233,
    "db_id": "esophageal",
    "sql_snippet": "SELECT coalesce(_agg(patients), '[]'::) as patient...",
    "valid": false,
    "error": "Expected type. Line 1, Col: 39.\n  SELECT coalesce(_agg(patients), '[]'::\u001b[4m)\u001b[0m as patients, coalesce(_agg(doctors), '[]'::) as doctors, coalesce(_agg(appointments), '[]'::) as ap",
    "duration_ms": 5.682229995727539,
    "input_sql_tokens": 74,
    "estimated_tokens": 217,
    "error_tokens": 69,
    "invalid_sql_tokens": 74,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "Expected type. Line 1, Col: 39.\n  SELECT coalesce(_agg(patients), '[]'::\u001b[4m)\u001b[0m as patients, coalesce(_agg(doctors), '[]'::) as doctors, coalesce(_agg(appointments), '[]'::) as ap",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT coalesce(_agg(patients), '[]'::) as patients, coalesce(_agg(doctors), '[]'::) as doctors, coalesce(_agg(appointments), '[]'::) as appointments FROM (SELECT * FROM patients) AS patients, (SELECT * FROM doctors) AS doctors, (SELECT * FROM appointments) AS appointments;",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 234,
    "db_id": "esophageal",
    "sql_snippet": "UPDATE patients_info\nSET general_info = jsonb_set(...",
    "valid": true,
    "error": null,
    "duration_ms": 3.376007080078125,
    "input_sql_tokens": 29,
    "estimated_tokens": 116,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "UPDATE patients_info\nSET general_info = jsonb_set(general_info, '{accept_appointments}', '\"false\"');",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UPDATE",
        "clauses_present": [
          "UPDATE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 235,
    "db_id": "toxicology",
    "sql_snippet": "SELECT b.molecule_id, b.date AS buy_date, s.date A...",
    "valid": true,
    "error": null,
    "duration_ms": 6.01649284362793,
    "input_sql_tokens": 92,
    "estimated_tokens": 193,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT b.molecule_id, b.date AS buy_date, s.date AS sell_date, s.molecules, b.usd_total AS buy_usd_total, s.usd_total AS sell_usd_total FROM transaction b JOIN transaction s ON b.molecule_id = s.molecule_id WHERE b.sell = 0 AND s.sell = 1 ORDER BY b.date, s.date",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.052000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-ORDER",
        "clauses_present": [
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 236,
    "db_id": "erolp",
    "sql_snippet": "WITH RECURSIVE weekdays AS ( SELECT generate_serie...",
    "valid": true,
    "error": null,
    "duration_ms": 12.014627456665039,
    "input_sql_tokens": 231,
    "estimated_tokens": 339,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE weekdays AS ( SELECT generate_series(0, 60) AS offset ), dates AS ( SELECT CURRENT_DATE + (w.offset || ' days')::interval AS date, EXTRACT(ISODOW FROM CURRENT_DATE + (w.offset || ' days')::interval) AS day_of_week FROM weekdays w WHERE EXTRACT(ISODOW FROM CURRENT_DATE + (w.offset || ' days')::interval) IN (1, 2, 3, 4, 5, 6, 7) ), schedule_blocks_with_dates AS ( SELECT sb.*, d.date AS block_date FROM schedule_blocks sb JOIN dates d ON sb.day_of_week ILIKE to_char(d.date, 'Day') WHERE sb.is_available = TRUE AND d.date >= CURRENT_DATE AND d.date <= CURRENT_DATE + INTERVAL '2 months' ) SELECT block_id, user_id, block_date AS date, start_time, end_time FROM schedule_blocks_with_dates ORDER BY date;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14300000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 237,
    "db_id": "european_football_2",
    "sql_snippet": "select id, (select sum(buildupplayspeed) over (ROW...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0126571655273438,
    "input_sql_tokens": 57,
    "estimated_tokens": 159,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select id, (select sum(buildupplayspeed) over (ROWS UNBOUNDED PRECEDING) as a), sum(buildupplayspeed) over (ROWS UNBOUNDED PRECEDING) as b from team_attributes limit 10",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09800000000000002,
        "pattern_signature": "SELECT-FROM-WINDOW-LIMIT-SUBQUERY",
        "clauses_present": [
          "FROM",
          "LIMIT",
          "SELECT",
          "SUBQUERY",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 238,
    "db_id": "erolp",
    "sql_snippet": "CREATE VIEW overview AS SELECT count(*) AS learner...",
    "valid": true,
    "error": null,
    "duration_ms": 3.2625198364257812,
    "input_sql_tokens": 34,
    "estimated_tokens": 126,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE VIEW overview AS SELECT count(*) AS learners_count FROM learners, SELECT count(*) AS institutions_count FROM institutions, SELECT count(*) AS curricula_count FROM curricula",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10800000000000001,
        "pattern_signature": "SELECT-FROM-JOIN",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 239,
    "db_id": "esophageal",
    "sql_snippet": "SELECT patients.patient_id, demographics.height, t...",
    "valid": true,
    "error": null,
    "duration_ms": 5.046844482421875,
    "input_sql_tokens": 109,
    "estimated_tokens": 195,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT patients.patient_id, demographics.height, treatment_and_followup.primary_pathology_karnofsky_performance_score, MIN(primary_pathology_karnofsky_performance_score) AS min_performance_score FROM patients JOIN treatment_and_followup ON patients.patient_id = treatment_and_followup.patient_id JOIN demographics ON patients.patient_id = demographics.patient_id WHERE informed_consent_verified = TRUE GROUP BY patients.patient_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.093,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 240,
    "db_id": "erolp",
    "sql_snippet": "WITH RECURSIVE A(GroupNum, n, RollingSum, id) AS (...",
    "valid": true,
    "error": null,
    "duration_ms": 8.524894714355469,
    "input_sql_tokens": 221,
    "estimated_tokens": 357,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE A(GroupNum, n, RollingSum, id) AS (\n    SELECT 1, Performance_Prediction, Performance_Prediction, prediction_code\n    FROM performance_predictions\n    ORDER BY prediction_code ASC\n    LIMIT 1\n    UNION ALL\n    SELECT\n        CASE\n            WHEN RollingSum + P.Performance_Prediction > 200\n            THEN GroupNum + 1\n            ELSE GroupNum\n        END,\n        P.Performance_Prediction,\n        CASE\n            WHEN RollingSum + P.Performance_Prediction > 200\n            THEN P.Performance_Prediction\n            ELSE RollingSum + P.Performance_Prediction\n        END,\n        P.prediction_code\n    FROM A\n    JOIN performance_predictions AS P ON A.id + 1 = P.prediction_code\n)\nSELECT\n    GroupNum,\n    n,\n    SUM(n) OVER (PARTITION BY GroupNum) AS group_sum\nFROM A\nORDER BY GroupNum, n;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09500000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WINDOW-UNION-ORDER-LIMIT",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "LIMIT",
          "ORDER",
          "SELECT",
          "UNION",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 241,
    "db_id": "financial",
    "sql_snippet": "SELECT DISTINCT A.client_id AS child FROM client A...",
    "valid": true,
    "error": null,
    "duration_ms": 2.994537353515625,
    "input_sql_tokens": 37,
    "estimated_tokens": 126,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DISTINCT A.client_id AS child FROM client A, client B\nWHERE A.birth_date + INTERVAL '16 years' < B.birth_date;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.042,
        "pattern_signature": "SELECT-DISTINCT-FROM-JOIN-WHERE",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 242,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT g.GasStationID FROM transactions_1k t JOIN ...",
    "valid": true,
    "error": null,
    "duration_ms": 4.991769790649414,
    "input_sql_tokens": 74,
    "estimated_tokens": 168,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT g.GasStationID FROM transactions_1k t JOIN gasstations g\nON t.GasStationID = g.GasStationID GROUP BY g.GasStationID\nHAVING SUM(t.Amount * t.Price) / SUM(t.Amount * t.Price) OVER (PARTITION BY t.CustomerID) >= 0.7",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.064,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-HAVING-WINDOW",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 243,
    "db_id": "financial",
    "sql_snippet": "SELECT CASE WHEN c.type = 'gold' THEN 'Gold' ELSE ...",
    "valid": true,
    "error": null,
    "duration_ms": 4.258155822753906,
    "input_sql_tokens": 84,
    "estimated_tokens": 184,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT CASE WHEN c.type = 'gold' THEN 'Gold' ELSE 'Non-Gold'\nEND AS card_type_group, COUNT(l.loan_id) AS loan_count\nFROM loan l\nJOIN disp d ON l.account_id = d.account_id\nJOIN card c ON d.disp_id = c.disp_id\nGROUP BY c.type",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08600000000000001,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 244,
    "db_id": "student_club",
    "sql_snippet": "SELECT link_to_member, link_to_event, count(1) AS ...",
    "valid": true,
    "error": null,
    "duration_ms": 4.57310676574707,
    "input_sql_tokens": 100,
    "estimated_tokens": 186,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT link_to_member, link_to_event, count(1) AS total FROM attendance\nGROUP BY GROUPING SETS ((link_to_member), (link_to_member, link_to_event))\nORDER BY max(count(1)) over (partition by link_to_member) desc, max(count(1))\nover (partition by link_to_member,link_to_event) desc, count(1) desc;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.046,
        "pattern_signature": "SELECT-FROM-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 6
      }
    }
  },
  {
    "query_idx": 245,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT DISTINCT ON (CustomerID) * FROM transaction...",
    "valid": true,
    "error": null,
    "duration_ms": 2.654552459716797,
    "input_sql_tokens": 18,
    "estimated_tokens": 127,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DISTINCT ON (CustomerID) * FROM transactions_1k ORDER BY Date DESC;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-DISTINCT-DISTINCT_ON-FROM-ORDER",
        "clauses_present": [
          "DISTINCT",
          "DISTINCT_ON",
          "FROM",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 246,
    "db_id": "esophageal",
    "sql_snippet": "MERGE INTO treatment_and_followup_backup b USING t...",
    "valid": true,
    "error": null,
    "duration_ms": 5.590677261352539,
    "input_sql_tokens": 196,
    "estimated_tokens": 289,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "MERGE INTO treatment_and_followup_backup b USING treatment_and_followup_latest a ON b.patient_id = a.patient_id WHEN MATCHED THEN UPDATE SET followup_no = a.followup_no, primary_pathology_karnofsky_performance_score = a.primary_pathology_karnofsky_performance_score, primary_pathology_eastern_cancer_oncology_group = a.primary_pathology_eastern_cancer_oncology_group WHEN NOT MATCHED THEN INSERT (patient_id, followup_no, primary_pathology_karnofsky_performance_score, primary_pathology_eastern_cancer_oncology_group) VALUES (a.patient_id, a.followup_no, a.primary_pathology_karnofsky_performance_score, a.primary_pathology_eastern_cancer_oncology_group);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.020000000000000004,
        "pattern_signature": "INSERT-UPDATE-MERGE",
        "clauses_present": [
          "INSERT",
          "MERGE",
          "UPDATE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 247,
    "db_id": "erolp",
    "sql_snippet": "SELECT learner_code, engagement_history FROM learn...",
    "valid": true,
    "error": null,
    "duration_ms": 0.9930133819580078,
    "input_sql_tokens": 14,
    "estimated_tokens": 103,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT learner_code, engagement_history FROM learners_array;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 248,
    "db_id": "erolp",
    "sql_snippet": "SELECT Engagement_Level, MAX(rating), MIN(rating) ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.9642581939697266,
    "input_sql_tokens": 44,
    "estimated_tokens": 140,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT Engagement_Level, MAX(rating), MIN(rating) FROM resource_usage JOIN target_labels ON resource_usage.learner_code = target_labels.learner_code GROUP BY Engagement_Level;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.05700000000000001,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 249,
    "db_id": "erolp",
    "sql_snippet": "SELECT learner_code, rating, usage_date FROM resou...",
    "valid": true,
    "error": null,
    "duration_ms": 2.596139907836914,
    "input_sql_tokens": 59,
    "estimated_tokens": 165,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT learner_code, rating, usage_date FROM resource_usage WHERE (learner_code, usage_date) = (SELECT learner_code, MAX(usage_date) FROM resource_usage GROUP BY learner_code) ORDER BY learner_code, usage_date DESC;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09900000000000003,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 250,
    "db_id": "erolp",
    "sql_snippet": "SELECT learner_code, CASE WHEN Geographic_Location...",
    "valid": false,
    "error": "Required keyword: 'this' missing for <class 'sqlglot.expressions.Parameter'>. Line 1, Col: 318.\n  tory > 5 AND Gender = 'Female' AND Language_Proficiency IN ('Basic', 'Intermediate') AND CASE WHEN $\u001b[4m{\u001b[0msocio_status} IN ('Low', 'Middle') THEN Geographic_Location = 'Urban' WHEN ${socio_status} = 'High' ",
    "duration_ms": 10.858535766601562,
    "input_sql_tokens": 124,
    "estimated_tokens": 295,
    "error_tokens": 99,
    "invalid_sql_tokens": 124,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "Required keyword: 'this' missing for <class 'sqlglot.expressions.Parameter'>. Line 1, Col: 318.\n  tory > 5 AND Gender = 'Female' AND Language_Proficiency IN ('Basic', 'Intermediate') AND CASE WHEN $\u001b[4m{\u001b[0msocio_status} IN ('Low', 'Middle') THEN Geographic_Location = 'Urban' WHEN ${socio_status} = 'High' ",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT learner_code, CASE WHEN Geographic_Location = 'Urban' THEN 1 WHEN Geographic_Location = 'Rural' THEN 2 ELSE 0 END AS location_id, AVG(Pre_Test_Score) AS average_pre_test_score FROM learners WHERE Engagement_History > 5 AND Gender = 'Female' AND Language_Proficiency IN ('Basic', 'Intermediate') AND CASE WHEN ${socio_status} IN ('Low', 'Middle') THEN Geographic_Location = 'Urban' WHEN ${socio_status} = 'High' THEN Geographic_Location = 'Rural' END;",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 251,
    "db_id": "california_schools",
    "sql_snippet": "WITH src(id,geom) as (values (1, 'linestring(0 0, ...",
    "valid": true,
    "error": null,
    "duration_ms": 9.685754776000977,
    "input_sql_tokens": 174,
    "estimated_tokens": 278,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH src(id,geom) as (values (1, 'linestring(0 0, 0 10)'::geometry), (2, 'linestring(0 10, 0 11)'::geometry), (3, 'linestring(1 1, 0 5)'::geometry), (4, 'linestring(1 1, 2 2)'::geometry)) SELECT a.id, st_asText(st_intersection(a.geom, b.geom)) FROM src AS a WHERE NOT EXISTS (SELECT 1 FROM src as b WHERE a.id != b.id AND ST_Toches(a.geom, b.geom) AND ST_Equals(ST_EndPoint(b.geom), ST_Intersection(a.geom, b.geom)));",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08800000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-VALUES",
        "clauses_present": [
          "CTE",
          "FROM",
          "SELECT",
          "VALUES",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 252,
    "db_id": "erolp",
    "sql_snippet": "select device_info::json ->> 'SerialNumber' as Ser...",
    "valid": true,
    "error": null,
    "duration_ms": 4.0531158447265625,
    "input_sql_tokens": 71,
    "estimated_tokens": 165,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select device_info::json ->> 'SerialNumber' as SerialNumber, cto ->> 'ChannelId'::INT   AS channelid, cto ->> 'ChannelName' AS ChannelName from device_details CROSS JOIN LATERAL json_array_elements(device_info::json ->'ChannelListDto') Channels(cto);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.035,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_CROSS-LATERAL",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "LATERAL",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 253,
    "db_id": "erolp",
    "sql_snippet": "WITH test AS ( SELECT EXTRACT(DAY FROM diff) || ' ...",
    "valid": true,
    "error": null,
    "duration_ms": 8.680105209350586,
    "input_sql_tokens": 232,
    "estimated_tokens": 342,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH test AS ( SELECT EXTRACT(DAY FROM diff) || ' days ' || EXTRACT(HOUR FROM diff) || ' hours ' || EXTRACT(MINUTE FROM diff) || ' minutes ' || EXTRACT(SECOND FROM diff) || ' seconds ' AS time_diff FROM ( SELECT TIMESTAMP '2023-01-10 15:12:24' - TIMESTAMP '2023-01-01 10:34:36' AS diff ) AS diff_query JOIN ( SELECT generate_series( timestamp '2023-01-01', timestamp '2023-01-10', interval '1 day' ) AS the_day ) AS dates ON dates.the_day BETWEEN TIMESTAMP '2023-01-01 10:34:36' AND TIMESTAMP '2023-01-10 15:12:24' WHERE EXTRACT('ISODOW' FROM dates.the_day) < 6 ) SELECT * FROM test",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.19400000000000003,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 2,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 254,
    "db_id": "erolp",
    "sql_snippet": "WITH links AS (SELECT greatest(link.source_cluster...",
    "valid": true,
    "error": null,
    "duration_ms": 13.065099716186523,
    "input_sql_tokens": 221,
    "estimated_tokens": 319,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH links AS (SELECT greatest(link.source_cluster, link.target_cluster) AS big, least(link.source_cluster, link.target_cluster) AS smol, link.type AS type FROM link AS link) SELECT l.cluster AS left_id, l.cluster_type AS left_type, l.cluster_label AS left_label, r.cluster AS right_id, r.cluster_type AS right_type, r.cluster_label AS right_label, count(distinct(l.article)) AS articles, array_agg(distinct(links.type)) AS link_types FROM tag AS r, tag AS l JOIN links ON l.cluster = links.big WHERE l.cluster > r.cluster AND l.article = r.article AND r.cluster = links.smol GROUP BY l.cluster, l.cluster_label, l.cluster_type, r.cluster, r.cluster_label, r.cluster_type ORDER BY count(distinct(l.article)) DESC;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.169,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 255,
    "db_id": "global_atlas",
    "sql_snippet": "SELECT i.country, o.name, o.city, o.established FR...",
    "valid": true,
    "error": null,
    "duration_ms": 4.6787261962890625,
    "input_sql_tokens": 64,
    "estimated_tokens": 178,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT i.country, o.name, o.city, o.established FROM public.ismember i INNER JOIN\npublic.organization o ON o.abbreviation = i.organization WHERE i.type = 'member'\nAND i.country = 'CI' ORDER BY o.established DESC LIMIT 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.062000000000000006,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-WHERE-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "LIMIT",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 256,
    "db_id": "erolp",
    "sql_snippet": "WITH CTE AS (select inst.\"Institution_Type\", outcm...",
    "valid": true,
    "error": null,
    "duration_ms": 8.16202163696289,
    "input_sql_tokens": 184,
    "estimated_tokens": 297,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH CTE AS (select inst.\"Institution_Type\", outcm.\"Pre_Test_Score\", dense_rank()\nover (partition by \"Institution_Type\" order by \"Pre_Test_Score\" desc) as score_rank from outcomes as outcm\njoin enrollment as enrl on outcm.learner_code = enrl.learner_code join institutions as inst\non enrl.institution_key = inst.institution_key where inst.\"Institution_Type\" = 'Public' or\ninst.\"Institution_Type\" = 'Private') select (case when \"Institution_Type\" = 'Public' AND score_rank = 1\nTHEN \"Pre_Test_Score\" END) - (case when \"Institution_Type\" = 'Private' AND score_rank = 1 THEN \"Pre_Test_Score\" END)\nas score_diff FROM CTE",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.17700000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 257,
    "db_id": "erolp",
    "sql_snippet": "SELECT regexp_replace(\"Content_Type\", '^(.)|\\1', '...",
    "valid": true,
    "error": null,
    "duration_ms": 1.7158985137939453,
    "input_sql_tokens": 24,
    "estimated_tokens": 114,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT regexp_replace(\"Content_Type\", '^(.)|\\1', '', 'ig') FROM educational_resources",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 258,
    "db_id": "esophageal",
    "sql_snippet": "select regexp_replace((select regexp_replace(prima...",
    "valid": true,
    "error": null,
    "duration_ms": 2.983570098876953,
    "input_sql_tokens": 62,
    "estimated_tokens": 157,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select regexp_replace((select regexp_replace(primary_pathology_histological_type, 'NOS$',\n'Not Otherwise Specified') from pathology_and_surgery), 'Adenocarcinoma', 'Adenoma Carcinoma')\nas transformed_histological_type from pathology_and_surgery;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08600000000000002,
        "pattern_signature": "SELECT-FROM-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 259,
    "db_id": "spotify",
    "sql_snippet": "(SELECT COUNT(*) FROM sp_artists WHERE pop > 50) /...",
    "valid": true,
    "error": null,
    "duration_ms": 1.996755599975586,
    "input_sql_tokens": 26,
    "estimated_tokens": 124,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "(SELECT COUNT(*) FROM sp_artists WHERE pop > 50) / (SELECT COUNT(*) FROM sp_artists);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.13700000000000004,
        "pattern_signature": "SELECT-FROM-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 260,
    "db_id": "esophageal",
    "sql_snippet": "SELECT CASE WHEN COALESCE(primary_pathology_initia...",
    "valid": true,
    "error": null,
    "duration_ms": 6.763458251953125,
    "input_sql_tokens": 225,
    "estimated_tokens": 318,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT CASE WHEN COALESCE(primary_pathology_initial_pathologic_diagnosis_method,\nprimary_pathology_init_pathology_dx_method_other) LIKE 'Other method, specify:'\nTHEN NULL ELSE primary_pathology_neoplasm_histologic_grade END AS histologic_grade,\nCASE WHEN COALESCE(primary_pathology_initial_pathologic_diagnosis_method,\nprimary_pathology_init_pathology_dx_method_other) LIKE 'Other method, \nspecify:' THEN NULL ELSE primary_pathology_days_to_initial_pathologic_diagnosis END AS\ndays_to_initial_diagnosis, CASE WHEN COALESCE(primary_pathology_initial_pathologic_diagnosis_method,\nprimary_pathology_init_pathology_dx_method_other) LIKE 'Other method, specify:'\nTHEN NULL ELSE primary_pathology_age_at_initial_pathologic_diagnosis END AS\nage_at_initial_diagnosis FROM pathology_and_surgery",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 261,
    "db_id": "spotify",
    "sql_snippet": "SELECT * FROM sp_album_ctb WHERE (alb, art, feat_a...",
    "valid": true,
    "error": null,
    "duration_ms": 4.016399383544922,
    "input_sql_tokens": 52,
    "estimated_tokens": 150,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM sp_album_ctb WHERE (alb, art, feat_arts, start_date) IN (SELECT alb, art, feat_arts, end_date + INTERVAL '1 day' FROM sp_album_ctb);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09300000000000003,
        "pattern_signature": "SELECT-FROM-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 262,
    "db_id": "esophageal",
    "sql_snippet": "SELECT patients.patient_id, patients.patient_barco...",
    "valid": true,
    "error": null,
    "duration_ms": 4.523277282714844,
    "input_sql_tokens": 75,
    "estimated_tokens": 180,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT patients.patient_id, patients.patient_barcode, patient_addresses.address_id, patient_addresses.city_of_procurement FROM patients, patient_addresses WHERE patients.patient_id = 1 AND patient_addresses.patient_id = patients.patient_id ORDER BY patient_addresses.address_id DESC LIMIT 1;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.062000000000000006,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "JOIN",
          "LIMIT",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 263,
    "db_id": "erolp",
    "sql_snippet": "SELECT l.learner_code, l.gender, r.resource_key, '...",
    "valid": true,
    "error": null,
    "duration_ms": 7.999658584594727,
    "input_sql_tokens": 144,
    "estimated_tokens": 238,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT l.learner_code, l.gender, r.resource_key, 'Regular Feedback' as FeedbackType, r.feedback as UserFeedback FROM learners l INNER JOIN resource_usage r ON l.learner_code = r.learner_code WHERE UserFeedback = ANY(ARRAY['Negative']) UNION ALL SELECT l.learner_code, l.gender, 0 as resource_key, 'Synthetic Feedback' as FeedbackType, CASE WHEN o.learner_satisfaction_score < 3 THEN 'Negative' ELSE 'Positive' END as UserFeedback FROM learners l INNER JOIN outcomes o ON l.learner_code = o.learner_code WHERE UserFeedback = ANY(ARRAY['Negative']);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.094,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-WHERE-UNION",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "UNION",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 264,
    "db_id": "global_atlas",
    "sql_snippet": "SELECT * FROM city ORDER BY COALESCE(SUBSTRING(nam...",
    "valid": false,
    "error": "Unbalanced parentheses or brackets",
    "duration_ms": 7.48133659362793,
    "input_sql_tokens": 75,
    "estimated_tokens": 149,
    "error_tokens": 6,
    "invalid_sql_tokens": 75,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unbalanced_tokens",
          "message": "Unbalanced parentheses or brackets",
          "location": null,
          "context": "1 unclosed '('",
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT * FROM city ORDER BY COALESCE(SUBSTRING(name FROM '[A-Z]+'), ''), COALESCE(SUBSTRING(name FROM '(?<=-)[0-9]+')::INTEGER, 0), COALESCE(SUBSTRING(name FROM '(?<=\\()[0-9]+')::BIGINT, 0)\uff1b",
      "tags": [
        "syntax_unbalanced_tokens"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 265,
    "db_id": "global_atlas",
    "sql_snippet": "SELECT c.name, c.code, array_agg(cn.othername) AS ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.048419952392578,
    "input_sql_tokens": 56,
    "estimated_tokens": 157,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT c.name, c.code, array_agg(cn.othername) AS alternative_names FROM country c LEFT JOIN countryothername cn ON c.code = cn.country GROUP BY c.name, c.code ORDER BY c.name ASC;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.051000000000000004,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 266,
    "db_id": "erolp",
    "sql_snippet": "SELECT ST_Touches(ol.geom, l.geom)\nFROM institutio...",
    "valid": true,
    "error": null,
    "duration_ms": 1.9609928131103516,
    "input_sql_tokens": 41,
    "estimated_tokens": 139,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT ST_Touches(ol.geom, l.geom)\nFROM institution_location ol, learner_institution_location l\nWHERE ST_Touches(ol.geom, l.geom)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.052000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 267,
    "db_id": "esophageal",
    "sql_snippet": "SELECT * FROM\n    (SELECT tissue_source_site, COUN...",
    "valid": true,
    "error": null,
    "duration_ms": 6.755352020263672,
    "input_sql_tokens": 115,
    "estimated_tokens": 222,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM\n    (SELECT tissue_source_site, COUNT (*) AS total\n    FROM (SELECT * FROM patients) AS _\n    GROUP BY tissue_source_site) result_total\n    INNER JOIN\n    (SELECT tissue_source_site, COUNT (*) AS processed\n    FROM (SELECT * FROM patients WHERE informed_consent_verified=true) AS _\n    GROUP BY tissue_source_site) result_processed\n    ON result_total.tissue_source_site = result_processed.tissue_source_site;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.27,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 4,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 268,
    "db_id": "debit_card_specializing",
    "sql_snippet": "WITH sales AS ( SELECT \"gasstationid\" AS \"Gasstati...",
    "valid": true,
    "error": null,
    "duration_ms": 8.001327514648438,
    "input_sql_tokens": 150,
    "estimated_tokens": 262,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH sales AS ( SELECT \"gasstationid\" AS \"GasstationId\", \"customerid\" AS \"CustomerId\", \"date\" AS \"SaleDate\", \"amount\" AS \"Amount\" FROM \"transactions_1k\" ), initial_purchase AS ( SELECT \"GasstationId\", \"CustomerId\", MIN(CAST(\"SaleDate\" AS date)) AS \"FirstPurchaseDate\" FROM sales GROUP BY \"GasstationId\", \"CustomerId\" ), customer_wages AS ( SELECT i.\"CustomerId\", s.* FROM sales s JOIN initial_purchase i ON s.\"CustomerId\" = i.\"CustomerId\" WHERE s.\"SaleDate\" >= i.\"FirstPurchaseDate\" ORDER BY i.\"CustomerId\" DESC ) SELECT * FROM customer_wages",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.12200000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 269,
    "db_id": "california_schools",
    "sql_snippet": "ALTER TABLE (SELECT quote_ident(c.table_schema) ||...",
    "valid": true,
    "error": null,
    "duration_ms": 5.586147308349609,
    "input_sql_tokens": 124,
    "estimated_tokens": 193,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "ALTER TABLE (SELECT quote_ident(c.table_schema) || '.' || quote_ident(c.table_name) || ' RENAME \"' || c.column_name || '\" TO ' || quote_ident(lower(c.column_name)) || ';' As ddlsql FROM information_schema.columns As c WHERE c.table_schema NOT IN('information_schema', 'pg_catalog') AND c.column_name <> lower(c.column_name) ORDER BY c.table_schema, c.table_name, c.column_name);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 270,
    "db_id": "erolp",
    "sql_snippet": "SELECT product_id FROM product WHERE product_id IN...",
    "valid": true,
    "error": null,
    "duration_ms": 1.9505023956298828,
    "input_sql_tokens": 28,
    "estimated_tokens": 121,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT product_id FROM product WHERE product_id IN (101, 103) AND is_searchable = true",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.027000000000000003,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 271,
    "db_id": "erolp",
    "sql_snippet": "SELECT * FROM orders WHERE customer_id = 1 OR prod...",
    "valid": true,
    "error": null,
    "duration_ms": 1.3124942779541016,
    "input_sql_tokens": 23,
    "estimated_tokens": 116,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM orders WHERE customer_id = 1 OR product_id = 'P202'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.027000000000000003,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 272,
    "db_id": "erolp",
    "sql_snippet": "SELECT DISTINCT transaction_date, salesperson_name...",
    "valid": true,
    "error": null,
    "duration_ms": 3.122568130493164,
    "input_sql_tokens": 39,
    "estimated_tokens": 147,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DISTINCT transaction_date, salesperson_name FROM sales_log WHERE salesperson_name NOT IN (SELECT salesperson_name FROM sales_log GROUP BY transaction_date, salesperson_name)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09300000000000003,
        "pattern_signature": "SELECT-DISTINCT-FROM-WHERE-GROUP-SUBQUERY",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "GROUP",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 273,
    "db_id": "financial",
    "sql_snippet": "SELECT p.product_id, p.product_name FROM Product p...",
    "valid": true,
    "error": null,
    "duration_ms": 4.54401969909668,
    "input_sql_tokens": 65,
    "estimated_tokens": 171,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT p.product_id, p.product_name FROM Product p JOIN ProductPrice pp ON p.product_id = pp.product_id WHERE pp.price < ( SELECT MAX(price) FROM ProductPrice WHERE product_id = p.product_id ) ORDER BY p.product_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14100000000000001,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 274,
    "db_id": "erolp",
    "sql_snippet": "SELECT CD.customer_id, COUNT(S.customer_id) AS tot...",
    "valid": true,
    "error": null,
    "duration_ms": 8.536577224731445,
    "input_sql_tokens": 166,
    "estimated_tokens": 256,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT CD.customer_id, COUNT(S.customer_id) AS total_sales, SUM(S.amount) AS total_amount, COUNT(C.customer_id) AS total_communications, COUNT(F.customer_id) AS total_feedback, COUNT(F.customer_id) FILTER (WHERE F.feedback_type='positive') AS total_positive_feedback, COUNT(F.customer_id) FILTER (WHERE F.feedback_type='negative') AS total_negative_feedback FROM customer_details CD JOIN sales S ON CD.customer_id = S.customer_id JOIN communications C ON CD.customer_id = C.customer_id JOIN feedback F ON CD.customer_id = F.customer_id GROUP BY CD.customer_id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.165,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP-FILTER",
        "clauses_present": [
          "FILTER",
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 3,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 6
      }
    }
  },
  {
    "query_idx": 275,
    "db_id": "erolp",
    "sql_snippet": "CREATE OR REPLACE FUNCTION fn_concat(f_name charac...",
    "valid": true,
    "error": null,
    "duration_ms": 2.2172927856445312,
    "input_sql_tokens": 128,
    "estimated_tokens": 212,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION fn_concat(f_name character varying, l_name character varying) RETURNS character varying AS $$ BEGIN IF cust.f_name IS NULL AND cust.l_name IS NULL THEN RETURN NULL; ELSEIF cust.f_name IS NULL AND cust.l_name IS NOT NULL THEN RETURN cust.l_name; ELSEIF cust.f_name IS NOT NULL AND cust.l_name IS NULL THEN RETURN cust.f_name; ELSE RETURN CONCAT(cust.f_name, ' ', cust.l_name); END IF; END; $$ LANGUAGE plpgsql;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 276,
    "db_id": "erolp",
    "sql_snippet": "SELECT * FROM fn_concat(f_name, l_name);",
    "valid": true,
    "error": null,
    "duration_ms": 0.9782314300537109,
    "input_sql_tokens": 16,
    "estimated_tokens": 88,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM fn_concat(f_name, l_name);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 277,
    "db_id": "erolp",
    "sql_snippet": "SELECT * FROM orders WHERE '10015' = ANY(string_to...",
    "valid": true,
    "error": null,
    "duration_ms": 1.9826889038085938,
    "input_sql_tokens": 30,
    "estimated_tokens": 108,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM orders WHERE '10015' = ANY(string_to_array(orders.delivery_zones, ','))",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 278,
    "db_id": "student_club",
    "sql_snippet": "WITH t1 AS ( SELECT e.event_id FROM event e LEFT J...",
    "valid": false,
    "error": "Failed to parse any statement following CTE. Line 1, Col: 197.\n  nt ), t2 AS ( SELECT e.event_id FROM event e INNEr JOIN attendance a ON e.event_id = a.link_to_event\u001b[4m)\u001b[0m",
    "duration_ms": 6.00433349609375,
    "input_sql_tokens": 68,
    "estimated_tokens": 208,
    "error_tokens": 66,
    "invalid_sql_tokens": 68,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "Failed to parse any statement following CTE. Line 1, Col: 197.\n  nt ), t2 AS ( SELECT e.event_id FROM event e INNEr JOIN attendance a ON e.event_id = a.link_to_event\u001b[4m)\u001b[0m",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "WITH t1 AS ( SELECT e.event_id FROM event e LEFT JOIN attendance a ON e.event_id = a.link_to_event ), t2 AS ( SELECT e.event_id FROM event e INNEr JOIN attendance a ON e.event_id = a.link_to_event)",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 279,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT transactions_1k.* FROM transactions_1k LEFT...",
    "valid": true,
    "error": null,
    "duration_ms": 1.878499984741211,
    "input_sql_tokens": 31,
    "estimated_tokens": 128,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT transactions_1k.* FROM transactions_1k LEFT JOIN customers ON transactions_1k.customerid = customers.customerid LIMIT 5",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.045000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-LIMIT",
        "clauses_present": [
          "FROM",
          "JOIN",
          "LIMIT",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 280,
    "db_id": "toxicology",
    "sql_snippet": "SELECT bond_id FROM bond WHERE bond_id LIKE 'TR1%5...",
    "valid": true,
    "error": null,
    "duration_ms": 2.568483352661133,
    "input_sql_tokens": 29,
    "estimated_tokens": 122,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT bond_id FROM bond WHERE bond_id LIKE 'TR1%5' OR bond_id LIKE 'TR2%4'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.027000000000000003,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 281,
    "db_id": "student_club",
    "sql_snippet": "SELECT SUM(cost) AS total_cost, link_to_member FRO...",
    "valid": true,
    "error": null,
    "duration_ms": 1.9981861114501953,
    "input_sql_tokens": 25,
    "estimated_tokens": 103,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT SUM(cost) AS total_cost, link_to_member FROM expense GROUP BY link_to_budget",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 282,
    "db_id": "financial",
    "sql_snippet": "SELECT t.trans_id, a.district_id, t.amount FROM tr...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0150413513183594,
    "input_sql_tokens": 37,
    "estimated_tokens": 130,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT t.trans_id, a.district_id, t.amount FROM trans AS t JOIN account AS a ON t.account_id = a.account_id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.045000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 283,
    "db_id": "california_schools",
    "sql_snippet": "SELECT schools.cdscode, frpm.cdscode FROM schools ...",
    "valid": true,
    "error": null,
    "duration_ms": 1.8925666809082031,
    "input_sql_tokens": 29,
    "estimated_tokens": 122,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT schools.cdscode, frpm.cdscode FROM schools LEFT JOIN frpm ON schools.cdscode = frpm.cdscode",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.045000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 284,
    "db_id": "european_football_2",
    "sql_snippet": "SELEC Player.player_api_id, Player.player_name, Pl...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 13.\n  SELEC Player\u001b[4m.\u001b[0mplayer_api_id, Player.player_name, Player_Attributes.overall_rating FROM player LEFT JOIN player_att",
    "duration_ms": 2.530336380004883,
    "input_sql_tokens": 61,
    "estimated_tokens": 190,
    "error_tokens": 57,
    "invalid_sql_tokens": 61,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 13.\n  SELEC Player\u001b[4m.\u001b[0mplayer_api_id, Player.player_name, Player_Attributes.overall_rating FROM player LEFT JOIN player_att",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELEC Player.player_api_id, Player.player_name, Player_Attributes.overall_rating FROM player LEFT JOIN player_attributes ON Player.player_api_id = Player_Attributes.player_api_id WHERE Player_Attributes.overall_rating = 68",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 285,
    "db_id": "superhero",
    "sql_snippet": "SELECT * FROM attribute JOIN hero_attribute ON her...",
    "valid": true,
    "error": null,
    "duration_ms": 2.5107860565185547,
    "input_sql_tokens": 39,
    "estimated_tokens": 136,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM attribute JOIN hero_attribute ON hero_attribute.attribute_id = attribute.id WHERE (attribute_name <> 'Speed' AND attribute_value <> 35)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.062000000000000006,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 286,
    "db_id": "california_schools",
    "sql_snippet": "SELECT cdscode, COUNT(cdscode) FROM schools WHERE ...",
    "valid": true,
    "error": null,
    "duration_ms": 1.5301704406738281,
    "input_sql_tokens": 26,
    "estimated_tokens": 108,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT cdscode, COUNT(cdscode) FROM schools WHERE district = 'Alameda County Office of Education' LIMIT 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.023,
        "pattern_signature": "SELECT-FROM-WHERE-LIMIT",
        "clauses_present": [
          "FROM",
          "LIMIT",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 287,
    "db_id": "formula_1",
    "sql_snippet": "SELECT s.driverstandingsid, s.raceid, d.driverid F...",
    "valid": true,
    "error": null,
    "duration_ms": 4.059076309204102,
    "input_sql_tokens": 48,
    "estimated_tokens": 140,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT s.driverstandingsid, s.raceid, d.driverid FROM driverstandings AS s LEFT JOIN drivers AS d ON d.driverid = s.driverid AND s.raceid = 19",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.05500000000000001,
        "pattern_signature": "SELECT-FROM-JOIN",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 288,
    "db_id": "financial",
    "sql_snippet": "SELECT status, SUM(amount) AS total_amount, SUM(pa...",
    "valid": true,
    "error": null,
    "duration_ms": 3.5238265991210938,
    "input_sql_tokens": 38,
    "estimated_tokens": 131,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT status, SUM(amount) AS total_amount, SUM(payments) AS total_payments, (total_amount + total_payments) AS s FROM loan GROUP BY status",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.022000000000000002,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 289,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT COUNT(diagnosis), diagnosis FROM patient WH...",
    "valid": true,
    "error": null,
    "duration_ms": 2.996683120727539,
    "input_sql_tokens": 24,
    "estimated_tokens": 127,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT COUNT(diagnosis), diagnosis FROM patient WHERE diagnosis = 'PSS' GROUP BY diagnosis HAVING COUNT(*) > 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.036000000000000004,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-HAVING",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 290,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT DISTINCT u.id AS UserId, u.displayname, u.r...",
    "valid": true,
    "error": null,
    "duration_ms": 11.182785034179688,
    "input_sql_tokens": 127,
    "estimated_tokens": 219,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DISTINCT u.id AS UserId, u.displayname, u.reputation, b.name AS BadgeName, b.date AS BadgeDate FROM users AS u LEFT JOIN badges AS b ON b.userid = u.id WHERE u.reputation >= 10000 AND b.name = 'Teacher' UNION ALL SELECT DISTINCT u.id AS UserId, u.displayname, u.reputation, NULL AS BadgeName, NULL AS BadgeDate FROM users AS u LEFT JOIN badges AS b ON b.userid = u.id WHERE u.reputation >= 10000",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.094,
        "pattern_signature": "SELECT-DISTINCT-FROM-JOIN-WHERE-UNION",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "JOIN",
          "SELECT",
          "UNION",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 291,
    "db_id": "student_club",
    "sql_snippet": "SELECT SUM(expense.cost) AS total_expense, SUM(bud...",
    "valid": true,
    "error": null,
    "duration_ms": 2.997159957885742,
    "input_sql_tokens": 58,
    "estimated_tokens": 144,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT SUM(expense.cost) AS total_expense, SUM(budget.amount) AS total_budget, budget.link_to_event FROM budget, expense WHERE budget.budget_id = expense.link_to_budget GROUP BY budget.link_to_event",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.064,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 292,
    "db_id": "superhero",
    "sql_snippet": "SELECT superhero_name, LENGTH(superhero_name) FROM...",
    "valid": true,
    "error": null,
    "duration_ms": 5.656957626342773,
    "input_sql_tokens": 82,
    "estimated_tokens": 184,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT superhero_name, LENGTH(superhero_name) FROM superhero WHERE LENGTH(superhero_name) = (SELECT MIN(LENGTH(superhero_name)) FROM superhero) OR LENGTH(superhero_name) = (SELECT MAX(LENGTH(superhero_name)) FROM superhero) ORDER BY LENGTH(superhero_name) ASC NULLS FIRST, superhero_name ASC NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14700000000000005,
        "pattern_signature": "SELECT-FROM-WHERE-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 293,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT DISTINCT customerid, *, MAX(date) AS maxdat...",
    "valid": true,
    "error": null,
    "duration_ms": 2.0079612731933594,
    "input_sql_tokens": 19,
    "estimated_tokens": 99,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DISTINCT customerid, *, MAX(date) AS maxdate FROM transactions_1k",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-DISTINCT-FROM",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 294,
    "db_id": "card_games",
    "sql_snippet": "SELECT id, (CASE WHEN (colors = 'W' and power = '4...",
    "valid": false,
    "error": "Expected END after CASE. Line 1, Col: 84.\n  SELECT id, (CASE WHEN (colors = 'W' and power = '4') THEN coalesce(watermark, '996'\u001b[4m)\u001b[0m watermark WHEN (colors = 'B' and power = '3') THEN coalesce(watermark, '997') watermark WHEN (color",
    "duration_ms": 10.323524475097656,
    "input_sql_tokens": 111,
    "estimated_tokens": 269,
    "error_tokens": 85,
    "invalid_sql_tokens": 111,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "Expected END after CASE. Line 1, Col: 84.\n  SELECT id, (CASE WHEN (colors = 'W' and power = '4') THEN coalesce(watermark, '996'\u001b[4m)\u001b[0m watermark WHEN (colors = 'B' and power = '3') THEN coalesce(watermark, '997') watermark WHEN (color",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT id, (CASE WHEN (colors = 'W' and power = '4') THEN coalesce(watermark, '996') watermark WHEN (colors = 'B' and power = '3') THEN coalesce(watermark, '997') watermark WHEN (colors = 'U' and power = '2') THEN coalesce(watermark, '998') watermark WHEN (colors = 'R' and power = '0') THEN coalesce(watermark, '999') watermark END) watermark FROM cards",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 295,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT posts.owneruserid, posts.tags, AVG(posts.sc...",
    "valid": true,
    "error": null,
    "duration_ms": 8.775949478149414,
    "input_sql_tokens": 102,
    "estimated_tokens": 202,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT posts.owneruserid, posts.tags, AVG(posts.score) AS AvgOfScore FROM posts WHERE posts.owneruserid = 183 AND posts.tags LIKE '%distribution%' AND EXISTS(SELECT creaiondate FROM posts AS pdates WHERE pdates.owneruserid = posts.owneruserid AND pdates.tags = posts.tags AND pdates.creaiondate = posts.creaiondate ORDER BY pdates.creaiondate DESC NULLS LAST LIMIT 5)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.07000000000000002,
        "pattern_signature": "SELECT-FROM-WHERE-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "LIMIT",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 296,
    "db_id": "student_club",
    "sql_snippet": "SELECT link_to_member, COUNT(DISTINCT DATE(event_d...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 244.\n  ent.event_id WHERE event_date BETWEEN '2019-01-01' AND '2023-12-31' GROUP BY link_to_member [split] \u001b[4mWITH\u001b[0m cte AS ( SELECT link_to_member, DATE(event_date) AS event_day, ROW_NUMBER() OVER (PARTITION BY link",
    "duration_ms": 9.423971176147461,
    "input_sql_tokens": 208,
    "estimated_tokens": 386,
    "error_tokens": 106,
    "invalid_sql_tokens": 208,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 244.\n  ent.event_id WHERE event_date BETWEEN '2019-01-01' AND '2023-12-31' GROUP BY link_to_member [split] \u001b[4mWITH\u001b[0m cte AS ( SELECT link_to_member, DATE(event_date) AS event_day, ROW_NUMBER() OVER (PARTITION BY link",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT link_to_member, COUNT(DISTINCT DATE(event_date)) AS total_attendance_days FROM attendance JOIN event ON attendance.link_to_event = event.event_id WHERE event_date BETWEEN '2019-01-01' AND '2023-12-31' GROUP BY link_to_member [split] WITH cte AS ( SELECT link_to_member, DATE(event_date) AS event_day, ROW_NUMBER() OVER (PARTITION BY link_to_member ORDER BY DATE(event_date)) AS rn FROM attendance JOIN event ON attendance.link_to_event = event.event_id WHERE event_date BETWEEN '2019-01-01' AND '2023-12-31' ) SELECT link_to_member, COUNT(DISTINCT event_day) AS total_attendance_days FROM cte GROUP BY link_to_member",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 297,
    "db_id": "student_club",
    "sql_snippet": "SELECT * FROM (SELECT member_id, first_name, last_...",
    "valid": true,
    "error": null,
    "duration_ms": 5.026340484619141,
    "input_sql_tokens": 67,
    "estimated_tokens": 169,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM (SELECT member_id, first_name, last_name FROM member) AS A LEFT JOIN (SELECT link_to_member FROM attendance WHERE link_to_event = 'recEVTik3MlqbvLFi') AS B ON A.member_id = B.link_to_member",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.16000000000000003,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 298,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT t.customerid, p.description, MAX(t.date) FR...",
    "valid": true,
    "error": null,
    "duration_ms": 4.249811172485352,
    "input_sql_tokens": 45,
    "estimated_tokens": 150,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT t.customerid, p.description, MAX(t.date) FROM transactions_1k AS t INNER JOIN products AS p ON t.productid = p.productid GROUP BY t.customerid",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.051000000000000004,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 299,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT t1.CustomerID AS Customer1, t2.CustomerID A...",
    "valid": true,
    "error": null,
    "duration_ms": 9.32168960571289,
    "input_sql_tokens": 116,
    "estimated_tokens": 212,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT t1.CustomerID AS Customer1, t2.CustomerID AS Customer2, COUNT(*) AS Count FROM (SELECT CustomerID, CONCAT(Date, GasStationID) AS ConcatenatedValue, COUNT(*) FROM transactions_1k) AS t1, (SELECT CustomerID, CONCAT(Date, GasStationID) AS ConcatenatedValue, COUNT(*) FROM transactions_1k) AS t2 WHERE t1.ConcatenatedValue = t2.ConcatenatedValue GROUP BY Customer1, Customer2 ORDER BY Count DESC NULLS LAST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.168,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 300,
    "db_id": "debit_card_specializing",
    "sql_snippet": "WITH DAILY_REVENUE AS (SELECT date, SUM(amount) AS...",
    "valid": true,
    "error": null,
    "duration_ms": 8.315801620483398,
    "input_sql_tokens": 124,
    "estimated_tokens": 232,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH DAILY_REVENUE AS (SELECT date, SUM(amount) AS TotalAmount FROM transactions_1k GROUP BY date ORDER BY date ASC NULLS FIRST), MOVING_AVG AS (SELECT date, SUM(TotalAmount) OVER (ORDER BY date ASC NULLS FIRST ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS TotalAmount, CAST(AVG(TotalAmount) OVER (ORDER BY date ASC NULLS FIRST ROWS BETWEEN 2 PRECEDING AND CURRENT ROW) AS DECIMAL(10, 2)) AS AverageAmount FROM daily_revenue) SELECT * FROM moving_avg",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09200000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 301,
    "db_id": "student_club",
    "sql_snippet": "SELECT m.department, COUNT(e.expense_id) AS cnt, e...",
    "valid": true,
    "error": null,
    "duration_ms": 4.963397979736328,
    "input_sql_tokens": 78,
    "estimated_tokens": 186,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT m.department, COUNT(e.expense_id) AS cnt, e.cost AS highest_cost FROM expense AS e INNER JOIN member AS mem ON e.link_to_member = mem.member_id INNER JOIN major AS m ON mem.link_to_major = m.major_id GROUP BY m.department ORDER BY cnt DESC NULLS LAST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08600000000000001,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 302,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT * FROM (SELECT country, segment, COUNT(*) A...",
    "valid": true,
    "error": null,
    "duration_ms": 5.071878433227539,
    "input_sql_tokens": 69,
    "estimated_tokens": 179,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM (SELECT country, segment, COUNT(*) AS count_segment, DENSE_RANK() OVER (PARTITION BY country ORDER BY (SELECT COUNT(*) AS count_segment FROM gasstations) NULLS FIRST) AS \"rnk\" FROM gasstations GROUP BY country, segment) AS segment_rank WHERE rnk = 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.18700000000000003,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 303,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT pt.id, pt.sex, pt.birthday, ex.diagnosis FR...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 59.\n  SELECT pt.id, pt.sex, pt.birthday, ex.diagnosis FRM \u001b[4mpatient\u001b[0m pt, examination ex WHERE pt.id = (SELECT ex.id FROM examination ex WHERE ex.diagnosis = 'SLE' AND e",
    "duration_ms": 4.038572311401367,
    "input_sql_tokens": 58,
    "estimated_tokens": 204,
    "error_tokens": 74,
    "invalid_sql_tokens": 58,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 59.\n  SELECT pt.id, pt.sex, pt.birthday, ex.diagnosis FRM \u001b[4mpatient\u001b[0m pt, examination ex WHERE pt.id = (SELECT ex.id FROM examination ex WHERE ex.diagnosis = 'SLE' AND e",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT pt.id, pt.sex, pt.birthday, ex.diagnosis FRM patient pt, examination ex WHERE pt.id = (SELECT ex.id FROM examination ex WHERE ex.diagnosis = 'SLE' AND ex.\"aCL IgG\" > 3.0)",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 304,
    "db_id": "toxicology",
    "sql_snippet": "SELECT COUNT(b.bond_id) AS total, b1.bond AS bond,...",
    "valid": true,
    "error": null,
    "duration_ms": 11.084318161010742,
    "input_sql_tokens": 235,
    "estimated_tokens": 337,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT COUNT(b.bond_id) AS total, b1.bond AS bond, b2.bond_type_dash AS bond_type_dash, b3.bond_type_equal AS bond_type_equal, b4.bond_type_hash AS bond_type_hash FROM bond AS b LEFT JOIN (SELECT bond_id, COUNT(*) AS bond FROM bond WHERE bond_id = 'TR000_1_2') AS b1 ON b1.bond_id = b.bond_id LEFT JOIN (SELECT bond_id, COUNT(*) AS bond_type_dash FROM bond WHERE bond_type = '-') AS b2 ON b2.bond_id = b.bond_id LEFT JOIN (SELECT bond_id, COUNT(*) AS bond_type_equal FROM bond WHERE bond_type = '=') AS b3 ON b3.bond_id = b.bond_id LEFT JOIN (SELECT bond_id, COUNT(*) AS bond_type_hash FROM bond WHERE bond_type = '#') AS b4 ON b4.bond_id = b.bond_id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.33999999999999997,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 4,
        "num_subqueries": 4,
        "num_ctes": 0,
        "num_aggregations": 5
      }
    }
  },
  {
    "query_idx": 305,
    "db_id": "european_football_2",
    "sql_snippet": "UPDATE league l SET name = concat('abc', ',', name...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 101.\n  UPDATE league l SET name = concat('abc', ',', name) FROM country c WHERE l.country_id = c.id \u001b[4mGROUP BY\u001b[0m l.country_id HAVING l.country_id > 1000;",
    "duration_ms": 4.057645797729492,
    "input_sql_tokens": 47,
    "estimated_tokens": 194,
    "error_tokens": 75,
    "invalid_sql_tokens": 47,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 101.\n  UPDATE league l SET name = concat('abc', ',', name) FROM country c WHERE l.country_id = c.id \u001b[4mGROUP BY\u001b[0m l.country_id HAVING l.country_id > 1000;",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "UPDATE league l SET name = concat('abc', ',', name) FROM country c WHERE l.country_id = c.id GROUP BY l.country_id HAVING l.country_id > 1000;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 306,
    "db_id": "formula_1",
    "sql_snippet": "SELECT r.*, rank := rank + 1 AS ranking FROM (SELE...",
    "valid": true,
    "error": null,
    "duration_ms": 4.022121429443359,
    "input_sql_tokens": 63,
    "estimated_tokens": 169,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT r.*, rank := rank + 1 AS ranking FROM (SELECT 0 AS rank) AS init, results AS r JOIN drivers AS d ON r.driverid = d.driverid ORDER BY r.fastestlap ASC NULLS FIRST, d.dob ASC NULLS FIRST LIMIT 10",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14600000000000002,
        "pattern_signature": "SELECT-FROM-JOIN-ORDER-LIMIT-SUBQUERY",
        "clauses_present": [
          "FROM",
          "JOIN",
          "LIMIT",
          "ORDER",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 2,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 307,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT * FROM transactions_1k WHERE CONCAT(date, '...",
    "valid": true,
    "error": null,
    "duration_ms": 3.2472610473632812,
    "input_sql_tokens": 62,
    "estimated_tokens": 148,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM transactions_1k WHERE CONCAT(date, ' ', time) BETWEEN CAST('2012-08-22' AS DATE) AND CAST('2012-08-23' AS DATE) ORDER BY amount DESC NULLS LAST LIMIT 3",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "LIMIT",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 308,
    "db_id": "california_schools",
    "sql_snippet": "SELECT state, MAX(county) AS County, MAX(city) AS ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0083656311035156,
    "input_sql_tokens": 37,
    "estimated_tokens": 119,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT state, MAX(county) AS County, MAX(city) AS City, MAX(cdscode) AS CDSCode FROM schools WHERE NOT state IS NULL GROUP BY state",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.035,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 309,
    "db_id": "financial",
    "sql_snippet": "SELECT account.account_id, loan.loan_id, SUM(loan....",
    "valid": true,
    "error": null,
    "duration_ms": 5.023002624511719,
    "input_sql_tokens": 99,
    "estimated_tokens": 189,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT account.account_id, loan.loan_id, SUM(loan.amount) AS total_amount FROM account JOIN loan ON account.account_id = loan.account_id JOIN trans ON loan.account_id = trans.account_id WHERE loan.status LIKE '%A%' AND trans.type LIKE '%PRIJEM%' AND trans.type LIKE '%VYDAJ%' GROUP BY loan.loan_id ORDER BY account.account_id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.113,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 310,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT date, COUNT(*) FROM transactions_1k WHERE E...",
    "valid": true,
    "error": null,
    "duration_ms": 2.2025108337402344,
    "input_sql_tokens": 26,
    "estimated_tokens": 104,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT date, COUNT(*) FROM transactions_1k WHERE EXTRACT(DAY FROM date) IN (3, 24)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.023,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 311,
    "db_id": "financial",
    "sql_snippet": "SELECT 5 AS RATES, COUNT(A8) FROM district WHERE A...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 70.\n  SELECT 5 AS RATES, COUNT(A8) FROM district WHERE A8 = 5 [split] \u001b[4mSELECT\u001b[0m 5 AS RATES, COUNT(A9) FROM district WHERE A9 = 5 [split] SELECT 4 AS RATES, COUNT(A8) FROM district",
    "duration_ms": 6.379127502441406,
    "input_sql_tokens": 130,
    "estimated_tokens": 287,
    "error_tokens": 85,
    "invalid_sql_tokens": 130,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 70.\n  SELECT 5 AS RATES, COUNT(A8) FROM district WHERE A8 = 5 [split] \u001b[4mSELECT\u001b[0m 5 AS RATES, COUNT(A9) FROM district WHERE A9 = 5 [split] SELECT 4 AS RATES, COUNT(A8) FROM district",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT 5 AS RATES, COUNT(A8) FROM district WHERE A8 = 5 [split] SELECT 5 AS RATES, COUNT(A9) FROM district WHERE A9 = 5 [split] SELECT 4 AS RATES, COUNT(A8) FROM district WHERE A8 = 4 [split] SELECT 4 AS RATES, COUNT(A9) FROM district WHERE A9 = 4 [split] SELECT 3 AS RATES, COUNT(A8) FROM district WHERE A8 = 3 [split] SELECT 3 AS RATES, COUNT(A9) FROM district WHERE A9 = 3",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 312,
    "db_id": "card_games",
    "sql_snippet": "SELECT s.id, s.code, s.parentcode AS ancestralCode...",
    "valid": true,
    "error": null,
    "duration_ms": 2.036571502685547,
    "input_sql_tokens": 29,
    "estimated_tokens": 107,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT s.id, s.code, s.parentcode AS ancestralCode FROM sets AS s WHERE NOT s.parentcode IS NULL",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 313,
    "db_id": "student_club",
    "sql_snippet": "SELECT event.event_id AS event_id, event.event_nam...",
    "valid": true,
    "error": null,
    "duration_ms": 3.7488937377929688,
    "input_sql_tokens": 110,
    "estimated_tokens": 196,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT event.event_id AS event_id, event.event_name AS event_name, MAX(attendance.link_to_member) AS largest_member, expense.cost FROM event LEFT JOIN attendance ON event.event_id = attendance.link_to_event LEFT JOIN expense ON attendance.link_to_member = expense.link_to_member WHERE event.event_id = 'rec2N69DMcrqN9PJC' GROUP BY event.event_id, expense.cost",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.093,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 314,
    "db_id": "debit_card_specializing",
    "sql_snippet": "WITH Partitioned AS (SELECT *, ROW_NUMBER() OVER (...",
    "valid": true,
    "error": null,
    "duration_ms": 8.202314376831055,
    "input_sql_tokens": 118,
    "estimated_tokens": 232,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH Partitioned AS (SELECT *, ROW_NUMBER() OVER (PARTITION BY CustomerID, Date ORDER BY CustomerID NULLS FIRST, Date NULLS FIRST) AS RowNumber FROM transactions_1k) SELECT *, CASE WHEN RowNumber > 1 THEN 0 ELSE COALESCE(CAST(AGE(CAST((SELECT MAX(Date) FROM transactions_1k WHERE Date < a.Date AND CustomerID = a.CustomerID) AS TIMESTAMP), CAST(a.Date AS TIMESTAMP)) AS BIGINT), 0) END AS Days_between FROM partitioned AS a",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11900000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 315,
    "db_id": "superhero",
    "sql_snippet": "SELECT hp1.hero_id AS id1, hp2.hero_id AS id2 FROM...",
    "valid": true,
    "error": null,
    "duration_ms": 3.668069839477539,
    "input_sql_tokens": 75,
    "estimated_tokens": 181,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT hp1.hero_id AS id1, hp2.hero_id AS id2 FROM hero_power AS hp1 INNER JOIN hero_power AS hp2 ON hp1.hero_id < hp2.hero_id WHERE hp1.power_id IN (SELECT DISTINCT hp2.power_id) GROUP BY id1, id2",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.118,
        "pattern_signature": "SELECT-DISTINCT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-SUBQUERY",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 316,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT transactions_1k.transactionid, transactions...",
    "valid": true,
    "error": null,
    "duration_ms": 6.0176849365234375,
    "input_sql_tokens": 150,
    "estimated_tokens": 254,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT transactions_1k.transactionid, transactions_1k.date, transactions_1k.customerid, STRING_AGG(gasstations.gasstationid::text, '|' ORDER BY transactions_1k.transactionid NULLS FIRST) AS gasstation_ids, STRING_AGG(products.productid::text, '|' ORDER BY transactions_1k.transactionid NULLS FIRST) AS product_ids FROM transactions_1k LEFT JOIN gasstations ON transactions_1k.gasstationid = gasstations.gasstationid LEFT JOIN products ON transactions_1k.productid = products.productid WHERE NOT transactions_1k.customerid IS NULL GROUP BY transactions_1k.customerid",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09899999999999999,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 317,
    "db_id": "student_club",
    "sql_snippet": "SELECT * FROM budget GROUP BY link_to_event WHEN e...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 48.\n  SELECT * FROM budget GROUP BY link_to_event \u001b[4mWHEN\u001b[0m event_status = 'Closed' THEN 'Closed' WHEN event_status = 'Open' AND event_status = 'Planning' THEN",
    "duration_ms": 3.0357837677001953,
    "input_sql_tokens": 74,
    "estimated_tokens": 214,
    "error_tokens": 68,
    "invalid_sql_tokens": 74,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 48.\n  SELECT * FROM budget GROUP BY link_to_event \u001b[4mWHEN\u001b[0m event_status = 'Closed' THEN 'Closed' WHEN event_status = 'Open' AND event_status = 'Planning' THEN",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT * FROM budget GROUP BY link_to_event WHEN event_status = 'Closed' THEN 'Closed' WHEN event_status = 'Open' AND event_status = 'Planning' THEN 'Open' WHEN event_status = 'Open' THEN 'Open' WHEN event_status = 'Planning' THEN 'Planning' ELSE 'Unknown' END;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 318,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT c.customerid, SUM(t.amount) FROM customers ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.934694290161133,
    "input_sql_tokens": 41,
    "estimated_tokens": 146,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT c.customerid, SUM(t.amount) FROM customers AS c INNER JOIN transactions_1k AS t ON c.customerid = t.customerid GROUP BY c.customerid",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.051000000000000004,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 319,
    "db_id": "card_games",
    "sql_snippet": "SELECT table_name FROM information_schema.tables W...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0493736267089844,
    "input_sql_tokens": 35,
    "estimated_tokens": 138,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' ORDER BY (SELECT MAX(\"Update_Time\") FROM cards) NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10900000000000003,
        "pattern_signature": "SELECT-FROM-WHERE-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 320,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT m.* FROM match AS m WHERE m.league_id = '1'...",
    "valid": true,
    "error": null,
    "duration_ms": 2.0084381103515625,
    "input_sql_tokens": 32,
    "estimated_tokens": 118,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT m.* FROM match AS m WHERE m.league_id = '1' GROUP BY m.date ORDER BY m.date ASC NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 321,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT\n    id,\n    MAX(Max_v) AS Max_v,\n    NULL A...",
    "valid": true,
    "error": null,
    "duration_ms": 7.649898529052734,
    "input_sql_tokens": 172,
    "estimated_tokens": 290,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT\n    id,\n    MAX(Max_v) AS Max_v,\n    NULL AS MAX_attribute\nFROM (\n    SELECT id, crossing AS Max_v, 'crossing' AS AttributeName FROM Player_Attributes\n    UNION ALL\n    SELECT id, finishing AS Max_v, 'finishing' AS AttributeName FROM Player_Attributes\n    UNION ALL\n    SELECT id, heading_accuracy AS Max_v, 'heading_accuracy' AS AttributeName FROM Player_Attributes\n    UNION ALL\n    SELECT id, short_passing AS Max_v, 'short_passing' AS AttributeName FROM Player_Attributes\n    UNION ALL\n    SELECT id, volleys AS Max_v, 'volleys' AS AttributeName FROM Player_Attributes\n) T\nGROUP BY id LIMIT 10;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09200000000000003,
        "pattern_signature": "SELECT-FROM-GROUP-UNION-LIMIT-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "LIMIT",
          "SELECT",
          "SUBQUERY",
          "UNION"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 322,
    "db_id": "codebase_community",
    "sql_snippet": "UPDATE ?? = REPLACE(??, 'http://stackoverflow.com'...",
    "valid": false,
    "error": "Expected table name but got <Token token_type: TokenType.DQMARK, text: ??, line: 1, col: 9, start: 7, end: 8, comments: []>. Line 1, Col: 9.\n  UPDATE \u001b[4m??\u001b[0m = REPLACE(??, 'http://stackoverflow.com', 'https://stackoverflow.com');",
    "duration_ms": 1.5468597412109375,
    "input_sql_tokens": 22,
    "estimated_tokens": 182,
    "error_tokens": 86,
    "invalid_sql_tokens": 22,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "Expected table name but got <Token token_type: TokenType.DQMARK, text: ??, line: 1, col: 9, start: 7, end: 8, comments: []>. Line 1, Col: 9.\n  UPDATE \u001b[4m??\u001b[0m = REPLACE(??, 'http://stackoverflow.com', 'https://stackoverflow.com');",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "UPDATE ?? = REPLACE(??, 'http://stackoverflow.com', 'https://stackoverflow.com');",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 323,
    "db_id": "card_games",
    "sql_snippet": "CREATE TABLE content (id serial PRIMARY KEY NOT NU...",
    "valid": false,
    "error": "Required keyword: 'expressions' missing for <class 'sqlglot.expressions.Constraint'>. Line 1, Col: 163.\n  _id int NOT NULL, nested_item_id int, block_id int, \"order\" int NOT NULL, CONSTRAINT not_own_parent \u001b[4mCHECK\u001b[0m nested_item_id <> id)",
    "duration_ms": 4.023075103759766,
    "input_sql_tokens": 54,
    "estimated_tokens": 212,
    "error_tokens": 84,
    "invalid_sql_tokens": 54,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "Required keyword: 'expressions' missing for <class 'sqlglot.expressions.Constraint'>. Line 1, Col: 163.\n  _id int NOT NULL, nested_item_id int, block_id int, \"order\" int NOT NULL, CONSTRAINT not_own_parent \u001b[4mCHECK\u001b[0m nested_item_id <> id)",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "CREATE TABLE content (id serial PRIMARY KEY NOT NULL, item_id int NOT NULL, nested_item_id int, block_id int, \"order\" int NOT NULL, CONSTRAINT not_own_parent CHECK nested_item_id <> id)",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 324,
    "db_id": "card_games",
    "sql_snippet": "SELECT cd.*, fd.* FROM cards cd INNER JOIN foreign...",
    "valid": true,
    "error": null,
    "duration_ms": 4.664421081542969,
    "input_sql_tokens": 55,
    "estimated_tokens": 168,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT cd.*, fd.* FROM cards cd INNER JOIN foreign_data fd ON cd.uuid = fd.uuid WHERE cd.availability = 'mtgo,paper' ORDER BY cd.releaseDate DESC, cd.uuid, fd.id LIMIT 100;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.052000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-WHERE-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "LIMIT",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 325,
    "db_id": "card_games",
    "sql_snippet": "INSERT INTO rulings (date, text, uuid) SELECT t.co...",
    "valid": true,
    "error": null,
    "duration_ms": 8.000373840332031,
    "input_sql_tokens": 141,
    "estimated_tokens": 233,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO rulings (date, text, uuid) SELECT t.col1, t.col2, t.col3 FROM (SELECT '2023-01-01' AS col1, 'Some ruling text.' AS col2, (SELECT uuid FROM cards WHERE borderColor = 'black' AND layout = 'normal') AS col3 UNION ALL SELECT '2023-01-02' AS col1, 'Another ruling text.' AS col2, (SELECT uuid FROM cards WHERE isAlternative = 1) AS col3) t WHERE NOT EXISTS (SELECT 1 FROM rulings WHERE rulings.date = t.col1::date);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.242,
        "pattern_signature": "SELECT-FROM-WHERE-UNION-INSERT-SUBQUERY",
        "clauses_present": [
          "FROM",
          "INSERT",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 3,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 326,
    "db_id": "formula_1",
    "sql_snippet": "INSERT INTO constructorResults (constructorResults...",
    "valid": true,
    "error": null,
    "duration_ms": 4.52733039855957,
    "input_sql_tokens": 69,
    "estimated_tokens": 174,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO constructorResults (constructorResultsId, raceId, constructorId, points, status)\nSELECT constructorResults.constructorResultsId, constructorResults.raceId, constructorResults.constructorId, constructorResults.points, constructorResults.status FROM constructors INNER JOIN constructorResults ON constructorResults.constructorResultsId = constructors.constructorId;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.045000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-INSERT",
        "clauses_present": [
          "FROM",
          "INSERT",
          "JOIN",
          "JOIN_INNER",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 327,
    "db_id": "european_football_2",
    "sql_snippet": "UPDATE Match SET date = TO_CHAR(make_timestamp(ext...",
    "valid": true,
    "error": null,
    "duration_ms": 6.287813186645508,
    "input_sql_tokens": 88,
    "estimated_tokens": 173,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "UPDATE Match SET date = TO_CHAR(make_timestamp(extract(year from date::timestamp)::int, extract(month from date::timestamp)::int, extract(day from date::timestamp)::int, 14, extract(minute from date::timestamp)::int, extract(second from date::timestamp)::double precision), 'YYYY-MM-DD HH24:MI:SS');",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UPDATE",
        "clauses_present": [
          "UPDATE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 328,
    "db_id": "toxicology",
    "sql_snippet": "SELECT element FROM atom LEFT JOIN molecule ON ato...",
    "valid": true,
    "error": null,
    "duration_ms": 1.001119613647461,
    "input_sql_tokens": 20,
    "estimated_tokens": 113,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT element FROM atom LEFT JOIN molecule ON atom.molecule_id = molecule.molecule_id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.045000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 329,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT humidity_level, (humidity_level - LAG(humid...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0128955841064453,
    "input_sql_tokens": 48,
    "estimated_tokens": 134,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT humidity_level, (humidity_level - LAG(humidity_level, 1) OVER (ORDER BY record_id NULLS FIRST)) AS diff FROM warehouse_humidity WHERE diff = 0 OR diff > 10",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.033,
        "pattern_signature": "SELECT-FROM-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 330,
    "db_id": "student_club",
    "sql_snippet": "SELECT s.member_id FROM members AS s WHERE s.posit...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 1, Col: 95.\n  SELECT s.member_id FROM members AS s WHERE s.position = 'Member' AND s.email @@ angela.sanders\u001b[4m@\u001b[0mlpu.edu;",
    "duration_ms": 3.5719871520996094,
    "input_sql_tokens": 34,
    "estimated_tokens": 165,
    "error_tokens": 59,
    "invalid_sql_tokens": 34,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 1, Col: 95.\n  SELECT s.member_id FROM members AS s WHERE s.position = 'Member' AND s.email @@ angela.sanders\u001b[4m@\u001b[0mlpu.edu;",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT s.member_id FROM members AS s WHERE s.position = 'Member' AND s.email @@ angela.sanders@lpu.edu;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 331,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT id, SUM(count) AS COUNT, SUM(excerptpostid)...",
    "valid": true,
    "error": null,
    "duration_ms": 1.7960071563720703,
    "input_sql_tokens": 27,
    "estimated_tokens": 116,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT id, SUM(count) AS COUNT, SUM(excerptpostid) AS EXCERPTPOSTID FROM backup_colour",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.022000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 332,
    "db_id": "card_games",
    "sql_snippet": "SELECT id FROM cards JOIN decks ON cards.id = deck...",
    "valid": true,
    "error": null,
    "duration_ms": 3.7457942962646484,
    "input_sql_tokens": 28,
    "estimated_tokens": 125,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT id FROM cards JOIN decks ON cards.id = decks.card1_id WHERE decks.card1_id <> 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.052000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 333,
    "db_id": "formula_1",
    "sql_snippet": "SELECT name, COUNT(*) FROM races",
    "valid": true,
    "error": null,
    "duration_ms": 1.9958019256591797,
    "input_sql_tokens": 8,
    "estimated_tokens": 82,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT name, COUNT(*) FROM races",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 334,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT team_list.t_id FROM team_list LEFT JOIN det...",
    "valid": true,
    "error": null,
    "duration_ms": 4.53948974609375,
    "input_sql_tokens": 62,
    "estimated_tokens": 154,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT team_list.t_id FROM team_list LEFT JOIN detail ON team_list.t_id = detail.t_id WHERE detail.type IN ('a', 'b') GROUP BY team_list.t_id HAVING COUNT(DISTINCT detail.type) = 2",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.065,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP-HAVING",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 335,
    "db_id": "debit_card_specializing",
    "sql_snippet": "WITH MissingValues AS (SELECT a.id + 1 AS missing_...",
    "valid": true,
    "error": null,
    "duration_ms": 6.808996200561523,
    "input_sql_tokens": 75,
    "estimated_tokens": 185,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH MissingValues AS (SELECT a.id + 1 AS missing_value FROM worker1 AS a LEFT JOIN worker1 AS b ON a.id + 1 = b.id WHERE b.id IS NULL) SELECT MIN(missing_value) AS lowest_missing_value FROM missingvalues WHERE NOT missing_value IN (SELECT id FROM worker2)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.15100000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 336,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT userid, RANK() OVER (ORDER BY viewcount, fa...",
    "valid": true,
    "error": null,
    "duration_ms": 5.404949188232422,
    "input_sql_tokens": 73,
    "estimated_tokens": 155,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT userid, RANK() OVER (ORDER BY viewcount, favoritecount, upvotecount DESC) as view_rank, RANK() OVER (ORDER BY viewcount, favoritecount, upvotecount DESC) as favorite_rank, RANK() OVER (ORDER BY viewcount, favoritecount, upvotecount DESC) as upvote_rank FROM user_record ORDER BY userid",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.028,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 337,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT CAST(SUM(CASE WHEN p2.product_name = 'Produ...",
    "valid": true,
    "error": null,
    "duration_ms": 7.011890411376953,
    "input_sql_tokens": 102,
    "estimated_tokens": 184,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT CAST(SUM(CASE WHEN p2.product_name = 'Product Y' THEN 1 ELSE 0 END) AS DOUBLE PRECISION) / NULLIF(COUNT(*), 0) AS percent_Y_after_X FROM orders AS p1 JOIN orders AS p2 ON p1.customer_id = p2.customer_id WHERE p1.product_name = 'Product X' AND p1.purchase_rank + 1 = p2.purchase_rank",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.064,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 338,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT CAST(SUM(CASE WHEN p2.product_name = 'Produ...",
    "valid": true,
    "error": null,
    "duration_ms": 6.036996841430664,
    "input_sql_tokens": 102,
    "estimated_tokens": 184,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT CAST(SUM(CASE WHEN p2.product_name = 'Product Z' THEN 1 ELSE 0 END) AS DOUBLE PRECISION) / NULLIF(COUNT(*), 0) AS percent_Z_after_X FROM orders AS p1 JOIN orders AS p2 ON p1.customer_id = p2.customer_id WHERE p1.product_name = 'Product X' AND p1.purchase_rank + 1 = p2.purchase_rank",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.064,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 339,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT CAST(SUM(CASE WHEN p2.product_name = 'Produ...",
    "valid": true,
    "error": null,
    "duration_ms": 7.055759429931641,
    "input_sql_tokens": 102,
    "estimated_tokens": 184,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT CAST(SUM(CASE WHEN p2.product_name = 'Product Z' THEN 1 ELSE 0 END) AS DOUBLE PRECISION) / NULLIF(COUNT(*), 0) AS percent_Z_after_Y FROM orders AS p1 JOIN orders AS p2 ON p1.customer_id = p2.customer_id WHERE p1.product_name = 'Product Y' AND p1.purchase_rank + 1 = p2.purchase_rank",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.064,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 340,
    "db_id": "financial",
    "sql_snippet": "SELECT SUM(t1.quantity) AS total FROM products AS ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.5167465209960938,
    "input_sql_tokens": 47,
    "estimated_tokens": 129,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT SUM(t1.quantity) AS total FROM products AS t1 LEFT JOIN records AS t2 ON t1.order_id = t2.order_id WHERE t2.order_status = 'A'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.058,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 341,
    "db_id": "card_games",
    "sql_snippet": "SELECT type, COUNT(*) AS type_count FROM card_type...",
    "valid": true,
    "error": null,
    "duration_ms": 4.779815673828125,
    "input_sql_tokens": 38,
    "estimated_tokens": 150,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT type, COUNT(*) AS type_count FROM card_type WHERE cardid IN (SELECT DISTINCT cardid FROM info) GROUP BY type ORDER BY type_count DESC NULLS LAST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10900000000000003,
        "pattern_signature": "SELECT-DISTINCT-FROM-WHERE-GROUP-ORDER-SUBQUERY",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 342,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT results.score, scores.value, scores.segment...",
    "valid": true,
    "error": null,
    "duration_ms": 6.019353866577148,
    "input_sql_tokens": 56,
    "estimated_tokens": 161,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT results.score, scores.value, scores.segment FROM customer_scores AS scores JOIN customer_results AS results ON scores.segment = results.segment WHERE results.score >= scores.score GROUP BY scores.segment ORDER BY scores.customerid DESC NULLS LAST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.052000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 343,
    "db_id": "superhero",
    "sql_snippet": "CHECK(id <> spouseid)",
    "valid": true,
    "error": null,
    "duration_ms": 0.7200241088867188,
    "input_sql_tokens": 8,
    "estimated_tokens": 75,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CHECK(id <> spouseid)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 344,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "CREATE TABLE log_content (\"log_id\" INT GENERATED B...",
    "valid": true,
    "error": null,
    "duration_ms": 4.039764404296875,
    "input_sql_tokens": 54,
    "estimated_tokens": 142,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TABLE log_content (\"log_id\" INT GENERATED BY DEFAULT AS IDENTITY NOT NULL, \"content\" VARCHAR(32) NOT NULL, \"no_of_chars\" INT NULL DEFAULT CHAR_LENGTH(\"content\"), PRIMARY KEY (\"log_id\"))",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 345,
    "db_id": "debit_card_specializing",
    "sql_snippet": "UPDATE products SET description = 'Other' WHERE pr...",
    "valid": true,
    "error": null,
    "duration_ms": 2.989053726196289,
    "input_sql_tokens": 15,
    "estimated_tokens": 89,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "UPDATE products SET description = 'Other' WHERE productid = 2",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "WHERE-UPDATE",
        "clauses_present": [
          "UPDATE",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 346,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT CASE WHEN amount_sold < 1000 THEN 'Under 10...",
    "valid": true,
    "error": null,
    "duration_ms": 4.870414733886719,
    "input_sql_tokens": 122,
    "estimated_tokens": 200,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT CASE WHEN amount_sold < 1000 THEN 'Under 1000' WHEN amount_sold BETWEEN 1000 AND 9999 THEN '1000 to 9999' WHEN amount_sold BETWEEN 10000 AND 49999 THEN '10000 to 49999' WHEN amount_sold >= 50000 THEN '50000 and above' END AS range, AVG(Count) AS avg FROM sales_data GROUP BY range",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 347,
    "db_id": "formula_1",
    "sql_snippet": "DELETE FROM pitstops WHERE raceid = (SELECT MIN(ra...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0291080474853516,
    "input_sql_tokens": 29,
    "estimated_tokens": 127,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DELETE FROM pitstops WHERE raceid = (SELECT MIN(raceid) FROM pitstops GROUP BY milliseconds HAVING COUNT(*) > 1)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.112,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-HAVING-DELETE-SUBQUERY",
        "clauses_present": [
          "DELETE",
          "FROM",
          "GROUP",
          "HAVING",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 348,
    "db_id": "card_games",
    "sql_snippet": "INSERT INTO session_card (session_id, card_id, car...",
    "valid": true,
    "error": null,
    "duration_ms": 0.9853839874267578,
    "input_sql_tokens": 34,
    "estimated_tokens": 123,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO session_card (session_id, card_id, card_mode) VALUES (9410, 256, 'rw')",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 349,
    "db_id": "card_games",
    "sql_snippet": "CREATE TABLE IF NOT EXISTS session_card (sc_id int...",
    "valid": true,
    "error": null,
    "duration_ms": 4.001617431640625,
    "input_sql_tokens": 50,
    "estimated_tokens": 134,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TABLE IF NOT EXISTS session_card (sc_id integer NOT NULL, session_id integer DEFAULT NULL, card_id integer DEFAULT NULL, card_mode character varying(10) DEFAULT NULL, PRIMARY KEY (sc_id))",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 350,
    "db_id": "card_games",
    "sql_snippet": "SELECT c.* FROM cards c WHERE c.setcode IN (SELECT...",
    "valid": true,
    "error": null,
    "duration_ms": 4.980564117431641,
    "input_sql_tokens": 56,
    "estimated_tokens": 154,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT c.* FROM cards c WHERE c.setcode IN (SELECT setcode FROM cards WHERE isreprint = 1) OR c.id = (SELECT MAX(id) FROM cards WHERE setcode = c.setcode AND isreprint = 0)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.16500000000000004,
        "pattern_signature": "SELECT-FROM-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 351,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SET list = (SELECT id FROM patient WHERE sex = 'F'...",
    "valid": true,
    "error": null,
    "duration_ms": 1.9948482513427734,
    "input_sql_tokens": 25,
    "estimated_tokens": 123,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SET list = (SELECT id FROM patient WHERE sex = 'F' AND id < 40000);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10300000000000004,
        "pattern_signature": "SELECT-FROM-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 352,
    "db_id": "card_games",
    "sql_snippet": "SELECT * FROM rules AS t1 WHERE t1.valid_from <= '...",
    "valid": true,
    "error": null,
    "duration_ms": 7.0247650146484375,
    "input_sql_tokens": 166,
    "estimated_tokens": 244,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM rules AS t1 WHERE t1.valid_from <= '2024-12-31' AND (t1.valid_to >= '2022-07-01' OR t1.valid_to IS NULL) AND NOT EXISTS(SELECT 1 FROM rules AS t2 WHERE t2.valid_from > t1.valid_from AND t2.valid_from <= '2024-12-31' AND (t2.valid_to IS NULL OR t2.valid_to > '2022-07-01') AND t2.valid_from <= COALESCE(t1.valid_to, '2024-12-31'))",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.094,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 353,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT t1.product_code, t1.product_id, t1.assign_k...",
    "valid": true,
    "error": null,
    "duration_ms": 5.125284194946289,
    "input_sql_tokens": 86,
    "estimated_tokens": 183,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT t1.product_code, t1.product_id, t1.assign_key, STRING_AGG(t2.value_name, ',') FROM products_sample AS t1 LEFT JOIN value_list AS t2 ON t2.value_id::text = ANY(string_to_array(t1.assign_key, ',')) GROUP BY t1.assign_key",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.051000000000000004,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 354,
    "db_id": "card_games",
    "sql_snippet": "SELECT p.id, p.name, c.item, c.size FROM packages ...",
    "valid": false,
    "error": "Unbalanced parentheses or brackets",
    "duration_ms": 13.156890869140625,
    "input_sql_tokens": 105,
    "estimated_tokens": 179,
    "error_tokens": 6,
    "invalid_sql_tokens": 105,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unbalanced_tokens",
          "message": "Unbalanced parentheses or brackets",
          "location": null,
          "context": "2 unclosed '('",
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT p.id, p.name, c.item, c.size FROM packages p LEFT JOIN contents c ON (c.packageid=p.id) WHERE (( p.id IN ( SELECT packageid FROM contents WHERE item='square' AND size='A' ) AND ( p.id IN ( SELECT packageid FROM contents WHERE item='circle' AND size='B' )) GROUP BY p.id HAVING ( SELECT COUNT(*) FROM contents WHERE packageid=p.id ) = 2;",
      "tags": [
        "syntax_unbalanced_tokens"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 355,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT ProductID, SPLIT_PART(Description, 'x', 1) ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.5622119903564453,
    "input_sql_tokens": 38,
    "estimated_tokens": 127,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT ProductID, SPLIT_PART(Description, 'x', 1) AS count, SPLIT_PART(Description, 'x', 2) AS type FROM product",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 356,
    "db_id": "debit_card_specializing",
    "sql_snippet": "WITH duplicates AS (SELECT product FROM promotions...",
    "valid": true,
    "error": null,
    "duration_ms": 4.619359970092773,
    "input_sql_tokens": 36,
    "estimated_tokens": 154,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH duplicates AS (SELECT product FROM promotions GROUP BY product HAVING COUNT(product) > 1) SELECT * FROM promotions INNER JOIN duplicates ON promotions.product = duplicates.product",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10200000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-GROUP-HAVING",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 357,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT team, MIN(source) AS source, MAX(destinatio...",
    "valid": true,
    "error": null,
    "duration_ms": 3.649473190307617,
    "input_sql_tokens": 26,
    "estimated_tokens": 119,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT team, MIN(source) AS source, MAX(destination) AS destination FROM source_destination_flight GROUP BY team",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.022000000000000002,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 358,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT EXTRACT(YEAR FROM CAST(c.creationdate AS DA...",
    "valid": true,
    "error": null,
    "duration_ms": 5.005359649658203,
    "input_sql_tokens": 73,
    "estimated_tokens": 167,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT EXTRACT(YEAR FROM CAST(c.creationdate AS DATE)), u.displayname, COUNT(c.id) AS nbrOfComments FROM comments AS c INNER JOIN users AS u ON c.userid = u.id WHERE EXTRACT(YEAR FROM CAST(c.creationdate AS DATE)) = '2010' GROUP BY u.id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.058,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 359,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT t1.transactionid, g.gasstationid, p.product...",
    "valid": true,
    "error": null,
    "duration_ms": 7.9669952392578125,
    "input_sql_tokens": 147,
    "estimated_tokens": 229,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT t1.transactionid, g.gasstationid, p.productid, COALESCE(t1.date, g.country, p.description) AS date, COALESCE(t1.amount, 0) AS amount, COALESCE(g.chainid, 0) AS chainid, COALESCE(p.description, '') AS description FROM transactions_1k AS t1 FULL OUTER JOIN gasstations AS g ON t1.gasstationid = g.gasstationid FULL OUTER JOIN products AS p ON COALESCE(t1.date, g.country) = p.productid WHERE t1.date IS NULL AND g.country IS NULL",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.097,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 360,
    "db_id": "financial",
    "sql_snippet": "INSERT INTO account (\"account_id\", \"district_id\", ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.038644790649414,
    "input_sql_tokens": 60,
    "estimated_tokens": 151,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO account (\"account_id\", \"district_id\", \"frequency\", \"account_type\", \"date\") VALUES (12345, 18, 'POPLATEK MESICNE', 'Regular', '1970-12-13')",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 361,
    "db_id": "card_games",
    "sql_snippet": "WITH RECURSIVE HierarchyCTE(entityid, parentid, em...",
    "valid": true,
    "error": null,
    "duration_ms": 13.72981071472168,
    "input_sql_tokens": 253,
    "estimated_tokens": 392,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE HierarchyCTE(entityid, parentid, emission, total_emission, percentage, level) AS (\n    SELECT entityid, parentid, emission, emission AS total_emission, pctcontribution, 0\n    FROM tree_table\n    WHERE NOT entityid IN (SELECT DISTINCT parentid FROM tree_table WHERE NOT parentid IS NULL)\n    UNION ALL\n    SELECT h.entityid, h.parentid, h.emission, h.emission + cte.total_emission * (CAST(cte.pctcontribution AS DOUBLE PRECISION) / NULLIF(100, 0)) AS total_emission, h.pctcontribution, cte.level + 1\n    FROM tree_table AS h\n    JOIN hierarchycte AS cte ON h.entityid = cte.parentid\n)\nSELECT entityid, parentid, SUM(total_emission) AS total_emission\nFROM (\n    SELECT entityid, parentid, SUM(total_emission) AS total_emission, level\n    FROM hierarchycte\n    GROUP BY entityid, parentid, level\n)\nGROUP BY entityid, parentid\nORDER BY entityid NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.22300000000000003,
        "pattern_signature": "WITH-CTE-SELECT-DISTINCT-FROM-JOIN-WHERE-GROUP-UNION-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "DISTINCT",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 2,
        "num_ctes": 1,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 362,
    "db_id": "debit_card_specializing",
    "sql_snippet": "CREATE TABLE table1 (start INT NOT NULL, id INT GE...",
    "valid": true,
    "error": null,
    "duration_ms": 2.6397705078125,
    "input_sql_tokens": 38,
    "estimated_tokens": 122,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TABLE table1 (start INT NOT NULL, id INT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY, counter INT NOT NULL, difference INT NOT NULL, end INT NOT NULL)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 363,
    "db_id": "debit_card_specializing",
    "sql_snippet": "CREATE OR REPLACE PROCEDURE doWhile()\nLANGUAGE plp...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0279159545898438,
    "input_sql_tokens": 111,
    "estimated_tokens": 200,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE PROCEDURE doWhile()\nLANGUAGE plpgsql\nAS $$\nDECLARE\n    i INT := 1;\n    start INT := 120;\n    counter INT := 1;\n    end INT := 300;\nBEGIN\n    WHILE (i <= end) LOOP\n        INSERT INTO table1 VALUES (start, DEFAULT, counter, start+counter, end);\n        i := i+1;\n        counter := counter+1;\n    END LOOP;\nEND;\n$$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 364,
    "db_id": "debit_card_specializing",
    "sql_snippet": "CALL doWhile()",
    "valid": true,
    "error": null,
    "duration_ms": 1.0173320770263672,
    "input_sql_tokens": 5,
    "estimated_tokens": 72,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CALL doWhile()",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 365,
    "db_id": "debit_card_specializing",
    "sql_snippet": "CREATE OR REPLACE PROCEDURE insertMore()\nLANGUAGE ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.4445056915283203,
    "input_sql_tokens": 110,
    "estimated_tokens": 199,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE PROCEDURE insertMore()\nLANGUAGE plpgsql\nAS $$\nDECLARE\n    start INT;\n    counter INT := 1;\n    end INT;\nBEGIN\n    SELECT COUNT(*) INTO end FROM table1;\n    SELECT MAX(id)+1 INTO start FROM table1;\n    WHILE (counter <= end) LOOP\n        INSERT INTO table1 VALUES (start, DEFAULT, counter, start+counter, end);\n        counter := counter+1;\n    END LOOP;\nEND;\n$$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 366,
    "db_id": "debit_card_specializing",
    "sql_snippet": "CALL insertMore()",
    "valid": true,
    "error": null,
    "duration_ms": 1.2028217315673828,
    "input_sql_tokens": 5,
    "estimated_tokens": 72,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CALL insertMore()",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 367,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT * FROM table1",
    "valid": true,
    "error": null,
    "duration_ms": 1.2073516845703125,
    "input_sql_tokens": 6,
    "estimated_tokens": 95,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM table1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 368,
    "db_id": "student_club",
    "sql_snippet": "SELECT j.* FROM event e, json_array_elements(e.eve...",
    "valid": true,
    "error": null,
    "duration_ms": 7.349252700805664,
    "input_sql_tokens": 116,
    "estimated_tokens": 237,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT j.* FROM event e, json_array_elements(e.event_schedule->'$.*[*]') AS j(element)\nCROSS JOIN LATERAL (\n  SELECT\n    (j.element->>'start')::TIME AS date_start,\n    (j.element->>'end')::TIME AS date_end,\n    (j.element->>'*')::VARCHAR(10) AS day\n) AS j\nWHERE e.event_id='rec0Si5cQ4rJRVzd6';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14300000000000002,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_CROSS-LATERAL-WHERE-SUBQUERY",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "LATERAL",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 369,
    "db_id": "codebase_community",
    "sql_snippet": "SELECT\n  id,\n  displayname,\n  age,\n  SUM(date_part...",
    "valid": false,
    "error": "Expected ]. Line 5, Col: 79.\n  \n  id,\n  displayname,\n  age,\n  SUM(date_part('day', lastaccessdate - creationdate) + 1) - [subtract \u001b[4mholidays\u001b[0m] AS TotalDays\nFROM\n  users\nGROUP BY\n  displayname, age\nORDER BY\n  users.id;",
    "duration_ms": 6.014823913574219,
    "input_sql_tokens": 67,
    "estimated_tokens": 244,
    "error_tokens": 89,
    "invalid_sql_tokens": 67,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "Expected ]. Line 5, Col: 79.\n  \n  id,\n  displayname,\n  age,\n  SUM(date_part('day', lastaccessdate - creationdate) + 1) - [subtract \u001b[4mholidays\u001b[0m] AS TotalDays\nFROM\n  users\nGROUP BY\n  displayname, age\nORDER BY\n  users.id;",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT\n  id,\n  displayname,\n  age,\n  SUM(date_part('day', lastaccessdate - creationdate) + 1) - [subtract holidays] AS TotalDays\nFROM\n  users\nGROUP BY\n  displayname, age\nORDER BY\n  users.id;",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 370,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT COUNT(*) AS count FROM duration AS d WHERE ...",
    "valid": true,
    "error": null,
    "duration_ms": 7.1086883544921875,
    "input_sql_tokens": 230,
    "estimated_tokens": 324,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT COUNT(*) AS count FROM duration AS d WHERE (TIMESTAMP '2011-12-19 12:00:00' >= d.start AND TIMESTAMP '2011-12-19 12:00:00' < d.\"end\") OR (TIMESTAMP '2011-12-19 15:00:00' > d.start AND TIMESTAMP '2011-12-19 15:00:00' <= d.\"end\") OR (d.start BETWEEN TIMESTAMP '2011-12-19 12:00:00' AND TIMESTAMP '2011-12-19 15:00:00' AND d.\"end\" BETWEEN TIMESTAMP '2011-12-19 12:00:00' AND TIMESTAMP '2011-12-19 15:00:00');",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.07300000000000001,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 371,
    "db_id": "financial",
    "sql_snippet": "SELECT ct.c_id, bt.start_time::date AS date, trip_...",
    "valid": true,
    "error": null,
    "duration_ms": 12.247800827026367,
    "input_sql_tokens": 242,
    "estimated_tokens": 330,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT ct.c_id, bt.start_time::date AS date, trip_counts.trip_count, SUM(CASE WHEN tc.duration = 'Single' AND trip_counts.trip_count = 1 THEN tc.cost WHEN tc.duration = 'Single' AND trip_counts.trip_count = 2 THEN tc.cost * 2 ELSE 0 END) + SUM(CASE WHEN tc.duration = 'Day' AND trip_counts.trip_count >= 3 THEN tc.cost ELSE 0 END) AS total_cost FROM customertrip ct JOIN bustrip bt ON ct.b_id = bt.b_id JOIN ticketcosts tc ON tc.duration IN ('Single', 'Day') JOIN (SELECT b_id, start_time::date AS trip_date, COUNT(*) AS trip_count FROM bustrip GROUP BY b_id, start_time::date) trip_counts ON ct.b_id = trip_counts.b_id AND bt.start_time::date = trip_counts.trip_date GROUP BY ct.c_id, bt.start_time::date;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.239,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 3,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 372,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT CONCAT(EXTRACT(HOUR FROM description), ' ho...",
    "valid": true,
    "error": null,
    "duration_ms": 2.718210220336914,
    "input_sql_tokens": 39,
    "estimated_tokens": 128,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT CONCAT(EXTRACT(HOUR FROM description), ' hours, ', EXTRACT(MINUTE FROM description), ' minutes, ', EXTRACT(SECOND FROM description), ' seconds') FROM backup_colour",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 373,
    "db_id": "student_club",
    "sql_snippet": "CREATE TABLE `lessonschedule` (`record_id` SMALLIN...",
    "valid": true,
    "error": null,
    "duration_ms": 3.4551620483398438,
    "input_sql_tokens": 99,
    "estimated_tokens": 166,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TABLE `lessonschedule` (`record_id` SMALLINT NOT NULL, `student_id` SMALLINT, `lesson_date_time` TIMESTAMP NOT NULL, PRIMARY KEY (`record_id`, `student_id`, `lesson_date_time`), CONSTRAINT `fk_record` FOREIGN KEY (`record_id`) REFERENCES `record`(`id`), CONSTRAINT `fk_student` FOREIGN KEY (`student_id`) REFERENCES `student`(`id`));",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 374,
    "db_id": "student_club",
    "sql_snippet": "ALTER TABLE \"member_privileges\" ADD CONSTRAINT \"me...",
    "valid": true,
    "error": null,
    "duration_ms": 1.8770694732666016,
    "input_sql_tokens": 28,
    "estimated_tokens": 113,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "ALTER TABLE \"member_privileges\" ADD CONSTRAINT \"member_fk\" FOREIGN KEY REFERENCES \"member\"(\"member_id\");",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.020000000000000004,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 375,
    "db_id": "superhero",
    "sql_snippet": "CREATE TABLE hero_event (event_id SERIAL PRIMARY K...",
    "valid": true,
    "error": null,
    "duration_ms": 2.439737319946289,
    "input_sql_tokens": 31,
    "estimated_tokens": 115,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TABLE hero_event (event_id SERIAL PRIMARY KEY, superhero TEXT NOT NULL, event_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIME);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 376,
    "db_id": "superhero",
    "sql_snippet": "ALTER TABLE superhero ALTER COLUMN description TYP...",
    "valid": true,
    "error": null,
    "duration_ms": 1.8525123596191406,
    "input_sql_tokens": 16,
    "estimated_tokens": 100,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "ALTER TABLE superhero ALTER COLUMN description TYPE JSON SET NOT NULL SET DEFAULT '{}';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 377,
    "db_id": "student_club",
    "sql_snippet": "SELECT REGEXP_REPLACE(first_name, '(\\w)\\w', '\\1*')...",
    "valid": true,
    "error": null,
    "duration_ms": 2.3186206817626953,
    "input_sql_tokens": 55,
    "estimated_tokens": 144,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT REGEXP_REPLACE(first_name, '(\\w)\\w', '\\1*') AS masked_first_name, REGEXP_REPLACE(last_name, '(\\w)\\w', '\\1*') AS masked_last_name FROM member",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 378,
    "db_id": "student_club",
    "sql_snippet": "SELECT b.\"event_id\", b.\"amount\", b.\"link_to_member...",
    "valid": true,
    "error": null,
    "duration_ms": 4.186391830444336,
    "input_sql_tokens": 83,
    "estimated_tokens": 164,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT b.\"event_id\", b.\"amount\", b.\"link_to_member\", \"link_to_event\" FROM event AS b JOIN budget AS b ON b.\"event_id\" = b.\"link_to_event\" LEFT JOIN attendance AS b ON b.\"event_id\" = b.\"link_to_event\" ORDER BY b.\"event_id\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08,
        "pattern_signature": "SELECT-FROM-JOIN-ORDER",
        "clauses_present": [
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 379,
    "db_id": "superhero",
    "sql_snippet": "CREATE FUNCTION check_alignment(alignment_name VAR...",
    "valid": false,
    "error": "Error tokenizing 'alignment_name LIKE '%Good%' THEN 'Y' ELSE 'N' EN'",
    "duration_ms": 0.6363391876220703,
    "input_sql_tokens": 39,
    "estimated_tokens": 120,
    "error_tokens": 22,
    "invalid_sql_tokens": 39,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_error",
          "message": "Error tokenizing 'alignment_name LIKE '%Good%' THEN 'Y' ELSE 'N' EN'",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "CREATE FUNCTION check_alignment(alignment_name VARCHAR) RETURNS VARCHAR(1) AS $$ BEGIN RETURN CASE WHEN alignment_name LIKE '%Good%' THEN 'Y' ELSE 'N' END",
      "tags": [
        "syntax_error"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 380,
    "db_id": "toxicology",
    "sql_snippet": "WITH RECURSIVE \"atom_hierarchy\" AS (SELECT \"atom_i...",
    "valid": true,
    "error": null,
    "duration_ms": 7.04503059387207,
    "input_sql_tokens": 147,
    "estimated_tokens": 246,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE \"atom_hierarchy\" AS (SELECT \"atom_id\", \"atom_id2\", \"bond_id\", 1 AS \"level\" FROM connected WHERE \"atom_id\" = 'TR007_8' UNION ALL SELECT c.\"atom_id\", c.\"atom_id2\", c.\"bond_id\", ah.\"level\" + 1 FROM connected AS c JOIN atom_hierarchy AS ah ON c.\"atom_id\" = ah.\"atom_id2\") SELECT \"atom_id\", \"atom_id2\", \"bond_id\", \"level\" FROM atom_hierarchy ORDER BY \"level\" NULLS FIRST, \"atom_id\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.096,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-UNION-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 381,
    "db_id": "superhero",
    "sql_snippet": "WITH \"MaxHeightCTE\" AS (SELECT \"alignment_id\", \"pu...",
    "valid": true,
    "error": null,
    "duration_ms": 9.147882461547852,
    "input_sql_tokens": 215,
    "estimated_tokens": 314,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH \"MaxHeightCTE\" AS (SELECT \"alignment_id\", \"publisher_id\", MAX(\"height_cm\") AS \"max_height\" FROM superhero GROUP BY \"alignment_id\", \"publisher_id\"), \"JoinedCTE\" AS (SELECT s.\"id\", s.\"superhero_name\", s.\"alignment_id\", s.\"publisher_id\", s.\"height_cm\", s.\"hair_colour_id\" FROM superhero AS s JOIN maxheightcte AS m ON s.\"alignment_id\" = m.\"alignment_id\" AND s.\"publisher_id\" = m.\"publisher_id\" AND s.\"height_cm\" = m.\"max_height\") SELECT \"alignment_id\", \"publisher_id\", SUM(\"hair_colour_id\") AS \"total_hair_colour\", MAX(\"height_cm\") AS \"max_height\" FROM joinedcte GROUP BY \"alignment_id\", \"publisher_id\" ORDER BY \"alignment_id\" NULLS FIRST, \"publisher_id\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.137,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 382,
    "db_id": "toxicology",
    "sql_snippet": "WITH atom_bonds AS (\n    SELECT a.\"atom_id\", a.\"mo...",
    "valid": true,
    "error": null,
    "duration_ms": 17.139196395874023,
    "input_sql_tokens": 369,
    "estimated_tokens": 480,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH atom_bonds AS (\n    SELECT a.\"atom_id\", a.\"molecule_id\", a.\"element\",\n           STRING_AGG(c.\"bond_id\", ',' ORDER BY c.\"bond_id\" NULLS FIRST) AS connected_bonds\n    FROM atom AS a\n    LEFT JOIN connected AS c ON a.\"atom_id\" = c.\"atom_id\"\n    GROUP BY a.\"atom_id\", a.\"molecule_id\", a.\"element\"\n),\nmolecule_stats AS (\n    SELECT m.\"molecule_id\", m.\"label\",\n           COUNT(a.\"atom_id\") OVER (PARTITION BY m.\"molecule_id\") AS atom_count,\n           ROW_NUMBER() OVER (PARTITION BY m.\"molecule_id\" ORDER BY m.\"molecule_id\" NULLS FIRST) AS rn\n    FROM molecule AS m\n    LEFT JOIN atom AS a ON m.\"molecule_id\" = a.\"molecule_id\"\n)\nSELECT ab.\"atom_id\", ab.\"molecule_id\", ab.\"element\", ms.\"label\",\n       (regexp_split_to_array(ab.connected_bonds || ',', ','))[1]::json#>>'{}' AS bond_id,\n       b.\"bond_type\"\nFROM atom_bonds AS ab\nJOIN molecule_stats AS ms ON ab.\"molecule_id\" = ms.\"molecule_id\" AND ms.rn = 1\nLEFT JOIN bond AS b ON SPLIT_PART(ab.connected_bonds || ',', ',', 1) = b.\"bond_id\"\nWHERE NOT ab.\"atom_id\" IS NULL\nORDER BY ab.\"molecule_id\" NULLS FIRST, ab.\"atom_id\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.233,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 4,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 383,
    "db_id": "european_football_2",
    "sql_snippet": "DO $$\nDECLARE v_year NUMERIC;\nv_week NUMERIC;\nv_ho...",
    "valid": true,
    "error": null,
    "duration_ms": 3.8344860076904297,
    "input_sql_tokens": 349,
    "estimated_tokens": 432,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DO $$\nDECLARE v_year NUMERIC;\nv_week NUMERIC;\nv_home_team_wins NUMERIC;\nv_away_team_wins NUMERIC;\nv_draws NUMERIC;\nv_total_matches NUMERIC;\nBEGIN\nSELECT EXTRACT(YEAR\n               FROM TO_TIMESTAMP(\"date\", 'YYYY-MM-DD HH24:MI:SS')),\n       TO_CHAR(TO_TIMESTAMP(\"date\", 'YYYY-MM-DD HH24:MI:SS'), 'IW'),\n       SUM(CASE\n               WHEN \"home_team_goal\" > \"away_team_goal\" THEN 1\n               ELSE 0\n           END),\n       SUM(CASE\n               WHEN \"home_team_goal\" < \"away_team_goal\" THEN 1\n               ELSE 0\n           END),\n       SUM(CASE\n               WHEN \"home_team_goal\" = \"away_team_goal\" THEN 1\n               ELSE 0\n           END),\n       COUNT(*)\nFROM \"match\"\nGROUP BY EXTRACT(YEAR\n                 FROM TO_TIMESTAMP(\"date\", 'YYYY-MM-DD HH24:MI:SS')),\n         TO_CHAR(TO_TIMESTAMP(\"date\", 'YYYY-MM-DD HH24:MI:SS'), 'IW')\nORDER BY EXTRACT(YEAR\n                 FROM TO_TIMESTAMP(\"date\", 'YYYY-MM-DD HH24:MI:SS')),\n         TO_CHAR(TO_TIMESTAMP(\"date\", 'YYYY-MM-DD HH24:MI:SS'), 'IW');\nEND $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 384,
    "db_id": "toxicology",
    "sql_snippet": "WITH atom_stats AS (\n    SELECT molecule_id, COUNT...",
    "valid": true,
    "error": null,
    "duration_ms": 34.66606140136719,
    "input_sql_tokens": 833,
    "estimated_tokens": 995,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH atom_stats AS (\n    SELECT molecule_id, COUNT(*) AS atom_count, string_agg(element, ',' ORDER BY atom_id NULLS FIRST) AS elements\n    FROM atom\n    GROUP BY molecule_id\n),\nbond_hierarchy AS (\n    WITH RECURSIVE hierarchy AS (\n        SELECT bond_id, molecule_id, bond_type, 1 AS bond_depth, '/' || bond_id AS bond_path\n        FROM bond\n        WHERE bond_id LIKE '%\\_2\\_%' ESCAPE '\\'\n        UNION ALL\n        SELECT b.bond_id, b.molecule_id, b.bond_type, h.bond_depth + 1, \n               h.bond_path || '/' || b.bond_id\n        FROM bond b\n        JOIN hierarchy h ON h.bond_id = substring(b.bond_id, 1, position('_' in b.bond_id || '_') - 1) || '_' || \n                           CAST(CAST(substring(h.bond_id from position('_' in h.bond_id) + 1) AS DOUBLE PRECISION) + 1 AS TEXT)\n    )\n    SELECT * FROM hierarchy\n),\nmolecule_json AS (\n    SELECT m.molecule_id, m.label, \n           json_build_object(\n               'molecule_id', m.molecule_id, \n               'label', m.label, \n               'atoms', (\n                   SELECT json_agg(json_build_object('atom_id', a.atom_id, 'element', a.element) ORDER BY a.atom_id NULLS FIRST)\n                   FROM atom AS a \n                   WHERE a.molecule_id = m.molecule_id\n               )\n           ) AS molecule_data\n    FROM molecule AS m\n)\nSELECT m.molecule_id, m.label, a.atom_id, a.element, b.bond_id, b.bond_type, c.atom_id2, \n       stats.atom_count, stats.elements, \n       CASE WHEN molecule_data::text ~ '\"element\":\\s*\"cl\"' THEN 'Contains Chlorine' ELSE 'No Chlorine' END AS contains_cl,\n       bh.bond_depth, bh.bond_path\nFROM molecule AS m\nINNER JOIN atom AS a ON m.molecule_id = a.molecule_id\nINNER JOIN connected AS c ON a.atom_id = c.atom_id\nLEFT JOIN bond AS b ON c.bond_id = b.bond_id\nLEFT JOIN atom_stats AS stats ON m.molecule_id = stats.molecule_id\nLEFT JOIN molecule_json AS mj ON m.molecule_id = mj.molecule_id\nLEFT JOIN bond_hierarchy AS bh ON b.bond_id = bh.bond_id\nWHERE (NOT m.label IS NULL OR EXISTS(\n    SELECT 1 FROM atom AS a2 \n    WHERE a2.molecule_id = m.molecule_id \n    GROUP BY a2.molecule_id \n    HAVING COUNT(*) > 3\n))\nAND c.atom_id2 IN (\n    SELECT a3.atom_id \n    FROM atom AS a3 \n    WHERE a3.element = CASE \n        WHEN a.element = 'cl' THEN 'cl' \n        WHEN a.element = 'h' THEN 'o' \n        WHEN a.element = 'o' THEN 'h' \n        ELSE a.element \n    END\n)\nORDER BY m.molecule_id NULLS FIRST, a.atom_id NULLS FIRST, \n         COALESCE(CAST(substring(b.bond_id from '[0-9]+') AS DOUBLE PRECISION), 0) NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.4930000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-HAVING-UNION-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 7,
        "num_subqueries": 2,
        "num_ctes": 4,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 385,
    "db_id": "toxicology",
    "sql_snippet": "WITH RECURSIVE molecule_hierarchy AS (\n\n    SELECT...",
    "valid": true,
    "error": null,
    "duration_ms": 18.622398376464844,
    "input_sql_tokens": 440,
    "estimated_tokens": 553,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE molecule_hierarchy AS (\n\n    SELECT m.\"molecule_id\", m.\"label\", a.\"atom_id\", a.\"element\", 1 AS level, CAST(m.\"molecule_id\" AS VARCHAR(4000)) AS path\n    FROM molecule AS m\n    JOIN atom AS a ON m.\"molecule_id\" = a.\"molecule_id\"\n    WHERE a.\"element\" = 'cl'\n\n    UNION ALL\n\n\n    SELECT m.\"molecule_id\", m.\"label\", a.\"atom_id\", a.\"element\", mh.level + 1, mh.path || '->' || m.\"molecule_id\"\n    FROM molecule_hierarchy AS mh\n    JOIN connected AS c ON mh.\"atom_id\" = c.\"atom_id\"\n    JOIN bond AS b ON c.\"bond_id\" = b.\"bond_id\"\n    JOIN atom AS a ON c.\"atom_id2\" = a.\"atom_id\"\n    JOIN molecule AS m ON a.\"molecule_id\" = m.\"molecule_id\"\n    WHERE mh.level < 3 AND m.\"molecule_id\" <> SUBSTRING(mh.path FROM POSITION('->' IN mh.path) + 2)\n)\nSELECT m.\"molecule_id\", m.\"label\", a.\"atom_id\", a.\"element\", c.\"atom_id2\", b.\"bond_id\", b.\"bond_type\"\nFROM molecule AS m\nJOIN atom AS a ON m.\"molecule_id\" = a.\"molecule_id\"\nJOIN connected AS c ON a.\"atom_id\" = c.\"atom_id\"\nJOIN bond AS b ON c.\"bond_id\" = b.\"bond_id\"\nWHERE EXISTS(\n    SELECT 1\n    FROM molecule_hierarchy AS mh\n    WHERE m.\"molecule_id\" = mh.\"molecule_id\"\n)\nORDER BY m.\"molecule_id\" NULLS FIRST, a.\"atom_id\" NULLS FIRST, c.\"atom_id2\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.332,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-UNION-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 8,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 386,
    "db_id": "toxicology",
    "sql_snippet": "WITH molecule_atoms AS (\n    SELECT m.molecule_id,...",
    "valid": true,
    "error": null,
    "duration_ms": 23.203372955322266,
    "input_sql_tokens": 451,
    "estimated_tokens": 597,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH molecule_atoms AS (\n    SELECT m.molecule_id, m.label, a.atom_id, a.element,\n           ROW_NUMBER() OVER (PARTITION BY m.molecule_id ORDER BY a.atom_id NULLS FIRST) AS atom_seq\n    FROM molecule AS m\n    LEFT JOIN atom AS a ON m.molecule_id = a.molecule_id\n),\nmolecule_bonds AS (\n    SELECT b.molecule_id, b.bond_id, b.bond_type,\n           c.atom_id AS source_atom, c.atom_id2 AS target_atom,\n           DENSE_RANK() OVER (PARTITION BY b.molecule_id ORDER BY b.bond_id NULLS FIRST) AS bond_rank\n    FROM bond AS b\n    LEFT JOIN connected AS c ON b.bond_id = c.bond_id\n),\natom_connections AS (\n    SELECT ma.molecule_id, ma.label, ma.atom_id, ma.element,\n           mb.bond_id, mb.bond_type,\n           CASE WHEN mb.source_atom = ma.atom_id OR mb.target_atom = ma.atom_id THEN 1 ELSE 0 END AS is_connected\n    FROM molecule_atoms AS ma\n    CROSS JOIN molecule_bonds AS mb\n    WHERE ma.molecule_id = mb.molecule_id\n)\nSELECT ac.molecule_id, ac.label, ac.atom_id, ac.element, ac.bond_id, ac.bond_type\nFROM atom_connections AS ac\nWHERE ac.is_connected = 1\nUNION ALL\nSELECT DISTINCT ma.molecule_id, ma.label, ma.atom_id, ma.element, NULL AS bond_id, NULL AS bond_type\nFROM molecule_atoms AS ma\nWHERE NOT EXISTS(SELECT 1 FROM connected AS c WHERE c.atom_id = ma.atom_id)\nORDER BY molecule_id NULLS FIRST, atom_id NULLS FIRST, bond_id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.23300000000000004,
        "pattern_signature": "WITH-CTE-SELECT-DISTINCT-FROM-JOIN-JOIN_CROSS-WHERE-WINDOW-UNION-ORDER",
        "clauses_present": [
          "CTE",
          "DISTINCT",
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "ORDER",
          "SELECT",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 3,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 387,
    "db_id": "european_football_2",
    "sql_snippet": "WITH match_stats AS (SELECT \"m\".\"date\" AS \"match_d...",
    "valid": true,
    "error": null,
    "duration_ms": 23.148775100708008,
    "input_sql_tokens": 712,
    "estimated_tokens": 886,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH match_stats AS (SELECT \"m\".\"date\" AS \"match_date\", \"l\".\"name\" AS \"league_name\", \"c\".\"name\" AS \"country_name\", \"ht\".\"team_long_name\" AS \"home_team\", \"at\".\"team_long_name\" AS \"away_team\", \"m\".\"home_team_goal\" AS \"home_team_goals\", \"m\".\"away_team_goal\" AS \"away_team_goals\", RANK() OVER (PARTITION BY \"m\".\"league_id\", \"m\".\"season\" ORDER BY \"m\".\"home_team_goal\" + \"m\".\"away_team_goal\" DESC NULLS LAST) AS \"high_scoring_rank\" FROM match AS \"m\" INNER JOIN league AS \"l\" ON \"m\".\"league_id\" = \"l\".\"id\" INNER JOIN country AS \"c\" ON \"m\".\"country_id\" = \"c\".\"id\" INNER JOIN team AS \"ht\" ON \"m\".\"home_team_api_id\" = \"ht\".\"team_api_id\" INNER JOIN team AS \"at\" ON \"m\".\"away_team_api_id\" = \"at\".\"team_api_id\"), team_performance AS (SELECT \"team_long_name\", COUNT(*) AS \"total_matches\", SUM(CASE WHEN \"home_team\" = \"team_long_name\" THEN \"home_team_goals\" ELSE \"away_team_goals\" END) AS \"goals_scored\", AVG(CASE WHEN \"home_team\" = \"team_long_name\" THEN \"home_team_goals\" ELSE \"away_team_goals\" END) AS \"avg_goals_per_match\" FROM (SELECT \"match_date\", \"home_team\", \"away_team\", \"home_team_goals\", \"away_team_goals\", \"home_team\" AS \"team_long_name\" FROM match_stats UNION ALL SELECT \"match_date\", \"home_team\", \"away_team\", \"home_team_goals\", \"away_team_goals\", \"away_team\" AS \"team_long_name\" FROM match_stats) GROUP BY \"team_long_name\") SELECT ms.\"match_date\", ms.\"league_name\", ms.\"country_name\", ms.\"home_team\", ms.\"away_team\", ms.\"home_team_goals\", ms.\"away_team_goals\", ms.\"high_scoring_rank\", htp.\"avg_goals_per_match\" AS \"home_team_avg_goals\", atp.\"avg_goals_per_match\" AS \"away_team_avg_goals\" FROM match_stats AS ms LEFT JOIN team_performance AS htp ON ms.\"home_team\" = htp.\"team_long_name\" LEFT JOIN team_performance AS atp ON ms.\"away_team\" = atp.\"team_long_name\" WHERE ms.\"high_scoring_rank\" <= 10 GROUP BY ms.\"match_date\", ms.\"league_name\", ms.\"country_name\", ms.\"home_team\", ms.\"away_team\", ms.\"home_team_goals\", ms.\"away_team_goals\", ms.\"high_scoring_rank\" ORDER BY ms.\"match_date\" DESC NULLS LAST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.36100000000000004,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-WINDOW-UNION-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 6,
        "num_subqueries": 1,
        "num_ctes": 2,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 388,
    "db_id": "toxicology",
    "sql_snippet": "WITH atom_elements AS (SELECT a.atom_id, a.molecul...",
    "valid": true,
    "error": null,
    "duration_ms": 12.386798858642578,
    "input_sql_tokens": 266,
    "estimated_tokens": 378,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH atom_elements AS (SELECT a.atom_id, a.molecule_id, a.element, RANK() OVER (PARTITION BY a.molecule_id ORDER BY a.atom_id NULLS FIRST) AS element_rank FROM atom AS a), bond_details AS (SELECT b.bond_id, b.molecule_id, b.bond_type, DENSE_RANK() OVER (PARTITION BY b.molecule_id ORDER BY b.bond_id NULLS FIRST) AS bond_rank FROM bond AS b) SELECT ae.atom_id, ae.molecule_id, ae.element, c.bond_id, CASE WHEN bd.bond_type IS NULL THEN 'Unknown' ELSE bd.bond_type END AS bond_type FROM atom_elements AS ae LEFT JOIN connected AS c ON ae.atom_id = c.atom_id LEFT JOIN bond_details AS bd ON c.bond_id = bd.bond_id AND ae.molecule_id = bd.molecule_id AND ae.element_rank = bd.bond_rank WHERE EXISTS(SELECT 1 FROM molecule AS m WHERE m.molecule_id = ae.molecule_id AND NOT m.label IS NULL) ORDER BY ae.atom_id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.21000000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 389,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT \"m\".\"id\", \"m\".\"home_team_api_id\", \"m\".\"away...",
    "valid": true,
    "error": null,
    "duration_ms": 8.466243743896484,
    "input_sql_tokens": 243,
    "estimated_tokens": 381,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT \"m\".\"id\", \"m\".\"home_team_api_id\", \"m\".\"away_team_api_id\", \"m\".\"home_team_goal\", \"m\".\"away_team_goal\", SUM(CASE WHEN \"m\".\"home_team_api_id\" = \"t\".\"team_api_id\" THEN \"m\".\"home_team_goal\" - \"m\".\"away_team_goal\" ELSE \"m\".\"away_team_goal\" - \"m\".\"home_team_goal\" END) OVER (PARTITION BY \"t\".\"team_api_id\" ORDER BY \"m\".\"id\" NULLS FIRST) AS \"goal_difference\" FROM match AS \"m\" INNER JOIN team AS \"t\" ON \"m\".\"home_team_api_id\" = \"t\".\"team_api_id\" OR \"m\".\"away_team_api_id\" = \"t\".\"team_api_id\" WHERE \"m\".\"date\" = '2008-11-22' ORDER BY \"t\".\"team_api_id\" NULLS FIRST, \"m\".\"id\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.068,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 390,
    "db_id": "toxicology",
    "sql_snippet": "WITH atom_stats AS (\n    SELECT a.molecule_id, COU...",
    "valid": true,
    "error": null,
    "duration_ms": 28.388261795043945,
    "input_sql_tokens": 678,
    "estimated_tokens": 819,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH atom_stats AS (\n    SELECT a.molecule_id, COUNT(a.atom_id) AS atom_count,\n           STRING_AGG(a.element, ',' ORDER BY a.atom_id NULLS FIRST) AS elements\n    FROM atom AS a\n    GROUP BY a.molecule_id\n),\nbond_hierarchy AS (\n    SELECT bond_id, molecule_id, bond_type,\n           SUBSTRING(bond_id FROM '^[^_]+') AS molecule_prefix,\n           CAST(SUBSTRING(bond_id FROM '[^_]+' FOR 1) AS DOUBLE PRECISION) AS first_atom_num,\n           CAST(SUBSTRING(bond_id FROM '[^_]+$') AS DOUBLE PRECISION) AS second_atom_num\n    FROM bond\n),\nmolecule_connectivity AS (\n    SELECT m.molecule_id, m.label,\n           COUNT(DISTINCT c.atom_id) AS connected_atoms,\n           COUNT(DISTINCT c.bond_id) AS bond_count,\n           CASE WHEN m.label = '+' THEN 'Positive'\n                WHEN m.label = '-' THEN 'Negative'\n                ELSE 'Neutral'\n           END AS charge_type\n    FROM molecule AS m\n    LEFT JOIN atom AS a ON m.molecule_id = a.molecule_id\n    LEFT JOIN connected AS c ON a.atom_id = c.atom_id\n    GROUP BY m.molecule_id, m.label\n)\nSELECT m.molecule_id, m.label, a.atom_id, a.element, b.bond_id, b.bond_type,\n       ast.atom_count, ast.elements,\n       bh.first_atom_num + bh.second_atom_num AS atom_sum,\n       mc.connected_atoms, mc.charge_type,\n       RANK() OVER (PARTITION BY m.molecule_id ORDER BY a.atom_id NULLS FIRST) AS atom_rank,\n       DENSE_RANK() OVER (PARTITION BY m.molecule_id ORDER BY b.bond_type NULLS FIRST) AS bond_type_rank\nFROM molecule AS m\nINNER JOIN atom AS a ON m.molecule_id = a.molecule_id\nINNER JOIN connected AS c ON a.atom_id = c.atom_id\nINNER JOIN bond AS b ON c.bond_id = CAST(SUBSTRING(b.bond_id FROM '[^_]+' FOR 1) || SUBSTRING(b.bond_id FROM '[^_]+$') AS DOUBLE PRECISION)\nLEFT JOIN atom_stats AS ast ON m.molecule_id = ast.molecule_id\nLEFT JOIN bond_hierarchy AS bh ON b.bond_id = bh.bond_id\nLEFT JOIN molecule_connectivity AS mc ON m.molecule_id = mc.molecule_id\nWHERE a.element IN (SELECT DISTINCT element FROM atom WHERE molecule_id LIKE 'TR%')\nAND NOT b.bond_type IS NULL\nORDER BY m.molecule_id NULLS FIRST, atom_rank NULLS FIRST, bh.first_atom_num NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.406,
        "pattern_signature": "WITH-CTE-SELECT-DISTINCT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "DISTINCT",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 8,
        "num_subqueries": 1,
        "num_ctes": 3,
        "num_aggregations": 6
      }
    }
  },
  {
    "query_idx": 391,
    "db_id": "toxicology",
    "sql_snippet": "DO $$\nDECLARE\n    v_molecule_id VARCHAR(512);\n    ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.7353038787841797,
    "input_sql_tokens": 265,
    "estimated_tokens": 369,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DO $$\nDECLARE\n    v_molecule_id VARCHAR(512);\n    v_label TEXT;\n    v_atom_id VARCHAR(512);\n    v_element TEXT;\n    v_atom_id2 VARCHAR(512);\n    v_bond_id VARCHAR(512);\n    v_bond_type TEXT;\nBEGIN\n    SELECT \"m\".\"molecule_id\",\n           \"m\".\"label\",\n           \"a\".\"atom_id\",\n           \"a\".\"element\",\n           \"c\".\"atom_id2\",\n           \"b\".\"bond_id\",\n           \"b\".\"bond_type\"\n    FROM \"molecule\" \"m\"\n    INNER JOIN \"atom\" \"a\" ON \"m\".\"molecule_id\" = \"a\".\"molecule_id\"\n    INNER JOIN \"connected\" \"c\" ON \"a\".\"atom_id\" = \"c\".\"atom_id\"\n    INNER JOIN \"bond\" \"b\" ON \"c\".\"bond_id\" = \"b\".\"bond_id\"\n    ORDER BY \"m\".\"molecule_id\",\n             \"a\".\"atom_id\",\n             \"c\".\"atom_id2\";\nEND $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 392,
    "db_id": "toxicology",
    "sql_snippet": "WITH atom_elements AS (\n    SELECT a.atom_id, a.mo...",
    "valid": true,
    "error": null,
    "duration_ms": 21.902084350585938,
    "input_sql_tokens": 435,
    "estimated_tokens": 556,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH atom_elements AS (\n    SELECT a.atom_id, a.molecule_id, a.element,\n           RANK() OVER (PARTITION BY a.molecule_id ORDER BY a.atom_id NULLS FIRST) AS element_rank\n    FROM atom AS a\n),\nbond_details AS (\n    SELECT b.bond_id, b.molecule_id, b.bond_type,\n           DENSE_RANK() OVER (PARTITION BY b.molecule_id ORDER BY b.bond_id NULLS FIRST) AS bond_rank\n    FROM bond AS b\n),\nmolecule_connections AS (\n    SELECT c.atom_id, c.atom_id2, c.bond_id,\n           STRING_AGG(c.atom_id2, ',' ORDER BY c.atom_id2 NULLS FIRST) OVER (PARTITION BY c.atom_id) AS connected_atoms\n    FROM connected AS c\n)\nSELECT m.molecule_id, m.label, ae.atom_id, ae.element, bd.bond_id, bd.bond_type, mc.connected_atoms\nFROM molecule AS m\nLEFT JOIN atom_elements AS ae ON m.molecule_id = ae.molecule_id\nLEFT JOIN molecule_connections AS mc ON ae.atom_id = mc.atom_id\nLEFT JOIN bond_details AS bd ON mc.bond_id = CAST(bd.bond_id AS text)\nWHERE ae.element_rank <= 10 AND bd.bond_rank <= 5 AND (m.label IS NULL OR m.label IN ('+', '-'))\nGROUP BY m.molecule_id, m.label, ae.atom_id, ae.element, bd.bond_id, bd.bond_type, mc.connected_atoms\nHAVING COUNT(DISTINCT mc.atom_id2) > 0\nORDER BY m.molecule_id NULLS FIRST, ae.atom_id NULLS FIRST, bd.bond_id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.257,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-HAVING-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 3,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 393,
    "db_id": "toxicology",
    "sql_snippet": "SELECT m.\"molecule_id\",\n       COUNT(a.\"atom_id\") ...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 7, Col: 29.\n  a.\"atom_id\" = c.\"atom_id\"\nINNER JOIN \"bond\" b ON c.\"bond_id\" = b.\"bond_id\"\nGROUP BY m.\"molecule_id\" \u001b[4mINTO\u001b[0m :result_variable",
    "duration_ms": 9.256362915039062,
    "input_sql_tokens": 114,
    "estimated_tokens": 266,
    "error_tokens": 76,
    "invalid_sql_tokens": 114,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 7, Col: 29.\n  a.\"atom_id\" = c.\"atom_id\"\nINNER JOIN \"bond\" b ON c.\"bond_id\" = b.\"bond_id\"\nGROUP BY m.\"molecule_id\" \u001b[4mINTO\u001b[0m :result_variable",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT m.\"molecule_id\",\n       COUNT(a.\"atom_id\") / COUNT(DISTINCT b.\"bond_id\") AS result\nFROM \"molecule\" m\nINNER JOIN \"atom\" a ON m.\"molecule_id\" = a.\"molecule_id\"\nINNER JOIN \"connected\" c ON a.\"atom_id\" = c.\"atom_id\"\nINNER JOIN \"bond\" b ON c.\"bond_id\" = b.\"bond_id\"\nGROUP BY m.\"molecule_id\" INTO :result_variable",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 394,
    "db_id": "toxicology",
    "sql_snippet": "WITH atom_data AS (SELECT a.atom_id, a.molecule_id...",
    "valid": true,
    "error": null,
    "duration_ms": 22.042512893676758,
    "input_sql_tokens": 443,
    "estimated_tokens": 541,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH atom_data AS (SELECT a.atom_id, a.molecule_id, CASE WHEN a.element = 'cl' THEN UPPER(a.element) ELSE a.element END AS element FROM atom AS a), bond_data AS (SELECT b.bond_id, b.molecule_id, CASE WHEN b.bond_type = '-' THEN 'single' WHEN b.bond_type = '=' THEN 'double' WHEN b.bond_type = '#' THEN 'triple' ELSE b.bond_type END AS bond_type FROM bond AS b), molecule_elements AS (SELECT m.molecule_id, string_agg(a.element, ',' ORDER BY a.atom_id NULLS FIRST) AS elements FROM molecule AS m LEFT JOIN atom_data AS a ON m.molecule_id = a.molecule_id GROUP BY m.molecule_id) SELECT COALESCE(a.atom_id, b.bond_id) AS \"id\", COALESCE(a.molecule_id, b.molecule_id) AS \"molecule_id\", COALESCE(a.element, CASE WHEN b.bond_type = 'single' THEN '-' WHEN b.bond_type = 'double' THEN '=' WHEN b.bond_type = 'triple' THEN '#' ELSE b.bond_type END) AS \"val\", me.elements AS molecule_composition FROM atom_data AS a FULL OUTER JOIN bond_data AS b ON a.molecule_id = b.molecule_id LEFT JOIN molecule_elements AS me ON COALESCE(a.molecule_id, b.molecule_id) = me.molecule_id WHERE (NOT a.atom_id IS NULL OR NOT b.bond_id IS NULL) AND (me.elements LIKE '%cl%' OR me.elements IS NULL OR COALESCE(a.element, b.bond_type) ~ '^[a-z]+$') ORDER BY CASE WHEN NOT a.atom_id IS NULL THEN 1 ELSE 2 END NULLS FIRST, \"id\" NULLS FIRST, \"molecule_id\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.232,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 3,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 395,
    "db_id": "toxicology",
    "sql_snippet": "WITH RECURSIVE molecule_hierarchy AS ( SELECT m.mo...",
    "valid": true,
    "error": null,
    "duration_ms": 35.35008430480957,
    "input_sql_tokens": 702,
    "estimated_tokens": 812,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE molecule_hierarchy AS ( SELECT m.molecule_id, m.label, a.atom_id, a.element, CAST(NULL AS VARCHAR(512)) AS atom_id2, CAST(NULL AS VARCHAR(512)) AS bond_id, CAST(NULL AS TEXT) AS bond_type, 1 AS level, CAST(a.atom_id AS VARCHAR(4000)) AS path FROM molecule AS m JOIN atom AS a ON m.molecule_id = a.molecule_id UNION ALL   SELECT h.molecule_id, h.label, h.atom_id, h.element, c.atom_id2, c.bond_id, b.bond_type, h.level + 1, h.path || '->' || c.atom_id2 FROM molecule_hierarchy AS h JOIN connected AS c ON h.atom_id = c.atom_id LEFT JOIN bond AS b ON c.bond_id = b.bond_id WHERE h.level < 3   AND POSITION(c.atom_id2 IN h.path) = 0  ), pivoted_elements AS (SELECT molecule_id, MAX(CASE WHEN rn = 1 THEN element END) AS element1, MAX(CASE WHEN rn = 2 THEN element END) AS element2, MAX(CASE WHEN rn = 3 THEN element END) AS element3 FROM (SELECT molecule_id, element, ROW_NUMBER() OVER (PARTITION BY molecule_id ORDER BY atom_id NULLS FIRST) AS rn FROM atom) GROUP BY molecule_id) SELECT m.molecule_id, m.label, a.atom_id, json_build_object('element', a.element, 'connected_atoms', (SELECT json_agg(json_build_object('atom_id', c.atom_id2, 'bond_type', b.bond_type) ORDER BY c.atom_id2 NULLS FIRST) FROM connected AS c LEFT JOIN bond AS b ON c.bond_id = b.bond_id WHERE c.atom_id = a.atom_id)) AS atom_details, c.atom_id2, b.bond_id, b.bond_type, pe.element1, pe.element2, pe.element3, string_agg(a.element, ',') WITHIN GROUP (ORDER BY a.atom_id NULLS FIRST) OVER (PARTITION BY m.molecule_id) AS elements_list FROM molecule AS m JOIN atom AS a ON m.molecule_id = a.molecule_id LEFT JOIN connected AS c ON a.atom_id = c.atom_id LEFT JOIN bond AS b ON c.bond_id = b.bond_id AND m.molecule_id = SUBSTRING(b.bond_id, 1, POSITION('_' IN b.bond_id) - 1) LEFT JOIN pivoted_elements AS pe ON m.molecule_id = pe.molecule_id WHERE EXISTS(SELECT 1 FROM molecule_hierarchy AS mh WHERE mh.molecule_id = m.molecule_id AND mh.level > 1) ORDER BY m.molecule_id NULLS FIRST, a.atom_id NULLS FIRST, c.atom_id2 NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.5,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-UNION-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 8,
        "num_subqueries": 2,
        "num_ctes": 2,
        "num_aggregations": 5
      }
    }
  },
  {
    "query_idx": 396,
    "db_id": "toxicology",
    "sql_snippet": "WITH molecule_stats AS (\n    SELECT m.\"molecule_id...",
    "valid": true,
    "error": null,
    "duration_ms": 21.494388580322266,
    "input_sql_tokens": 491,
    "estimated_tokens": 611,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH molecule_stats AS (\n    SELECT m.\"molecule_id\", m.\"label\", COUNT(DISTINCT a.\"atom_id\") AS atom_count, COUNT(DISTINCT b.\"bond_id\") AS bond_count\n    FROM molecule AS m\n    LEFT JOIN atom AS a ON m.\"molecule_id\" = a.\"molecule_id\"\n    LEFT JOIN connected AS c ON a.\"atom_id\" = c.\"atom_id\"\n    LEFT JOIN bond AS b ON c.\"bond_id\" = b.\"bond_id\" AND b.\"molecule_id\" = m.\"molecule_id\"\n    GROUP BY m.\"molecule_id\", m.\"label\"\n),\natom_details AS (\n    SELECT a.\"molecule_id\", a.\"atom_id\", a.\"element\",\n           STRING_AGG(c.\"atom_id2\", ',' ORDER BY c.\"atom_id2\" NULLS FIRST) AS connected_atoms,\n           COUNT(DISTINCT c.\"bond_id\") AS bonds_per_atom\n    FROM atom AS a\n    LEFT JOIN connected AS c ON a.\"atom_id\" = c.\"atom_id\"\n    GROUP BY a.\"molecule_id\", a.\"atom_id\", a.\"element\"\n)\nSELECT ms.\"molecule_id\", ms.\"label\", ad.\"atom_id\", ad.\"element\", c.\"bond_id\", b.\"bond_type\",\n       ms.atom_count, ms.bond_count, ad.connected_atoms, ad.bonds_per_atom\nFROM molecule_stats AS ms\nJOIN atom_details AS ad ON ms.\"molecule_id\" = ad.\"molecule_id\"\nLEFT JOIN connected AS c ON ad.\"atom_id\" = c.\"atom_id\"\nLEFT JOIN bond AS b ON c.\"bond_id\" = b.\"bond_id\"\nWHERE ms.atom_count > 0 AND (ad.bonds_per_atom > 0 OR NOT c.\"bond_id\" IS NULL)\nORDER BY CASE WHEN ms.\"label\" = '+' THEN 0 ELSE 1 END NULLS FIRST,\n         ms.\"molecule_id\" NULLS FIRST,\n         ad.\"atom_id\" NULLS FIRST,\n         c.\"bond_id\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.3400000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 7,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 397,
    "db_id": "toxicology",
    "sql_snippet": "WITH molecule_pairs AS (\n    SELECT\n        CASE W...",
    "valid": true,
    "error": null,
    "duration_ms": 29.169797897338867,
    "input_sql_tokens": 702,
    "estimated_tokens": 836,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH molecule_pairs AS (\n    SELECT\n        CASE WHEN POSITION(',' IN pair_str) > 0\n             THEN TRIM(SUBSTRING(pair_str FROM 1 FOR POSITION(',' IN pair_str) - 1))\n             ELSE pair_str END AS mol_id1,\n        CASE WHEN POSITION(',' IN pair_str) > 0\n             THEN TRIM(SUBSTRING(pair_str FROM POSITION(',' IN pair_str) + 1))\n             ELSE NULL END AS mol_id2\n    FROM (\n        SELECT 'TR427, TR430' AS pair_str\n        UNION ALL\n        SELECT 'TR427, TR431'\n        UNION ALL\n        SELECT 'TR430, TR431'\n    ) AS pairs\n),\nmolecule_stats AS (\n    SELECT\n        m.\"molecule_id\",\n        m.\"label\",\n        COUNT(a.\"atom_id\") OVER (PARTITION BY m.\"molecule_id\") AS atom_count,\n        COUNT(DISTINCT b.\"bond_id\") OVER (PARTITION BY m.\"molecule_id\") AS bond_count,\n        STRING_AGG(a.\"element\", ',' ORDER BY a.\"element\" NULLS FIRST) OVER (PARTITION BY m.\"molecule_id\") AS elements\n    FROM molecule AS m\n    LEFT JOIN atom AS a ON m.\"molecule_id\" = a.\"molecule_id\"\n    LEFT JOIN bond AS b ON m.\"molecule_id\" = b.\"molecule_id\"\n)\nSELECT\n    m1.\"molecule_id\" AS molecule_id1,\n    m1.\"label\" AS label1,\n    m1.atom_count,\n    m1.elements,\n    m2.\"molecule_id\" AS molecule_id2,\n    m2.\"label\" AS label2,\n    m2.atom_count,\n    m2.elements,\n    CASE\n        WHEN m1.bond_count > 0 AND m2.bond_count > 0 THEN 'Both have bonds'\n        WHEN m1.bond_count > 0 THEN 'Only ' || m1.\"molecule_id\" || ' has bonds'\n        WHEN m2.bond_count > 0 THEN 'Only ' || m2.\"molecule_id\" || ' has bonds'\n        ELSE 'Neither has bonds'\n    END AS bond_status\nFROM molecule_stats AS m1\nJOIN molecule_pairs AS mp ON m1.\"molecule_id\" = mp.mol_id1\nJOIN molecule_stats AS m2 ON m2.\"molecule_id\" = mp.mol_id2\nWHERE EXISTS(\n    SELECT 1\n    FROM connected AS c1\n    JOIN connected AS c2 ON c1.\"bond_id\" = c2.\"bond_id\"\n    WHERE c1.\"atom_id\" LIKE m1.\"molecule_id\" || '%'\n    AND c2.\"atom_id\" LIKE m2.\"molecule_id\" || '%'\n)\nAND m1.\"molecule_id\" = m2.\"molecule_id\"\nORDER BY m1.\"molecule_id\" NULLS FIRST, m2.\"molecule_id\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.367,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-WINDOW-UNION-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 5,
        "num_subqueries": 1,
        "num_ctes": 2,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 398,
    "db_id": "toxicology",
    "sql_snippet": "SELECT \"m\".\"molecule_id\", \"m\".\"label\", \"a\".\"elemen...",
    "valid": true,
    "error": null,
    "duration_ms": 4.022121429443359,
    "input_sql_tokens": 72,
    "estimated_tokens": 191,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT \"m\".\"molecule_id\", \"m\".\"label\", \"a\".\"element\" FROM molecule AS \"m\" INNER JOIN atom AS \"a\" ON \"m\".\"molecule_id\" = \"a\".\"molecule_id\" ORDER BY \"m\".\"molecule_id\" NULLS FIRST, \"a\".\"atom_id2\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.045000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-ORDER",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 399,
    "db_id": "toxicology",
    "sql_snippet": "WITH molecule_stats AS (\n    SELECT m.\"molecule_id...",
    "valid": true,
    "error": null,
    "duration_ms": 29.810190200805664,
    "input_sql_tokens": 752,
    "estimated_tokens": 867,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH molecule_stats AS (\n    SELECT m.\"molecule_id\",\n           COUNT(DISTINCT a.\"atom_id\") AS atom_count,\n           COUNT(DISTINCT b.\"bond_id\") AS bond_count,\n           string_agg(DISTINCT CASE WHEN a.\"element\" IS NULL THEN NULL WHEN ',' IS NULL THEN NULL ELSE a.\"element\" END, ',') AS elements\n    FROM molecule AS m\n    LEFT OUTER JOIN atom AS a ON m.\"molecule_id\" = a.\"molecule_id\"\n    LEFT OUTER JOIN connected AS c ON a.\"atom_id\" = c.\"atom_id\"\n    LEFT OUTER JOIN bond AS b ON c.\"bond_id\" = b.\"bond_id\"\n    GROUP BY m.\"molecule_id\"\n),\nmolecule_pivot AS (\n    SELECT *\n    FROM (\n        SELECT m.\"molecule_id\",\n               a.\"element\",\n               COUNT(*) AS element_count\n        FROM molecule AS m\n        JOIN atom AS a ON m.\"molecule_id\" = a.\"molecule_id\"\n        GROUP BY m.\"molecule_id\", a.\"element\"\n    ) t\n)\nSELECT m.\"molecule_id\",\n       m.\"label\",\n       a.\"atom_id\",\n       a.\"element\",\n       b.\"bond_id\",\n       b.\"bond_type\",\n       ms.atom_count,\n       ms.bond_count,\n       ms.elements,\n       mp.chlorine,\n       mp.carbon,\n       mp.hydrogen,\n       mp.oxygen,\n       mp.nitrogen,\n       RANK() OVER (PARTITION BY m.\"molecule_id\" ORDER BY a.\"atom_id\" NULLS FIRST) AS atom_rank,\n       DENSE_RANK() OVER (PARTITION BY m.\"molecule_id\" ORDER BY b.\"bond_type\" NULLS FIRST) AS bond_type_rank,\n       CASE\n           WHEN a.\"element\" = 'cl' THEN 'Chlorine'\n           WHEN a.\"element\" = 'c' THEN 'Carbon'\n           WHEN a.\"element\" = 'h' THEN 'Hydrogen'\n           WHEN a.\"element\" = 'o' THEN 'Oxygen'\n           WHEN a.\"element\" = 'n' THEN 'Nitrogen'\n           ELSE a.\"element\"\n       END AS element_name\nFROM molecule AS m\nLEFT OUTER JOIN atom AS a ON m.\"molecule_id\" = a.\"molecule_id\"\nLEFT OUTER JOIN connected AS c ON a.\"atom_id\" = c.\"atom_id\"\nLEFT OUTER JOIN bond AS b ON c.\"bond_id\" = b.\"bond_id\"\nLEFT OUTER JOIN molecule_stats AS ms ON m.\"molecule_id\" = ms.\"molecule_id\"\nLEFT OUTER JOIN molecule_pivot AS mp ON m.\"molecule_id\" = mp.\"molecule_id\"\nGROUP BY m.\"molecule_id\",\n         m.\"label\",\n         a.\"atom_id\",\n         a.\"element\",\n         b.\"bond_id\",\n         b.\"bond_type\",\n         ms.atom_count,\n         ms.bond_count,\n         ms.elements,\n         mp.chlorine,\n         mp.carbon,\n         mp.hydrogen,\n         mp.oxygen,\n         mp.nitrogen\nORDER BY m.\"molecule_id\" NULLS FIRST, a.\"atom_id\" NULLS FIRST, b.\"bond_id\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.441,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-GROUP-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 9,
        "num_subqueries": 1,
        "num_ctes": 2,
        "num_aggregations": 6
      }
    }
  },
  {
    "query_idx": 400,
    "db_id": "toxicology",
    "sql_snippet": "WITH molecule_stats AS (\n    SELECT m.\"molecule_id...",
    "valid": true,
    "error": null,
    "duration_ms": 12.735366821289062,
    "input_sql_tokens": 281,
    "estimated_tokens": 409,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH molecule_stats AS (\n    SELECT m.\"molecule_id\", COUNT(a.\"atom_id\") AS atom_count,\n           STRING_AGG(a.\"element\", ',' ORDER BY a.\"atom_id\" NULLS FIRST) AS elements\n    FROM molecule AS m\n    LEFT JOIN atom AS a ON m.\"molecule_id\" = a.\"molecule_id\"\n    GROUP BY m.\"molecule_id\"\n),\nbond_stats AS (\n    SELECT b.\"molecule_id\", COUNT(b.\"bond_id\") AS bond_count\n    FROM bond AS b\n    GROUP BY b.\"molecule_id\"\n)\nSELECT ms.\"molecule_id\", ms.atom_count AS \"total_atoms\", bs.bond_count,\n       CASE WHEN ms.atom_count > 0 THEN ROUND(CAST(bs.bond_count AS DOUBLE PRECISION) / ms.atom_count, 2)\n            ELSE 0 END AS bonds_per_atom,\n       ms.elements\nFROM molecule_stats AS ms\nLEFT JOIN bond_stats AS bs ON ms.\"molecule_id\" = bs.\"molecule_id\"\nWHERE ms.elements LIKE '%cl%'\nHAVING COUNT(ms.atom_count) > 0\nORDER BY ms.\"molecule_id\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.18200000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-HAVING-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 401,
    "db_id": "student_club",
    "sql_snippet": "SELECT e.\"event_id\", e.\"event_name\", e.\"event_date...",
    "valid": true,
    "error": null,
    "duration_ms": 4.603147506713867,
    "input_sql_tokens": 82,
    "estimated_tokens": 185,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT e.\"event_id\", e.\"event_name\", e.\"event_date\", e.\"type\",\n(SELECT MAX(CAST(column_value AS timestamp)) AS latest_event_date FROM (VALUES (e.\"event_date\")) AS value_table(column_value)\nWHERE column_value IS NOT NULL) AS latest_event_date FROM \"event\" e",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09900000000000003,
        "pattern_signature": "SELECT-FROM-WHERE-VALUES-SUBQUERY",
        "clauses_present": [
          "FROM",
          "SELECT",
          "SUBQUERY",
          "VALUES",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 402,
    "db_id": "student_club",
    "sql_snippet": "SELECT\n    TO_CHAR(type) AS event_type,\n    COUNT(...",
    "valid": false,
    "error": "Required keyword: 'format' missing for <class 'sqlglot.expressions.TimeToStr'>. Line 2, Col: 17.\n  SELECT\n    TO_CHAR(type\u001b[4m)\u001b[0m AS event_type,\n    COUNT(CASE WHEN EXTRACT(YEAR FROM event_date::timestamp) = recent_year THEN 1 EN",
    "duration_ms": 5.303621292114258,
    "input_sql_tokens": 146,
    "estimated_tokens": 307,
    "error_tokens": 80,
    "invalid_sql_tokens": 146,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "Required keyword: 'format' missing for <class 'sqlglot.expressions.TimeToStr'>. Line 2, Col: 17.\n  SELECT\n    TO_CHAR(type\u001b[4m)\u001b[0m AS event_type,\n    COUNT(CASE WHEN EXTRACT(YEAR FROM event_date::timestamp) = recent_year THEN 1 EN",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT\n    TO_CHAR(type) AS event_type,\n    COUNT(CASE WHEN EXTRACT(YEAR FROM event_date::timestamp) = recent_year THEN 1 END) -\n    COUNT(CASE WHEN EXTRACT(YEAR FROM event_date::timestamp) = oldest_year THEN 1 END) AS year_difference\nFROM event,\n    (\n        SELECT\n            MAX(EXTRACT(YEAR FROM event_date::timestamp)) AS recent_year,\n            MIN(EXTRACT(YEAR FROM event_date::timestamp)) AS oldest_year\n        FROM event\n    ) year_range\nGROUP BY TO_CHAR(type), recent_year, oldest_year;",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 403,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT COUNT(*)\nFROM match m1\nWHERE EXISTS (\n    S...",
    "valid": true,
    "error": null,
    "duration_ms": 4.001379013061523,
    "input_sql_tokens": 97,
    "estimated_tokens": 195,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT COUNT(*)\nFROM match m1\nWHERE EXISTS (\n    SELECT 1\n    FROM match m2\n    WHERE m2.home_team_api_id = m1.away_team_api_id\n    AND m2.away_team_api_id = m1.home_team_api_id\n)\nAND m1.home_team_api_id < m1.away_team_api_id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.05000000000000001,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 404,
    "db_id": "european_football_2",
    "sql_snippet": "DO $$\nDECLARE v_match_id BIGINT;\nv_match_date TEXT...",
    "valid": true,
    "error": null,
    "duration_ms": 2.788543701171875,
    "input_sql_tokens": 243,
    "estimated_tokens": 340,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DO $$\nDECLARE v_match_id BIGINT;\nv_match_date TEXT;\nv_home_team_goals BIGINT;\nv_away_team_goals BIGINT;\nv_home_team_name TEXT;\nv_away_team_name TEXT;\nv_league_name TEXT;\n\nBEGIN\nSELECT \"match\".\"id\",\n       \"match\".\"date\",\n       \"match\".\"home_team_goal\",\n       \"match\".\"away_team_goal\",\n       \"HomeTeam\".\"team_long_name\",\n       \"AwayTeam\".\"team_long_name\",\n       \"league\".\"name\"\nFROM \"match\"\nINNER JOIN \"team\" \"HomeTeam\" ON \"match\".\"home_team_api_id\" = \"HomeTeam\".\"team_api_id\"\nINNER JOIN \"team\" \"AwayTeam\" ON \"match\".\"away_team_api_id\" = \"AwayTeam\".\"team_api_id\"\nINNER JOIN \"league\" ON \"match\".\"league_id\" = \"league\".\"id\"\nORDER BY \"match\".\"date\";\n\nEND $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 405,
    "db_id": "european_football_2",
    "sql_snippet": "WITH match_years AS (\n    SELECT\n        M.league_...",
    "valid": true,
    "error": null,
    "duration_ms": 16.03531837463379,
    "input_sql_tokens": 410,
    "estimated_tokens": 533,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH match_years AS (\n    SELECT\n        M.league_id,\n        EXTRACT(YEAR FROM TO_DATE(M.date, 'YYYY-MM-DD HH24:MI:SS')) AS match_year,\n        COUNT(*) AS year_count\n    FROM match M\n    WHERE M.date IS NOT NULL\n    GROUP BY M.league_id, EXTRACT(YEAR FROM TO_DATE(M.date, 'YYYY-MM-DD HH24:MI:SS'))\n),\nleague_stats AS (\n    SELECT\n        L.id AS league_id,\n        L.name AS league_name,\n        C.name AS country_name,\n        COUNT(DISTINCT M.id) AS total_matches\n    FROM league L\n    JOIN country C ON L.country_id = C.id\n    LEFT JOIN match M ON L.country_id = M.country_id\n    GROUP BY L.id, L.name, C.name\n)\nSELECT\n    ls.league_name,\n    my.match_year AS \"year\",\n    my.year_count AS \"match_count\",\n    ROUND(my.year_count / NULLIF(ls.total_matches, 0) * 100, 2) AS percentage_of_total\nFROM match_years my\nJOIN league_stats ls ON my.league_id = CAST(SUBSTRING(ls.league_name FROM '[0-9]+') AS BIGINT)\nWHERE my.match_year BETWEEN 2008 AND 2016\nGROUP BY\n    ls.league_name,\n    my.match_year,\n    my.year_count,\n    ls.total_matches\nHAVING COUNT(*) > 0\nORDER BY\n    my.match_year,\n    ls.league_name",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.208,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-HAVING-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 3,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 406,
    "db_id": "toxicology",
    "sql_snippet": "WITH temp AS\n  (SELECT a.\"atom_id\",\n          a.\"m...",
    "valid": true,
    "error": null,
    "duration_ms": 7.004022598266602,
    "input_sql_tokens": 181,
    "estimated_tokens": 296,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH temp AS\n  (SELECT a.\"atom_id\",\n          a.\"molecule_id\",\n          ROW_NUMBER() OVER (PARTITION BY a.\"molecule_id\"\n                             ORDER BY a.\"atom_id\") - TO_DATE(REGEXP_SUBSTR(a.\"atom_id\", '\\d+$'), 'DD') AS grp\n   FROM \"atom\" a), temp2 AS\n  (SELECT t.\"atom_id\",\n          t.\"molecule_id\",\n          COUNT(*) OVER (PARTITION BY t.\"molecule_id\", t.grp) AS cnt\n   FROM temp t)\nSELECT t2.\"atom_id\",\n       t2.\"molecule_id\"\nFROM temp2 t2\nWHERE t2.cnt >= 3\nORDER BY t2.\"molecule_id\",\n         t2.\"atom_id\"",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08700000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 407,
    "db_id": "toxicology",
    "sql_snippet": "WITH\n\n    set_a (molecule_id, element_count) AS (\n...",
    "valid": true,
    "error": null,
    "duration_ms": 31.436681747436523,
    "input_sql_tokens": 842,
    "estimated_tokens": 1031,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH\n\n    set_a (molecule_id, element_count) AS (\n        SELECT molecule_id, COUNT(DISTINCT element)\n        FROM atom\n        GROUP BY molecule_id\n        HAVING COUNT(DISTINCT element) > 1\n    ),\n    set_b (molecule_id, element_count) AS (\n        SELECT m.molecule_id, COUNT(DISTINCT a.element)\n        FROM molecule m\n        JOIN atom a ON m.molecule_id = a.molecule_id\n        WHERE m.label IS NOT NULL\n        GROUP BY m.molecule_id\n    ),\n\n    unique_a (molecule_id, element_count, rn, density_rank) AS (\n        SELECT\n            molecule_id,\n            element_count,\n            ROW_NUMBER() OVER (PARTITION BY molecule_id ORDER BY element_count) AS rn,\n            DENSE_RANK() OVER (ORDER BY element_count DESC) AS density_rank\n        FROM set_a\n    ),\n    unique_b (molecule_id, element_count, rn, density_rank) AS (\n        SELECT\n            molecule_id,\n            element_count,\n            ROW_NUMBER() OVER (PARTITION BY molecule_id ORDER BY element_count) AS rn,\n            DENSE_RANK() OVER (ORDER BY element_count DESC) AS density_rank\n        FROM set_b\n    ),\n\n    molecule_hierarchy AS (\n        SELECT\n            molecule_id,\n            molecule_id AS root_molecule,\n            1 AS hierarchy_level\n        FROM molecule\n        WHERE label = '+'\n\n        UNION ALL\n\n        SELECT\n            m.molecule_id,\n            h.root_molecule,\n            h.hierarchy_level + 1\n        FROM molecule m\n        JOIN molecule_hierarchy h ON m.molecule_id = h.molecule_id\n    )\nSELECT\n    COUNT(CASE WHEN a.rn = b.rn AND a.density_rank = b.density_rank THEN 1 END) AS num_identical_in_a_and_b,\n    COUNT(CASE WHEN a.molecule_id IS NULL THEN 1 END) AS num_not_identical_in_a,\n    COUNT(CASE WHEN b.molecule_id IS NULL THEN 1 END) AS num_not_identical_in_b,\n    STRING_AGG(a.molecule_id, ',') WITHIN GROUP (ORDER BY a.density_rank) AS matching_molecules,\n    JSON_AGG(\n        JSON_BUILD_OBJECT(\n            'molecule', a.molecule_id,\n            'rank', a.density_rank\n        )\n        ORDER BY b.density_rank\n    ) AS molecule_json\nFROM unique_a a\nFULL OUTER JOIN unique_b b ON a.molecule_id = b.molecule_id AND a.rn = b.rn\nLEFT JOIN molecule_hierarchy h ON a.molecule_id = h.molecule_id\nWHERE\n\n    (SELECT bond_id\n     FROM bond\n     WHERE bond.molecule_id = a.molecule_id) = 'TR011_2_24'\n\n    AND EXISTS (\n        SELECT 1\n        FROM connected c\n        JOIN atom a1 ON c.atom_id = a1.atom_id\n        JOIN atom a2 ON c.atom_id2 = a2.atom_id\n        WHERE a1.molecule_id = a.molecule_id\n        AND a1.element = a2.element\n    )\nGROUP BY\n    GROUPING SETS (\n        (a.density_rank, b.density_rank),\n        ()\n    )\nHAVING\n    COUNT(DISTINCT a.molecule_id) > (\n        SELECT AVG(element_count)\n        FROM set_a\n    )",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.49700000000000005,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-HAVING-WINDOW-UNION-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 6,
        "num_subqueries": 2,
        "num_ctes": 5,
        "num_aggregations": 12
      }
    }
  },
  {
    "query_idx": 408,
    "db_id": "toxicology",
    "sql_snippet": "SELECT \"molecule_id\",\n\n  (SELECT \"element\"\n   FROM...",
    "valid": true,
    "error": null,
    "duration_ms": 2.9976367950439453,
    "input_sql_tokens": 53,
    "estimated_tokens": 160,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT \"molecule_id\",\n\n  (SELECT \"element\"\n   FROM \"atom\"\n   WHERE \"molecule_id\" = \"atom\".\"molecule_id\") AS \"elements\"\nFROM \"atom\"\nGROUP BY \"molecule_id\"",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09300000000000003,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 409,
    "db_id": "toxicology",
    "sql_snippet": "SELECT DISTINCT \"molecule_id\",\n                STR...",
    "valid": true,
    "error": null,
    "duration_ms": 3.000974655151367,
    "input_sql_tokens": 79,
    "estimated_tokens": 176,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DISTINCT \"molecule_id\",\n                STRING_AGG(DISTINCT \"atom_id\", ',') OVER (PARTITION BY \"molecule_id\" ORDER BY \"atom_id\") AS \"atom_ids\"\nFROM \"atom\"\nWHERE \"molecule_id\" = 'TR011'\nGROUP BY \"molecule_id\",\n         \"atom_id\"",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.023,
        "pattern_signature": "SELECT-DISTINCT-FROM-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "DISTINCT",
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 410,
    "db_id": "european_football_2",
    "sql_snippet": "WITH match_dates AS\n  (SELECT \"id\",\n          TO_D...",
    "valid": true,
    "error": null,
    "duration_ms": 10.609865188598633,
    "input_sql_tokens": 295,
    "estimated_tokens": 411,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH match_dates AS\n  (SELECT \"id\",\n          TO_DATE(\"date\", 'YYYY-MM-DD HH24:MI:SS') AS match_date,\n          TO_CHAR(TO_DATE(\"date\", 'YYYY-MM-DD HH24:MI:SS'), 'fmDay', 'English') AS day_of_week,\n          TO_DATE(\"date\", 'YYYY-MM-DD HH24:MI:SS') AS match_start_time,\n          TO_DATE(\"date\", 'YYYY-MM-DD HH24:MI:SS') + INTERVAL '2 HOUR' AS match_end_time\n   FROM \"match\")\nSELECT m.*,\n       ROUND(GREATEST(LEAST(m.match_end_time, m.match_date + INTERVAL '17:00:00' HOUR TO SECOND) - GREATEST(m.match_start_time, m.match_date + INTERVAL '07:30:00' HOUR TO SECOND), 0) * 24 * 60) AS match_duration_minutes\nFROM match_dates m\nWHERE m.match_date - DATE_TRUNC('week', m.match_date) < 5\n  AND m.\"id\" IN\n    (SELECT \"id\"\n     FROM \"DBA_VIEWS\")",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.12300000000000003,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 411,
    "db_id": "superhero",
    "sql_snippet": "WITH tiers AS (SELECT 1 as tier_start, 4 as tier_e...",
    "valid": true,
    "error": null,
    "duration_ms": 7.149934768676758,
    "input_sql_tokens": 115,
    "estimated_tokens": 217,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH tiers AS (SELECT 1 as tier_start, 4 as tier_end, 20 as rate UNION SELECT 5, 8, 50 UNION SELECT 10, 12, 100), input_qty AS (SELECT height_cm as quantity FROM superhero WHERE id = 1) SELECT SUM(CASE WHEN quantity >= tier_start THEN (LEAST(quantity, tier_end) - tier_start + 1) * rate ELSE 0 END) as total FROM tiers CROSS JOIN input_qty",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.112,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_CROSS-WHERE-UNION",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 412,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT \"home_team_api_id\" AS \"team_api_id\",\n      ...",
    "valid": false,
    "error": "Expecting ). Line 6, Col: 38.\n  \"match_count\"\nFROM \"match\" MATCH_RECOGNIZE (PARTITION BY \"country_id\"\n                              \u001b[4mORDER BY\u001b[0m \"date\" MEASURES FIRST(\"date\") AS \"start_date\", LAST(\"date\") AS \"end_date\", COUNT(*) AS \"match_count",
    "duration_ms": 4.00996208190918,
    "input_sql_tokens": 121,
    "estimated_tokens": 284,
    "error_tokens": 81,
    "invalid_sql_tokens": 121,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unbalanced_tokens",
          "message": "Expecting ). Line 6, Col: 38.\n  \"match_count\"\nFROM \"match\" MATCH_RECOGNIZE (PARTITION BY \"country_id\"\n                              \u001b[4mORDER BY\u001b[0m \"date\" MEASURES FIRST(\"date\") AS \"start_date\", LAST(\"date\") AS \"end_date\", COUNT(*) AS \"match_count",
          "location": null,
          "context": "Parser reported expecting parenthesis",
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT \"home_team_api_id\" AS \"team_api_id\",\n       \"start_date\",\n       \"end_date\",\n       \"match_count\"\nFROM \"match\" MATCH_RECOGNIZE (PARTITION BY \"country_id\"\n                              ORDER BY \"date\" MEASURES FIRST(\"date\") AS \"start_date\", LAST(\"date\") AS \"end_date\", COUNT(*) AS \"match_count\" PATTERN (consecutive_wins+) DEFINE consecutive_wins AS \"league_id\" = 'EUROPEAN_FOOTBALL_2')",
      "tags": [
        "syntax_unbalanced_tokens"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 413,
    "db_id": "toxicology",
    "sql_snippet": "WITH atom_stats AS (\n    SELECT\n        molecule_i...",
    "valid": true,
    "error": null,
    "duration_ms": 30.19881248474121,
    "input_sql_tokens": 501,
    "estimated_tokens": 626,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH atom_stats AS (\n    SELECT\n        molecule_id,\n        COUNT(*) AS atom_count,\n        (array_agg(element ORDER BY atom_id))[1] AS first_element,\n        (array_agg(element ORDER BY atom_id DESC))[1] AS last_element\n    FROM \"atom\"\n    GROUP BY molecule_id\n),\nranked_atoms AS (\n    SELECT\n        a.\"atom_id\",\n        a.\"molecule_id\",\n        a.\"element\",\n        DENSE_RANK() OVER (PARTITION BY a.\"molecule_id\" ORDER BY a.\"atom_id\") AS atom_rank,\n        stats.atom_count,\n        stats.first_element,\n        stats.last_element\n    FROM \"atom\" a\n    JOIN atom_stats stats ON a.\"molecule_id\" = stats.molecule_id\n),\nfiltered_atoms AS (\n    SELECT\n        ra.*,\n        CASE\n            WHEN ra.atom_rank <= 2 THEN 'TOP'\n            WHEN ra.atom_rank > ra.atom_count - 2 THEN 'BOTTOM'\n            ELSE 'MIDDLE'\n        END AS position,\n        LAG(ra.\"element\") OVER (PARTITION BY ra.\"molecule_id\" ORDER BY ra.\"atom_id\") AS prev_element,\n        LEAD(ra.\"element\") OVER (PARTITION BY ra.\"molecule_id\" ORDER BY ra.\"atom_id\") AS next_element\n    FROM ranked_atoms ra\n)\nSELECT\n    fa.\"atom_id\",\n    fa.\"molecule_id\",\n    fa.\"element\",\n    fa.atom_rank AS rnk,\n    fa.position,\n    fa.prev_element,\n    fa.next_element,\n    fa.first_element,\n    fa.last_element\nFROM filtered_atoms fa\nWHERE fa.atom_rank <= 2\nGROUP BY\n    fa.\"atom_id\",\n    fa.\"molecule_id\",\n    fa.\"element\",\n    fa.atom_rank,\n    fa.position,\n    fa.prev_element,\n    fa.next_element,\n    fa.first_element,\n    fa.last_element\nORDER BY fa.\"molecule_id\", fa.atom_rank",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.152,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 6
      }
    }
  },
  {
    "query_idx": 414,
    "db_id": "european_football_2",
    "sql_snippet": "WITH RECURSIVE split_date AS (\n  SELECT id,\n      ...",
    "valid": true,
    "error": null,
    "duration_ms": 9.580135345458984,
    "input_sql_tokens": 148,
    "estimated_tokens": 264,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE split_date AS (\n  SELECT id,\n         date,\n         1 AS level,\n         SPLIT_PART(date, ' ', 1) AS date_part\n  FROM team_attributes\n\n  UNION ALL\n\n  SELECT s.id,\n         s.date,\n         s.level + 1,\n         SPLIT_PART(s.date, ' ', s.level + 1) AS date_part\n  FROM split_date s\n  WHERE s.level < regexp_count(s.date, ' ') + 1\n    AND s.date_part != ''\n)\nSELECT id, date_part\nFROM split_date",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08100000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-UNION",
        "clauses_present": [
          "CTE",
          "FROM",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 415,
    "db_id": "california_schools",
    "sql_snippet": "SELECT REGEXP_REPLACE(cdscode, '\\.[^.]*$', '') AS ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0188560485839844,
    "input_sql_tokens": 48,
    "estimated_tokens": 128,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT REGEXP_REPLACE(cdscode, '\\.[^.]*$', '') AS output\nFROM schools\nWHERE cdscode = '1110.400000.8001382'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 416,
    "db_id": "toxicology",
    "sql_snippet": "WITH RECURSIVE molecule_hierarchy AS (\n\n    SELECT...",
    "valid": true,
    "error": null,
    "duration_ms": 32.094478607177734,
    "input_sql_tokens": 662,
    "estimated_tokens": 839,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE molecule_hierarchy AS (\n\n    SELECT\n        m.\"molecule_id\",\n        m.\"label\",\n        m.\"molecule_id\" AS root_molecule_id,\n        1 AS hierarchy_level,\n        '/' || m.\"molecule_id\" AS molecule_path\n    FROM \"molecule\" m\n    JOIN \"atom\" a ON m.\"molecule_id\" = a.\"molecule_id\"\n    JOIN \"connected\" c ON a.\"atom_id\" = c.\"atom_id\"\n    JOIN \"bond\" b ON c.\"bond_id\" = b.\"bond_id\"\n    WHERE b.\"bond_type\" = '-'\n\n    UNION ALL\n\n    SELECT\n        m.\"molecule_id\",\n        m.\"label\",\n        h.root_molecule_id,\n        h.hierarchy_level + 1,\n        h.molecule_path || '/' || m.\"molecule_id\"\n    FROM molecule_hierarchy h\n    JOIN \"connected\" c ON h.\"molecule_id\" != c.\"atom_id\"::text\n    JOIN \"atom\" a ON c.\"atom_id2\" = a.\"atom_id\"\n    JOIN \"molecule\" m ON a.\"molecule_id\" = m.\"molecule_id\"\n    JOIN \"bond\" b ON c.\"bond_id\" = b.\"bond_id\"\n    WHERE h.\"molecule_id\" != m.\"molecule_id\"\n),\nmonth_generator AS (\n\n    SELECT\n        TO_DATE('01/01/2018', 'MM/DD/YYYY') AS month_start_date,\n        1 AS month_num\n\n    UNION ALL\n\n    SELECT\n        month_start_date + INTERVAL '1 month',\n        month_num + 1\n    FROM month_generator\n    WHERE month_num < 12\n),\nmolecule_months AS (\n\n    SELECT\n        mg.month_start_date,\n        mh.molecule_id,\n        mh.label,\n        mh.hierarchy_level,\n        mh.molecule_path\n    FROM month_generator mg\n    CROSS JOIN LATERAL (\n        SELECT\n            h.molecule_id,\n            h.label,\n            h.hierarchy_level,\n            h.molecule_path\n        FROM molecule_hierarchy h\n        WHERE h.hierarchy_level <= mg.month_num\n    ) mh\n)\nSELECT\n    mm.month_start_date,\n    mm.molecule_id,\n    mm.label,\n    mm.hierarchy_level,\n    mm.molecule_path\nFROM molecule_months mm\nWHERE mm.month_start_date BETWEEN TO_DATE('01/01/2018', 'MM/DD/YYYY')\n                              AND TO_DATE('12/31/2018', 'MM/DD/YYYY')\nORDER BY\n    mm.month_start_date,\n    mm.hierarchy_level,\n    mm.molecule_id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.42500000000000004,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_CROSS-LATERAL-WHERE-UNION-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "LATERAL",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 8,
        "num_subqueries": 1,
        "num_ctes": 3,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 417,
    "db_id": "toxicology",
    "sql_snippet": "WITH tbl AS\n  (SELECT TO_DATE('12.01.2023', 'dd.mm...",
    "valid": true,
    "error": null,
    "duration_ms": 46.37718200683594,
    "input_sql_tokens": 1087,
    "estimated_tokens": 1286,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH tbl AS\n  (SELECT TO_DATE('12.01.2023', 'dd.mm.yyyy') AS act_date\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('19.01.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('19.01.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('19.01.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('19.01.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('12.02.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('31.01.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('13.02.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('17.02.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('17.02.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('19.02.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('10.03.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('12.03.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('27.03.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy\n   UNION ALL SELECT TO_DATE('10.04.2023', 'dd.mm.yyyy')\n   FROM (SELECT 1) AS dummy),\n     t2 AS\n  (SELECT TO_CHAR(t.act_date, 'MON-yy') AS act_month,\n          TO_CHAR(t.act_date, 'yyyymm') AS rn_2\n   FROM tbl t\n   GROUP BY TO_CHAR(t.act_date, 'MON-yy'),\n            TO_CHAR(t.act_date, 'yyyymm')\n   ORDER BY TO_CHAR(t.act_date, 'yyyymm')),\n     grid AS\n  (SELECT t1.activation_month,\n          t1.rn_1,\n          t2.act_month,\n          t2.rn_2\n   FROM\n     (SELECT TO_CHAR(t.act_date, 'MON-yy') AS activation_month,\n             TO_CHAR(t.act_date, 'yyyymm') AS rn_1\n      FROM tbl t\n      GROUP BY TO_CHAR(t.act_date, 'MON-yy'),\n               TO_CHAR(t.act_date, 'yyyymm')\n      ORDER BY TO_CHAR(t.act_date, 'yyyymm')) t1\n   LEFT JOIN t2 ON (t1.rn_1 <= t2.rn_2)),\n     molecule_activity AS\n  (SELECT m.\"molecule_id\",\n          TO_CHAR(t.act_date, 'yyyymm') AS act_date\n   FROM tbl t\n   INNER JOIN \"molecule\" m ON m.\"molecule_id\" IN\n     (SELECT DISTINCT \"molecule_id\"\n      FROM \"bond\"\n      UNION SELECT DISTINCT \"molecule_id\"\n      FROM \"atom\"))\nSELECT g.activation_month,\n       g.act_month,\n       CASE\n           WHEN g.rn_1 = g.rn_2 THEN\n                  (SELECT COUNT(DISTINCT ma.\"molecule_id\")\n                   FROM molecule_activity ma\n                   WHERE ma.act_date = g.rn_1)\n           ELSE\n                  (SELECT COUNT(DISTINCT ma.\"molecule_id\")\n                   FROM molecule_activity ma\n                   WHERE ma.act_date BETWEEN g.rn_1 AND g.rn_2)\n       END AS active_molecules\nFROM grid g\nGROUP BY g.activation_month,\n         g.act_month\nORDER BY g.rn_1,\n         g.rn_2",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.3940000000000001,
        "pattern_signature": "WITH-CTE-SELECT-DISTINCT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-UNION-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "DISTINCT",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 19,
        "num_ctes": 4,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 418,
    "db_id": "california_schools",
    "sql_snippet": "WITH \"credits\" AS (\n    SELECT\n        5001 AS \"ID...",
    "valid": true,
    "error": null,
    "duration_ms": 32.11784362792969,
    "input_sql_tokens": 932,
    "estimated_tokens": 1060,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH \"credits\" AS (\n    SELECT\n        5001 AS \"ID\",\n        12 AS \"ARTCRED\",\n        7.5 AS \"BIZCRED\",\n        12 AS \"HUMCRED\",\n        14 AS \"NATCRED\",\n        11 AS \"TEKCRED\",\n        9 AS \"GENCRED\",\n        TO_DATE('01.01.2010', 'dd.mm.yyyy') AS \"EFFECTIVE_DATE\"\n    UNION ALL\n    SELECT\n        5001 AS \"ID\",\n        15 AS \"ARTCRED\",\n        9 AS \"BIZCRED\",\n        14 AS \"HUMCRED\",\n        16 AS \"NATCRED\",\n        13 AS \"TEKCRED\",\n        11 AS \"GENCRED\",\n        TO_DATE('01.01.2020', 'dd.mm.yyyy') AS \"EFFECTIVE_DATE\"\n    UNION ALL\n    SELECT\n        5002 AS \"ID\",\n        10.5 AS \"ARTCRED\",\n        6 AS \"BIZCRED\",\n        5 AS \"HUMCRED\",\n        4 AS \"NATCRED\",\n        6 AS \"TEKCRED\",\n        3 AS \"GENCRED\",\n        TO_DATE('01.01.2015', 'dd.mm.yyyy') AS \"EFFECTIVE_DATE\"\n),\n\n\"grp_choices\" AS (\n    SELECT\n        5001 AS \"ID\",\n        'ART' AS \"GROUPCHOICE\",\n        TO_DATE('03.03.2010', 'dd.mm.yyyy') AS \"DATECHOICE\"\n    UNION ALL\n    SELECT\n        5001 AS \"ID\",\n        'BIZ' AS \"GROUPCHOICE\",\n        TO_DATE('05.05.2015', 'dd.mm.yyyy') AS \"DATECHOICE\"\n    UNION ALL\n    SELECT\n        5001 AS \"ID\",\n        'NAT' AS \"GROUPCHOICE\",\n        TO_DATE('23.06.2022', 'dd.mm.yyyy') AS \"DATECHOICE\"\n    UNION ALL\n    SELECT\n        5002 AS \"ID\",\n        'ART' AS \"GROUPCHOICE\",\n        TO_DATE('23.06.2023', 'dd.mm.yyyy') AS \"DATECHOICE\"\n),\n\n\"latest_credits\" AS (\n    SELECT\n        C.\"ID\",\n        C.\"ARTCRED\",\n        C.\"BIZCRED\",\n        C.\"HUMCRED\",\n        C.\"NATCRED\",\n        C.\"TEKCRED\",\n        C.\"GENCRED\",\n        C.\"EFFECTIVE_DATE\",\n        ROW_NUMBER() OVER (PARTITION BY C.\"ID\" ORDER BY C.\"EFFECTIVE_DATE\" DESC) AS RN\n    FROM \"credits\" C\n)\n\nSELECT\n    G.\"ID\",\n    G.\"GROUPCHOICE\",\n    SUM(\n        CASE\n            WHEN G.\"GROUPCHOICE\" = 'ART' AND LC.\"EFFECTIVE_DATE\" <= G.\"DATECHOICE\" THEN LC.\"ARTCRED\"\n            WHEN G.\"GROUPCHOICE\" = 'BIZ' AND LC.\"EFFECTIVE_DATE\" <= G.\"DATECHOICE\" THEN LC.\"BIZCRED\"\n            WHEN G.\"GROUPCHOICE\" = 'HUM' AND LC.\"EFFECTIVE_DATE\" <= G.\"DATECHOICE\" THEN LC.\"HUMCRED\"\n            WHEN G.\"GROUPCHOICE\" = 'NAT' AND LC.\"EFFECTIVE_DATE\" <= G.\"DATECHOICE\" THEN LC.\"NATCRED\"\n            WHEN G.\"GROUPCHOICE\" = 'TEK' AND LC.\"EFFECTIVE_DATE\" <= G.\"DATECHOICE\" THEN LC.\"TEKCRED\"\n            WHEN G.\"GROUPCHOICE\" = 'GEN' AND LC.\"EFFECTIVE_DATE\" <= G.\"DATECHOICE\" THEN LC.\"GENCRED\"\n            ELSE 0\n        END\n    ) AS \"TOTAL_CREDITS\"\nFROM \"grp_choices\" G\nJOIN \"latest_credits\" LC ON G.\"ID\" = LC.\"ID\"\nGROUP BY G.\"ID\", G.\"GROUPCHOICE\"\nORDER BY G.\"ID\", G.\"GROUPCHOICE\"",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.165,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-GROUP-WINDOW-UNION-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "UNION",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 419,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT \"team_api_id\",\n       \"buildupplayspeed\",\n ...",
    "valid": true,
    "error": null,
    "duration_ms": 4.548311233520508,
    "input_sql_tokens": 97,
    "estimated_tokens": 208,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT \"team_api_id\",\n       \"buildupplayspeed\",\n       \"date\"\nFROM\n  (SELECT \"team_api_id\",\n          \"buildupplayspeed\",\n          \"date\",\n          ROW_NUMBER() OVER (PARTITION BY \"team_api_id\"\n                             ORDER BY TO_NUMBER(\"date\") DESC) AS seq\n   FROM \"team_attributes\")\nWHERE seq = 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09300000000000003,
        "pattern_signature": "SELECT-FROM-WHERE-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 420,
    "db_id": "european_football_2",
    "sql_snippet": "WITH player_data AS (\n    SELECT\n        p.player_...",
    "valid": true,
    "error": null,
    "duration_ms": 40.17186164855957,
    "input_sql_tokens": 698,
    "estimated_tokens": 863,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH player_data AS (\n    SELECT\n        p.player_api_id AS player_id,\n        'name' AS attribute_type,\n        p.player_name AS attribute_value\n    FROM player p\n    WHERE p.player_api_id IS NOT NULL\n    UNION ALL\n    SELECT\n        pa.player_api_id AS player_id,\n        'rating' AS attribute_type,\n        CAST(pa.overall_rating AS TEXT) AS attribute_value\n    FROM player_attributes pa\n    WHERE pa.date = (\n        SELECT MAX(date)\n        FROM player_attributes\n        WHERE player_api_id = pa.player_api_id\n    )\n    UNION ALL\n    SELECT\n        pa.player_api_id AS player_id,\n        'foot' AS attribute_type,\n        pa.preferred_foot AS attribute_value\n    FROM player_attributes pa\n    WHERE pa.date = (\n        SELECT MAX(date)\n        FROM player_attributes\n        WHERE player_api_id = pa.player_api_id\n    )\n),\nplayer_stats AS (\n    SELECT\n        player_id,\n        attribute_type,\n        attribute_value,\n        ROW_NUMBER() OVER (PARTITION BY player_id, attribute_type ORDER BY attribute_value) AS rn\n    FROM player_data\n)\nSELECT\n    player_id,\n    (xpath('//attr[@type=\"name\"]/text()',\n        xmlagg(\n            xmlelement(name attr,\n                xmlattributes(attribute_type AS type),\n                attribute_value\n            )\n            ORDER BY attribute_type\n        )\n    ))[1]::text AS name,\n    (xpath('//attr[@type=\"rating\"]/text()',\n        xmlagg(\n            xmlelement(name attr,\n                xmlattributes(attribute_type AS type),\n                attribute_value\n            )\n            ORDER BY attribute_type\n        )\n    ))[1]::text AS rating,\n    (xpath('//attr[@type=\"foot\"]/text()',\n        xmlagg(\n            xmlelement(name attr,\n                xmlattributes(attribute_type AS type),\n                attribute_value\n            )\n            ORDER BY attribute_type\n        )\n    ))[1]::text AS preferred_foot\nFROM player_stats\nWHERE rn = 1\nGROUP BY player_id\nHAVING COUNT(DISTINCT attribute_type) = 3\nORDER BY CAST(\n    CASE\n        WHEN (xpath('//attr[@type=\"rating\"]/text()',\n            xmlagg(\n                xmlelement(name attr,\n                    xmlattributes(attribute_type AS type),\n                    attribute_value\n                )\n            )\n        ))[1]::text IS NULL THEN '0'\n        ELSE (xpath('//attr[@type=\"rating\"]/text()',\n            xmlagg(\n                xmlelement(name attr,\n                    xmlattributes(attribute_type AS type),\n                    attribute_value\n                )\n            )\n        ))[1]::text\n    END\nAS NUMERIC) DESC\nLIMIT 10",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.259,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-GROUP-HAVING-WINDOW-UNION-ORDER-LIMIT-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "LIMIT",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 2,
        "num_ctes": 2,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 421,
    "db_id": "superhero",
    "sql_snippet": "WITH \"MY_TABLE\" AS\n  (SELECT '1111' AS \"TECHNICAL_...",
    "valid": true,
    "error": null,
    "duration_ms": 19.205808639526367,
    "input_sql_tokens": 680,
    "estimated_tokens": 801,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH \"MY_TABLE\" AS\n  (SELECT '1111' AS \"TECHNICAL_ID\",\n          'NOTIONALCR' AS \"ASSET_TYPE\"\n   UNION ALL SELECT '1111' AS \"TECHNICAL_ID\",\n                    '50000' AS \"ASSET_TYPE\"\n   UNION ALL SELECT '2222' AS \"TECHNICAL_ID\",\n                    'FWDNOTLCR' AS \"ASSET_TYPE\"\n   UNION ALL SELECT '2222' AS \"TECHNICAL_ID\",\n                    '50000' AS \"ASSET_TYPE\"\n   UNION ALL SELECT '3333' AS \"TECHNICAL_ID\",\n                    '50000' AS \"ASSET_TYPE\"\n   UNION ALL SELECT '3333' AS \"TECHNICAL_ID\",\n                    'DUMMY' AS \"ASSET_TYPE\"),\n     \"MAP_RECRF_ASSET_TYPE\" AS\n  (SELECT 'SW' AS \"APPLICATION\",\n          'NOTIONALCR' AS \"ASSET_TYPE\",\n          1 AS \"PRIORITY\"\n   UNION ALL SELECT 'SW' AS \"APPLICATION\",\n                    'NOTIONALDB' AS \"ASSET_TYPE\",\n                    1 AS \"PRIORITY\"\n   UNION ALL SELECT 'SW' AS \"APPLICATION\",\n                    'FWDNOTLCR' AS \"ASSET_TYPE\",\n                    2 AS \"PRIORITY\"\n   UNION ALL SELECT 'SW' AS \"APPLICATION\",\n                    'FWDNOTLDR' AS \"ASSET_TYPE\",\n                    2 AS \"PRIORITY\"\n   UNION ALL SELECT 'SW' AS \"APPLICATION\",\n                    'SWOFFBALCR' AS \"ASSET_TYPE\",\n                    2 AS \"PRIORITY\"\n   UNION ALL SELECT 'SW' AS \"APPLICATION\",\n                    'SWOFFBALDR' AS \"ASSET_TYPE\",\n                    2 AS \"PRIORITY\"\n   UNION ALL SELECT 'SW' AS \"APPLICATION\",\n                    'SWFWNOTLCR' AS \"ASSET_TYPE\",\n                    2 AS \"PRIORITY\"\n   UNION ALL SELECT 'SW' AS \"APPLICATION\",\n                    'SWFWNOTLDB' AS \"ASSET_TYPE\",\n                    2 AS \"PRIORITY\"\n   UNION ALL SELECT 'SW' AS \"APPLICATION\",\n                    '50000' AS \"ASSET_TYPE\",\n                    3 AS \"PRIORITY\"),\n     \"CTE\" AS\n  (SELECT X.\"TECHNICAL_ID\",\n          X.\"ASSET_TYPE\",\n          ROW_NUMBER() OVER (PARTITION BY X.\"TECHNICAL_ID\"\n                             ORDER BY MRAT.\"PRIORITY\") AS \"rn\"\n   FROM \"MY_TABLE\" X\n   INNER JOIN \"MAP_RECRF_ASSET_TYPE\" MRAT ON X.\"ASSET_TYPE\" = MRAT.\"ASSET_TYPE\"\n   WHERE MRAT.\"APPLICATION\" = 'SW'\n   UNION ALL SELECT C.\"TECHNICAL_ID\",\n                    C.\"ASSET_TYPE\",\n                    C.\"rn\" + 1\n   FROM \"CTE\" C\n   WHERE C.\"rn\" < 10 )\nSELECT \"TECHNICAL_ID\",\n       \"ASSET_TYPE\"\nFROM \"CTE\"\nWHERE \"rn\" = 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.12,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-WINDOW-UNION-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 422,
    "db_id": "european_football_2",
    "sql_snippet": "WITH match_dates AS (\n    SELECT m.country_id,\n   ...",
    "valid": true,
    "error": null,
    "duration_ms": 23.234128952026367,
    "input_sql_tokens": 528,
    "estimated_tokens": 653,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH match_dates AS (\n    SELECT m.country_id,\n           m.date,\n           m.league_id,\n           m.season,\n           DENSE_RANK() OVER (PARTITION BY m.country_id ORDER BY m.date DESC) AS match_rank\n    FROM \"match\" m\n    WHERE m.date IS NOT NULL\n),\ncountry_stats AS (\n    SELECT c.id AS country_id,\n           c.name AS country_name,\n           COUNT(DISTINCT m.league_id) AS league_count,\n           COUNT(DISTINCT m.season) AS season_count\n    FROM \"country\" c\n    LEFT JOIN \"match\" m ON c.id = m.country_id\n    GROUP BY c.id, c.name\n),\nmatch_summary AS (\n    SELECT md.country_id,\n           md.date,\n           md.match_rank,\n           string_agg(l.name, ', ' ORDER BY l.name) AS leagues_played\n    FROM match_dates md\n    JOIN \"league\" l ON md.league_id = l.id\n    WHERE md.match_rank <= 2\n    GROUP BY md.country_id, md.date, md.match_rank\n)\nSELECT cs.country_id,\n       cs.country_name,\n       MAX(CASE WHEN ms.match_rank = 1 THEN ms.date END) AS last_match_date,\n       MAX(CASE WHEN ms.match_rank = 1 THEN ms.leagues_played END) AS last_match_leagues,\n       MAX(CASE WHEN ms.match_rank = 2 THEN ms.date END) AS prev_match_date,\n       MAX(CASE WHEN ms.match_rank = 2 THEN ms.leagues_played END) AS prev_match_leagues,\n       cs.league_count,\n       cs.season_count\nFROM country_stats cs\nLEFT JOIN match_summary ms ON cs.country_id = ms.country_id\nGROUP BY cs.country_id, cs.country_name, cs.league_count, cs.season_count\nHAVING MAX(CASE WHEN ms.match_rank = 1 THEN ms.date END) IS NOT NULL\nORDER BY MAX(CASE WHEN ms.match_rank = 1 THEN ms.date END) DESC",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.26,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-HAVING-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 3,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 10
      }
    }
  },
  {
    "query_idx": 423,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT T.\"team_long_name\",\n       T.\"team_short_na...",
    "valid": true,
    "error": null,
    "duration_ms": 4.528284072875977,
    "input_sql_tokens": 132,
    "estimated_tokens": 238,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT T.\"team_long_name\",\n       T.\"team_short_name\",\n       TA.\"buildUpPlaySpeed\",\n       TA.\"buildUpPlaySpeedClass\",\n       TA.\"chanceCreationShooting\",\n       TA.\"chanceCreationShootingClass\",\n       TA.\"defencePressure\",\n       TA.\"defencePressureClass\"\nFROM \"team\" T\nINNER JOIN \"team_attributes\" TA ON T.\"team_api_id\" = TA.\"team_api_id\"\nWHERE TA.\"date\" = '2013-09-20 00:00:00'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.052000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 424,
    "db_id": "california_schools",
    "sql_snippet": "SELECT \"valid_from\",\n       \"valid_until\",\n       ...",
    "valid": true,
    "error": null,
    "duration_ms": 10.015010833740234,
    "input_sql_tokens": 293,
    "estimated_tokens": 400,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT \"valid_from\",\n       \"valid_until\",\n       \"count\"\nFROM\n  (SELECT \"dt\" AS \"valid_from\",\n          LEAD(\"dt\") OVER (\n                           ORDER BY \"dt\") - INTERVAL '1' SECOND AS \"valid_until\",\n          SUM(\"count\" * \"type\") OVER (\n                                      ORDER BY \"dt\") AS \"count\"\n   FROM\n     (SELECT \"valid_from\",\n             \"valid_until\" + INTERVAL '1 DAY' AS \"valid_until\",\n             1 AS \"count\"\n      FROM\n        (SELECT TO_DATE('2014-01-01', 'YYYY-MM-DD') AS \"valid_from\",\n                TO_DATE('2014-01-31', 'YYYY-MM-DD') AS \"valid_until\"\n         FROM schools\n         UNION ALL SELECT TO_DATE('2014-02-01', 'YYYY-MM-DD') AS \"valid_from\",\n                          TO_DATE('2014-02-28', 'YYYY-MM-DD') AS \"valid_until\"\n         FROM schools)))\nWHERE \"count\" > 0\n  AND (\"valid_from\" <= \"valid_until\"\n       OR \"valid_until\" IS NULL)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.277,
        "pattern_signature": "SELECT-FROM-WHERE-WINDOW-UNION-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 3,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 425,
    "db_id": "california_schools",
    "sql_snippet": "WITH school_data AS (\n  SELECT\n    s.cdscode AS \"p...",
    "valid": true,
    "error": null,
    "duration_ms": 23.287057876586914,
    "input_sql_tokens": 618,
    "estimated_tokens": 758,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH school_data AS (\n  SELECT\n    s.cdscode AS \"pk\",\n    CASE\n      WHEN s.charter = 1 THEN 'Charter'\n      WHEN s.magnet = 1 THEN 'Magnet'\n      ELSE 'Regular'\n    END AS \"col2\",\n    SUBSTRING(s.county FROM 1 FOR POSITION(' ' IN s.county) - 1) AS \"col3\",\n    TO_TIMESTAMP(TO_CHAR(s.lastupdate, 'YYYY/MM/DD') || ' ' ||\n           LPAD(CAST(MOD(ROW_NUMBER() OVER (ORDER BY s.cdscode), 24) AS TEXT), 2, '0') || ':' ||\n           LPAD(CAST(MOD(ROW_NUMBER() OVER (ORDER BY s.cdscode) * 7, 60) AS TEXT), 2, '0'),\n           'YYYY/MM/DD HH24:MI') AS \"col4\"\n  FROM schools s\n  WHERE s.statustype = 'Active'\n    AND s.lastupdate IS NOT NULL\n),\nfiltered_data AS (\n  SELECT\n    sd.\"pk\",\n    sd.\"col2\",\n    sd.\"col3\",\n    sd.\"col4\"\n  FROM school_data sd\n  WHERE sd.\"col4\" >= TO_TIMESTAMP('2024/09/04 00:00', 'yyyy/mm/dd hh24:mi')\n    AND sd.\"col4\" < TO_CHAR(TO_TIMESTAMP('2024/09/04 00:05', 'yyyy/mm/dd hh24:mi'), 'yyyy/mm/dd hh24:mi')\n),\naggregated_data AS (\n  SELECT\n    fd.\"col2\",\n    STRING_AGG(DISTINCT fd.\"col3\", ', ' ORDER BY fd.\"col3\") AS \"col3_list\"\n  FROM filtered_data fd\n  GROUP BY fd.\"col2\"\n)\n\nSELECT\n  ad.\"col2\",\n  ad.\"col3_list\" AS \"col3\",\n  COUNT(fd.\"pk\") AS \"record_count\"\nFROM aggregated_data ad\nLEFT JOIN filtered_data fd ON fd.\"col2\" = ad.\"col2\"\nWHERE fd.\"col4\" BETWEEN\n  TO_TIMESTAMP('2024/09/04 00:00', 'yyyy/mm/dd hh24:mi')\n  AND\n  TO_TIMESTAMP('2024/09/04 00:05', 'yyyy/mm/dd hh24:mi')\nGROUP BY ad.\"col2\", ad.\"col3_list\"\nORDER BY \"record_count\" DESC",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.16200000000000003,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 426,
    "db_id": "european_football_2",
    "sql_snippet": "WITH \"data\" AS\n  (SELECT 101 AS \"id\",\n          'A...",
    "valid": true,
    "error": null,
    "duration_ms": 16.95108413696289,
    "input_sql_tokens": 395,
    "estimated_tokens": 526,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH \"data\" AS\n  (SELECT 101 AS \"id\",\n          'A' AS \"type\",\n          10 AS \"part\"\n   UNION ALL SELECT 101 AS \"id\",\n                    'B' AS \"type\",\n                    10 AS \"part\"\n   UNION ALL SELECT 101 AS \"id\",\n                    'B' AS \"type\",\n                    10 AS \"part\"\n   UNION ALL SELECT 101 AS \"id\",\n                    'B' AS \"type\",\n                    20 AS \"part\"\n   UNION ALL SELECT 101 AS \"id\",\n                    'C' AS \"type\",\n                    30 AS \"part\"\n   UNION ALL SELECT 102 AS \"id\",\n                    'A' AS \"type\",\n                    10 AS \"part\"\n   UNION ALL SELECT 102 AS \"id\",\n                    'B' AS \"type\",\n                    25 AS \"part\"\n   UNION ALL SELECT 103 AS \"id\",\n                    'A' AS \"type\",\n                    25 AS \"part\"\n   UNION ALL SELECT 103 AS \"id\",\n                    'B' AS \"type\",\n                    25 AS \"part\"),\n     \"w_cnt\" AS\n  (SELECT \"id\",\n          \"part\",\n          COUNT(*) AS \"cnt\"\n   FROM \"data\"\n   GROUP BY \"id\",\n            \"part\"\n   HAVING COUNT(*) > 1)\nSELECT d.\"id\",\n       d.\"type\",\n       d.\"part\"\nFROM \"data\" d\nINNER JOIN \"w_cnt\" w ON d.\"id\" = w.\"id\"\nAND d.\"part\" = w.\"part\"\nWHERE d.\"type\" = 'B'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.12500000000000003,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-HAVING-UNION",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 427,
    "db_id": "california_schools",
    "sql_snippet": "WITH \"columns\" (\"column_name\") AS\n  (SELECT 'cdsco...",
    "valid": true,
    "error": null,
    "duration_ms": 9.396076202392578,
    "input_sql_tokens": 190,
    "estimated_tokens": 318,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH \"columns\" (\"column_name\") AS\n  (SELECT 'cdscode'\n   UNION ALL SELECT 'statustype'\n   UNION ALL SELECT 'school'),\n     \"column_exists\" (\"column_name\",\n                      \"column_exists\") AS\n  (SELECT c.\"column_name\",\n          COALESCE(a.attname, 'NO')\n   FROM \"columns\" c\n   LEFT OUTER JOIN pg_attribute a ON (a.attrelid = 'schools'::regclass\n                                      AND c.\"column_name\" = a.attname))\nSELECT *\nFROM \"column_exists\"\nPIVOT (MAX(\"column_exists\")\n       FOR \"column_name\" IN ('cdscode', 'statustype', 'school'))\nWHERE\n    (SELECT \"column_name\"\n     FROM \"columns\") = 'cdscode';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.15400000000000003,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-UNION-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 428,
    "db_id": "superhero",
    "sql_snippet": "WITH string1_tab AS (\n    SELECT REGEXP_SUBSTR('24...",
    "valid": true,
    "error": null,
    "duration_ms": 16.215085983276367,
    "input_sql_tokens": 378,
    "estimated_tokens": 504,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH string1_tab AS (\n    SELECT REGEXP_SUBSTR('24,36,78,98', '[^,]+', 1, generate_series) AS value,\n           generate_series AS position\n    FROM generate_series(1, LENGTH('24,36,78,98') - LENGTH(REPLACE('24,36,78,98', ',', '')) + 1)\n),\nstring2_tab AS (\n    SELECT REGEXP_SUBSTR('25,36,88,98', '[^,]+', 1, generate_series) AS value,\n           generate_series AS position\n    FROM generate_series(1, LENGTH('25,36,88,98') - LENGTH(REPLACE('25,36,88,98', ',', '')) + 1)\n),\nstring1_parsed AS (\n    SELECT TO_NUMBER(TRIM(value), '999999') AS num_value\n    FROM string1_tab\n),\nstring2_parsed AS (\n    SELECT TO_NUMBER(TRIM(value), '999999') AS num_value\n    FROM string2_tab\n),\ncommon_values AS (\n    SELECT s1.num_value\n    FROM string1_parsed s1\n    JOIN string2_parsed s2 ON s1.num_value = s2.num_value\n)\nSELECT STRING_AGG(num_value::text, ',') WITHIN GROUP (ORDER BY num_value) AS common_values\nFROM common_values\nWHERE num_value IS NOT NULL\nHAVING COUNT(DISTINCT num_value) > 0",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14500000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-HAVING-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "HAVING",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 5,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 429,
    "db_id": "european_football_2",
    "sql_snippet": "WITH t AS\n  (SELECT \"date\",\n          \"match_api_i...",
    "valid": true,
    "error": null,
    "duration_ms": 20.0653076171875,
    "input_sql_tokens": 314,
    "estimated_tokens": 427,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH t AS\n  (SELECT \"date\",\n          \"match_api_id\" AS code,\n          CURRENT_DATE - DATE(TO_TIMESTAMP(\"date\", 'YYYY-MM-DD HH24:MI:SS')) AS duration,\n          COUNT(*) OVER (PARTITION BY DATE(TO_TIMESTAMP(\"date\", 'YYYY-MM-DD HH24:MI:SS')), \"match_api_id\", CURRENT_DATE - DATE(TO_TIMESTAMP(\"date\", 'YYYY-MM-DD HH24:MI:SS'))) AS cnt,\n          MIN(CURRENT_DATE - DATE(TO_TIMESTAMP(\"date\", 'YYYY-MM-DD HH24:MI:SS'))) OVER (PARTITION BY DATE(TO_TIMESTAMP(\"date\", 'YYYY-MM-DD HH24:MI:SS')), \"match_api_id\") AS min_dur\n   FROM \"match\")\nSELECT t.\"date\",\n       t.code,\n       t.duration,\n       CASE\n           WHEN t.min_dur = 0\n                OR MAX(t.cnt) OVER (PARTITION BY t.\"date\", t.code) > 1 THEN 'Y'\n           ELSE 'N'\n       END AS flg\nFROM t\nWHERE TO_TIMESTAMP(t.\"date\", 'YYYY-MM-DD HH24:MI:SS') = '2008-11-22 00:00:00'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09900000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-WINDOW",
        "clauses_present": [
          "CTE",
          "FROM",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 430,
    "db_id": "toxicology",
    "sql_snippet": "SELECT b.\"bond_id\",\n       b.\"molecule_id\",\n      ...",
    "valid": true,
    "error": null,
    "duration_ms": 9.246349334716797,
    "input_sql_tokens": 142,
    "estimated_tokens": 241,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT b.\"bond_id\",\n       b.\"molecule_id\",\n       b.\"bond_type\",\n       GREATEST(DATE_TRUNC('month', CURRENT_DATE - INTERVAL '1 day') + INTERVAL '1 day' + (m.months * INTERVAL '1 month'), CURRENT_DATE) AS bond_formation_date\nFROM \"bond\" b\nJOIN\n  (SELECT generate_series(0, 5) AS months) m\nGROUP BY b.\"bond_id\",\n         b.\"molecule_id\",\n         b.\"bond_type\",\n         m.months\nHAVING b.\"molecule_id\" = 'TR011'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.118,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-HAVING-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 431,
    "db_id": "european_football_2",
    "sql_snippet": "WITH team_speed_stats AS (\n    SELECT\n        team...",
    "valid": true,
    "error": null,
    "duration_ms": 31.686782836914062,
    "input_sql_tokens": 729,
    "estimated_tokens": 867,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH team_speed_stats AS (\n    SELECT\n        team_api_id,\n        date,\n        buildupplayspeed,\n        ROW_NUMBER() OVER (PARTITION BY team_api_id ORDER BY date DESC) as rn,\n        AVG(buildupplayspeed) OVER (PARTITION BY buildupplayspeedclass) as class_avg_speed\n    FROM team_attributes\n),\nmatch_details AS (\n    SELECT\n        m.id,\n        m.date,\n        m.home_team_api_id,\n        m.away_team_api_id,\n        m.home_team_goal,\n        m.away_team_goal,\n        t.team_long_name as home_team_name,\n        t2.team_long_name as away_team_name,\n        ta.buildupplayspeed as home_speed,\n        ta.buildupplayspeedclass as home_speed_class,\n        ta_away.buildupplayspeed as away_speed,\n        ts.class_avg_speed,\n        (SELECT AVG(buildupplayspeed) FROM team_attributes) as overall_avg_speed\n    FROM match m\n    JOIN team t ON m.home_team_api_id = t.team_api_id\n    JOIN team t2 ON m.away_team_api_id = t2.team_api_id\n    JOIN team_attributes ta ON m.home_team_api_id = ta.team_api_id\n    LEFT JOIN team_attributes ta_away ON m.away_team_api_id = ta_away.team_api_id\n        AND ta_away.date <= m.date\n    JOIN team_speed_stats ts ON ta.team_api_id = ts.team_api_id\n        AND ta.buildupplayspeed = ts.buildupplayspeed\n        AND ts.rn = 1\n    WHERE m.date BETWEEN TO_DATE('2015-01-01', 'YYYY-MM-DD') AND TO_DATE('2016-01-01', 'YYYY-MM-DD')\n)\nSELECT\n    id,\n    date,\n    home_team_api_id,\n    away_team_api_id,\n    home_team_goal,\n    away_team_goal,\n    home_team_name,\n    away_team_name,\n    home_speed,\n    home_speed_class,\n    away_speed,\n    CASE\n        WHEN home_speed > class_avg_speed THEN 'Above Class Average'\n        ELSE 'Below Class Average'\n    END as speed_comparison\nFROM match_details\nWHERE home_speed >\n    (SELECT AVG(buildupplayspeed)\n     FROM team_attributes\n     WHERE date BETWEEN\n        (SELECT MIN(date) FROM match_details) AND\n        (SELECT MAX(date) FROM match_details)\n     GROUP BY buildupplayspeedclass\n     HAVING buildupplayspeedclass = match_details.home_speed_class)\nORDER BY home_team_goal DESC, away_team_goal ASC",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.479,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-HAVING-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 5,
        "num_subqueries": 4,
        "num_ctes": 2,
        "num_aggregations": 5
      }
    }
  },
  {
    "query_idx": 432,
    "db_id": "european_football_2",
    "sql_snippet": "with lose_agg as\n  (select team_api_id,\n          ...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 29, Col: 6.\n   join profit_agg p on l.team_api_id = p.team_api_id\norder by coalesce(p.team_api_id, l.team_api_id)\n\u001b[4mselect\u001b[0m extract(year from to_date(date, 'YYYY-MM-DD HH24:MI:SS')) as year\nfrom team_attributes\nwhere date =",
    "duration_ms": 81.01272583007812,
    "input_sql_tokens": 428,
    "estimated_tokens": 630,
    "error_tokens": 107,
    "invalid_sql_tokens": 428,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 29, Col: 6.\n   join profit_agg p on l.team_api_id = p.team_api_id\norder by coalesce(p.team_api_id, l.team_api_id)\n\u001b[4mselect\u001b[0m extract(year from to_date(date, 'YYYY-MM-DD HH24:MI:SS')) as year\nfrom team_attributes\nwhere date =",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "with lose_agg as\n  (select team_api_id,\n          sum(case\n                  when extract(year from to_date(date, 'YYYY-MM-DD HH24:MI:SS')) = 2011 then defencepressure\n              end) as lose_5,\n          sum(case\n                  when extract(year from to_date(date, 'YYYY-MM-DD HH24:MI:SS')) = 2012 then defencepressure\n              end) as lose_10\n   from team_attributes\n   group by team_api_id),\n     profit_agg as\n  (select team_api_id,\n          sum(case\n                  when extract(year from to_date(date, 'YYYY-MM-DD HH24:MI:SS')) = 2011 then buildupplayspeed\n              end) as profit_5,\n          sum(case\n                  when extract(year from to_date(date, 'YYYY-MM-DD HH24:MI:SS')) = 2012 then buildupplayspeed\n              end) as profit_10\n   from team_attributes\n   group by team_api_id)\nselect l.lose_5,\n       p.profit_5,\n       l.lose_10,\n       p.profit_10,\n       coalesce(p.team_api_id, l.team_api_id) as team_api_id\nfrom lose_agg l\nfull outer join profit_agg p on l.team_api_id = p.team_api_id\norder by coalesce(p.team_api_id, l.team_api_id)\nselect extract(year from to_date(date, 'YYYY-MM-DD HH24:MI:SS')) as year\nfrom team_attributes\nwhere date = 'invalid_date_string'",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 433,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT \"id\", \"date\", \"home_team_goal\", LAG(\"home_t...",
    "valid": true,
    "error": null,
    "duration_ms": 7.061004638671875,
    "input_sql_tokens": 59,
    "estimated_tokens": 146,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT \"id\", \"date\", \"home_team_goal\", LAG(\"home_team_goal\") OVER (ORDER BY \"date\" DESC) AS prev_home_goal FROM \"match\" WHERE \"date\" <= '2024-02-26'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.023,
        "pattern_signature": "SELECT-FROM-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 434,
    "db_id": "toxicology",
    "sql_snippet": "SELECT \"atom_id\",\n    \"bond_id_1\",\n    \"bond_id_2\"...",
    "valid": true,
    "error": null,
    "duration_ms": 10.189294815063477,
    "input_sql_tokens": 152,
    "estimated_tokens": 251,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT \"atom_id\",\n    \"bond_id_1\",\n    \"bond_id_2\",\n    \"bond_id_3\"\nFROM (\n    SELECT \"atom_id\", \"bond_id\",\n           CASE WHEN \"bond_id\" = 1 THEN \"bond_id\" END AS \"bond_id_1\",\n           CASE WHEN \"bond_id\" = 2 THEN \"bond_id\" END AS \"bond_id_2\",\n           CASE WHEN \"bond_id\" = 3 THEN \"bond_id\" END AS \"bond_id_3\"\n    FROM \"connected\"\n) AS pivoted_data\nORDER BY \"atom_id\"",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08600000000000002,
        "pattern_signature": "SELECT-FROM-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 435,
    "db_id": "student_club",
    "sql_snippet": "WITH OrderedCategories AS (\n    SELECT\n        SUM...",
    "valid": true,
    "error": null,
    "duration_ms": 10.378837585449219,
    "input_sql_tokens": 127,
    "estimated_tokens": 235,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH OrderedCategories AS (\n    SELECT\n        SUM(spent) AS category_total,\n        category\n    FROM budget\n    GROUP BY category\n    ORDER BY category DESC\n),\nCumulative AS (\n    SELECT category_total, category,\n           SUM(category_total) OVER (ORDER BY category DESC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS cumulative_sum\n    FROM OrderedCategories\n)\nSELECT category_total, category\nFROM Cumulative\nWHERE cumulative_sum <= 800\nAND (cumulative_sum - category_total) < 800",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.103,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 436,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT player_id,\n    MAX(overall_rating) AS overa...",
    "valid": true,
    "error": null,
    "duration_ms": 11.994123458862305,
    "input_sql_tokens": 114,
    "estimated_tokens": 222,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT player_id,\n    MAX(overall_rating) AS overall_rating,\n    potential,\n    preferred_foot,\n    attacking_work_rate\nFROM (SELECT player_api_id AS player_id, overall_rating, potential, preferred_foot, attacking_work_rate, row_number() OVER (PARTITION BY player_api_id ORDER BY date DESC) as rn FROM player_attributes WHERE date <= '2015-12-31') subquery\nWHERE rn = 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10600000000000001,
        "pattern_signature": "SELECT-FROM-WHERE-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 437,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT XMLSERIALIZE(DOCUMENT XMLELEMENT(NAME \"file...",
    "valid": false,
    "error": "Expecting ). Line 1, Col: 39.\n  SELECT XMLSERIALIZE(DOCUMENT \u001b[4mXMLELEMENT\u001b[0m(NAME \"files\", XMLAGG(XMLELEMENT(NAME \"file\", XMLFOREST(\"id\" AS \"id\", \"team_long_name\" AS \"team_long",
    "duration_ms": 5.007028579711914,
    "input_sql_tokens": 116,
    "estimated_tokens": 270,
    "error_tokens": 72,
    "invalid_sql_tokens": 116,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unbalanced_tokens",
          "message": "Expecting ). Line 1, Col: 39.\n  SELECT XMLSERIALIZE(DOCUMENT \u001b[4mXMLELEMENT\u001b[0m(NAME \"files\", XMLAGG(XMLELEMENT(NAME \"file\", XMLFOREST(\"id\" AS \"id\", \"team_long_name\" AS \"team_long",
          "location": null,
          "context": "Parser reported expecting parenthesis",
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT XMLSERIALIZE(DOCUMENT XMLELEMENT(NAME \"files\", XMLAGG(XMLELEMENT(NAME \"file\", XMLFOREST(\"id\" AS \"id\", \"team_long_name\" AS \"team_long_name\"))\n                                                        ORDER BY \"team_long_name\" COLLATE \"fr_FR\")) INDENT SIZE = 2) AS result\nFROM \"team\"\nWHERE \"id\" IN\n    (SELECT \"id\"\n     FROM \"team_attributes\"\n     WHERE \"date\" IS NULL)",
      "tags": [
        "syntax_unbalanced_tokens"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 438,
    "db_id": "european_football_2",
    "sql_snippet": "WITH match_times AS (\n    SELECT\n        \"date\",\n ...",
    "valid": true,
    "error": null,
    "duration_ms": 43.3802604675293,
    "input_sql_tokens": 674,
    "estimated_tokens": 808,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH match_times AS (\n    SELECT\n        \"date\",\n        \"match_api_id\",\n        EXTRACT(HOUR FROM CAST(\"date\" AS TIMESTAMP)) +\n        EXTRACT(MINUTE FROM CAST(\"date\" AS TIMESTAMP))/60 AS hour_of_day,\n        TO_CHAR(CAST(\"date\" AS TIMESTAMP), 'YYYY-MM-DD') AS match_date_str\n    FROM \"match\"\n),\ntarget_times AS (\n    SELECT 8 AS target_hour\n    UNION ALL\n    SELECT 20 AS target_hour\n),\ndistance_calc AS (\n    SELECT\n        mt.\"date\",\n        mt.\"match_api_id\",\n        mt.match_date_str,\n        tt.target_hour,\n        CASE\n            WHEN tt.target_hour = 8 THEN 'morning'\n            WHEN tt.target_hour = 20 THEN 'evening'\n        END AS time_period,\n        ABS(mt.hour_of_day - tt.target_hour) AS time_distance,\n        DENSE_RANK() OVER (\n            PARTITION BY mt.match_date_str, tt.target_hour\n            ORDER BY ABS(mt.hour_of_day - tt.target_hour)\n        ) AS time_rank\n    FROM match_times mt\n    CROSS JOIN target_times tt\n)\nSELECT\n    TO_TIMESTAMP(dc.match_date_str || ' ' ||\n           LPAD(FLOOR(dc.target_hour)::text, 2, '0') || ':00:00',\n           'YYYY-MM-DD HH24:MI:SS') AS target_datetime,\n    dc.\"date\",\n    dc.\"match_api_id\",\n    dc.time_period,\n    dc.time_distance,\n    EXTRACT(DAY FROM (CAST(dc.\"date\" AS TIMESTAMP) - TO_TIMESTAMP(dc.match_date_str, 'YYYY-MM-DD'))) * 24 +\n    EXTRACT(HOUR FROM (CAST(dc.\"date\" AS TIMESTAMP) - TO_TIMESTAMP(dc.match_date_str, 'YYYY-MM-DD'))) +\n    EXTRACT(MINUTE FROM (CAST(dc.\"date\" AS TIMESTAMP) - TO_TIMESTAMP(dc.match_date_str, 'YYYY-MM-DD')))/60 AS actual_hours,\n    RANK() OVER (\n        PARTITION BY dc.match_date_str, dc.time_period\n        ORDER BY dc.time_distance, dc.\"match_api_id\"\n    ) AS final_rank\nFROM distance_calc dc\nWHERE dc.time_rank <= 1\n  AND dc.time_distance <=\n      CASE\n          WHEN dc.target_hour = 8 THEN 4\n          WHEN dc.target_hour = 20 THEN 3\n      END\nORDER BY\n    dc.match_date_str,\n    dc.target_hour,\n    dc.time_distance",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.138,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_CROSS-WHERE-WINDOW-UNION-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "ORDER",
          "SELECT",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 439,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT REPLACE(SUBSTR(date, 1, INSTR(date, '.', -1...",
    "valid": true,
    "error": null,
    "duration_ms": 4.184484481811523,
    "input_sql_tokens": 57,
    "estimated_tokens": 136,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT REPLACE(SUBSTR(date, 1, INSTR(date, '.', -1) - 1), '.') || SUBSTR(date, INSTR(date, '.', -1)) AS \"updated_value\"\nFROM team_attributes\nWHERE date LIKE '%.%'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 440,
    "db_id": "toxicology",
    "sql_snippet": "WITH molecule_stats AS (\n    SELECT m.\"molecule_id...",
    "valid": true,
    "error": null,
    "duration_ms": 18.280744552612305,
    "input_sql_tokens": 457,
    "estimated_tokens": 575,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH molecule_stats AS (\n    SELECT m.\"molecule_id\",\n           COUNT(a.\"atom_id\") AS atom_count,\n           MIN(a.\"element\") AS first_element\n    FROM \"molecule\" m\n    LEFT JOIN \"atom\" a ON m.\"molecule_id\" = a.\"molecule_id\"\n    GROUP BY m.\"molecule_id\"\n),\natom_details AS (\n    SELECT a.\"molecule_id\",\n           a.\"atom_id\",\n           ROW_NUMBER() OVER (PARTITION BY a.\"molecule_id\" ORDER BY a.\"atom_id\") AS atom_seq,\n           LEAD(a.\"atom_id\") OVER (PARTITION BY a.\"molecule_id\" ORDER BY a.\"atom_id\") AS next_atom\n    FROM \"atom\" a\n)\nSELECT m.\"molecule_id\",\n       ms.atom_count,\n       CASE\n           WHEN ms.atom_count > 0 THEN\n               STRING_AGG(a.\"atom_id\", ',' ORDER BY ad.atom_seq)\n           ELSE 'No atoms'\n       END AS \"atom_ids\",\n       JSON_AGG(\n           JSON_BUILD_OBJECT(\n               'atom_id', a.\"atom_id\",\n               'element', a.\"element\"\n           )\n           ORDER BY a.\"atom_id\"\n       ) AS atom_json\nFROM \"molecule\" m\nLEFT OUTER JOIN molecule_stats ms ON m.\"molecule_id\" = ms.\"molecule_id\"\nLEFT OUTER JOIN \"atom\" a ON m.\"molecule_id\" = a.\"molecule_id\"\nLEFT OUTER JOIN atom_details ad ON a.\"atom_id\" = ad.\"atom_id\"\nLEFT OUTER JOIN \"connected\" c ON a.\"atom_id\" = c.\"atom_id\"\n                              AND c.\"atom_id2\" = ad.next_atom\nWHERE (ms.first_element IS NULL OR ms.first_element != 'h')\nGROUP BY m.\"molecule_id\", ms.atom_count\nORDER BY ms.atom_count DESC NULLS LAST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.276,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 5,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 5
      }
    }
  },
  {
    "query_idx": 441,
    "db_id": "european_football_2",
    "sql_snippet": "WITH \"my_table\" AS\n  (SELECT 'A' AS \"cto\",\n       ...",
    "valid": false,
    "error": "Expecting ). Line 38, Col: 46.\n  ize\"\n   FROM \"my_table\" t) MATCH_RECOGNIZE(PARTITION BY \"cto\"\n                                      \u001b[4mORDER BY\u001b[0m \"rn\" MEASURES MATCH_NUMBER() AS \"mn\", SUM(\"filesize\") AS \"total_size\" ALL ROWS PER MATCH PATTERN ((",
    "duration_ms": 29.91199493408203,
    "input_sql_tokens": 672,
    "estimated_tokens": 875,
    "error_tokens": 81,
    "invalid_sql_tokens": 672,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unbalanced_tokens",
          "message": "Expecting ). Line 38, Col: 46.\n  ize\"\n   FROM \"my_table\" t) MATCH_RECOGNIZE(PARTITION BY \"cto\"\n                                      \u001b[4mORDER BY\u001b[0m \"rn\" MEASURES MATCH_NUMBER() AS \"mn\", SUM(\"filesize\") AS \"total_size\" ALL ROWS PER MATCH PATTERN ((",
          "location": null,
          "context": "Parser reported expecting parenthesis",
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "WITH \"my_table\" AS\n  (SELECT 'A' AS \"cto\",\n          1 AS \"nif\",\n          'A1' AS \"file_\",\n          5 AS \"filesize\"\n   UNION ALL SELECT 'A' AS \"cto\",\n                    1 AS \"nif\",\n                    'A2' AS \"file_\",\n                    3 AS \"filesize\"\n   UNION ALL SELECT 'A' AS \"cto\",\n                    2 AS \"nif\",\n                    'A3' AS \"file_\",\n                    2 AS \"filesize\"\n   UNION ALL SELECT 'A' AS \"cto\",\n                    2 AS \"nif\",\n                    'A4' AS \"file_\",\n                    1 AS \"filesize\"\n   UNION ALL SELECT 'B' AS \"cto\",\n                    1 AS \"nif\",\n                    'B1' AS \"file_\",\n                    4 AS \"filesize\"\n   UNION ALL SELECT 'B' AS \"cto\",\n                    1 AS \"nif\",\n                    'B2' AS \"file_\",\n                    6 AS \"filesize\")\nSELECT \"cto\",\n       \"nif\",\n       \"file_\",\n       \"partition\",\n       \"mn\" - \"first_mn\" + 1 AS \"subpartition\",\n       \"total_size\"\nFROM\n  (SELECT t.*,\n          ROW_NUMBER() OVER (PARTITION BY \"cto\"\n                             ORDER BY SUBSTR(\"file_\", 1, 1), CAST(SUBSTR(\"file_\", 2) AS INTEGER)) AS \"rn\",\n          SUM(\"filesize\") OVER (PARTITION BY \"nif\") AS \"nif_size\"\n   FROM \"my_table\" t) MATCH_RECOGNIZE(PARTITION BY \"cto\"\n                                      ORDER BY \"rn\" MEASURES MATCH_NUMBER() AS \"mn\", SUM(\"filesize\") AS \"total_size\" ALL ROWS PER MATCH PATTERN ((same_nif* nif)* same_nif* end_nif) DEFINE same_nif AS \"nif\" = NEXT(\"nif\"), nif AS (NEXT(\"nif\") IS NULL\n                                                                                                                                                                                                                                     OR \"nif\" != NEXT(\"nif\"))\n                                      AND SUM(\"filesize\") + NEXT(\"nif_size\") <= 10, end_nif AS SUM(\"filesize\") <= 10) MATCH_RECOGNIZE(PARTITION BY \"cto\"\n                                                                                                                                      ORDER BY \"rn\" MEASURES MATCH_NUMBER() AS \"partition\", FIRST(\"mn\") AS \"first_mn\" ALL ROWS PER MATCH PATTERN ((same_nif* nif)+) DEFINE same_nif AS \"nif\" = NEXT(\"nif\"), nif AS (NEXT(\"nif\") IS NULL\n                                                                                                                                                                                                                                                                                                                    OR \"nif\" != NEXT(\"nif\"))\n                                                                                                                                      AND \"mn\" - FIRST(\"mn\") < 7)\nUNION ALL\nSELECT \"cto\",\n       \"nif\",\n       'A1X' AS \"file_\",\n       5 AS \"filesize\"\nFROM (SELECT 'A' AS \"cto\", 1 AS \"nif\") AS dual",
      "tags": [
        "syntax_unbalanced_tokens"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 442,
    "db_id": "superhero",
    "sql_snippet": "WITH RECURSIVE \"a\" (\"test\") AS\n  (SELECT 'Jack|Spa...",
    "valid": true,
    "error": null,
    "duration_ms": 4.727363586425781,
    "input_sql_tokens": 144,
    "estimated_tokens": 251,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE \"a\" (\"test\") AS\n  (SELECT 'Jack|Sparrow|17-09-16|DY7009|Address at some where|details '\n   UNION ALL SELECT 'Jack|Sparrow|17-09-16|DY7009|'\n   UNION ALL SELECT 'Jack|Sparrow|17-09-16'\n   UNION ALL SELECT \"test\" || '|MoreData'\n   FROM \"a\")\nSELECT \"test\",\n       REGEXP_SUBSTR(\"test\", '([^|]+\\|?){1,5}') AS \"res\"\nFROM \"a\"",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.054000000000000006,
        "pattern_signature": "WITH-CTE-SELECT-FROM-UNION",
        "clauses_present": [
          "CTE",
          "FROM",
          "SELECT",
          "UNION",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 443,
    "db_id": "student_club",
    "sql_snippet": "SELECT * FROM \"event\"\n    WHERE \"status\"::text <> ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.9838085174560547,
    "input_sql_tokens": 51,
    "estimated_tokens": 144,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM \"event\"\n    WHERE \"status\"::text <> 'Closed'\n    ORDER BY \"event_date\"\n    OFFSET 10 ROWS FETCH FIRST 5 ROWS ONLY\n    FOR UPDATE SKIP LOCKED;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE-ORDER-OFFSET-LOCKING",
        "clauses_present": [
          "FROM",
          "LOCKING",
          "OFFSET",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 444,
    "db_id": "toxicology",
    "sql_snippet": "SELECT\n  \"molecule\".\"molecule_id\",\n  MIN(\"atom\".\"a...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0143260955810547,
    "input_sql_tokens": 56,
    "estimated_tokens": 168,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT\n  \"molecule\".\"molecule_id\",\n  MIN(\"atom\".\"atom_id\") AS \"first_atom_id\"\nFROM \"molecule\"\nINNER JOIN \"atom\" ON \"molecule\".\"molecule_id\" = \"atom\".\"molecule_id\";",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.051000000000000004,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 445,
    "db_id": "toxicology",
    "sql_snippet": "SELECT \"molecule\".\"molecule_id\",\n      \"molecule\"....",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 14, Col: 20.\n  .\"bond_id\" = \"bond\".\"bond_id\"\nORDER BY \"molecule\".\"molecule_id\",\n         \"atom\".\"atom_id\"\n         \u001b[4m\"connected\"\u001b[0m.\"atom_id2\";",
    "duration_ms": 9.678125381469727,
    "input_sql_tokens": 160,
    "estimated_tokens": 343,
    "error_tokens": 71,
    "invalid_sql_tokens": 160,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 14, Col: 20.\n  .\"bond_id\" = \"bond\".\"bond_id\"\nORDER BY \"molecule\".\"molecule_id\",\n         \"atom\".\"atom_id\"\n         \u001b[4m\"connected\"\u001b[0m.\"atom_id2\";",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT \"molecule\".\"molecule_id\",\n      \"molecule\".\"label\",\n      \"atom\".\"atom_id\",\n      \"atom\".\"element\",\n      \"bond\".\"bond_id\",\n      \"bond\".\"bond_type\",\n      \"connected\".\"atom_id2\"\nFROM \"molecule\"\nINNER JOIN \"atom\" ON \"molecule\".\"molecule_id\" = \"atom\".\"molecule_id\"\nINNER JOIN \"connected\" ON \"atom\".\"atom_id\" = \"connected\".\"atom_id\"\nINNER JOIN \"bond\" ON \"connected\".\"bond_id\" = \"bond\".\"bond_id\"\nORDER BY \"molecule\".\"molecule_id\",\n         \"atom\".\"atom_id\"\n         \"connected\".\"atom_id2\";",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 446,
    "db_id": "california_schools",
    "sql_snippet": "UPDATE \"frpm\" AS target\n    \"Charter School (Y/N)\"...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 2, Col: 26.\n  UPDATE \"frpm\" AS target\n    \u001b[4m\"Charter School (Y/N)\"\u001b[0m = 1000\n   FROM (\n       SELECT DISTINCT \"cdscode\"\n       FROM \"frpm\"\n       WHERE \"Percent (%) Elig",
    "duration_ms": 1.9998550415039062,
    "input_sql_tokens": 81,
    "estimated_tokens": 240,
    "error_tokens": 77,
    "invalid_sql_tokens": 81,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 2, Col: 26.\n  UPDATE \"frpm\" AS target\n    \u001b[4m\"Charter School (Y/N)\"\u001b[0m = 1000\n   FROM (\n       SELECT DISTINCT \"cdscode\"\n       FROM \"frpm\"\n       WHERE \"Percent (%) Elig",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "UPDATE \"frpm\" AS target\n    \"Charter School (Y/N)\" = 1000\n   FROM (\n       SELECT DISTINCT \"cdscode\"\n       FROM \"frpm\"\n       WHERE \"Percent (%) Eligible Free (K-12)\" >= 0.5\n   ) AS source\n   WHERE target.\"cdscode\" = source.\"cdscode\";",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 447,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT\n        player_fifa_api_id as id,\n        M...",
    "valid": true,
    "error": null,
    "duration_ms": 3.5533905029296875,
    "input_sql_tokens": 57,
    "estimated_tokens": 153,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT\n        player_fifa_api_id as id,\n        MIN(date::date) AS first_date,\n        MAX(date::date) AS last_date\n    FROM player_attributes\n    GROUP BY player_fifa_api_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.022000000000000002,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 448,
    "db_id": "toxicology",
    "sql_snippet": "SELECT m.molecule_id AS ID, COUNT(a.atom_id) AS QT...",
    "valid": true,
    "error": null,
    "duration_ms": 5.204916000366211,
    "input_sql_tokens": 75,
    "estimated_tokens": 157,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT m.molecule_id AS ID, COUNT(a.atom_id) AS QTY, COUNT(b.bond_id) AS VALUE FROM molecule m LEFT JOIN atom a ON m.molecule_id = a.molecule_id LEFT JOIN bond b ON m.molecule_id = b.molecule_id GROUP BY m.molecule_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.092,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 449,
    "db_id": "toxicology",
    "sql_snippet": "WITH RECURSIVE molecule_atoms_recursive AS (\n  SEL...",
    "valid": true,
    "error": null,
    "duration_ms": 5.143880844116211,
    "input_sql_tokens": 127,
    "estimated_tokens": 247,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE molecule_atoms_recursive AS (\n  SELECT \"molecule_id\", 1 AS atom_number, atom_count\n  FROM (\n    SELECT \"molecule_id\", COUNT(\"atom_id\") AS atom_count\n    FROM \"atom\"\n    GROUP BY \"molecule_id\"\n  ) base\n  UNION ALL\n  SELECT mar.\"molecule_id\", mar.atom_number + 1, mar.atom_count\n  FROM molecule_atoms_recursive mar\n\n)\nSELECT \"molecule_id\", atom_number\nFROM molecule_atoms_recursive;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14600000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-GROUP-UNION-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 450,
    "db_id": "toxicology",
    "sql_snippet": "WITH RECURSIVE replacements (molecule_id, current_...",
    "valid": false,
    "error": "Unbalanced parentheses or brackets",
    "duration_ms": 11.342048645019531,
    "input_sql_tokens": 153,
    "estimated_tokens": 237,
    "error_tokens": 6,
    "invalid_sql_tokens": 153,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unbalanced_tokens",
          "message": "Unbalanced parentheses or brackets",
          "location": null,
          "context": "1 unclosed '('",
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "WITH RECURSIVE replacements (molecule_id, current_label, current_spos) AS (\n  SELECT molecule_id,\n         label::text,\n         strpos(label::text, '+')\n  FROM molecule\n  UNION ALL\n  SELECT r.molecule_id,\n         overlay(r.current_label placing '-' from r.current_spos for 1),\n         strpos(overlay(r.current_label placing '-' from r.current_spos for 1), '+')\n  FROM replacements r\n  WHERE r.current_spos > 0\nSELECT molecule_id,\n       current_label AS label\nFROM replacements\n\nWHERE current_spos = 0;",
      "tags": [
        "syntax_unbalanced_tokens"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 451,
    "db_id": "california_schools",
    "sql_snippet": "SELECT s.\"cds\",\n       s.\"sname\"::text,\n       (SE...",
    "valid": true,
    "error": null,
    "duration_ms": 9.728193283081055,
    "input_sql_tokens": 175,
    "estimated_tokens": 281,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT s.\"cds\",\n       s.\"sname\"::text,\n       (SELECT json_agg(json_build_object(\n         'enroll12', t.\"enroll12\"::text,\n         'NumTstTakr', t.\"numtsttakr\"::text,\n         'AvgScrRead', t.\"avgscrread\"::text,\n         'AvgScrMath', t.\"avgscrmath\"::text,\n         'AvgScrWrite', t.\"avgscrwrite\"::text\n         ) ORDER BY t.\"enroll12\" DESC)\n\n       WHERE t.\"rtype\"::text = 'S'\n       AND t.\"cds\" = s.\"cds\"\n       )\nFROM \"satscores\" s\nWHERE s.\"rtype\"::text = 'S';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11600000000000002,
        "pattern_signature": "SELECT-FROM-WHERE-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 452,
    "db_id": "european_football_2",
    "sql_snippet": "WITH RECURSIVE Match_Recursive AS (\n  SELECT id, c...",
    "valid": true,
    "error": null,
    "duration_ms": 10.238409042358398,
    "input_sql_tokens": 234,
    "estimated_tokens": 361,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE Match_Recursive AS (\n  SELECT id, country_id, date, home_team_goal, away_team_goal, 1 as lvl\n  FROM match\n  UNION ALL\n  SELECT m.id, m.country_id, m.date, m.home_team_goal, m.away_team_goal, mr.lvl + 1\n  FROM match m\n  JOIN Match_Recursive mr ON m.country_id = mr.country_id\n  WHERE mr.lvl < 2\n)\nSELECT\n  json_build_object(\n    'country_id' || mr.country_id,\n    json_agg(\n      json_build_object(\n        'date', mr.date,\n        'home_team_goal', mr.home_team_goal,\n        'away_team_goal', mr.away_team_goal\n      ) ORDER BY mr.date::date\n    )\n  ) AS \"JSON\"\nFROM Match_Recursive mr\nGROUP BY mr.country_id;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10200000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-UNION-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 453,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT M.\"id\", MAX(M.\"date\"), M.\"overall_rating\" F...",
    "valid": true,
    "error": null,
    "duration_ms": 4.194974899291992,
    "input_sql_tokens": 42,
    "estimated_tokens": 137,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT M.\"id\", MAX(M.\"date\"), M.\"overall_rating\" FROM player_rate AS M GROUP BY M.\"id\", MAX(M.\"date\"), M.\"overall_rating\"",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.022000000000000002,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 454,
    "db_id": "student_club",
    "sql_snippet": "SELECT guid FROM login WHERE (login, name) IN (SEL...",
    "valid": true,
    "error": null,
    "duration_ms": 4.381418228149414,
    "input_sql_tokens": 43,
    "estimated_tokens": 151,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT guid FROM login WHERE (login, name) IN (SELECT login, name FROM login GROUP BY login, name HAVING COUNT(*) > 1) AND NOT guid IN (SELECT room_guid FROM groups)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.15800000000000003,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP-HAVING-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 455,
    "db_id": "california_schools",
    "sql_snippet": "select \"element\", \"record\"\n    from \"frpm_record\"\n...",
    "valid": true,
    "error": null,
    "duration_ms": 8.947372436523438,
    "input_sql_tokens": 133,
    "estimated_tokens": 236,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "select \"element\", \"record\"\n    from \"frpm_record\"\n    union all\n\n    select\n        substring(\"element\", 1, position('_' in \"element\") - 1) ||'_rate' as element,\n        max(case when substring(\"element\", -1) = '2' then \"record\" end) /\n        max(case when substring(\"element\", -1) = '1' then \"record\" end) as \"record\"\n    from \"frpm_record\"\n    group by substring(\"element\", 1, position('_' in \"element\") - 1)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.022000000000000002,
        "pattern_signature": "SELECT-FROM-GROUP-UNION",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT",
          "UNION"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 456,
    "db_id": "student_club",
    "sql_snippet": "WITH member_data AS (\n    SELECT\n        member_id...",
    "valid": true,
    "error": null,
    "duration_ms": 17.063379287719727,
    "input_sql_tokens": 380,
    "estimated_tokens": 520,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH member_data AS (\n    SELECT\n        member_id,\n        member_name,\n        ROW_NUMBER() OVER (PARTITION BY member_id ORDER BY member_name) AS rn\n    FROM \"member_trunc\"\n),\ntokenized_members AS (\n    SELECT\n        a.\"link_to_event\",\n        generate_series(1, length(a.\"link_to_member\") - length(replace(a.\"link_to_member\", '|', '')) + 1) AS position,\n        split_part(a.\"link_to_member\", '|', generate_series(1, length(a.\"link_to_member\") - length(replace(a.\"link_to_member\", '|', '')) + 1)) AS member_token\n    FROM \"attendance_trunc\" a\n    WHERE a.\"link_to_member\" IS NOT NULL\n),\nmember_names AS (\n    SELECT\n        tm.\"link_to_event\",\n        tm.position,\n        COALESCE(md.member_name, 'Unknown Member') AS member_name\n    FROM tokenized_members tm\n    LEFT JOIN member_data md ON (tm.member_token = md.member_id AND md.rn = 1)\n)\nSELECT\n    mn.\"link_to_event\",\n    string_agg(mn.member_name, '|' ORDER BY CASE\n                    WHEN mn.position IS NULL THEN 9999\n                    ELSE mn.position\n                 END) AS replaced_members\nFROM member_names mn\nGROUP BY mn.\"link_to_event\"\nHAVING COUNT(DISTINCT mn.position) > 0\nORDER BY mn.\"link_to_event\"",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.15500000000000003,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-HAVING-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 457,
    "db_id": "toxicology",
    "sql_snippet": "SELECT a.atom_id, COUNT(c.atom_id2) as connection_...",
    "valid": true,
    "error": null,
    "duration_ms": 5.600690841674805,
    "input_sql_tokens": 70,
    "estimated_tokens": 176,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT a.atom_id, COUNT(c.atom_id2) as connection_count FROM atom a LEFT JOIN connected c ON a.atom_id = c.atom_id WHERE a.atom_id IN (SELECT atom_id FROM test WHERE atom_id LIKE 'TR%') GROUP BY a.atom_id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.15100000000000002,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "SUBQUERY",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 458,
    "db_id": "toxicology",
    "sql_snippet": "SELECT EXTRACT(YEAR FROM bl.transact_dt_tm) as yea...",
    "valid": true,
    "error": null,
    "duration_ms": 4.043817520141602,
    "input_sql_tokens": 82,
    "estimated_tokens": 183,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT EXTRACT(YEAR FROM bl.transact_dt_tm) as year, bl.bond_type, COUNT(*) as bond_count FROM bond_list bl RIGHT JOIN bond_ref br ON bl.bond_type = br.bond_type GROUP BY EXTRACT(YEAR FROM bl.transact_dt_tm), bl.bond_type ORDER BY year, br.bond_seq",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.051000000000000004,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-ORDER",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 459,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT header || ': ' || name AS grouped_countries...",
    "valid": true,
    "error": null,
    "duration_ms": 4.700422286987305,
    "input_sql_tokens": 67,
    "estimated_tokens": 177,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT header || ': ' || name AS grouped_countries\nFROM (\n    SELECT\n        MAX(CASE WHEN name LIKE 'Country Group%' THEN name END)\n        OVER (ORDER BY id) AS header,\n        id,\n        name\n    FROM country\n)\nWHERE name NOT LIKE 'Country Group%'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09900000000000003,
        "pattern_signature": "SELECT-FROM-WHERE-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 460,
    "db_id": "toxicology",
    "sql_snippet": "CREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";UPDATE ...",
    "valid": true,
    "error": null,
    "duration_ms": 3.290414810180664,
    "input_sql_tokens": 35,
    "estimated_tokens": 103,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";UPDATE record SET r1 = uuid_generate_v4(), r2 = uuid_generate_v4();",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 461,
    "db_id": "student_club",
    "sql_snippet": "CREATE EXTENSION IF NOT EXISTS pgcrypto;\nSELECT di...",
    "valid": true,
    "error": null,
    "duration_ms": 3.2782554626464844,
    "input_sql_tokens": 52,
    "estimated_tokens": 120,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE EXTENSION IF NOT EXISTS pgcrypto;\nSELECT digest(product_id::bytea, 'sha1') AS hash_value, length(digest(product_id::bytea, 'sha1')) AS hash_length\nFROM products;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 462,
    "db_id": "toxicology",
    "sql_snippet": "CREATE OR REPLACE FUNCTION FIND_TEST_TABLE_COLUMN(...",
    "valid": true,
    "error": null,
    "duration_ms": 5.907297134399414,
    "input_sql_tokens": 390,
    "estimated_tokens": 491,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION FIND_TEST_TABLE_COLUMN(\n    IN_COLUMN1 VARCHAR,\n    IN_COLUMN2 VARCHAR,\n    IN_COLUMN3 VARCHAR,\n    IN_COLUMN4 VARCHAR,\n    IN_REQUESTED_COLUMN VARCHAR\n) RETURNS VARCHAR AS $$\nDECLARE\n    C_TEST_TABLE REFCURSOR;\n    C_TEST_TABLE_REC RECORD;\n    RESULT VARCHAR(255);\n    query TEXT;\nBEGIN\n    query := 'SELECT * FROM test_table WHERE column1 = $1 AND column2 = $2 AND column3 = $3';\n    IF IN_COLUMN4 IS NULL THEN\n         query := query || ';';\n         OPEN C_TEST_TABLE FOR EXECUTE query USING IN_COLUMN1, IN_COLUMN2, IN_COLUMN3;\n    ELSE\n         query := query || ' AND column4 = $4;';\n         OPEN C_TEST_TABLE FOR EXECUTE query USING IN_COLUMN1, IN_COLUMN2, IN_COLUMN3, IN_COLUMN4;\n    END IF;\n\n    LOOP\n        FETCH C_TEST_TABLE INTO C_TEST_TABLE_REC;\n        EXIT WHEN NOT FOUND;\n\n        IF IN_REQUESTED_COLUMN = 'COLUMN1' THEN\n            RESULT := C_TEST_TABLE.column1;\n            EXIT;\n        ELSIF IN_REQUESTED_COLUMN = 'COLUMN2' THEN\n            RESULT := C_TEST_TABLE.column2;\n            EXIT;\n        ELSIF IN_REQUESTED_COLUMN = 'COLUMN3' THEN\n            RESULT := C_TEST_TABLE.column3;\n            EXIT;\n        END IF;\n    END LOOP;\n    CLOSE C_TEST_TABLE;\n    RETURN RESULT;\nEND;\n$$ LANGUAGE plpgsql;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 463,
    "db_id": "student_club",
    "sql_snippet": "CREATE EXTENSION IF NOT EXISTS pgcrypto;\nSELECT di...",
    "valid": true,
    "error": null,
    "duration_ms": 4.140138626098633,
    "input_sql_tokens": 52,
    "estimated_tokens": 120,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE EXTENSION IF NOT EXISTS pgcrypto;\nSELECT digest(product_id::bytea, 'sha1') AS hash_value, length(digest(product_id::bytea, 'sha1')) AS hash_length\nFROM products;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 464,
    "db_id": "student_club",
    "sql_snippet": "SELECT event_id, notes, CASE WHEN notes IS NULL TH...",
    "valid": true,
    "error": null,
    "duration_ms": 4.794597625732422,
    "input_sql_tokens": 47,
    "estimated_tokens": 129,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT event_id, notes, CASE WHEN notes IS NULL THEN LEAD(notes) OVER (ORDER BY event_id ASC NULLS FIRST) ELSE notes END AS imputed_notes FROM event ORDER BY event_id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 465,
    "db_id": "student_club",
    "sql_snippet": "WITH MemberEventDates AS (SELECT a.link_to_member,...",
    "valid": true,
    "error": null,
    "duration_ms": 14.361143112182617,
    "input_sql_tokens": 280,
    "estimated_tokens": 396,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH MemberEventDates AS (SELECT a.link_to_member, TO_TIMESTAMP(e.event_date, 'YYYY-MM-DD HH24:MI:SS') AS event_date, DENSE_RANK() OVER (PARTITION BY a.link_to_member ORDER BY TO_TIMESTAMP(e.event_date, 'YYYY-MM-DD HH24:MI:SS') DESC NULLS LAST) AS date_rank FROM attendance AS a LEFT JOIN event AS e ON a.link_to_event = e.event_id WHERE e.status = 'Open' OR e.status IS NULL), LatestEvents AS (SELECT link_to_member, MAX(CASE WHEN date_rank = 1 THEN event_date END) AS Latest_Event_Date FROM membereventdates GROUP BY link_to_member) SELECT m.first_name || ' ' || m.last_name AS member_name, le.link_to_member, TO_CHAR(le.Latest_Event_Date, 'YYYY-MM-DD') AS Latest_Event_Date FROM latestevents AS le RIGHT JOIN member AS m ON le.link_to_member = m.member_id WHERE m.position <> 'Alumni' ORDER BY le.Latest_Event_Date DESC NULLS LAST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.18000000000000005,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 466,
    "db_id": "financial",
    "sql_snippet": "SELECT trans_id, account_id, date, CASE WHEN CAST(...",
    "valid": true,
    "error": null,
    "duration_ms": 5.151033401489258,
    "input_sql_tokens": 100,
    "estimated_tokens": 186,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT trans_id, account_id, date, CASE WHEN CAST(EXTRACT(epoch FROM CAST(CAST(date AS TIMESTAMP) AS TIMESTAMP) - CAST(CAST(MIN(date) OVER (PARTITION BY account_id) AS TIMESTAMP) AS TIMESTAMP)) / 86400 AS BIGINT) <= 30 THEN 'Followup' ELSE 'New' END AS Category FROM trans ORDER BY trans_id NULLS FIRST LIMIT 10",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "LIMIT",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 467,
    "db_id": "student_club",
    "sql_snippet": "WITH cte AS (SELECT *, ROW_NUMBER() OVER (PARTITIO...",
    "valid": true,
    "error": null,
    "duration_ms": 7.698774337768555,
    "input_sql_tokens": 169,
    "estimated_tokens": 267,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH cte AS (SELECT *, ROW_NUMBER() OVER (PARTITION BY m1.member_id, m2.member_id ORDER BY e.event_date DESC NULLS LAST) AS rn FROM attendance AS a1 JOIN attendance AS a2 ON a1.link_to_event = a2.link_to_event AND a1.link_to_member < a2.link_to_member JOIN member AS m1 ON a1.link_to_member = m1.member_id JOIN member AS m2 ON a2.link_to_member = m2.member_id JOIN event AS e ON a1.link_to_event = e.event_id) SELECT * FROM cte WHERE rn = 1 ORDER BY event_date NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.201,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 4,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 468,
    "db_id": "card_games",
    "sql_snippet": "WITH CardLegalities AS (\n    SELECT C.uuid, COUNT(...",
    "valid": true,
    "error": null,
    "duration_ms": 11.510848999023438,
    "input_sql_tokens": 173,
    "estimated_tokens": 310,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH CardLegalities AS (\n    SELECT C.uuid, COUNT(L.id) AS LegalityCount, STRING_AGG(L.format, ', ' ORDER BY L.format NULLS FIRST) AS Formats\n    FROM cards AS C\n    LEFT JOIN legalities AS L ON L.uuid = C.uuid\n    GROUP BY C.uuid\n),\nCardDetails AS (\n    SELECT C.name, C.manacost, CL.LegalityCount, CL.Formats\n    FROM cards AS C\n    INNER JOIN cardlegalities AS CL ON CL.uuid = C.uuid\n)\nSELECT name, manacost\nFROM carddetails\nWHERE LegalityCount > 0 AND NOT Formats LIKE '%commander%'\nEXCEPT\nSELECT name, manacost\nFROM carddetails\nWHERE LegalityCount = 0",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.17000000000000004,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-EXCEPT-ORDER",
        "clauses_present": [
          "CTE",
          "EXCEPT",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 469,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT ROW_NUMBER() OVER (ORDER BY T.transactionid...",
    "valid": true,
    "error": null,
    "duration_ms": 6.608247756958008,
    "input_sql_tokens": 98,
    "estimated_tokens": 184,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT ROW_NUMBER() OVER (ORDER BY T.transactionid NULLS FIRST) AS Row, CAST(EXTRACT(epoch FROM CAST(CAST(LEAD(T.date, 1, 0) OVER (ORDER BY T.date NULLS FIRST) AS TIMESTAMP) AS TIMESTAMP) - CAST(CAST(T.date AS TIMESTAMP) AS TIMESTAMP)) AS BIGINT) AS TimeDifference FROM transactions_1k AS T LIMIT 100",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "LIMIT",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 470,
    "db_id": "financial",
    "sql_snippet": "WITH CardIssuanceDays AS ( SELECT c.card_id, c.iss...",
    "valid": true,
    "error": null,
    "duration_ms": 17.719268798828125,
    "input_sql_tokens": 354,
    "estimated_tokens": 484,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH CardIssuanceDays AS ( SELECT c.card_id, c.issued, TO_CHAR(CAST(CAST(TO_CHAR(c.issued, 'MM/DD/YYYY') AS VARCHAR(10)) AS TIMESTAMP), 'TMDay') AS day_of_week  , ROW_NUMBER() OVER (PARTITION BY TO_CHAR(CAST(c.issued AS TIMESTAMP), '%W') ORDER BY c.issued NULLS FIRST) AS rank_in_day   FROM card AS c   INNER JOIN disp AS d ON c.disp_id = d.disp_id AND d.type = 'OWNER'   WHERE c.issued BETWEEN CURRENT_TIMESTAMP + INTERVAL '-5 YEAR' AND 0 + INTERVAL MONTH + INTERVAL '-1 DAY'), WeekdayReference  AS (SELECT 0 AS day_num, 'Sunday' AS day_name UNION ALL SELECT 1, 'Monday' UNION ALL SELECT 2, 'Tuesday' UNION ALL SELECT 3, 'Wednesday' UNION ALL SELECT 4, 'Thursday' UNION ALL SELECT 5, 'Friday' UNION ALL SELECT 6, 'Saturday') SELECT c.card_id, TO_CHAR(c.issued, 'YYYY-MM-DD') AS issuance_date  , wr.day_name AS day_of_week FROM cardissuancedays AS c   LEFT JOIN weekdayreference AS wr ON wr.day_name = c.day_of_week   WHERE c.rank_in_day <= 5 AND NOT c.day_of_week IN (SELECT day_name FROM weekdayreference WHERE day_num IN (0, 6)) ORDER BY issuance_date   NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.20700000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-WINDOW-UNION-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 1,
        "num_ctes": 2,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 471,
    "db_id": "superhero",
    "sql_snippet": "SELECT full_name, STRPOS(SUBSTR(full_name, 2), ' '...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0002593994140625,
    "input_sql_tokens": 29,
    "estimated_tokens": 118,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT full_name, STRPOS(SUBSTR(full_name, 2), ' ') + 2 - 1 FROM superhero",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 472,
    "db_id": "financial",
    "sql_snippet": "SELECT date, account_id, CASE WHEN EXISTS(type = '...",
    "valid": true,
    "error": null,
    "duration_ms": 2.99072265625,
    "input_sql_tokens": 48,
    "estimated_tokens": 141,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT date, account_id, CASE WHEN EXISTS(type = 'PRIJEM' AND 'VYDAJ' AND 'SLUZBY') THEN 1 ELSE 0 END FROM trans GROUP BY \"date\", account_id",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.030000000000000006,
        "pattern_signature": "SELECT-FROM-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 473,
    "db_id": "financial",
    "sql_snippet": "WITH ClientAccountSummary AS (\n    SELECT\n        ...",
    "valid": true,
    "error": null,
    "duration_ms": 19.554853439331055,
    "input_sql_tokens": 384,
    "estimated_tokens": 535,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH ClientAccountSummary AS (\n    SELECT\n        cl.client_id,\n        cl.gender,\n        cl.birth_date,\n        d.account_id,\n        d.type,\n        ROW_NUMBER() OVER (PARTITION BY cl.client_id ORDER BY d.account_id DESC NULLS LAST) AS account_rank\n    FROM\n        client AS cl\n    LEFT JOIN\n        disp AS d ON d.client_id = cl.client_id\n    WHERE\n        d.type = 'OWNER' OR d.type IS NULL\n),\nBabyBoomerFlag AS (\n    SELECT\n        client_id,\n        gender,\n        CASE\n            WHEN TO_CHAR(CAST(birth_date AS TIMESTAMP), 'YYYY') BETWEEN '1948' AND '1960' THEN 'Yes'\n            ELSE 'No'\n        END AS is_baby_boomer\n    FROM\n        client\n)\nSELECT\n    c.client_id,\n    c.gender,\n    b.is_baby_boomer AS age_old,\n    CASE\n        WHEN c.type = 'OWNER' THEN c.account_id\n        ELSE NULL\n    END AS last_account\nFROM\n    clientaccountsummary AS c\nJOIN\n    babyboomerflag AS b ON b.client_id = c.client_id\nWHERE\n    c.account_rank = 1 OR c.account_rank IS NULL\nGROUP BY\n    c.client_id, c.gender, b.is_baby_boomer, c.type, c.account_id\nHAVING\n    COUNT(c.account_id) <= 1\nORDER BY\n    c.client_id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.18100000000000005,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-HAVING-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 474,
    "db_id": "student_club",
    "sql_snippet": "SELECT event.event_id, event.event_name, STRING_AG...",
    "valid": true,
    "error": null,
    "duration_ms": 5.539417266845703,
    "input_sql_tokens": 116,
    "estimated_tokens": 216,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT event.event_id, event.event_name, STRING_AGG(attendance.link_to_member, ';') AS attendances, STRING_AGG(budget.category, ';') AS budget_category FROM event LEFT JOIN attendance ON event.event_id = attendance.link_to_event LEFT JOIN budget ON event.event_id = budget.link_to_event WHERE event.event_id = 'reczhS8wix6Kzbp9P' GROUP BY event.event_id, event.event_name",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09899999999999999,
        "pattern_signature": "SELECT-FROM-JOIN-WHERE-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 475,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT \"customerid\", \"date\", \"productid\", \"amount\"...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 2, Col: 36.\n  T \"customerid\", \"date\", \"productid\", \"amount\" FROM \"transactions_1k\"\nWHERE (\"productid\" IN (2,5,9)) \u001b[4mPIVOT\u001b[0m(COUNT(\"amount\") FOR productid IN (2, 5, 9)) AS pivot_table;",
    "duration_ms": 4.647016525268555,
    "input_sql_tokens": 63,
    "estimated_tokens": 229,
    "error_tokens": 90,
    "invalid_sql_tokens": 63,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 2, Col: 36.\n  T \"customerid\", \"date\", \"productid\", \"amount\" FROM \"transactions_1k\"\nWHERE (\"productid\" IN (2,5,9)) \u001b[4mPIVOT\u001b[0m(COUNT(\"amount\") FOR productid IN (2, 5, 9)) AS pivot_table;",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT \"customerid\", \"date\", \"productid\", \"amount\" FROM \"transactions_1k\"\nWHERE (\"productid\" IN (2,5,9)) PIVOT(COUNT(\"amount\") FOR productid IN (2, 5, 9)) AS pivot_table;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 476,
    "db_id": "student_club",
    "sql_snippet": "WITH BudgetCategories AS (SELECT budget_id, catego...",
    "valid": true,
    "error": null,
    "duration_ms": 10.017156600952148,
    "input_sql_tokens": 211,
    "estimated_tokens": 323,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH BudgetCategories AS (SELECT budget_id, category, spent, remaining, amount, event_status, link_to_event, DENSE_RANK() OVER (PARTITION BY link_to_event ORDER BY category NULLS FIRST) AS category_rank FROM budget WHERE link_to_event = 'recggMW2eyCYceNcy'), CategoryRanges AS (SELECT 'Food' AS min_category, 'Speaker Gifts' AS max_category, (SELECT category_rank FROM budgetcategories WHERE category = 'Food' AND link_to_event = 'recggMW2eyCYceNcy') AS min_rank, (SELECT category_rank FROM budgetcategories WHERE category = 'Speaker Gifts' AND link_to_event = 'recggMW2eyCYceNcy') AS max_rank) SELECT b.* FROM budgetcategories AS b CROSS JOIN categoryranges AS cr WHERE b.category_rank BETWEEN cr.min_rank AND cr.max_rank ORDER BY b.category NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.261,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_CROSS-WHERE-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 2,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 477,
    "db_id": "superhero",
    "sql_snippet": "SELECT ???, s.superhero_name, p.publisher_name FRO...",
    "valid": false,
    "error": "Required keyword: 'this' missing for <class 'sqlglot.expressions.Coalesce'>. Line 1, Col: 11.\n  SELECT ???\u001b[4m,\u001b[0m s.superhero_name, p.publisher_name FROM superhero s JOIN publisher p ON s.publisher_id = p.id WHERE",
    "duration_ms": 2.638101577758789,
    "input_sql_tokens": 46,
    "estimated_tokens": 195,
    "error_tokens": 75,
    "invalid_sql_tokens": 46,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "Required keyword: 'this' missing for <class 'sqlglot.expressions.Coalesce'>. Line 1, Col: 11.\n  SELECT ???\u001b[4m,\u001b[0m s.superhero_name, p.publisher_name FROM superhero s JOIN publisher p ON s.publisher_id = p.id WHERE",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT ???, s.superhero_name, p.publisher_name FROM superhero s JOIN publisher p ON s.publisher_id = p.id WHERE s.id IN (1, 2, 3)",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 478,
    "db_id": "formula_1",
    "sql_snippet": "WITH CircuitFilters AS (SELECT c.circuitid, CASE W...",
    "valid": true,
    "error": null,
    "duration_ms": 12.24207878112793,
    "input_sql_tokens": 156,
    "estimated_tokens": 278,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH CircuitFilters AS (SELECT c.circuitid, CASE WHEN c.country LIKE 'M%' THEN 1 ELSE 0 END AS IsCountryStartingWithM, CASE WHEN c.name LIKE '%International%' THEN 1 ELSE 0 END AS HasInternationalInName FROM circuits AS c) SELECT r.raceid FROM races AS r INNER JOIN circuitfilters AS cf ON cf.circuitid = r.circuitid WHERE cf.IsCountryStartingWithM = 1 EXCEPT SELECT r.raceid FROM races AS r INNER JOIN circuits AS c ON c.circuitid = r.circuitid WHERE c.name LIKE '%International%' HAVING COUNT(DISTINCT c.country LIKE 'M%') > 0",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.15100000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-HAVING-EXCEPT",
        "clauses_present": [
          "CTE",
          "EXCEPT",
          "FROM",
          "HAVING",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 479,
    "db_id": "card_games",
    "sql_snippet": "SELECT name, COUNT(printings) AS Prints FROM cards...",
    "valid": true,
    "error": null,
    "duration_ms": 3.4818649291992188,
    "input_sql_tokens": 26,
    "estimated_tokens": 112,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT name, COUNT(printings) AS Prints FROM cards GROUP BY name ORDER BY Prints DESC NULLS LAST LIMIT 3",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-GROUP-ORDER-LIMIT",
        "clauses_present": [
          "FROM",
          "GROUP",
          "LIMIT",
          "ORDER",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 480,
    "db_id": "toxicology",
    "sql_snippet": "SELECT atom_id FROM ( SELECT CASE WHEN element = '...",
    "valid": false,
    "error": "Expected END after CASE. Line 4, Col: 82.\n  _id) != 'c' THEN atom_id\nWHEN element = 'cl' AND lead(element) OVER (ORDER BY atom_id) IS NULL THEN \u001b[4matom_id\u001b[0m, ROW_NUMBER()\nOVER (ORDER BY atom_id) AS row_num ) AS tmp5 WHERE atom_id IS NOT NULL;",
    "duration_ms": 15.413761138916016,
    "input_sql_tokens": 144,
    "estimated_tokens": 316,
    "error_tokens": 94,
    "invalid_sql_tokens": 144,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "Expected END after CASE. Line 4, Col: 82.\n  _id) != 'c' THEN atom_id\nWHEN element = 'cl' AND lead(element) OVER (ORDER BY atom_id) IS NULL THEN \u001b[4matom_id\u001b[0m, ROW_NUMBER()\nOVER (ORDER BY atom_id) AS row_num ) AS tmp5 WHERE atom_id IS NOT NULL;",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT atom_id FROM ( SELECT CASE WHEN element = 'cl' AND lead(element) OVER\n(ORDER BY atom_id) = 'c' THEN REPLACE(CONCAT(atom_id, lead(atom_id) OVER (ORDER BY atom_id)), ' ', '')\nWHEN element = 'cl' AND lead(element) OVER (ORDER BY atom_id) != 'c' THEN atom_id\nWHEN element = 'cl' AND lead(element) OVER (ORDER BY atom_id) IS NULL THEN atom_id, ROW_NUMBER()\nOVER (ORDER BY atom_id) AS row_num ) AS tmp5 WHERE atom_id IS NOT NULL;",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 481,
    "db_id": "formula_1",
    "sql_snippet": "WITH RaceResults AS (SELECT r.raceId, r.name AS ra...",
    "valid": true,
    "error": null,
    "duration_ms": 22.70650863647461,
    "input_sql_tokens": 386,
    "estimated_tokens": 516,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RaceResults AS (SELECT r.raceId, r.name AS raceName, c.name AS circuitName, d.forename || ' ' || d.surname AS driverName, DENSE_RANK() OVER (PARTITION BY r.year ORDER BY res.points DESC NULLS LAST) AS seasonRanking, res.driverId, res.constructorId, res.position AS finishPosition, res.points, ROW_NUMBER() OVER (PARTITION BY r.raceId, res.constructorId ORDER BY res.points DESC NULLS LAST) AS constructorDriverRank FROM races AS r INNER JOIN circuits AS c ON r.circuitId = c.circuitId INNER JOIN results AS res ON r.raceId = res.raceId INNER JOIN drivers AS d ON res.driverId = d.driverId WHERE NOT res.position IS NULL), ConstructorPerformance AS (SELECT constructorId, AVG(CAST(points AS REAL)) AS avgPoints, COUNT(DISTINCT raceId) AS raceCount FROM results GROUP BY constructorId HAVING COUNT(DISTINCT raceId) > 5) SELECT rr.raceId, rr.raceName, rr.circuitName, d.forename AS driverForename, d.surname AS driverSurname, co.name AS constructorName, rr.finishPosition, rr.points, rr.seasonRanking, cp.avgPoints AS constructorAvgPoints, CASE WHEN rr.constructorDriverRank = 1 THEN 'Primary' ELSE 'Secondary' END AS driverStatus FROM raceresults AS rr INNER JOIN drivers AS d ON rr.driverId = d.driverId LEFT JOIN constructors AS co ON co.constructorId = rr.constructorId LEFT JOIN constructorperformance AS cp ON cp.constructorId = co.constructorId WHERE rr.constructorDriverRank <= 2 ORDER BY rr.raceId NULLS FIRST, rr.finishPosition NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.30900000000000005,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-HAVING-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 6,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 482,
    "db_id": "toxicology",
    "sql_snippet": "SELECT a1.atom_id AS atom_id1, a2.atom_id AS atom_...",
    "valid": true,
    "error": null,
    "duration_ms": 4.615306854248047,
    "input_sql_tokens": 118,
    "estimated_tokens": 212,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT a1.atom_id AS atom_id1, a2.atom_id AS atom_id2, b.bond_id, b.bond_type FROM atom AS a1 CROSS JOIN atom AS a2 LEFT JOIN connected AS c ON a1.atom_id = c.atom_id LEFT JOIN bond AS b ON c.bond_id = b.bond_id WHERE a1.molecule_id = a2.molecule_id ORDER BY a1.atom_id NULLS FIRST, a2.atom_id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.112,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_CROSS-WHERE-ORDER",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "ORDER",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 3,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 483,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT ID, DATE, GOT, LAST_VALUE(GOT) OVER (PARTIT...",
    "valid": true,
    "error": null,
    "duration_ms": 2.7468204498291016,
    "input_sql_tokens": 32,
    "estimated_tokens": 114,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT ID, DATE, GOT, LAST_VALUE(GOT) OVER (PARTITION BY ID ORDER BY DATE NULLS FIRST) AS NEW_GOT FROM laboratory",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.016,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 484,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH PatientExamData AS (SELECT P.ID AS PATIENTID,...",
    "valid": true,
    "error": null,
    "duration_ms": 21.604299545288086,
    "input_sql_tokens": 424,
    "estimated_tokens": 534,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH PatientExamData AS (SELECT P.ID AS PATIENTID, P.SEX, P.BIRTHDAY, E.\"Examination Date\", E.DIAGNOSIS, E.THROMBOSIS, ROW_NUMBER() OVER (PARTITION BY P.ID ORDER BY E.\"Examination Date\" NULLS FIRST) AS ExamRank FROM patient AS P LEFT JOIN examination AS E ON P.ID = E.ID), LatestLabResults AS (SELECT L.ID, L.PLT, L.WBC, ROW_NUMBER() OVER (PARTITION BY L.ID ORDER BY L.\"date\" DESC NULLS LAST) AS LabRank FROM laboratory AS L WHERE L.\"date\" <= CURRENT_TIMESTAMP), PatientRiskProfile AS (SELECT PED.PATIENTID, PED.SEX, PED.BIRTHDAY, PED.\"Examination Date\", PED.DIAGNOSIS, PED.THROMBOSIS, CASE WHEN LLR.PLT < 150 OR LLR.WBC > 11 THEN 'High' WHEN PED.THROMBOSIS IS NULL THEN 'Unknown' ELSE 'Normal' END AS RiskCategory FROM patientexamdata AS PED LEFT JOIN latestlabresults AS LLR ON PED.PATIENTID = LLR.ID AND LLR.LabRank = 1) SELECT PATIENTID, SEX, BIRTHDAY, COUNT(\"Examination Date\") AS EXAMINATIONCOUNT, SUM(CASE WHEN THROMBOSIS = 1 THEN 1 ELSE 0 END) AS THROMBOSISCOUNT, SUM(CASE WHEN THROMBOSIS = 0 THEN 1 ELSE 0 END) AS NOTHROMBOSISCOUNT, MAX(CASE WHEN RiskCategory = 'High' THEN 1 ELSE 0 END) AS HighRiskFlag FROM patientriskprofile WHERE RiskCategory <> 'Unknown' OR THROMBOSIS IN (0, 1) GROUP BY PATIENTID, SEX, BIRTHDAY HAVING COUNT(\"Examination Date\") > 0 ORDER BY SUM(CASE WHEN THROMBOSIS = 1 THEN 1 ELSE 0 END) DESC NULLS LAST, PATIENTID NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.241,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-HAVING-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 6
      }
    }
  },
  {
    "query_idx": 485,
    "db_id": "california_schools",
    "sql_snippet": "WITH data AS (SELECT county, cdscode, ROW_NUMBER()...",
    "valid": true,
    "error": null,
    "duration_ms": 14.299154281616211,
    "input_sql_tokens": 312,
    "estimated_tokens": 424,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH data AS (SELECT county, cdscode, ROW_NUMBER() OVER (PARTITION BY county ORDER BY cdscode ASC NULLS FIRST) AS rnk, DENSE_RANK() OVER (PARTITION BY county ORDER BY cdscode ASC NULLS FIRST) AS dense_rnk FROM schools), county_pairs AS (SELECT a.cdscode AS cdscode1, a.county AS county1, b.cdscode AS cdscode2, b.county AS county2, a.rnk AS rnk1, b.rnk AS rnk2, a.dense_rnk AS dense_rnk1, b.dense_rnk AS dense_rnk2 FROM data AS a LEFT JOIN data AS b ON a.county = b.county AND b.dense_rnk = a.dense_rnk + 1 WHERE a.rnk % 2 = 1), filtered_pairs AS (SELECT cp.*, CASE WHEN cp.cdscode1 < cp.cdscode2 THEN 'Ascending' WHEN cp.cdscode1 > cp.cdscode2 THEN 'Descending' ELSE 'Equal' END AS comparison_result FROM county_pairs AS cp WHERE NOT cp.rnk2 IS NULL AND cp.rnk2 - cp.rnk1 <= 2) SELECT cdscode1, county1, cdscode2, county2, comparison_result FROM filtered_pairs WHERE comparison_result <> 'Equal' ORDER BY county1 NULLS FIRST, rnk1 NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.15600000000000003,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 486,
    "db_id": "toxicology",
    "sql_snippet": "WITH MoleculeAtomCounts AS (SELECT molecule_id, CO...",
    "valid": true,
    "error": null,
    "duration_ms": 23.51212501525879,
    "input_sql_tokens": 521,
    "estimated_tokens": 627,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH MoleculeAtomCounts AS (SELECT molecule_id, COUNT(*) AS atom_count FROM atom GROUP BY molecule_id), BondDetails AS (SELECT b.bond_id, b.molecule_id, b.bond_type, SUBSTRING(b.bond_id FROM 1 FOR POSITION('_' IN b.bond_id) - 1) AS derived_molecule_id, SUBSTRING(b.bond_id FROM POSITION('_' IN b.bond_id) + 1 FOR POSITION('_' IN SUBSTRING(b.bond_id FROM POSITION('_' IN b.bond_id) + 1)) - 1) AS first_atom_suffix, SUBSTRING(b.bond_id FROM POSITION('_' IN SUBSTRING(b.bond_id FROM POSITION('_' IN b.bond_id) + 1)) + POSITION('_' IN b.bond_id) FOR LENGTH(b.bond_id)) AS second_atom_suffix FROM bond AS b) SELECT a1.molecule_id, a1.atom_id AS atom1_id, a1.element AS atom1_element, a2.atom_id AS atom2_id, a2.element AS atom2_element, b.bond_id, b.bond_type FROM atom AS a1 INNER JOIN connected AS c ON a1.atom_id = c.atom_id INNER JOIN atom AS a2 ON c.atom_id2 = a2.atom_id LEFT JOIN bonddetails AS b ON c.bond_id = b.bond_id AND a1.molecule_id = b.derived_molecule_id AND RIGHT(a1.atom_id, LENGTH(a1.atom_id) - POSITION('_' IN a1.atom_id)) = b.first_atom_suffix AND RIGHT(a2.atom_id, LENGTH(a2.atom_id) - POSITION('_' IN a2.atom_id)) = b.second_atom_suffix INNER JOIN moleculeatomcounts AS mac ON a1.molecule_id = mac.molecule_id AND mac.atom_count > 0 WHERE (NOT b.bond_type IS NULL OR c.bond_id IS NULL) AND a1.atom_id < a2.atom_id   ORDER BY a1.molecule_id NULLS FIRST, a1.atom_id NULLS FIRST, a2.atom_id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.267,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 4,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 487,
    "db_id": "toxicology",
    "sql_snippet": "WITH AtomBondMapping AS (\n    SELECT\n        a.ato...",
    "valid": true,
    "error": null,
    "duration_ms": 20.034074783325195,
    "input_sql_tokens": 458,
    "estimated_tokens": 596,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH AtomBondMapping AS (\n    SELECT\n        a.atom_id,\n        SUBSTRING(a.atom_id FROM 1 FOR POSITION('_' IN a.atom_id) - 1) || '_' ||\n        SUBSTRING(a.atom_id FROM POSITION('_' IN a.atom_id) + 1 FOR LENGTH(a.atom_id)) || '_' ||\n        CAST(CAST(SUBSTRING(c.atom_id2 FROM POSITION('_' IN c.atom_id2) + 1 FOR LENGTH(c.atom_id2)) AS INTEGER) AS VARCHAR) AS derived_bond_id\n    FROM atom AS a\n    INNER JOIN connected AS c ON a.atom_id = c.atom_id\n    WHERE a.element = 'c'\n),\nMoleculeStats AS (\n    SELECT\n        molecule_id,\n        COUNT(atom_id) OVER (PARTITION BY molecule_id) AS atom_count,\n        ROW_NUMBER() OVER (PARTITION BY molecule_id ORDER BY atom_id NULLS FIRST) AS atom_seq\n    FROM atom\n)\nSELECT\n    m.molecule_id,\n    m.label AS molecule_label,\n    a.atom_id,\n    a.element AS atom_element,\n    b.bond_id,\n    b.bond_type\nFROM molecule AS m\nINNER JOIN atom AS a ON m.molecule_id = a.molecule_id\nINNER JOIN connected AS c ON a.atom_id = c.atom_id\nINNER JOIN atombondmapping AS abm ON a.atom_id = abm.atom_id\nLEFT JOIN bond AS b ON abm.derived_bond_id = b.bond_id\nINNER JOIN moleculestats AS ms ON a.molecule_id = ms.molecule_id AND a.atom_id = ms.atom_id\nWHERE ms.atom_seq <= ms.atom_count / 2\nORDER BY m.molecule_id NULLS FIRST, a.atom_id NULLS FIRST, b.bond_id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.28400000000000003,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 6,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 488,
    "db_id": "toxicology",
    "sql_snippet": "SELECT * FROM molecule WHERE NOT molecule_id IN ('...",
    "valid": true,
    "error": null,
    "duration_ms": 1.9538402557373047,
    "input_sql_tokens": 31,
    "estimated_tokens": 109,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM molecule WHERE NOT molecule_id IN ('TR000', 'TR001', 'TR002', NULL)",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 489,
    "db_id": "card_games",
    "sql_snippet": "WITH MonthlyRulings AS ( SELECT EXTRACT(YEAR FROM ...",
    "valid": true,
    "error": null,
    "duration_ms": 14.396190643310547,
    "input_sql_tokens": 283,
    "estimated_tokens": 413,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH MonthlyRulings AS ( SELECT EXTRACT(YEAR FROM \"date\") AS ruling_year, EXTRACT(MONTH FROM \"date\") AS ruling_month, \"date\", \"text\", \"uuid\" FROM rulings), DailyRulingsWithRank AS ( SELECT ruling_year, ruling_month, TO_CHAR(DATE_TRUNC('month', \"date\"), 'YYYY-MM') AS month_format, \"date\", DENSE_RANK() OVER (PARTITION BY ruling_year, ruling_month ORDER BY \"date\" NULLS FIRST) AS date_rank, COUNT(*) OVER (PARTITION BY \"date\") AS rulings_per_day FROM monthlyrulings), DistinctDaysPerMonth AS ( SELECT month_format AS month, MAX(date_rank) AS distinct_days FROM dailyrulingswithrank GROUP BY month_format) SELECT d.month, d.distinct_days, (SELECT \"date\" FROM rulings WHERE TO_CHAR(\"date\", 'YYYY-MM') = d.month LIMIT 1) AS first_ruling_date     FROM distinctdayspermonth AS d LEFT JOIN ( SELECT TO_CHAR(\"date\", 'YYYY-MM') AS month, COUNT(*) AS total_rulings FROM rulings GROUP BY TO_CHAR(\"date\", 'YYYY-MM')) AS r ON d.month = r.month ORDER BY d.month NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.20400000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-ORDER-LIMIT-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "LIMIT",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 2,
        "num_ctes": 3,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 490,
    "db_id": "superhero",
    "sql_snippet": "WITH SuperheroGenderCTE AS (SELECT s.id AS superhe...",
    "valid": true,
    "error": null,
    "duration_ms": 6.985187530517578,
    "input_sql_tokens": 127,
    "estimated_tokens": 239,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH SuperheroGenderCTE AS (SELECT s.id AS superhero_id, s.superhero_name, g.gender, ROW_NUMBER() OVER (PARTITION BY s.superhero_name ORDER BY g.id NULLS FIRST) AS rn FROM superhero AS s LEFT JOIN gender AS g ON CASE WHEN s.gender_id = g.id THEN 1 WHEN s.gender_id IS NULL AND g.id = 3 THEN 1 ELSE 0 END = 1) SELECT superhero_name, gender FROM superherogendercte WHERE rn = 1 ORDER BY superhero_id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11599999999999999,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 491,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH PatientExamHistory AS (SELECT p.id, p.sex, p....",
    "valid": true,
    "error": null,
    "duration_ms": 22.91560173034668,
    "input_sql_tokens": 400,
    "estimated_tokens": 498,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH PatientExamHistory AS (SELECT p.id, p.sex, p.birthday, p.description, p.\"First Date\", p.admission, p.diagnosis AS PatientDiagnosis, e.\"Examination Date\", e.\"aCL IgG\", e.\"aCL IgM\", e.ana, e.\"ANA Pattern\", e.\"aCL IgA\", e.diagnosis AS ExamDiagnosis, e.kct, e.rvvt, e.lac, e.symptoms, e.thrombosis, ROW_NUMBER() OVER (PARTITION BY p.id ORDER BY e.\"Examination Date\" DESC NULLS LAST) AS ExamRank, COUNT(*) OVER (PARTITION BY p.id) AS ExamCount FROM patient AS p LEFT JOIN examination AS e ON e.id = p.id LEFT JOIN laboratory AS l ON l.id = p.id AND l.date = e.\"Examination Date\" WHERE (p.sex = 'F' OR e.thrombosis = 1)), LatestLabResults AS (SELECT l.id, l.date, l.wbc, l.rbc, l.hgb, ROW_NUMBER() OVER (PARTITION BY l.id ORDER BY l.date DESC NULLS LAST) AS LabRank FROM laboratory AS l) SELECT peh.*, llr.wbc, llr.rbc, llr.hgb, CASE WHEN peh.ExamCount > 1 THEN 'Multiple Exams' WHEN peh.ExamCount = 1 THEN 'Single Exam' ELSE 'No Exams' END AS ExamStatus FROM patientexamhistory AS peh LEFT JOIN latestlabresults AS llr ON llr.id = peh.id AND llr.LabRank = 1 WHERE peh.ExamRank = 1 OR peh.ExamRank IS NULL ORDER BY CASE WHEN peh.thrombosis = 1 THEN 0 ELSE 1 END NULLS FIRST, peh.id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.229,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 3,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 492,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH LabResults AS (\n    SELECT l.id, l.date, l.go...",
    "valid": true,
    "error": null,
    "duration_ms": 37.383317947387695,
    "input_sql_tokens": 686,
    "estimated_tokens": 811,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH LabResults AS (\n    SELECT l.id, l.date, l.got, l.gpt, l.ldh, l.alp, l.tp, l.alb, l.ua, l.un, l.cre, l.\"T-BIL\", l.\"T-CHO\", l.tg, l.cpk, l.glu, l.wbc, l.rbc, l.hgb, l.hct, l.plt, l.pt, l.aptt, l.fg, l.\"U-PRO\", l.igg, l.iga, l.igm, l.crp, l.ra, l.rf, l.c3, l.c4, l.rnp, l.sm, l.sc170, l.ssa, l.ssb, l.centromea, l.dna, l.\"DNA-II\",\n    ROW_NUMBER() OVER (PARTITION BY l.id ORDER BY l.date DESC NULLS LAST) AS LatestRank,\n    CASE\n        WHEN l.crp IS NULL THEN 0\n        WHEN l.crp IN ('Positive', 'Negative') THEN 1\n        ELSE 2\n    END AS CRPType\n    FROM laboratory AS l\n    INNER JOIN patient AS p ON l.id = p.id\n    WHERE p.sex = 'F'\n),\nPatientDiagnosis AS (\n    SELECT id, MAX(CASE WHEN diagnosis LIKE '%SLE%' THEN 1 ELSE 0 END) AS HasSLE\n    FROM examination\n    GROUP BY id\n),\nLatestLabWithRank AS (\n    SELECT lr.*,\n    DENSE_RANK() OVER (PARTITION BY lr.id ORDER BY lr.CRPType DESC NULLS LAST, lr.date DESC NULLS LAST) AS PriorityRank\n    FROM labresults AS lr\n    LEFT JOIN patientdiagnosis AS pd ON lr.id = pd.id\n    WHERE (lr.LatestRank = 1 OR (pd.HasSLE = 1 AND lr.LatestRank <= 3))\n)\nSELECT l.id, l.date, l.got, l.gpt, l.ldh, l.alp, l.tp, l.alb, l.ua, l.un, l.cre, l.\"T-BIL\", l.\"T-CHO\", l.tg, l.cpk, l.glu, l.wbc, l.rbc, l.hgb, l.hct, l.plt, l.pt, l.aptt, l.fg, l.\"U-PRO\", l.igg, l.iga, l.igm, l.crp, l.ra, l.rf, l.c3, l.c4, l.rnp, l.sm, l.sc170, l.ssa, l.ssb, l.centromea, l.dna, l.\"DNA-II\"\nFROM latestlabwithrank AS l\nWHERE l.PriorityRank = 1 AND (NOT l.crp IN ('Positive', 'Negative') OR l.CRPType > 0)\nORDER BY l.id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.227,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 493,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH LabResults AS (\n    SELECT l.id, l.date, l.go...",
    "valid": true,
    "error": null,
    "duration_ms": 36.96489334106445,
    "input_sql_tokens": 686,
    "estimated_tokens": 811,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH LabResults AS (\n    SELECT l.id, l.date, l.got, l.gpt, l.ldh, l.alp, l.tp, l.alb, l.ua, l.un, l.cre, l.\"T-BIL\", l.\"T-CHO\", l.tg, l.cpk, l.glu, l.wbc, l.rbc, l.hgb, l.hct, l.plt, l.pt, l.aptt, l.fg, l.\"U-PRO\", l.igg, l.iga, l.igm, l.crp, l.ra, l.rf, l.c3, l.c4, l.rnp, l.sm, l.sc170, l.ssa, l.ssb, l.centromea, l.dna, l.\"DNA-II\",\n    ROW_NUMBER() OVER (PARTITION BY l.id ORDER BY l.date DESC NULLS LAST) AS LatestRank,\n    CASE\n        WHEN l.crp IS NULL THEN 0\n        WHEN l.crp IN ('Positive', 'Negative') THEN 1\n        ELSE 2\n    END AS CRPType\n    FROM laboratory AS l\n    INNER JOIN patient AS p ON l.id = p.id\n    WHERE p.sex = 'F'\n),\nPatientDiagnosis AS (\n    SELECT id, MAX(CASE WHEN diagnosis LIKE '%SLE%' THEN 1 ELSE 0 END) AS HasSLE\n    FROM examination\n    GROUP BY id\n),\nLatestLabWithRank AS (\n    SELECT lr.*,\n    DENSE_RANK() OVER (PARTITION BY lr.id ORDER BY lr.CRPType DESC NULLS LAST, lr.date DESC NULLS LAST) AS PriorityRank\n    FROM labresults AS lr\n    LEFT JOIN patientdiagnosis AS pd ON lr.id = pd.id\n    WHERE (lr.LatestRank = 1 OR (pd.HasSLE = 1 AND lr.LatestRank <= 3))\n)\nSELECT l.id, l.date, l.got, l.gpt, l.ldh, l.alp, l.tp, l.alb, l.ua, l.un, l.cre, l.\"T-BIL\", l.\"T-CHO\", l.tg, l.cpk, l.glu, l.wbc, l.rbc, l.hgb, l.hct, l.plt, l.pt, l.aptt, l.fg, l.\"U-PRO\", l.igg, l.iga, l.igm, l.crp, l.ra, l.rf, l.c3, l.c4, l.rnp, l.sm, l.sc170, l.ssa, l.ssb, l.centromea, l.dna, l.\"DNA-II\"\nFROM latestlabwithrank AS l\nWHERE l.PriorityRank = 1 AND (NOT l.crp IN ('Positive', 'Negative') OR l.CRPType > 0)\nORDER BY l.id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.227,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 3,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 494,
    "db_id": "formula_1",
    "sql_snippet": "WITH RaceResults AS (SELECT r.raceId, r.year, r.na...",
    "valid": true,
    "error": null,
    "duration_ms": 20.840167999267578,
    "input_sql_tokens": 336,
    "estimated_tokens": 446,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RaceResults AS (SELECT r.raceId, r.year, r.name AS raceName, res.positionText, d.forename || ' ' || d.surname AS driverName, res.driverId, ROW_NUMBER() OVER (PARTITION BY r.raceId, res.positionText ORDER BY res.resultId NULLS FIRST) AS position_rank FROM results AS res INNER JOIN races AS r ON res.raceId = r.raceId INNER JOIN drivers AS d ON res.driverId = d.driverId WHERE CAST(res.positionText AS INT) <= 3) SELECT rr.raceId, MAX(rr.year) AS year, MAX(rr.raceName) AS raceName, MAX(CASE WHEN rr.positionText = '1' THEN rr.driverName END) AS position1_driver, MAX(CASE WHEN rr.positionText = '1' THEN rr.driverId END) AS position1, MAX(CASE WHEN rr.positionText = '2' THEN rr.driverName END) AS position2_driver, MAX(CASE WHEN rr.positionText = '2' THEN rr.driverId END) AS position2, MAX(CASE WHEN rr.positionText = '3' THEN rr.driverName END) AS position3_driver, MAX(CASE WHEN rr.positionText = '3' THEN rr.driverId END) AS position3 FROM raceresults AS rr WHERE position_rank = 1   GROUP BY rr.raceId ORDER BY MAX(rr.year) DESC NULLS LAST, rr.positionText NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.202,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 9
      }
    }
  },
  {
    "query_idx": 495,
    "db_id": "formula_1",
    "sql_snippet": "WITH x AS (SELECT driverid, statusid, ROW_NUMBER()...",
    "valid": true,
    "error": null,
    "duration_ms": 9.702920913696289,
    "input_sql_tokens": 175,
    "estimated_tokens": 291,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH x AS (SELECT driverid, statusid, ROW_NUMBER() OVER (PARTITION BY driverid ORDER BY COUNT(*) DESC NULLS LAST) AS rn FROM results GROUP BY driverid, statusid) INSERT INTO results (resultid, raceid, driverid, constructorid, number, grid, position, positiontext, positionorder, points, laps, time, milliseconds, fastestlap, rank, fastestlaptime, fastestlapspeed, statusid) SELECT driverid, 1, driverid, 1, 1, 1, position, positiontext, positionorder, points, 1, '00:00:00', 0, 1, 1, '00:00:00', '000.000', statusid FROM x WHERE rn = 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.07700000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-GROUP-WINDOW-ORDER-INSERT",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "INSERT",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 496,
    "db_id": "formula_1",
    "sql_snippet": "WITH DriverGroups AS (SELECT CASE WHEN nationality...",
    "valid": true,
    "error": null,
    "duration_ms": 11.188983917236328,
    "input_sql_tokens": 149,
    "estimated_tokens": 257,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH DriverGroups AS (SELECT CASE WHEN nationality IS NULL THEN 'Unknown' ELSE nationality END AS driver_group, code FROM drivers WHERE NOT code IS NULL), GroupedCodes AS (SELECT driver_group, MIN(code) AS min_code, MAX(code) AS max_code, COUNT(DISTINCT code) AS distinct_code_count FROM drivergroups GROUP BY driver_group) SELECT driver_group, CASE WHEN distinct_code_count > 1 THEN MIN(min_code)     || '-' || MAX(max_code) ELSE MAX(max_code)   END AS concat_codes FROM groupedcodes GROUP BY driver_group, distinct_code_count ORDER BY driver_group NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11699999999999999,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 6
      }
    }
  },
  {
    "query_idx": 497,
    "db_id": "formula_1",
    "sql_snippet": "WITH DriverGroups AS (SELECT CASE WHEN nationality...",
    "valid": true,
    "error": null,
    "duration_ms": 11.336803436279297,
    "input_sql_tokens": 149,
    "estimated_tokens": 257,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH DriverGroups AS (SELECT CASE WHEN nationality IS NULL THEN 'Unknown' ELSE nationality END AS driver_group, code FROM drivers WHERE NOT code IS NULL), GroupedCodes AS (SELECT driver_group, MIN(code) AS min_code, MAX(code) AS max_code, COUNT(DISTINCT code) AS distinct_code_count FROM drivergroups GROUP BY driver_group) SELECT driver_group, CASE WHEN distinct_code_count > 1 THEN MIN(min_code)     || '-' || MAX(max_code) ELSE MAX(max_code)   END AS concat_codes FROM groupedcodes GROUP BY driver_group, distinct_code_count ORDER BY driver_group NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11699999999999999,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 6
      }
    }
  },
  {
    "query_idx": 498,
    "db_id": "european_football_2",
    "sql_snippet": "WITH TeamAverages AS (\n    SELECT\n        AVG(CAST...",
    "valid": true,
    "error": null,
    "duration_ms": 14.438629150390625,
    "input_sql_tokens": 345,
    "estimated_tokens": 469,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH TeamAverages AS (\n    SELECT\n        AVG(CAST(buildupplayspeed AS DECIMAL(10, 2))) AS AvgBuildupplaySpeed,\n        AVG(CAST(defenceteamwidth AS DECIMAL(10, 2))) AS AvgDefenceTeamWidth\n    FROM team_attributes\n    WHERE buildupplayspeed IS NOT NULL AND defenceteamwidth IS NOT NULL\n),\nFilteredTeams AS (\n    SELECT\n        TA.id,\n        TA.buildupplayspeed,\n        TA.buildupplaypassing,\n        TA.chancecreationpassing,\n        TA.chancecreationcrossing,\n        TA.chancecreationshooting,\n        TA.defencepressure,\n        TA.defenceaggression,\n        TA.defenceteamwidth,\n        ROW_NUMBER() OVER (PARTITION BY TA.team_api_id ORDER BY TA.date DESC NULLS LAST) AS LatestRecord\n    FROM team_attributes AS TA\n    JOIN teamaverages AS AVG ON TA.buildupplayspeed >= AVG.AvgBuildupplaySpeed AND TA.defenceteamwidth <= AVG.AvgDefenceTeamWidth\n)\nSELECT\n    id,\n    buildupplayspeed,\n    buildupplaypassing,\n    chancecreationpassing,\n    chancecreationcrossing,\n    chancecreationshooting,\n    defencepressure,\n    defenceaggression,\n    defenceteamwidth\nFROM filteredteams\nWHERE LatestRecord = 1\nORDER BY buildupplayspeed DESC NULLS LAST, defenceteamwidth ASC NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14500000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 499,
    "db_id": "european_football_2",
    "sql_snippet": "WITH TeamAverages AS (\n    SELECT\n        AVG(CAST...",
    "valid": true,
    "error": null,
    "duration_ms": 12.452840805053711,
    "input_sql_tokens": 345,
    "estimated_tokens": 469,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH TeamAverages AS (\n    SELECT\n        AVG(CAST(buildupplayspeed AS DECIMAL(10, 2))) AS AvgBuildupplaySpeed,\n        AVG(CAST(defenceteamwidth AS DECIMAL(10, 2))) AS AvgDefenceTeamWidth\n    FROM team_attributes\n    WHERE buildupplayspeed IS NOT NULL AND defenceteamwidth IS NOT NULL\n),\nFilteredTeams AS (\n    SELECT\n        TA.id,\n        TA.buildupplayspeed,\n        TA.buildupplaypassing,\n        TA.chancecreationpassing,\n        TA.chancecreationcrossing,\n        TA.chancecreationshooting,\n        TA.defencepressure,\n        TA.defenceaggression,\n        TA.defenceteamwidth,\n        ROW_NUMBER() OVER (PARTITION BY TA.team_api_id ORDER BY TA.date DESC NULLS LAST) AS LatestRecord\n    FROM team_attributes AS TA\n    JOIN teamaverages AS AVG ON TA.buildupplayspeed >= AVG.AvgBuildupplaySpeed AND TA.defenceteamwidth <= AVG.AvgDefenceTeamWidth\n)\nSELECT\n    id,\n    buildupplayspeed,\n    buildupplaypassing,\n    chancecreationpassing,\n    chancecreationcrossing,\n    chancecreationshooting,\n    defencepressure,\n    defenceaggression,\n    defenceteamwidth\nFROM filteredteams\nWHERE LatestRecord = 1\nORDER BY buildupplayspeed DESC NULLS LAST, defenceteamwidth ASC NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14500000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 500,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH PatientTestDates AS (SELECT p.ID, p.SEX, p.Di...",
    "valid": true,
    "error": null,
    "duration_ms": 15.04206657409668,
    "input_sql_tokens": 252,
    "estimated_tokens": 369,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH PatientTestDates AS (SELECT p.ID, p.SEX, p.Diagnosis, l.Date, ROW_NUMBER() OVER (PARTITION BY p.ID ORDER BY l.Date NULLS FIRST) AS RowNum FROM patient AS p LEFT JOIN laboratory AS l ON p.ID = l.ID WHERE l.Date >= p.\"First Date\" OR p.\"First Date\" IS NULL), ExaminationDates AS (SELECT p.ID, MIN(e.\"Examination Date\") AS earliest_exam_date FROM patient AS p LEFT JOIN examination AS e ON p.ID = e.ID GROUP BY p.ID) SELECT ptd.ID, ptd.SEX, ptd.Diagnosis, CASE WHEN ptd.Date < ed.earliest_exam_date OR ed.earliest_exam_date IS NULL THEN ptd.Date ELSE ed.earliest_exam_date END AS earliest_test_date FROM patienttestdates AS ptd LEFT JOIN examinationdates AS ed ON ptd.ID = ed.ID WHERE ptd.RowNum = 1 GROUP BY ptd.ID, ptd.SEX, ptd.Diagnosis, ptd.Date, ed.earliest_exam_date",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.20900000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 3,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 501,
    "db_id": "toxicology",
    "sql_snippet": "WITH x AS (SELECT FLOOR(COALESCE(LENGTH(CAST(label...",
    "valid": true,
    "error": null,
    "duration_ms": 4.9991607666015625,
    "input_sql_tokens": 88,
    "estimated_tokens": 173,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH x AS (SELECT FLOOR(COALESCE(LENGTH(CAST(label AS TEXT)), 0) / 100) AS labellength FROM molecule) SELECT labellength * 100 AS labellengthstart, (labellength + 1) * 100 - 1 AS labellengthend, COUNT(*) AS moleculecount FROM x ORDER BY labellength NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.07,
        "pattern_signature": "WITH-CTE-SELECT-FROM-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "ORDER",
          "SELECT",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 502,
    "db_id": "card_games",
    "sql_snippet": "SELECT * FROM (SELECT id, name, ROW_NUMBER() OVER ...",
    "valid": true,
    "error": null,
    "duration_ms": 6.7005157470703125,
    "input_sql_tokens": 96,
    "estimated_tokens": 206,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT * FROM (SELECT id, name, ROW_NUMBER() OVER (PARTITION BY id ORDER BY label NULLS FIRST) AS item, CONCAT(label, ' (', tag1, ')') AS value FROM (SELECT id, name, 'Colors' AS label, colors AS tag1 FROM cards UNION ALL SELECT id, name, 'ManaCost' AS label, manacost AS tag1 FROM cards) AS src) AS src WHERE id = '1'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.16900000000000004,
        "pattern_signature": "SELECT-FROM-WHERE-WINDOW-UNION-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 503,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH PatientThrombosisHistory AS (SELECT e.ID, e.T...",
    "valid": true,
    "error": null,
    "duration_ms": 21.147966384887695,
    "input_sql_tokens": 297,
    "estimated_tokens": 423,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH PatientThrombosisHistory AS (SELECT e.ID, e.Thrombosis, ROW_NUMBER() OVER (PARTITION BY e.ID ORDER BY e.\"Examination Date\" DESC NULLS LAST) AS RecencyRank, COUNT(*) OVER (PARTITION BY e.ID) AS ExamCount FROM examination AS e WHERE NOT e.Thrombosis IS NULL), LabResults AS (SELECT l.ID, AVG(l.PLT) AS AvgPlateletCount, MAX(CASE WHEN l.PLT < 150 THEN 1 ELSE 0 END) AS HasLowPlatelets FROM laboratory AS l WHERE l.Date >= CURRENT_TIMESTAMP + INTERVAL '-1 YEAR' GROUP BY l.ID) SELECT p.ID AS PatientID, p.Diagnosis, CASE WHEN lr.HasLowPlatelets = 1 AND pth.Thrombosis IS NULL THEN 1 WHEN pth.ExamCount > 1 THEN (SELECT Thrombosis FROM examination WHERE ID = p.ID ORDER BY \"Examination Date\" NULLS FIRST LIMIT 1) ELSE COALESCE(pth.Thrombosis, 0) END AS ThrombosisStatus, lr.AvgPlateletCount FROM patient AS p LEFT JOIN patientthrombosishistory AS pth ON p.ID = pth.ID AND pth.RecencyRank = 1 LEFT JOIN labresults AS lr ON p.ID = lr.ID ORDER BY p.ID NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.23500000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-ORDER-LIMIT-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "LIMIT",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 1,
        "num_ctes": 2,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 504,
    "db_id": "european_football_2",
    "sql_snippet": "WITH TEAMATTRS AS (SELECT BUILDUPPLAYSPEED AS VALU...",
    "valid": true,
    "error": null,
    "duration_ms": 9.770393371582031,
    "input_sql_tokens": 147,
    "estimated_tokens": 251,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH TEAMATTRS AS (SELECT BUILDUPPLAYSPEED AS VALUE, 'Team_Attributes' AS IDENTIFIER, ROW_NUMBER() OVER (ORDER BY BUILDUPPLAYSPEED NULLS FIRST) AS RN FROM team_attributes) SELECT PLAYERATTRS.VALUE, PLAYERATTRS.IDENTIFIER, TEAMATTRS.VALUE, TEAMATTRS.IDENTIFIER FROM (SELECT OVERALL_RATING AS VALUE, 'Player_Attributes' AS IDENTIFIER, ROW_NUMBER() OVER (ORDER BY OVERALL_RATING NULLS FIRST) AS RN FROM player_attributes) AS PLAYERATTRS FULL OUTER JOIN teamattrs ON PLAYERATTRS.RN = TEAMATTRS.RN WHERE PLAYERATTRS.IDENTIFIER = 'Team_Attributes'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.138,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 505,
    "db_id": "european_football_2",
    "sql_snippet": "SELECT \"date\", home_team_api_id AS group_1, away_t...",
    "valid": true,
    "error": null,
    "duration_ms": 15.277624130249023,
    "input_sql_tokens": 328,
    "estimated_tokens": 410,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT \"date\", home_team_api_id AS group_1, away_team_api_id AS group_2, home_team_goal AS daily_profits, SUM(home_team_goal) OVER (PARTITION BY CAST(\"date\" AS INT), home_team_api_id, away_team_api_id ORDER BY \"date\" NULLS FIRST ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS mtd, SUM(home_team_goal) OVER (PARTITION BY TO_CHAR(CAST(\"date\" AS TIMESTAMP), 'YYYY'), TO_CHAR(CAST(\"date\" AS TIMESTAMP), 'quarter'), home_team_api_id, away_team_api_id ORDER BY \"date\" NULLS FIRST ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS qtd, SUM(home_team_goal) OVER (PARTITION BY TO_CHAR(CAST(\"date\" AS TIMESTAMP), 'YYYY'), home_team_api_id, away_team_api_id ORDER BY \"date\" NULLS FIRST ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ytd, SUM(home_team_goal) OVER (PARTITION BY home_team_api_id, away_team_api_id ORDER BY \"date\" NULLS FIRST ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS ltd FROM match ORDER BY \"date\" NULLS FIRST, home_team_api_id NULLS FIRST, away_team_api_id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.034,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 506,
    "db_id": "card_games",
    "sql_snippet": "WITH CardLegalities AS (\n    SELECT c.name AS card...",
    "valid": true,
    "error": null,
    "duration_ms": 15.099525451660156,
    "input_sql_tokens": 310,
    "estimated_tokens": 437,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH CardLegalities AS (\n    SELECT c.name AS card_name, l.format, l.status, l.id,\n    DENSE_RANK() OVER (PARTITION BY c.uuid, l.format ORDER BY CASE WHEN l.status = 'Legal' THEN 0 ELSE 1 END NULLS FIRST) AS status_priority\n    FROM cards AS c\n    LEFT JOIN legalities AS l ON c.uuid = l.uuid\n    WHERE l.format IN ('commander', 'duel', 'legacy')\n),\nLegalityStats AS (\n    SELECT card_name, format,\n    MAX(CASE WHEN status = 'Legal' THEN id END) AS legal_id,\n    MAX(CASE WHEN status = 'Banned' THEN id END) AS banned_id\n    FROM cardlegalities\n    GROUP BY card_name, format\n)\nSELECT cl.card_name, cl.format, ls.legal_id, ls.banned_id,\nCASE WHEN cl.status = 'Legal' AND cl.status_priority = 1 THEN ls.legal_id - ls.banned_id END AS id_diff\nFROM cardlegalities AS cl\nJOIN legalitystats AS ls ON cl.card_name = ls.card_name AND cl.format = ls.format\nWHERE cl.status IN ('Legal', 'Banned')\nORDER BY cl.card_name ASC NULLS FIRST, cl.format ASC NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.18600000000000003,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 507,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH a AS (SELECT id, date AS applicationid, ROW_N...",
    "valid": true,
    "error": null,
    "duration_ms": 8.075952529907227,
    "input_sql_tokens": 102,
    "estimated_tokens": 210,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH a AS (SELECT id, date AS applicationid, ROW_NUMBER() OVER (PARTITION BY id ORDER BY date NULLS FIRST) AS rn, LAG(date) OVER (PARTITION BY id ORDER BY date NULLS FIRST) AS prev FROM laboratory) SELECT id AS usercode, prev AS data_1, rn AS id_2, applicationid AS data_2, rn - 1 AS id_1 FROM a WHERE NOT prev IS NULL AND id = 27654",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08700000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 508,
    "db_id": "formula_1",
    "sql_snippet": "SELECT RACEID, NAME, \"date\", LAG(RACEID) OVER (PAR...",
    "valid": true,
    "error": null,
    "duration_ms": 6.205558776855469,
    "input_sql_tokens": 84,
    "estimated_tokens": 181,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT RACEID, NAME, \"date\", LAG(RACEID) OVER (PARTITION BY YEAR ORDER BY \"date\" NULLS FIRST) AS PREVRACEID, LEAD(RACEID) OVER (PARTITION BY YEAR ORDER BY \"date\" NULLS FIRST) AS NEXTRACEID FROM races ORDER BY YEAR NULLS FIRST, \"date\" NULLS FIRST, \"non_existent_column\" NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.022000000000000002,
        "pattern_signature": "SELECT-FROM-WINDOW-ORDER",
        "clauses_present": [
          "FROM",
          "ORDER",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 509,
    "db_id": "superhero",
    "sql_snippet": "WITH pages AS (SELECT 1 AS page_id, 1 AS power_id ...",
    "valid": true,
    "error": null,
    "duration_ms": 17.359018325805664,
    "input_sql_tokens": 262,
    "estimated_tokens": 379,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH pages AS (SELECT 1 AS page_id, 1 AS power_id UNION ALL SELECT 1, 7 UNION ALL SELECT 2, 1 UNION ALL SELECT 3, 1 UNION ALL SELECT 3, 7 UNION ALL SELECT 3, 89 UNION ALL SELECT 4, 20 UNION ALL SELECT 5, 55 UNION ALL SELECT 5, 1 UNION ALL SELECT 6, 1 UNION ALL SELECT 6, 13), items AS (SELECT 10 AS hero_id, 1 AS power_id UNION ALL SELECT 10, 7 UNION ALL SELECT 10, 20 UNION ALL SELECT 12, 1 UNION ALL SELECT 12, 55) SELECT p.page_id, i.hero_id FROM (SELECT p.page_id, p.power_id, COUNT(*) OVER (PARTITION BY p.page_id) AS total_powers FROM pages AS p) AS p INNER JOIN items AS i ON p.power_id = i.power_id GROUP BY p.page_id, i.hero_id, p.total_powers HAVING COUNT(i.power_id) > p.total_powers",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.14,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-GROUP-HAVING-WINDOW-UNION-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 2,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 510,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH data AS (SELECT p.id, p.\"First Date\" AS as_of...",
    "valid": true,
    "error": null,
    "duration_ms": 9.000539779663086,
    "input_sql_tokens": 175,
    "estimated_tokens": 283,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH data AS (SELECT p.id, p.\"First Date\" AS as_of_date, p.diagnosis AS current_diagnosis, LAG(p.diagnosis) OVER (PARTITION BY p.id ORDER BY p.\"First Date\" NULLS FIRST) AS prev_diagnosis, CASE WHEN p.diagnosis IN ('RA susp.', 'PSS', 'SLE') THEN 1 ELSE 0 END AS output_flag FROM patient AS p) SELECT as_of_date, id, current_diagnosis, prev_diagnosis, CASE WHEN output_flag = 1 THEN MIN(as_of_date) OVER (PARTITION BY id, output_flag ORDER BY as_of_date NULLS FIRST) END AS desired_output FROM data WHERE current_diagnosis <> prev_diagnosis OR prev_diagnosis IS NULL AND id = '2110'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10300000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 511,
    "db_id": "toxicology",
    "sql_snippet": "WITH ATOMRNS AS (SELECT MOLECULE_ID, ELEMENT, ROW_...",
    "valid": true,
    "error": null,
    "duration_ms": 9.378910064697266,
    "input_sql_tokens": 134,
    "estimated_tokens": 246,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH ATOMRNS AS (SELECT MOLECULE_ID, ELEMENT, ROW_NUMBER() OVER (PARTITION BY MOLECULE_ID ORDER BY ATOM_ID NULLS FIRST) AS RN FROM atom) SELECT MOLECULE_ID, MAX(CASE WHEN RN = 1 THEN ELEMENT END) AS ELEMENT1, MAX(CASE WHEN RN = 2 THEN ELEMENT END) AS ELEMENT2, MAX(CASE WHEN RN = 3 THEN ELEMENT END) AS ELEMENT3 FROM atomrns JOIN atom ON ATOMRNS.MOLECULE_ID = ATOM.MOLECULE_ID GROUP BY MOLECULE_ID",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10700000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 512,
    "db_id": "superhero",
    "sql_snippet": "WITH SUPERHEROLIST AS (SELECT ID, SUPERHERO_NAME, ...",
    "valid": true,
    "error": null,
    "duration_ms": 22.859573364257812,
    "input_sql_tokens": 341,
    "estimated_tokens": 443,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH SUPERHEROLIST AS (SELECT ID, SUPERHERO_NAME, FULL_NAME, ROW_NUMBER() OVER (PARTITION BY PUBLISHER_ID ORDER BY ID NULLS FIRST) AS PUBLISHER_RANK, DENSE_RANK() OVER (ORDER BY ALIGNMENT_ID NULLS FIRST, ID NULLS FIRST) AS GLOBAL_RANK FROM superhero WHERE NOT HEIGHT_CM IS NULL), SUPERHERO_POWERS AS (SELECT S.ID, S.SUPERHERO_NAME, COUNT(HP.POWER_ID) AS POWER_COUNT, STRING_AGG(SP.POWER_NAME, ', ' ORDER BY SP.POWER_NAME NULLS FIRST) AS POWERS FROM superhero AS S LEFT JOIN hero_power AS HP ON S.ID = HP.HERO_ID LEFT JOIN superpower AS SP ON HP.POWER_ID = SP.ID GROUP BY S.ID, S.SUPERHERO_NAME) SELECT S1.SUPERHERO_NAME AS CURRENTSUPERHERO, S2.SUPERHERO_NAME AS SUPERHEROAFTER4, S1.POWERS AS CURRENT_POWERS, S2.POWERS AS NEXT_POWERS FROM superherolist AS S1 LEFT JOIN superherolist AS S2 ON S2.GLOBAL_RANK = S1.GLOBAL_RANK + 4 AND S2.PUBLISHER_ID = S1.PUBLISHER_ID LEFT JOIN superhero_powers AS SP1 ON S1.ID = SP1.ID LEFT JOIN superhero_powers AS SP2 ON S2.ID = SP2.ID WHERE S1.PUBLISHER_RANK <= 10 ORDER BY S1.GLOBAL_RANK NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.261,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 5,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 3
      }
    }
  },
  {
    "query_idx": 513,
    "db_id": "card_games",
    "sql_snippet": "SELECT num FROM (SELECT number AS num, ROW_NUMBER(...",
    "valid": true,
    "error": null,
    "duration_ms": 8.009672164916992,
    "input_sql_tokens": 63,
    "estimated_tokens": 175,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT num FROM (SELECT number AS num, ROW_NUMBER() OVER (ORDER BY id NULLS FIRST) - ROW_NUMBER() OVER (PARTITION BY CAST(number AS INT) ORDER BY id NULLS FIRST) AS grp FROM cards) AS a GROUP BY grp, num HAVING COUNT(*) >= 3",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09900000000000003,
        "pattern_signature": "SELECT-FROM-GROUP-HAVING-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "HAVING",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 514,
    "db_id": "toxicology",
    "sql_snippet": "WITH BondTypeRanking AS (SELECT bond_id, molecule_...",
    "valid": true,
    "error": null,
    "duration_ms": 18.4628963470459,
    "input_sql_tokens": 304,
    "estimated_tokens": 426,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH BondTypeRanking AS (SELECT bond_id, molecule_id, bond_type, CASE WHEN bond_type = '-' THEN 1 WHEN bond_type = '=' THEN 2 WHEN bond_type = '#' THEN 3 ELSE CAST(bond_type AS INT)   END AS bond_type_rank FROM bond), MoleculeWithMultipleBondTypes AS (SELECT molecule_id FROM bond GROUP BY molecule_id HAVING COUNT(DISTINCT CASE WHEN bond_type = '-' THEN 'single' WHEN bond_type = '=' THEN 'double' WHEN bond_type = '#' THEN 'triple' ELSE bond_type END) > 1) SELECT b.molecule_id, b.bond_type FROM (SELECT btr.molecule_id, btr.bond_type, ROW_NUMBER() OVER (PARTITION BY btr.molecule_id ORDER BY btr.bond_type_rank NULLS FIRST, LENGTH(CAST(btr.bond_type AS TEXT)) NULLS FIRST  , btr.bond_type NULLS FIRST) AS rn FROM bondtyperanking AS btr INNER JOIN moleculewithmultiplebondtypes AS m ON btr.molecule_id = m.molecule_id WHERE NOT btr.bond_type_rank IS NULL  ) AS b WHERE b.rn = 1 ORDER BY CASE WHEN b.molecule_id LIKE 'TR%' THEN 0 ELSE 1 END NULLS FIRST  , b.molecule_id NULLS FIRST",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.158,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-HAVING-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 1,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 515,
    "db_id": "california_schools",
    "sql_snippet": "WITH SchoolScores AS (\n    SELECT\n        s.school...",
    "valid": true,
    "error": null,
    "duration_ms": 12.861490249633789,
    "input_sql_tokens": 245,
    "estimated_tokens": 392,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH SchoolScores AS (\n    SELECT\n        s.school,\n        sa.avgscrread,\n        sa.avgscrmath,\n        sa.avgscrwrite,\n        DENSE_RANK() OVER (PARTITION BY sa.rtype ORDER BY sa.avgscrread DESC) AS ReadingRank\n    FROM\n        schools AS s\n    INNER JOIN\n        satscores AS sa ON s.cdscode = sa.cds\n    WHERE\n        s.county = 'Alameda'\n        AND sa.rtype = 'S'\n),\nMaxReadingScore AS (\n    SELECT MAX(avgscrread) AS MaxRead\n    FROM satscores\n    WHERE rtype = 'S'\n)\nSELECT\n    ss.school,\n    ss.avgscrread,\n    ss.avgscrmath,\n    ss.avgscrwrite\nFROM\n    SchoolScores ss\nCROSS JOIN\n    MaxReadingScore mrs\nWHERE\n    ss.avgscrread = mrs.MaxRead\n    AND ss.ReadingRank > 1\nORDER BY\n    ss.avgscrread DESC;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.18700000000000006,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-JOIN_CROSS-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 516,
    "db_id": "financial",
    "sql_snippet": "INSERT INTO account (account_id, district_id, freq...",
    "valid": true,
    "error": null,
    "duration_ms": 3.000497817993164,
    "input_sql_tokens": 76,
    "estimated_tokens": 165,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO account (account_id, district_id, frequency, date) VALUES (4, 10, 'POPLATEK PO OBRATU', '2023-04-01') ON DUPLICATE KEY UPDATE frequency = 'POPLATEK PO OBRATU', date = '2023-04-01';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 517,
    "db_id": "financial",
    "sql_snippet": "INSERT INTO account (account_id, district_id, freq...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0257701873779297,
    "input_sql_tokens": 76,
    "estimated_tokens": 165,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "INSERT INTO account (account_id, district_id, frequency, date) VALUES (9999, 3, 'POPLATEK TYDNE', '2024-10-22') ON DUPLICATE KEY UPDATE frequency = 'POPLATEK TYDNE', date = '2024-10-22';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "VALUES-INSERT",
        "clauses_present": [
          "INSERT",
          "VALUES"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 518,
    "db_id": "california_schools",
    "sql_snippet": "DO $$\nDECLARE\n    xml_result xml;\nBEGIN\n    -- Fir...",
    "valid": true,
    "error": null,
    "duration_ms": 7.912874221801758,
    "input_sql_tokens": 463,
    "estimated_tokens": 553,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DO $$\nDECLARE\n    xml_result xml;\nBEGIN\n    -- First attempt to build the XML structure with nested XML queries\n    WITH SchemaInfo AS (\n        SELECT\n            COLUMN_NAME,\n            DATA_TYPE,\n            ORDINAL_POSITION\n        FROM INFORMATION_SCHEMA.COLUMNS\n        WHERE TABLE_NAME = 'schools' AND TABLE_SCHEMA = current_schema()\n    ),\n    SATData AS (\n        SELECT\n            cds,\n            rtype,\n            ROW_NUMBER() OVER(PARTITION BY cds ORDER BY NumTstTakr DESC) AS RowRank\n        FROM satscores\n        WHERE NumTstTakr > 0\n    )\n\n    SELECT xmlelement(\n        name \"Results\",\n        (SELECT xmlagg(\n            xmlelement(\n                name \"Columns\",\n                (SELECT xmlagg(\n                    xmlelement(\n                        name \"Column\",\n                        xmlattributes(COLUMN_NAME as \"Name\"),\n                        xmlelement(name \"DataType\", DATA_TYPE)\n                    )\n                )\n                FROM SchemaInfo\n                ORDER BY ORDINAL_POSITION)\n            )\n        )),\n        (SELECT xmlagg(\n            xmlelement(\n                name \"Rows\",\n                (SELECT xmlagg(\n                    xmlelement(\n                        name \"Row\",\n                        xmlelement(name \"cds\", CASE WHEN cds IS NULL THEN 'xsi:nil=\"true\"' ELSE cds END),\n                        xmlelement(name \"rtype\", CASE WHEN rtype IS NULL THEN 'xsi:nil=\"true\"' ELSE rtype END)\n                    )\n                )\n                FROM SATData\n                WHERE RowRank = 1)\n            )\n        ))\n    ) INTO xml_result;\n\n    -- Attempt to extract specific nodes using XPath that doesn't match the structure\n    SELECT xpath('/Results/Rows/Row', xml_result)::text AS RowsXml,\n           xpath('/Results/Columns/Column', xml_result)::text AS ColumnsXml,\n           (xpath('/Results', xml_result))[1]::text AS EntireXmlAsText;\nEND $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 519,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT CustomerID, Consumption, MIN(Date) AS MinDa...",
    "valid": true,
    "error": null,
    "duration_ms": 7.705450057983398,
    "input_sql_tokens": 103,
    "estimated_tokens": 191,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT CustomerID, Consumption, MIN(Date) AS MinDate, MAX(Date) AS MaxDate\nFROM yearmonth WHERE Consumption = 0 GROUP BY CustomerID, Consumption;\n\nUPDATE yearmonth TGT SET DenseRankTest = SRC.NewRank\nFROM (SELECT Row_ID, DENSE_RANK() OVER (PARTITION BY CustomerID ORDER BY Consumption ASC) AS NewRank\n      FROM yearmonth) AS SRC\nWHERE SRC.Row_ID = TGT.Row_ID;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.029,
        "pattern_signature": "SELECT-FROM-WHERE-GROUP",
        "clauses_present": [
          "FROM",
          "GROUP",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 520,
    "db_id": "debit_card_specializing",
    "sql_snippet": "SELECT\n    c.customerid,\n    (\n        SELECT\n    ...",
    "valid": false,
    "error": "Expecting ). Line 8, Col: 11.\n  ) AS transactionid\n        FROM transactions_1k t\n        WHERE t.customerid = c.customerid\n        \u001b[4mFOR\u001b[0m JSON PATH\n    ) AS transactions\nFROM customers c\nINNER JOIN transactions_1k t ON c.customerid = t.c",
    "duration_ms": 5.995750427246094,
    "input_sql_tokens": 99,
    "estimated_tokens": 270,
    "error_tokens": 78,
    "invalid_sql_tokens": 99,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unbalanced_tokens",
          "message": "Expecting ). Line 8, Col: 11.\n  ) AS transactionid\n        FROM transactions_1k t\n        WHERE t.customerid = c.customerid\n        \u001b[4mFOR\u001b[0m JSON PATH\n    ) AS transactions\nFROM customers c\nINNER JOIN transactions_1k t ON c.customerid = t.c",
          "location": null,
          "context": "Parser reported expecting parenthesis",
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "SELECT\n    c.customerid,\n    (\n        SELECT\n            CAST(t.transactionid AS TEXT) AS transactionid\n        FROM transactions_1k t\n        WHERE t.customerid = c.customerid\n        FOR JSON PATH\n    ) AS transactions\nFROM customers c\nINNER JOIN transactions_1k t ON c.customerid = t.customerid\nWHERE segment = 'SME'\nFOR JSON PATH, WITHOUT_ARRAY_WRAPPER;",
      "tags": [
        "syntax_unbalanced_tokens"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 521,
    "db_id": "formula_1",
    "sql_snippet": "SELECT r.name,\nCOALESCE(STRING_AGG(tmp.name, ', ')...",
    "valid": true,
    "error": null,
    "duration_ms": 6.874561309814453,
    "input_sql_tokens": 81,
    "estimated_tokens": 175,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT r.name,\nCOALESCE(STRING_AGG(tmp.name, ', '), '')\nFROM races r\nLEFT JOIN\n(\n    SELECT c.name, cr.raceid FROM constructors c\n    JOIN constructorresults cr ON c.constructorid = cr.constructorid\n) tmp ON tmp.raceid = r.raceid\nGROUP BY r.name",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.162,
        "pattern_signature": "SELECT-FROM-JOIN-GROUP-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "JOIN",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 2,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 522,
    "db_id": "toxicology",
    "sql_snippet": "SELECT ROW_NUMBER() OVER () AS rownum, id_column, ...",
    "valid": true,
    "error": null,
    "duration_ms": 6.003141403198242,
    "input_sql_tokens": 169,
    "estimated_tokens": 250,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT ROW_NUMBER() OVER () AS rownum, id_column, decimal_column, nvarchar_column\nFROM json_table(\n    '[\n        {\"id_column\": 1234, \"decimal_column\": 12.34, \"nvarchar_column\": \"asdf\"},\n        {\"id_column\": 5678, \"decimal_column\": 56.78, \"nvarchar_column\": \"fdsa\"}\n    ]',\n    '$[*]' COLUMNS (\n        id_column BIGINT PATH '$.id_column',\n        decimal_column DECIMAL(28,8) PATH '$.decimal_column',\n        nvarchar_column VARCHAR(30) PATH '$.nvarchar_column'\n    )\n) AS data",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "SELECT-FROM-WINDOW",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 523,
    "db_id": "formula_1",
    "sql_snippet": "SELECT name, value FROM races CROSS JOIN LATERAL u...",
    "valid": true,
    "error": null,
    "duration_ms": 5.603313446044922,
    "input_sql_tokens": 55,
    "estimated_tokens": 149,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT name, value FROM races CROSS JOIN LATERAL unnest(string_to_array(name, ' ')) AS value PIVOT (GROUPING(name) as name FOR value in ('name1','name2','name3','name4')) piv;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.041,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_CROSS-LATERAL",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "LATERAL",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 524,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "DO $$\nDECLARE\n    v_id bigint;\n    v_date date;\n  ...",
    "valid": true,
    "error": null,
    "duration_ms": 2.9952526092529297,
    "input_sql_tokens": 151,
    "estimated_tokens": 231,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DO $$\nDECLARE\n    v_id bigint;\n    v_date date;\n    db_update_cursor CURSOR FOR\n        SELECT id, date\n        FROM laboratory\n        ORDER BY id, date\n        LIMIT 2;\nBEGIN\n    OPEN db_update_cursor;\n    FETCH NEXT FROM db_update_cursor INTO v_id, v_date;\n    WHILE FOUND LOOP\n        INSERT INTO destinationTable(testRow)\n        VALUES ((SELECT v_id, v_date FOR JSON AUTO));\n\n        FETCH NEXT FROM db_update_cursor INTO v_id, v_date;\n    END LOOP;\n\n    CLOSE db_update_cursor;\nEND $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 525,
    "db_id": "superhero",
    "sql_snippet": "WITH hero_activity AS\n  (SELECT id,\n          acti...",
    "valid": true,
    "error": null,
    "duration_ms": 22.9337215423584,
    "input_sql_tokens": 557,
    "estimated_tokens": 663,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH hero_activity AS\n  (SELECT id,\n          activity_date,\n          activity_value,\n          hero_id\n   FROM (\n         VALUES (1,\n                 '2023-01-01',\n                 10,\n                 1), (2,\n                      '2023-01-02',\n                      20,\n                      1), (3,\n                           '2023-02-01',\n                           15,\n                           1), (4,\n                                '2023-02-02',\n                                25,\n                                1), (5,\n                                     '2023-01-03',\n                                     30,\n                                     2), (6,\n                                          '2023-02-03',\n                                          40,\n                                          2)) AS t (id, activity_date, activity_value, hero_id)),\n     activity_totals AS\n  (SELECT id,\n          activity_date,\n          activity_value,\n          SUM(activity_value) OVER (\n                                    ORDER BY activity_date) AS run_tot,\n                                   SUM(activity_value) OVER (PARTITION BY EXTRACT(YEAR FROM activity_date),\n                                                                          EXTRACT(MONTH FROM activity_date)\n                                                             ORDER BY activity_date) AS m_run_tot,\n                                                            CASE\n                                                                WHEN ROW_NUMBER() OVER (PARTITION BY EXTRACT(YEAR FROM activity_date),\n                                                                                                     EXTRACT(MONTH FROM activity_date)\n                                                                                        ORDER BY activity_date) = 1 THEN SUM(activity_value) OVER (\n                                                                                                                                                   ORDER BY activity_date ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING)\n                                                            END AS prev_m_run_tot\n   FROM hero_activity)\nSELECT id,\n       activity_date,\n       activity_value,\n       run_tot,\n       m_run_tot,\n       COALESCE(MAX(prev_m_run_tot) OVER (PARTITION BY EXTRACT(YEAR FROM activity_date), EXTRACT(MONTH FROM activity_date)), FIRST_VALUE(m_run_tot) OVER (\n                                                                                                                                                ORDER BY activity_date)) AS required_output\nFROM activity_totals\nWHERE prev_m_run_tot NOT IN (0,\n                             NULL);",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.101,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-WINDOW-ORDER-VALUES",
        "clauses_present": [
          "CTE",
          "FROM",
          "ORDER",
          "SELECT",
          "VALUES",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 5
      }
    }
  },
  {
    "query_idx": 526,
    "db_id": "formula_1",
    "sql_snippet": "WITH RaceResults AS (\n\n    SELECT\n        r.raceId...",
    "valid": true,
    "error": null,
    "duration_ms": 39.229393005371094,
    "input_sql_tokens": 444,
    "estimated_tokens": 594,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RaceResults AS (\n\n    SELECT\n        r.raceId,\n        r.year,\n        r.date,\n        res.driverId,\n        res.points,\n\n        DENSE_RANK() OVER (PARTITION BY res.driverId, r.year ORDER BY r.date) AS SeasonRaceNumber,\n\n        ROW_NUMBER() OVER (PARTITION BY res.driverId ORDER BY r.year, r.date) AS CareerRaceNumber\n    FROM results res\n    JOIN races r ON res.raceId = r.raceId\n    WHERE res.position IS NOT NULL\n),\nDriverFirstFiveRaces AS (\n\n    SELECT\n        driverId,\n        year,\n        raceId,\n        points,\n        SeasonRaceNumber,\n        CareerRaceNumber,\n\n        CASE WHEN CareerRaceNumber = 1 THEN 1\n             WHEN CareerRaceNumber = 2 THEN 2\n             WHEN CareerRaceNumber = 3 THEN 3\n             WHEN CareerRaceNumber = 4 THEN 4\n             WHEN CareerRaceNumber = 5 THEN 5\n             ELSE NULL\n        END AS RacePosition\n    FROM RaceResults\n    WHERE SeasonRaceNumber <= 5\n)\nSELECT\n    d.driverId,\n    d.forename || ' ' || d.surname AS DriverName,\n    MAX(CASE WHEN RacePosition = 1 THEN points END) AS Race1_Points,\n    MAX(CASE WHEN RacePosition = 2 THEN points END) AS Race2_Points,\n    MAX(CASE WHEN RacePosition = 3 THEN points END) AS Race3_Points,\n    MAX(CASE WHEN RacePosition = 4 THEN points END) AS Race4_Points,\n    MAX(CASE WHEN RacePosition = 5 THEN points END) AS Race5_Points,\n\n    year\nFROM DriverFirstFiveRaces r\nJOIN drivers d ON r.driverId = d.driverId\n\nGROUP BY d.driverId, d.forename, d.surname, year\nORDER BY d.surname, d.forename, year;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.19400000000000003,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 6
      }
    }
  },
  {
    "query_idx": 527,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH cte AS\n  (SELECT id,\n          \"Examination D...",
    "valid": true,
    "error": null,
    "duration_ms": 12.11094856262207,
    "input_sql_tokens": 206,
    "estimated_tokens": 328,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH cte AS\n  (SELECT id,\n          \"Examination Date\",\n          thrombosis,\n          risklag = LAG(thrombosis, 1, thrombosis) OVER (PARTITION BY id\n                                                         ORDER BY \"Examination Date\"),\n          rn = ROW_NUMBER() OVER (PARTITION BY id,\n                                               EXTRACT(YEAR FROM \"Examination Date\"),\n                                               EXTRACT(MONTH FROM \"Examination Date\")\n                                  ORDER BY \"Examination Date\" DESC)\n   FROM examination)\nSELECT id,\n       startofmonth = DATE_TRUNC('month', \"Examination Date\")::DATE,\n       increase_risk = CASE\n                           WHEN risklag < thrombosis THEN 'Yes'\n                           ELSE 'No'\n                       END,\n                       decrease_risk = CASE\n                                           WHEN risklag > thrombosis THEN 'Yes'\n                                           ELSE 'No'\n                                       END\nFROM cte\nWHERE rn = 1\n  AND risklag = '0'",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.08700000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-WINDOW-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "ORDER",
          "SELECT",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 528,
    "db_id": "toxicology",
    "sql_snippet": "WITH MoleculeList AS (\n    SELECT unnest(string_to...",
    "valid": true,
    "error": null,
    "duration_ms": 19.214153289794922,
    "input_sql_tokens": 336,
    "estimated_tokens": 455,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH MoleculeList AS (\n    SELECT unnest(string_to_array('TR000,TR001,TR002', ',')) AS molecule_id\n),\nMoleculeStats AS (\n    SELECT\n        m.molecule_id,\n        m.label,\n        COUNT(a.atom_id) AS atom_count,\n        COUNT(DISTINCT b.bond_type) AS unique_bond_types,\n        DENSE_RANK() OVER (ORDER BY COUNT(a.atom_id) DESC) AS size_rank\n    FROM molecule m\n    LEFT JOIN atom a ON m.molecule_id = a.molecule_id\n    LEFT JOIN bond b ON m.molecule_id = b.molecule_id\n    GROUP BY m.molecule_id, m.label\n)\nSELECT\n    ml.molecule_id,\n    ms.label,\n    ms.atom_count,\n    ms.unique_bond_types,\n    CASE\n        WHEN ms.size_rank = 1 THEN 'Largest'\n        WHEN ms.size_rank <= 3 THEN 'Top 3'\n        ELSE 'Other'\n    END AS size_category\nFROM MoleculeList ml\nLEFT JOIN MoleculeStats ms ON ml.molecule_id = ms.molecule_id\nWHERE ms.atom_count > (SELECT AVG(atom_count) FROM MoleculeStats)\n   OR ms.molecule_id IN (SELECT unnest(string_to_array('TR000,TR001', ',')));",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.28,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 3,
        "num_subqueries": 2,
        "num_ctes": 2,
        "num_aggregations": 5
      }
    }
  },
  {
    "query_idx": 529,
    "db_id": "european_football_2",
    "sql_snippet": "WITH KEYWORDMATCHES AS\n  (SELECT P.ID,\n          C...",
    "valid": true,
    "error": null,
    "duration_ms": 25.737762451171875,
    "input_sql_tokens": 409,
    "estimated_tokens": 545,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH KEYWORDMATCHES AS\n  (SELECT P.ID,\n          CASE\n              WHEN POSITION(LOWER('Aaron') IN LOWER(P.PLAYER_NAME)) > 0 THEN 'Aaron'\n          END AS COLAKEYWORD,\n          CASE\n              WHEN POSITION(LOWER('Cresswell') IN LOWER(P.PLAYER_NAME)) > 0 THEN 'Cresswell'\n          END AS COLBKEYWORD,\n          CASE\n              WHEN POSITION(LOWER('Doran') IN LOWER(P.PLAYER_NAME)) > 0 THEN 'Doran'\n          END AS COLCKEYWORD\n   FROM PLAYER AS P),\n     KEYWORDSCORES AS\n  (SELECT ID,\n          STRING_AGG(COLAKEYWORD, ', ') FILTER (WHERE COLAKEYWORD IS NOT NULL) AS KEYWORDSA,\n          STRING_AGG(COLBKEYWORD, ', ') FILTER (WHERE COLBKEYWORD IS NOT NULL) AS KEYWORDSB,\n          STRING_AGG(COLCKEYWORD, ', ') FILTER (WHERE COLCKEYWORD IS NOT NULL) AS KEYWORDSC,\n          SUM(CASE\n                  WHEN COLAKEYWORD IS NOT NULL THEN 10\n                  ELSE 0\n              END) AS COLASCORE,\n          SUM(CASE\n                  WHEN COLBKEYWORD IS NOT NULL THEN 5\n                  ELSE 0\n              END) AS COLBSCORE,\n          SUM(CASE\n                  WHEN COLCKEYWORD IS NOT NULL THEN 0.1\n                  ELSE 0\n              END) AS COLCSCORE\n   FROM KEYWORDMATCHES AS KM\n   GROUP BY ID)\nSELECT DISTINCT P.ID,\n                P.PLAYER_NAME AS DESCRIPTION,\n                (KS.COLASCORE + KS.COLBSCORE + KS.COLCSCORE) AS SCORE\nFROM PLAYER AS P\nINNER JOIN KEYWORDSCORES AS KS ON P.ID = KS.ID\nORDER BY KS.COLASCORE;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.156,
        "pattern_signature": "WITH-CTE-SELECT-DISTINCT-FROM-JOIN-JOIN_INNER-WHERE-GROUP-ORDER-FILTER",
        "clauses_present": [
          "CTE",
          "DISTINCT",
          "FILTER",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 6
      }
    }
  },
  {
    "query_idx": 530,
    "db_id": "california_schools",
    "sql_snippet": "WITH ChangeHistory AS (\n\n    SELECT\n        s.cdsc...",
    "valid": true,
    "error": null,
    "duration_ms": 32.92965888977051,
    "input_sql_tokens": 595,
    "estimated_tokens": 775,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH ChangeHistory AS (\n\n    SELECT\n        s.cdscode,\n        s.school,\n        s.fundingtype,\n        s.lastupdate,\n\n        DENSE_RANK() OVER (PARTITION BY s.cdscode ORDER BY s.lastupdate) AS ChangeSequence,\n\n        CASE WHEN LAG(s.school) OVER (PARTITION BY s.cdscode ORDER BY s.lastupdate) IS NULL\n             OR LAG(s.school) OVER (PARTITION BY s.cdscode ORDER BY s.lastupdate) <> s.school\n             THEN 1 ELSE 0 END AS SchoolChanged,\n        CASE WHEN LAG(s.fundingtype) OVER (PARTITION BY s.cdscode ORDER BY s.lastupdate) IS NULL\n             OR LAG(s.fundingtype) OVER (PARTITION BY s.cdscode ORDER BY s.lastupdate) <> s.fundingtype\n             THEN 1 ELSE 0 END AS FundingTypeChanged\n    FROM schools s\n),\n\nChangesOnly AS (\n    SELECT\n        ch.*,\n        LAG(ch.school) OVER (PARTITION BY ch.cdscode ORDER BY ch.ChangeSequence) AS PreviousSchool,\n        LAG(ch.fundingtype) OVER (PARTITION BY ch.cdscode ORDER BY ch.ChangeSequence) AS PreviousFundingType\n    FROM ChangeHistory ch\n    WHERE ch.SchoolChanged = 1 OR ch.FundingTypeChanged = 1\n)\n\n\nSELECT\n    c.cdscode,\n    'School' AS ColumnName,\n\n    COALESCE(p.school, '') AS OldValue,\n    COALESCE(c.school, '') AS NewValue\nFROM ChangeHistory c\n\nLEFT JOIN ChangeHistory p ON c.cdscode = p.cdscode\n\nWHERE c.SchoolChanged = 1\n  AND (p.ChangeSequence IS NULL OR p.ChangeSequence < c.ChangeSequence)\n\n  GROUP BY c.cdscode, c.school, p.school\n\n  HAVING MAX(p.ChangeSequence) = MAX(c.ChangeSequence - 1)\n\nUNION ALL\n\nSELECT\n    c.cdscode,\n    'FundingType' AS ColumnName,\n\n    COALESCE(p.fundingtype, '') AS OldValue,\n    COALESCE(c.fundingtype, '') AS NewValue\nFROM ChangesOnly c\n\nLEFT JOIN ChangesOnly p ON\n    c.cdscode = p.cdscode AND\n\n    p.ChangeSequence = c.ChangeSequence - 1\nWHERE\n\n    c.FundingTypeChanged = 1 AND\n\n    (p.fundingtype IS NULL OR c.fundingtype IS NULL OR p.fundingtype <> c.fundingtype)\n\nORDER BY\n    cdscode,\n\n    CASE WHEN ColumnName = 'School' THEN 1 ELSE 2 END;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.296,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-GROUP-HAVING-WINDOW-UNION-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "HAVING",
          "JOIN",
          "ORDER",
          "SELECT",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 9
      }
    }
  },
  {
    "query_idx": 531,
    "db_id": "european_football_2",
    "sql_snippet": "WITH CTE AS\n(\n    SELECT\n       pa.id,\n       xml_...",
    "valid": false,
    "error": "Expecting ). Line 5, Col: 39.\n  WITH CTE AS\n(\n    SELECT\n       pa.id,\n       xml_val = XMLPARSE(CONTENT \u001b[4m'<t>'\u001b[0m || REPLACE(pa.player_api_id::text, ',', '</t><t>') || '</t>'),\n       p.player_name as name\n    FRO",
    "duration_ms": 5.7125091552734375,
    "input_sql_tokens": 173,
    "estimated_tokens": 352,
    "error_tokens": 87,
    "invalid_sql_tokens": 173,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_unbalanced_tokens",
          "message": "Expecting ). Line 5, Col: 39.\n  WITH CTE AS\n(\n    SELECT\n       pa.id,\n       xml_val = XMLPARSE(CONTENT \u001b[4m'<t>'\u001b[0m || REPLACE(pa.player_api_id::text, ',', '</t><t>') || '</t>'),\n       p.player_name as name\n    FRO",
          "location": null,
          "context": "Parser reported expecting parenthesis",
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "WITH CTE AS\n(\n    SELECT\n       pa.id,\n       xml_val = XMLPARSE(CONTENT '<t>' || REPLACE(pa.player_api_id::text, ',', '</t><t>') || '</t>'),\n       p.player_name as name\n    FROM player_attributes pa\n    INNER JOIN player p\n       ON ',' || pa.player_api_id::text || ','\n           LIKE '%,' || p.player_api_id::text || ',%'\n)\nSELECT\n    id,\n    name,\n    player_api_id = xpath('text()', col)::VARCHAR(100)\nFROM CTE\nCROSS JOIN LATERAL XMLTABLE('/t' PASSING xml_val COLUMNS col XML PATH '.') AS CA\nLIMIT 10;",
      "tags": [
        "syntax_unbalanced_tokens"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 532,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH t AS\n  (SELECT e.*,\n          ROW_NUMBER() OV...",
    "valid": true,
    "error": null,
    "duration_ms": 11.228084564208984,
    "input_sql_tokens": 273,
    "estimated_tokens": 400,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH t AS\n  (SELECT e.*,\n          ROW_NUMBER() OVER (PARTITION BY e.id\n                             ORDER BY e.\"Examination Date\") AS seqnum\n   FROM examination AS e),\n     cte AS\n  (SELECT t.id,\n          t.\"Examination Date\" AS startdate,\n          t.seqnum,\n          'N' AS isrehire,\n          t.\"Examination Date\" AS anchordate\n   FROM t\n   WHERE t.seqnum = 1\n   UNION ALL SELECT t.id,\n                    t.\"Examination Date\" AS startdate,\n                    t.seqnum,\n                    CASE\n                        WHEN t.\"Examination Date\" > (cte.anchordate + INTERVAL '1 year') THEN 'N'\n                        ELSE 'Y'\n                    END AS isrehire,\n                    CASE\n                        WHEN t.\"Examination Date\" > (cte.anchordate + INTERVAL '1 year') THEN t.\"Examination Date\"\n                        ELSE cte.anchordate\n                    END AS anchordate\n   FROM cte\n   INNER JOIN t ON cte.id = t.id )\nSELECT id,\n       startdate,\n       seqnum,\n       isrehire\nFROM cte\nORDER BY id,\n         startdate;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.106,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-WINDOW-UNION-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "ORDER",
          "SELECT",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 533,
    "db_id": "card_games",
    "sql_snippet": "WITH RECURSIVE T_period_futur AS\n  (SELECT 1 AS Tp...",
    "valid": true,
    "error": null,
    "duration_ms": 7.999658584594727,
    "input_sql_tokens": 234,
    "estimated_tokens": 344,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE T_period_futur AS\n  (SELECT 1 AS Tpf_period_id,\n          CAST('2021-10-25' AS DATE) AS Tpf_start_period\n   UNION ALL SELECT Tpf_period_id + 1 AS Tpf_period_id,\n                    Tpf_start_period + INTERVAL '1 week'\n   FROM T_period_futur\n   WHERE Tpf_period_id < 12 )\nSELECT Tpf_period_id,\n       Tpf_start_period,\n       EXTRACT(YEAR FROM Tpf_start_period) AS Tpf_year,\n       CAST(EXTRACT(YEAR FROM Tpf_start_period) AS VARCHAR) || '.' || RIGHT('00' || CAST(EXTRACT(WEEK FROM Tpf_start_period) AS VARCHAR), 2) AS Tpf_period_number,\n       Tpf_start_period + INTERVAL '6 days' AS Tpf_end_period\nFROM T_period_futur;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.061000000000000006,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-UNION",
        "clauses_present": [
          "CTE",
          "FROM",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 534,
    "db_id": "financial",
    "sql_snippet": "DO $$ DECLARE _info TEXT := '{\"client_id\":1,\"gende...",
    "valid": true,
    "error": null,
    "duration_ms": 3.0279159545898438,
    "input_sql_tokens": 185,
    "estimated_tokens": 257,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DO $$ DECLARE _info TEXT := '{\"client_id\":1,\"gender\":\"F\"}'; _output_info TEXT; BEGIN BEGIN DECLARE _info_jsonb JSONB := _info::jsonb; BEGIN IF _info_jsonb ?? 'gender' AND (_info_jsonb ->> 'gender') = 'F' THEN _info_jsonb := jsonb_set(_info_jsonb, '{gender}', '\"M\"'::jsonb); END IF; _output_info := _info_jsonb::text; END; EXCEPTION WHEN others THEN _output_info := '{\"error\": \"Invalid operation\"}'; END; CREATE TEMP TABLE IF NOT EXISTS _json_update_result (info TEXT); TRUNCATE TABLE _json_update_result; INSERT INTO _json_update_result (info) VALUES (_output_info); END $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 535,
    "db_id": "financial",
    "sql_snippet": "SELECT info FROM _json_update_result;",
    "valid": true,
    "error": null,
    "duration_ms": 1.7447471618652344,
    "input_sql_tokens": 11,
    "estimated_tokens": 100,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT info FROM _json_update_result;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM",
        "clauses_present": [
          "FROM",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 536,
    "db_id": "student_club",
    "sql_snippet": "DROP TABLE IF EXISTS \"EventCategories\";",
    "valid": true,
    "error": null,
    "duration_ms": 1.177072525024414,
    "input_sql_tokens": 9,
    "estimated_tokens": 94,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DROP TABLE IF EXISTS \"EventCategories\";",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 537,
    "db_id": "student_club",
    "sql_snippet": "CREATE TABLE \"EventCategories\"( \"ID\" INT GENERATED...",
    "valid": true,
    "error": null,
    "duration_ms": 1.7495155334472656,
    "input_sql_tokens": 26,
    "estimated_tokens": 111,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TABLE \"EventCategories\"( \"ID\" INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY, \"IsBusinessCategory\" BOOLEAN NULL );",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 538,
    "db_id": "student_club",
    "sql_snippet": "DROP TABLE IF EXISTS \"BusinessCategories\";",
    "valid": true,
    "error": null,
    "duration_ms": 1.1723041534423828,
    "input_sql_tokens": 9,
    "estimated_tokens": 94,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DROP TABLE IF EXISTS \"BusinessCategories\";",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 539,
    "db_id": "student_club",
    "sql_snippet": "CREATE TABLE \"BusinessCategories\"( \"ID\" INT GENERA...",
    "valid": true,
    "error": null,
    "duration_ms": 2.5916099548339844,
    "input_sql_tokens": 35,
    "estimated_tokens": 121,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE TABLE \"BusinessCategories\"( \"ID\" INT GENERATED ALWAYS AS IDENTITY PRIMARY KEY, \"BusinessCategoryID\" INT NOT NULL REFERENCES \"EventCategories\"(\"ID\") );",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.020000000000000004,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 540,
    "db_id": "financial",
    "sql_snippet": "SELECT SPLIT_PART(CAST(amount AS TEXT) || ',' || C...",
    "valid": true,
    "error": null,
    "duration_ms": 7.787227630615234,
    "input_sql_tokens": 121,
    "estimated_tokens": 199,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT SPLIT_PART(CAST(amount AS TEXT) || ',' || CAST(balance AS TEXT) || ',' || CAST(account AS TEXT), ',', 1) as value1, SPLIT_PART(CAST(amount AS TEXT) || ',' || CAST(balance AS TEXT) || ',' || CAST(account AS TEXT), ',', 2) as value2, SPLIT_PART(CAST(amount AS TEXT) || ',' || CAST(balance AS TEXT) || ',' || CAST(account AS TEXT), ',', 3) as value3 FROM trans WHERE trans_id = 1",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.017,
        "pattern_signature": "SELECT-FROM-WHERE",
        "clauses_present": [
          "FROM",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 541,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT ID, value FROM PATIENT CROSS JOIN LATERAL s...",
    "valid": true,
    "error": null,
    "duration_ms": 2.5310516357421875,
    "input_sql_tokens": 42,
    "estimated_tokens": 140,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT ID, value FROM PATIENT CROSS JOIN LATERAL string_to_table(DIAGNOSIS, ',') AS s(value) WHERE DIAGNOSIS = 'SLE' || '; DROP TABLE PATIENT; --';",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.042,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_CROSS-LATERAL-WHERE",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_CROSS",
          "LATERAL",
          "SELECT",
          "WHERE"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 542,
    "db_id": "card_games",
    "sql_snippet": "WITH data1 AS ( SELECT originalreleasedate, (date_...",
    "valid": true,
    "error": null,
    "duration_ms": 9.664058685302734,
    "input_sql_tokens": 251,
    "estimated_tokens": 345,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH data1 AS ( SELECT originalreleasedate, (date_trunc('week', to_date(originalreleasedate, 'YYYY-MM-DD') + interval '1 day') - interval '1 day')::date AS start_of_week_mon, floor((to_date(originalreleasedate, 'YYYY-MM-DD') - DATE '2007-01-01') / 7)::int + 1 AS week_number FROM cards WHERE originalreleasedate IS NOT NULL AND to_date(originalreleasedate, 'YYYY-MM-DD') >= DATE '2007-01-01' ), weekly_data AS ( SELECT start_of_week_mon, week_number FROM data1 ) SELECT start_of_week_mon AS actual_start_of_week, (DATE '2007-01-01' + (week_number - 1) * INTERVAL '1 week')::date AS calculated_start_of_week, COUNT(*) AS card_count FROM weekly_data GROUP BY start_of_week_mon, week_number ORDER BY calculated_start_of_week;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.097,
        "pattern_signature": "WITH-CTE-SELECT-FROM-WHERE-GROUP-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 543,
    "db_id": "student_club",
    "sql_snippet": "SELECT e.\"first_name\" || ' ' || e.\"last_name\" AS e...",
    "valid": true,
    "error": null,
    "duration_ms": 3.545522689819336,
    "input_sql_tokens": 57,
    "estimated_tokens": 158,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT e.\"first_name\" || ' ' || e.\"last_name\" AS email_full_name, e.email, p.position FROM member_email AS e INNER JOIN member_position AS p ON email_full_name = p.full_name",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.045000000000000005,
        "pattern_signature": "SELECT-FROM-JOIN-JOIN_INNER",
        "clauses_present": [
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "SELECT"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 544,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "SELECT COUNT(motherGroups.Mothers) AS UniqueMother...",
    "valid": true,
    "error": null,
    "duration_ms": 3.823995590209961,
    "input_sql_tokens": 53,
    "estimated_tokens": 156,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT COUNT(motherGroups.Mothers) AS UniqueMotherGroups FROM\n(SELECT STRING_AGG(CAST(c.id AS VARCHAR), '') WITHIN GROUP (ORDER BY c.id) AS Mothers FROM laboratory c GROUP BY c.id) AS motherGroups",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.09800000000000002,
        "pattern_signature": "SELECT-FROM-GROUP-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "SUBQUERY"
        ],
        "num_joins": 0,
        "num_subqueries": 1,
        "num_ctes": 0,
        "num_aggregations": 2
      }
    }
  },
  {
    "query_idx": 545,
    "db_id": "european_football_2",
    "sql_snippet": "DO $$\nDECLARE\n    StartDate timestamp;\n    EndDate...",
    "valid": true,
    "error": null,
    "duration_ms": 1.9543170928955078,
    "input_sql_tokens": 92,
    "estimated_tokens": 167,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DO $$\nDECLARE\n    StartDate timestamp;\n    EndDate timestamp;\nBEGIN\n    StartDate := '2010-02-22 00:00:00';\n    EndDate := '2010-02-22 23:59:59';\n\n    SELECT *\n    FROM team_attributes\n    WHERE date BETWEEN StartDate AND EndDate;\nEND $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 546,
    "db_id": "financial",
    "sql_snippet": "WITH PaymentRanks AS (SELECT payments, ROW_NUMBER(...",
    "valid": false,
    "error": "Required keyword: 'expression' missing for <class 'sqlglot.expressions.And'>. Line 1, Col: 436.\n  UNT(*) FROM loan) <= 2 THEN NULL WHEN (SELECT distinct_payment_count FROM distinctpayments) = 1 AND \u001b[4mWHERE\u001b[0m payments IS NOT NULL THEN NULL ELSE (SELECT payments FROM paymentranks WHERE row_num = 1) END AS Se",
    "duration_ms": 11.162519454956055,
    "input_sql_tokens": 138,
    "estimated_tokens": 308,
    "error_tokens": 96,
    "invalid_sql_tokens": 138,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_keyword_misuse",
          "message": "Required keyword: 'expression' missing for <class 'sqlglot.expressions.And'>. Line 1, Col: 436.\n  UNT(*) FROM loan) <= 2 THEN NULL WHEN (SELECT distinct_payment_count FROM distinctpayments) = 1 AND \u001b[4mWHERE\u001b[0m payments IS NOT NULL THEN NULL ELSE (SELECT payments FROM paymentranks WHERE row_num = 1) END AS Se",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "WITH PaymentRanks AS (SELECT payments, ROW_NUMBER() OVER (ORDER BY payments DESC NULLS LAST) AS row_num, DENSE_RANK() OVER (ORDER BY payments DESC NULLS LAST) AS dense_rank_num, COUNT(*) OVER () AS total_count FROM loan), DistinctPayments AS (SELECT COUNT( payments) AS distinct_payment_count FROM loan) SELECT CASE WHEN (SELECT COUNT(*) FROM loan) <= 2 THEN NULL WHEN (SELECT distinct_payment_count FROM distinctpayments) = 1 AND WHERE payments IS NOT NULL THEN NULL ELSE (SELECT payments FROM paymentranks WHERE row_num = 1) END AS SecondHighest",
      "tags": [
        "syntax_keyword_misuse"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 547,
    "db_id": "formula_1",
    "sql_snippet": "CREATE OR REPLACE FUNCTION insert_race_name()\nRETU...",
    "valid": true,
    "error": null,
    "duration_ms": 2.397775650024414,
    "input_sql_tokens": 78,
    "estimated_tokens": 170,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "CREATE OR REPLACE FUNCTION insert_race_name()\nRETURNS TRIGGER AS $$\nBEGIN\nINSERT INTO race_names(race_name)\nVALUES ('New Race');\n RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER insert_race_name_trigger\nAFTER INSERT ON races\nFOR EACH STATEMENT\nEXECUTE FUNCTION insert_race_name();",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 548,
    "db_id": "formula_1",
    "sql_snippet": "INSERT INTO races (raceid, year, round, circuitid,...",
    "valid": false,
    "error": "Invalid expression / Unexpected token. Line 3, Col: 15.\n  VALUES (-1, 2009, 1, 10, 'New Test Race', '2009-07-15', '12:00:00', 'https://example.com')\nRETURNIG \u001b[4mraceid\u001b[0m, year, round, circuitid, name, date, time, url;",
    "duration_ms": 4.716634750366211,
    "input_sql_tokens": 98,
    "estimated_tokens": 273,
    "error_tokens": 101,
    "invalid_sql_tokens": 98,
    "validation_output": {
      "valid": false,
      "errors": [
        {
          "tag": "syntax_invalid_token",
          "message": "Invalid expression / Unexpected token. Line 3, Col: 15.\n  VALUES (-1, 2009, 1, 10, 'New Test Race', '2009-07-15', '12:00:00', 'https://example.com')\nRETURNIG \u001b[4mraceid\u001b[0m, year, round, circuitid, name, date, time, url;",
          "location": null,
          "context": null,
          "error_code": null,
          "taxonomy_category": "syntax",
          "affected_clauses": []
        }
      ],
      "sql": "INSERT INTO races (raceid, year, round, circuitid, name, date, time, url)\nVALUES (-1, 2009, 1, 10, 'New Test Race', '2009-07-15', '12:00:00', 'https://example.com')\nRETURNIG raceid, year, round, circuitid, name, date, time, url;",
      "tags": [
        "syntax_invalid_token"
      ],
      "query_metadata": null
    }
  },
  {
    "query_idx": 549,
    "db_id": "student_club",
    "sql_snippet": "SELECT 'budget_seq' FROM budget LIMIT 10",
    "valid": true,
    "error": null,
    "duration_ms": 1.7557144165039062,
    "input_sql_tokens": 13,
    "estimated_tokens": 106,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT 'budget_seq' FROM budget LIMIT 10",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.010000000000000002,
        "pattern_signature": "SELECT-FROM-LIMIT",
        "clauses_present": [
          "FROM",
          "LIMIT",
          "SELECT"
        ],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 550,
    "db_id": "financial",
    "sql_snippet": "WITH\n        spell_starts AS (\n            SELECT ...",
    "valid": true,
    "error": null,
    "duration_ms": 21.321773529052734,
    "input_sql_tokens": 546,
    "estimated_tokens": 709,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH\n        spell_starts AS (\n            SELECT start_date, end_date\n            FROM blackout_periods s1\n            WHERE NOT EXISTS (\n                SELECT 1\n                FROM blackout_periods s2\n                WHERE s2.start_date < s1.start_date\n                AND s1.start_date <= s2.end_date\n            )\n        ),\n        spell_ends AS (\n            SELECT start_date, end_date\n            FROM blackout_periods t1\n            WHERE NOT EXISTS (\n                SELECT 1\n                FROM blackout_periods t2\n                WHERE t2.start_date <= t1.end_date\n                AND t1.end_date < t2.end_date\n            )\n        )\n        SELECT s.start_date, MIN(e.end_date) as end_date\n        FROM spell_starts s\n        INNER JOIN spell_ends e\n        ON s.start_date <= e.end_date\n        GROUP BY s.start_date;\n\n\n        SELECT start_date, end_date\n        FROM (\n            SELECT (end_date + INTERVAL '1 day') AS start_date\n                ,LEAD((start_date - INTERVAL '1 day'), 1, '9999-01-01'::date) OVER (ORDER BY start_date) AS end_date\n            FROM merge_table_2\n\n            UNION ALL\n\n\n            SELECT '1900-01-01'::date AS start_date\n                ,(MIN(start_date) - INTERVAL '1 day') AS end_date\n            FROM merge_table_2\n        ) k\n        WHERE start_date <= end_date\n        AND '1900-01-01'::date <= start_date\n        AND end_date <= '9999-01-01'::date;\n\n\n        SELECT CASE WHEN t1.start_date < t2.start_date THEN t2.start_date ELSE t1.start_date END AS start_date\n            ,CASE WHEN t1.end_date < t2.end_date THEN t1.end_date ELSE t2.end_date END AS end_date\n        FROM table_1 t1\n        INNER JOIN inverse_merge_table_2 t2\n        ON t1.start_date < t2.end_date\n        AND t2.start_date < t1.end_date;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.15300000000000002,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-GROUP",
        "clauses_present": [
          "CTE",
          "FROM",
          "GROUP",
          "JOIN",
          "JOIN_INNER",
          "SELECT",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 551,
    "db_id": "european_football_2",
    "sql_snippet": "DO $$\nDECLARE\n    batch INT := 10000;\nBEGIN\n    WH...",
    "valid": true,
    "error": null,
    "duration_ms": 2.9480457305908203,
    "input_sql_tokens": 86,
    "estimated_tokens": 160,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "DO $$\nDECLARE\n    batch INT := 10000;\nBEGIN\n    WHILE batch > 0 LOOP\n        BEGIN\n            START TRANSACTION;\n            INSERT INTO player_stats\n            SELECT * FROM player_stats_temp\n            LIMIT batch;\n            GET DIAGNOSTICS batch = ROW_COUNT;\n            COMMIT;\n        END;\n    END LOOP;\nEND $$;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.0,
        "pattern_signature": "UNKNOWN",
        "clauses_present": [],
        "num_joins": 0,
        "num_subqueries": 0,
        "num_ctes": 0,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 552,
    "db_id": "formula_1",
    "sql_snippet": "SELECT DriverId, MIN(StartDate) AS StartDate, MAX(...",
    "valid": true,
    "error": null,
    "duration_ms": 9.699344635009766,
    "input_sql_tokens": 113,
    "estimated_tokens": 225,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "SELECT DriverId, MIN(StartDate) AS StartDate, MAX(EndDate) AS EndDate\nFROM (SELECT *,\nSUM(CASE WHEN a.EndDate = a.StartDate THEN 0 ELSE 1 END) OVER (ORDER BY DriverId, StartDate) sm\nFROM (SELECT DriverId, StartDate, EndDate,\nLAG(EndDate, 1, NULL) OVER (PARTITION BY DriverId ORDER BY DriverId, EndDate) prev_EndDate\nFROM driverContracts) a\n) b\nGROUP BY DriverId, sm;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.18600000000000003,
        "pattern_signature": "SELECT-FROM-GROUP-WINDOW-ORDER-SUBQUERY",
        "clauses_present": [
          "FROM",
          "GROUP",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "WINDOW"
        ],
        "num_joins": 0,
        "num_subqueries": 2,
        "num_ctes": 0,
        "num_aggregations": 4
      }
    }
  },
  {
    "query_idx": 553,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH RECURSIVE ExpCTE AS (\nSELECT\nDENSE_RANK() OVE...",
    "valid": true,
    "error": null,
    "duration_ms": 14.864206314086914,
    "input_sql_tokens": 300,
    "estimated_tokens": 454,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE ExpCTE AS (\nSELECT\nDENSE_RANK() OVER (ORDER BY exp_id) AS ExpRN\n, exp_id\n, mid\n, qty\nFROM\nExperiment WHERE mid = 2\n)\n, CTE AS\n(\nSELECT\ne.exp_id\n, e.mid\n, e.qty\n, i.qty - e.qty AS QtyAvailable\n, e.ExpRN\nFROM\nExpCTE e\nINNER JOIN\nInventory i ON i.mid = e.mid\nWHERE\ne.exp_id IN (SELECT e_sub.exp_id\nFROM Experiment e_sub\nWHERE NOT EXISTS (SELECT 1 FROM Inventory i_sub\nWHERE i_sub.mid = e_sub.mid AND i_sub.qty < e_sub.qty)\nORDER BY e_sub.exp_id\nLIMIT 1)\nAND e.mid = 2\nUNION ALL\nSELECT\ne.exp_id\n, e.mid\n, e.qty\n, c.QtyAvailable - e.qty\n, e.ExpRN\nFROM\nExpCTE e\nINNER JOIN\nCTE c ON c.ExpRN + 1 = e.ExpRN AND c.mid = e.mid\nWHERE\ne.qty <= c.QtyAvailable\n)\nSELECT exp_id, mid, qty, QtyAvailable, ExpRN\nFROM CTE;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.281,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-JOIN_INNER-WHERE-WINDOW-UNION-ORDER-LIMIT-SUBQUERY",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "JOIN_INNER",
          "LIMIT",
          "ORDER",
          "SELECT",
          "SUBQUERY",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 2,
        "num_subqueries": 1,
        "num_ctes": 2,
        "num_aggregations": 1
      }
    }
  },
  {
    "query_idx": 554,
    "db_id": "debit_card_specializing",
    "sql_snippet": "WITH RECURSIVE vt as (\nselect t.*, row_number() ov...",
    "valid": true,
    "error": null,
    "duration_ms": 15.898942947387695,
    "input_sql_tokens": 236,
    "estimated_tokens": 363,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE vt as (\nselect t.*, row_number() over (partition by CustomerID order by StartDate) as seqnum\nfrom transactions_1k t\n),\ncte as (\nselect vt.TransactionID, vt.CustomerID, vt.StartDate, vt.EndDate, vt.StartDate as first_begin_date, seqnum\nfrom vt\nwhere seqnum = 1\nunion all\nselect vt.TransactionID, vt.CustomerID, vt.StartDate, vt.EndDate,\n(case when vt.StartDate > (cte.EndDate + interval '90 days') then vt.StartDate else cte.EndDate end),\nvt.seqnum\nfrom cte join\nvt\non vt.seqnum = cte.seqnum + 1 and vt.CustomerID = cte.CustomerID\n)\nselect cte.TransactionID, cte.CustomerID, cte.StartDate, cte.EndDate,\n(case when first_begin_date = StartDate then 0 else 1 end) as flag\nfrom cte\norder by cte.CustomerID, cte.StartDate;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.11599999999999999,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-WINDOW-UNION-ORDER",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "ORDER",
          "SELECT",
          "UNION",
          "WHERE",
          "WINDOW",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 2,
        "num_aggregations": 0
      }
    }
  },
  {
    "query_idx": 555,
    "db_id": "thrombosis_prediction",
    "sql_snippet": "WITH RECURSIVE cte AS (\nSELECT ID, ParentID\nFROM L...",
    "valid": true,
    "error": null,
    "duration_ms": 5.689382553100586,
    "input_sql_tokens": 90,
    "estimated_tokens": 205,
    "error_tokens": 0,
    "invalid_sql_tokens": 0,
    "validation_output": {
      "valid": true,
      "errors": [],
      "sql": "WITH RECURSIVE cte AS (\nSELECT ID, ParentID\nFROM LaboratoryLink\nWHERE ID IN (657266, 115562)\nUNION ALL\nSELECT t.ID, t.ParentID\nFROM LaboratoryLink t\nJOIN cte c ON t.ID = c.ParentID\nWHERE t.ParentID IS NOT NULL\n)\nSELECT *\nFROM cte;",
      "tags": [],
      "query_metadata": {
        "complexity_score": 0.10300000000000001,
        "pattern_signature": "WITH-CTE-SELECT-FROM-JOIN-WHERE-UNION",
        "clauses_present": [
          "CTE",
          "FROM",
          "JOIN",
          "SELECT",
          "UNION",
          "WHERE",
          "WITH"
        ],
        "num_joins": 1,
        "num_subqueries": 0,
        "num_ctes": 1,
        "num_aggregations": 0
      }
    }
  }
]